<!DOCTYPE html>
<html>
	<head>
	</head>
	<body>
        <script>
            function main_script() {
                alert("hi");
                setMyTimeout(function () {
                    alert("blabla");
                }, 100);
                for (var i = 0; i < 1000000000; ++i ) {}
                alert("tt");
            }
        </script>
		<script>
            var scripts = [main_script];
            var message_queue = [];

            function getTime() {
                var d = new Date();
                return d.getTime();
            }

            function setMyTimeout(f, ms) {
                message_queue.push({
                   func: f,
                   execution_time: getTime() + ms
                });
            }

            for (var i = 0; i < scripts.length; ++i)
                scripts[i]();
            while (message_queue.length > 0) {
                var old_messages = message_queue;
                message_queue = [];
                for (var i = 0; i < old_messages.length; ++i) {
                    var message = old_messages[i];
                    if (message.execution_time <= getTime()) {
                        message.func();
                    } else {
                        message_queue.push(message);
                    }
                }
            }
		</script>
	</body>
</html>