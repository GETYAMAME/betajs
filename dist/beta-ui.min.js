/*! betajs - v0.0.1 - 2013-03-21, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */BetaJS.Templates={tokenize:function(t){if(BetaJS.Types.is_array(t))return t;var e=[],i=0;return t.replace(BetaJS.Templates.SYNTAX_REGEX(),function(s,n,r,a,_,o){return o>i+1&&e.push({type:BetaJS.Templates.TOKEN_STRING,data:BetaJS.Strings.js_escape(t.slice(i,o))}),_&&e.push({type:BetaJS.Templates.TOKEN_CODE,data:_}),n&&e.push({type:BetaJS.Templates.TOKEN_EXPR,data:n}),a&&e.push({type:BetaJS.Templates.TOKEN_INT,data:a}),r&&e.push({type:BetaJS.Templates.TOKEN_ESC,data:r}),i=o+s.length,s}),e},compile:function(source,options){BetaJS.Types.is_string(source)&&(source=this.tokenize(source)),options=options||{};for(var callbacks=options.callbacks||{},start_index=options.start_index||0,end_index=options.end_index||source.length,result="__p+='",i=start_index;end_index>i;++i)switch(source[i].type){case BetaJS.Templates.TOKEN_STRING:result+=source[i].data;break;case BetaJS.Templates.TOKEN_CODE:result+="';\n"+source[i].data+"\n__p+='";break;case BetaJS.Templates.TOKEN_EXPR:result+="'+\n((__t=("+source[i].data+"))==null?'':__t)+\n'";break;case BetaJS.Templates.TOKEN_ESC:result+="'+\n((__t=("+source[i].data+"))==null?'':BetaJS.Strings.htmlentities(__t))+\n'";break;case BetaJS.Templates.TOKEN_INT:with(callbacks){var ret=eval(source[i].data);BetaJS.Types.is_defined(ret)&&(result+=BetaJS.Strings.js_escape(ret))}}result+="';\n",result="with(obj||{}){\n"+result+"}\n",result="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+result+"return __p;\n";var func=Function("obj",result),func_call=function(t){return func.call(this,t)};return func_call.source="function(obj){\n"+result+"}",func_call}},BetaJS.Templates.SYNTAX={OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-",MODIFIER_INT:"!"},BetaJS.Templates.SYNTAX_REGEX=function(){var t=BetaJS.Templates.SYNTAX;return BetaJS.Templates.SYNTAX_REGEX_CACHED||(BetaJS.Templates.SYNTAX_REGEX_CACHED=RegExp(t.OPEN+t.MODIFIER_EXPR+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_ESC+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_INT+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_CODE+"([\\s\\S]+?)"+t.CLOSE+"|"+"$","g")),BetaJS.Templates.SYNTAX_REGEX_CACHED},BetaJS.Templates.TOKEN_STRING=1,BetaJS.Templates.TOKEN_CODE=2,BetaJS.Templates.TOKEN_EXPR=3,BetaJS.Templates.TOKEN_ESC=4,BetaJS.Templates.TOKEN_INT=5,BetaJS.Templates=BetaJS.Templates||{},BetaJS.Templates.Template=BetaJS.Class.extend("Template",{constructor:function(t){this._inherited(BetaJS.Templates.Template,"constructor"),this.__tokens=BetaJS.Templates.tokenize(t),this.__compiled=BetaJS.Templates.compile(this.__tokens)},evaluate:function(){return this.__compiled.apply(this,arguments)}},{bySelector:function(t){return new BetaJS.Templates.Template($(t).html())}}),BetaJS.Views=BetaJS.Views||{},BetaJS.Views.View=BetaJS.Class.extend("View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Ids.ClientIdMixin,{_templates:function(){return{}},_events:function(){return[]},_render:function(){this.__render_string?this.$el.html(this.__render_string):this.__templates["default"]&&this.$el.html(this.__templates["default"].evaluate(this.__properties.getAll()))},getTemplate:function(t){return this.__templates[t]},_setOption:function(t,e,i,s){var s=s?s:"__";this[s+e]=e in t?t[e]:i},_setOptionProperty:function(t,e,i){this.set(e,e in t?t[e]:i)},constructor:function(t){this._inherited(BetaJS.Views.View,"constructor"),this._setOption(t,"el",null),this._setOption(t,"visible",!0),this._setOption(t,"render_string",null),this._setOption(t,"events",[]),this._setOption(t,"attributes",{}),this.__old_attributes={},this._setOption(t,"css_classes",[]),this.__added_css_classes=[],this._setOption(t,"css_styles",{}),this.__old_css_styles={},this.__parent=null,this.__children={},this.__active=!1,this.$el=null,this.__events=this._events().concat(this.__events);var e=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,t.templates||{});"template"in t&&(e["default"]=t.template),this.__templates={};for(var i in e)this.__templates[i]=BetaJS.Types.is_string(e[i])?new BetaJS.Templates.Template(e[i]):new BetaJS.Templates.Template(e[i].html());this.__properties=new BetaJS.Events.Properties(t.properties||{}),this._setOption(t,"objects",{})},get:function(t){return this.__properties.get(t)},set:function(t,e){this.__properties.set(t,e)},isActive:function(){return this.__active},activate:function(){if(this.isActive())return!0;if(!this.__el)return!1;if(this.__parent&&!this.__parent.isActive())return!1;if(this.$el=this.__parent?this.__parent.$(this.__el):$(this.__el),0==this.$el.size()&&(this.$el=null),!this.$el)return!1;this.__old_attributes={};for(var t in this.__attributes){var e=this.$el.attr(t);this.__old_attributes[t]=BetaJS.Types.is_defined(e)?e:null,this.$el.attr(t,this.__attributes[t])}this.__added_css_classes=[];for(var i;this.__css_classes>i;++i)this.$el.hasClass(this.__css_classes[i])||(this.$el.addClass(this.__css_classes[i]),this.__added_css_classes.push(this.__css_classes[i]));this.__old_css_styles={};for(var t in this.__css_styles){var e=this.$el.css(t);this.__old_css_styles[t]=BetaJS.Types.is_defined(e)?e:null,this.$el.css(t,this.__css_styles[t])}return this.__bind(),this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),BetaJS.Objs.iter(this.__children,function(t){t.activate()}),!0},deactivate:function(){if(!this.isActive())return!1;BetaJS.Objs.iter(this.__children,function(t){t.deactivate()}),this.__active=!1,this.__unbind(),this.$el.html("");for(var t in this.__old_attributes)this.$el.attr(t,this.__old_attributes[t]);for(var e;this.__added_css_classes>e;++e)this.$el.removeClass(this.__added_css_classes[e]);for(var t in this.__old_css_styles)this.$el.css(t,this.__old_css_styles[t]);return this.$el=null,!0},$:function(t){return this.$el.find(t)},$data:function(t,e){return this.$("[data-"+t+"='"+e+"']")},destroy:function(){this.deactivate(),BetaJS.Objs.iter(this.__children,function(t){t.destroy()}),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},setVisibility:function(t){t!=this.__visible&&(this.__visible=t,this.isActive()&&this.$el.css("display",this.__visible?"":"none"))},__bind:function(){var t=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(e){BetaJS.Objs.iter(e,function(e,i){var s=t[e],n=i.match(BetaJS.Views.BIND_EVENT_SPLITTER),r=n[1],a=n[2];r=r+".events"+t.cid();var _=BetaJS.Functions.as_method(s,t);""===a?t.$el.on(r,_):t.$el.on(r,a,_)})})},__unbind:function(){this.$el.off(".events"+this.cid())},__render:function(){this.isActive()&&this._render()},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(t){t.deactivate()}),this.__render(),BetaJS.Objs.iter(this.__children,function(t){t.activate()}))},setEl:function(t){this.isActive()?(this.deactivate(),this.__el=t,this.activate()):this.__el=t},getParent:function(){return this.__parent},hasChild:function(t){return t&&t.cid()in this.__children},setParent:function(t){if(t!=this.__parent){if(this.deactivate(),this.__parent){var e=this.__parent;this.__parent=null,e.removeChild(this)}t&&(this.__parent=t,t.addChild(this),t.isActive()&&this.activate())}},children:function(){return BetaJS.Objs.values(this.__children)},addChildren:function(t){BetaJS.Objs.iter(t,function(t){this.addChild(t)},this)},addChild:function(t){return this.hasChild(t)?null:(this.__children[t.cid()]=t,this._notify("addChild",t),t.setParent(this),t)},removeChildren:function(t){BetaJS.Objs.iter(t,function(t){this.removeChild(t)},this)},removeChild:function(t){this.hasChild(t)&&(delete this.__children[t.cid()],t.setParent(null),this._notify("removeChild",t))}}]),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="<div data-selector=\"right\" class='holygrail-right-container'></div><div data-selector=\"left\" class='holygrail-left-container'></div><div data-selector=\"center\" class='holygrail-center-container'></div>",BetaJS.Templates.Cached["list-container-view-item-template"]='<div data-view-id="{%= cid %}" class="list-container-item"></div>',BetaJS.Templates.Cached["button-view-template"]="<button>{%= label %}</button>",BetaJS.Views.HolygrailView=BetaJS.Views.View.extend("HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.HolygrailView,"constructor",t),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(t){this.__setView("left",t)},getCenter:function(){return this.__center},setCenter:function(t){this.__setView("center",t)},getRight:function(){return this.__right},setRight:function(t){this.__setView("right",t)},__setView:function(t,e){this.removeChild(this["__"+t]),this["__"+t]=null,e&&(e.setEl('[data-selector="'+t+'"]'),this["__"+t]=this.addChild(e))}}),BetaJS.Views.ListContainerView=BetaJS.Views.View.extend("ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(t){this.__addChildContainer(t)},this)},__addChildContainer:function(t){this.isActive()&&this.$el.append(this.getTemplate("item").evaluate({cid:t.cid()})),t.setEl("[data-view-id='"+t.cid()+"']")},__removeChildContainer:function(t){this.$data("view-id",t.cid()).remove()}}),BetaJS.Views.ButtonView=BetaJS.Views.View.extend("ButtonView",{_templates:{"default":BetaJS.Templates.Cached["button-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.ButtonView,"constructor",t),this._setOptionProperty(t,"label","")},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click button":"__clickButton"}])},__clickButton:function(){this.trigger("clicked")}});