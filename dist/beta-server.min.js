/*! betajs - v0.0.1 - 2013-08-12, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};"undefined"!=typeof module&&"exports"in module&&(module.exports=BetaJS),BetaJS.Types={is_object:function(t){return"object"==typeof t},is_array:function(t){return"[object Array]"===Object.prototype.toString.call(t)},is_undefined:function(t){return t===void 0},is_null:function(t){return null==t},is_none:function(t){return this.is_undefined(t)||this.is_null(t)},is_defined:function(t){return t!==void 0},is_empty:function(t){if(this.is_none(t))return!0;if(this.is_array(t))return 0==t.length;if(this.is_object(t)){for(var e in t)return!1;return!0}return!1},is_string:function(t){return"string"==typeof t},is_function:function(t){return"function"==typeof t},is_boolean:function(t){return"boolean"==typeof t},compare:function(t,e){if(BetaJS.Types.is_boolean(t)&&BetaJS.Types.is_boolean(e))return t==e?0:t?1:-1;if(BetaJS.Types.is_array(t)&&BetaJS.Types.is_array(e)){for(var i=t.length,n=e.length,s=Math.min(i,n),r=0;s>r;++r){var _=this.compare(t[r],e[r]);if(0!=_)return _}return i==n?0:i>n?1:-1}return t.localeCompare(e)}},BetaJS.Strings={nl2br:function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(t){var e=this;return t.replace(this.JS_ESCAPER_REGEX(),function(t){return"\\"+e.JS_ESCAPES[t]})},starts_with:function(t,e){return t.substring(0,e.length)==e},strip_start:function(t,e){return this.starts_with(t,e)?t.substring(e.length):t}},BetaJS.Functions={as_method:function(t,e){return function(){return t.apply(e,arguments)}},once:function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}},BetaJS.Scopes={resolve:function(t,e){if(!BetaJS.Types.is_string(t))return t;for(var i=e||window||global,n=t.split("."),s=0;n.length>s;++s)i=i[n[s]];return i}},BetaJS.Objs={clone:function(t,e){return!e||0>=e?t:BetaJS.Types.is_array(t)?t.slice(0):BetaJS.Types.is_object(t)?this.extend({},t,e-1):t},extend:function(t,e,i){for(var n in e)t[n]=this.clone(e[n],i);return t},keys:function(t,e){if(BetaJS.Types.is_undefined(e)){var i=[];for(var n in t)i.push(n);return i}var i={};for(var n in t)i[n]=e;return i},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},filter:function(t,e,i){if(BetaJS.Types.is_array(t)){for(var n=[],s=0;t.length>s;++s)(i?e.apply(i,[t[s],s]):e(t[s],s))&&n.push(t[s]);return n}var n={};for(var r in t)(i?e.apply(i,[t[r],r]):e(t[r],r))&&(n[r]=t[r]);return n},equals:function(t,e,i){if(i&&i>0){for(var n in t)if(!n in e||!this.equals(t[n],e[n],i-1))return!1;for(var n in e)if(!n in t)return!1;return!0}return t==e},iter:function(t,e,i){if(BetaJS.Types.is_array(t))for(var n=0;t.length>n;++n){var s=i?e.apply(i,[t[n],n]):e(t[n],n);if(BetaJS.Types.is_defined(s)&&!s)return}else for(var r in t){var s=i?e.apply(i,[t[r],r]):e(t[r],r);if(BetaJS.Types.is_defined(s)&&!s)return}},intersect:function(t,e){var i={};for(var n in t)n in e&&(i[n]=t[n]);return i},contains_key:function(t,e){return BetaJS.Types.is_array(t)?BetaJS.Types.is_defined(t[e]):e in t},contains_value:function(t,e){if(BetaJS.Types.is_array(t)){for(var i=0;t.length>i;++i)if(t[i]===e)return!0}else for(var n in t)if(t[n]===e)return!0;return!1}},BetaJS.Ids={__uniqueId:0,uniqueId:function(t){return(t||"")+this.__uniqueId++},objectId:function(t){return t.__cid||(t.__cid=this.uniqueId("cid_")),t.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(t,e,i,n){e=e||[],BetaJS.Types.is_array(e)||(e=[e]),i=i||[],BetaJS.Types.is_array(i)||(i=[i]),n=n||[],BetaJS.Types.is_array(n)||(n=[n]);var s,r=this;BetaJS.Objs.iter(e,function(t){t.hasOwnProperty("constructor")&&(s=t.constructor)}),BetaJS.Types.is_defined(s)||(s=function(){r.apply(this,arguments)}),BetaJS.Objs.extend(s,r),BetaJS.Objs.iter(i,function(t){BetaJS.Objs.extend(s,t)});var _={};if(r.__class_statics_keys)for(var o in r.__class_statics_keys)s[o]=BetaJS.Objs.clone(r[o],1);BetaJS.Objs.iter(n,function(t){BetaJS.Objs.extend(s,t),BetaJS.Objs.extend(_,BetaJS.Objs.keys(t,!0))}),r.__class_statics_keys&&BetaJS.Objs.extend(_,r.__class_statics_keys),s.__class_statics_keys=_,s.parent=r,s.children=[],s.extend=this.extend,r.children||(r.children=[]),r.children.push(s);var a=function(){};return a.prototype=r.prototype,s.prototype=new a,s.prototype.cls=s,s.classname=t,s.__notifications={},r.__notifications&&BetaJS.Objs.extend(s.__notifications,r.__notifications),BetaJS.Objs.iter(e,function(t){if(BetaJS.Objs.extend(s.prototype,t),t._notifications)for(var e in t._notifications)s.__notifications[e]||(s.__notifications[e]=[]),s.__notifications[e].push(t._notifications[e])}),delete s.prototype._notifications,s},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype.as_method=function(t){return BetaJS.Functions.as_method(this[t],this)},BetaJS.Class.prototype._notify=function(t){if(this.cls.__notifications){var e=Array.prototype.slice.call(arguments,1),i=this.cls.__notifications[t];if(i)for(var n in i)this[i[n]].apply(this,e)}},BetaJS.Class.prototype.destroy=function(){this._notify("destroy");for(var t in this)delete this[t]},BetaJS.Class.prototype._inherited=function(t,e){return t.parent.prototype[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(t,e){return t.parent[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.instance_of=function(t){return this.cls.ancestor_of(t)},BetaJS.Class.ancestor_of=function(t){return this==t||this!=BetaJS.Class&&this.parent.ancestor_of(t)},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Class.is_class_instance=function(t){return null!=t&&BetaJS.Types.is_object(t)&&"_inherited"in t&&"cls"in t},BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={enter:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count++},leave:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count--,1>this.__enter_count&&this.destroy()}},BetaJS.Exceptions={ensure:function(t){return null!=t&&BetaJS.Types.is_object(t)&&"instance_of"in t&&t.instance_of(BetaJS.Exceptions.Exception)?t:new BetaJS.Exceptions.NativeException(t)}},BetaJS.Exceptions.Exception=BetaJS.Class.extend("Exception",{constructor:function(t){this._inherited(BetaJS.Exceptions.Exception,"constructor"),this.__message=t},assert:function(t){if(!this.instance_of(t))throw this;return this},callstack:function(){for(var t=[],e=arguments.callee.caller;e;)t.push(""+e),e=e.caller;return t},callstack_to_string:function(){return this.callstack().join("\n")},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+(""+this)+"\n\nCall Stack:\n"+this.callstack_to_string()}},{ensure:function(t){var t=BetaJS.Exceptions.ensure(t);return t.assert(this),t}}),BetaJS.Exceptions.NativeException=BetaJS.Exceptions.Exception.extend("NativeException",{constructor:function(t){this._inherited(BetaJS.Exceptions.NativeException,"constructor",""+t),this.__object=t},object:function(){return this.__object}}),BetaJS.Lists={},BetaJS.Lists.AbstractList=BetaJS.Class.extend("AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(t){var e=null;return this._iterate(function(i,n){return i==t?(e=n,!1):!0}),e},exists:function(t){return null!=this.get_ident(t)},_ident_changed:function(){},constructor:function(t){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,t&&BetaJS.Objs.iter(t,function(t){this.add(t)},this)},add:function(t){var e=this._add(t);return BetaJS.Types.is_defined(e)&&this.__count++,e},count:function(){return this.__count},clear:function(){var t=this;this._iterate(function(e,i){return t.remove_by_ident(i),!0})},remove_by_ident:function(t){var e=this._remove(t);return BetaJS.Types.is_defined(e)&&this.__count--,e},remove:function(t){return this.remove_by_ident(this.get_ident(t))},remove_by_filter:function(t){var e=this;this._iterate(function(i,n){return t(i)&&e.remove_by_ident(n),!0})},get:function(t){return this._get(t)},iterate:function(t){this._iterate(function(e,i){var n=t(e,i);return BetaJS.Types.is_defined(n)?n:!0})}}),BetaJS.Lists.LinkedList=BetaJS.Lists.AbstractList.extend("LinkedList",{constructor:function(t){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",t)},_add:function(t){return this.__last={obj:t,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(t){return t.next?t.next.prev=t.prev:this.__last=t.prev,t.prev?t.prev.next=t.next:this.__first=t.next,t.obj},_get:function(t){return t.obj},_iterate:function(t){for(var e=this.__first;null!=e;){var i=e;if(e=e.next,!t(i.obj,i))return}}}),BetaJS.Lists.ObjectIdList=BetaJS.Lists.AbstractList.extend("ObjectIdList",{constructor:function(t){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",t)},_add:function(t){var e=BetaJS.Ids.objectId(t);return this.__map[e]=t,e},_remove:function(t){var e=this.__map[t];return delete this.__map[t],e},_get:function(t){return this.__map[t]},_iterate:function(t){for(var e in this.__map)t(this.__map[e],e)},get_ident:function(t){var e=BetaJS.Ids.objectId(t);return this.__map[e]?e:null}}),BetaJS.Lists.ArrayList=BetaJS.Lists.AbstractList.extend("ArrayList",{constructor:function(t,e){this.__idToIndex={},this.__items=[],e=e||{},"compare"in e&&(this._compare=e.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",t)},set_compare:function(t){this._compare=t,t&&this.sort()},get_compare:function(){return this._compare},sort:function(t){if(t=t||this._compare){this.__items.sort(t);for(var e=0;this.__items.length>e;++e)this.__ident_changed(this.__items[e],e);this._sorted()}},_sorted:function(){},re_index:function(t){if(!("_compare"in this))return t;for(var e=this.__items.length-1,i=this.__items[t],n=t;e>n&&this._compare(this.__items[n],this.__items[n+1])>0;)this.__items[n]=this.__items[n+1],this.__ident_changed(this.__items[n],n),this.__items[n+1]=i,++n;if(n==t)for(;n>0&&0>this._compare(this.__items[n],this.__items[n-1]);)this.__items[n]=this.__items[n-1],this.__ident_changed(this.__items[n],n),this.__items[n-1]=i,--n;return n!=t&&(this.__ident_changed(i,n),this._re_indexed(i)),n},_re_indexed:function(){},_add:function(t){var e=this.__items.length;this.__items.push(t);var i=this.re_index(e);return this.__idToIndex[BetaJS.Ids.objectId(t)]=i,i},_remove:function(t){for(var e=this.__items[t],i=t+1;this.__items.length>i;++i)this.__items[i-1]=this.__items[i],this.__ident_changed(this.__items[i-1],i-1);return this.__items.pop(),delete this.__idToIndex[BetaJS.Ids.objectId(e)],e},_get:function(t){return this.__items[t]},_iterate:function(t){for(var e=BetaJS.Objs.clone(this.__items,1),i=0;e.length>i;++i)t(e[i],this.get_ident(e[i]))},__ident_changed:function(t,e){this.__idToIndex[BetaJS.Ids.objectId(t)]=e,this._ident_changed(t,e)},get_ident:function(t){var e=BetaJS.Ids.objectId(t);return e in this.__idToIndex?this.__idToIndex[e]:null},ident_by_id:function(t){return this.__idToIndex[t]}}),BetaJS.Iterators={ensure:function(t){return null==t?new BetaJS.Iterators.ArrayIterator([]):t.instance_of(BetaJS.Iterators.Iterator)?t:BetaJS.Types.is_array(t)?new BetaJS.Iterators.ArrayIterator(t):new BetaJS.Iterators.ArrayIterator([t])}},BetaJS.Iterators.Iterator=BetaJS.Class.extend("Iterator",{asArray:function(){for(var t=[];this.hasNext();)t.push(this.next());return t}}),BetaJS.Iterators.ArrayIterator=BetaJS.Iterators.Iterator.extend("ArrayIterator",{constructor:function(t){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__arr=t,this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Iterators.ObjectKeysIterator=BetaJS.Iterators.ArrayIterator.extend("ObjectKeysIterator",{constructor:function(t){this._inherited(BetaJS.Iterators.ObjectKeysIterator,"constructor",BetaJS.Objs.keys(t))}}),BetaJS.Iterators.ObjectValuesIterator=BetaJS.Iterators.ArrayIterator.extend("ObjectValuesIterator",{constructor:function(t){this._inherited(BetaJS.Iterators.ObjectValuesIterator,"constructor",BetaJS.Objs.values(t))}}),BetaJS.Iterators.MappedIterator=BetaJS.Iterators.Iterator.extend("MappedIterator",{constructor:function(t,e){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=t,this.__map=e},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map(this.__iterator.next()):null}}),BetaJS.Iterators.FilteredIterator=BetaJS.Iterators.Iterator.extend("FilteredIterator",{constructor:function(t,e,i){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=t,this.__filter=e,this.__context=i||this,this.__next=null},hasNext:function(){return this.__crawl(),null!=this.__next},next:function(){this.__crawl();var t=this.__next;return this.__next=null,t},__crawl:function(){for(;null==this.__next&&this.__iterator.hasNext();){var t=this.__iterator.next();this.__filter_func(t)&&(this.__next=t)}},__filter_func:function(t){return this.__filter.apply(this.__context,[t])}}),BetaJS.Iterators.SkipIterator=BetaJS.Iterators.Iterator.extend("SkipIterator",{constructor:function(t,e){for(this._inherited(BetaJS.Iterators.SkipIterator,"constructor"),this.__iterator=t;e>0;)t.next(),e--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}),BetaJS.Iterators.LimitIterator=BetaJS.Iterators.Iterator.extend("LimitIterator",{constructor:function(t,e){this._inherited(BetaJS.Iterators.LimitIterator,"constructor"),this.__iterator=t,this.__limit=e},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return 0>=this.__limit?null:(this.__limit--,this.__iterator.next())}}),BetaJS.Iterators.SortedIterator=BetaJS.Iterators.Iterator.extend("SortedIterator",{constructor:function(t,e){this._inherited(BetaJS.Iterators.SortedIterator,"constructor"),this.__arr=t.asArray(),this.__arr.sort(e),this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={__create_event_object:function(t,e,i){i=i||{};var n={callback:t,context:e};return i.min_delay&&(n.min_delay=new BetaJS.Timers.Timer({delay:i.min_delay,once:!0,start:!1,context:this,fire:function(){n.max_delay&&n.max_delay.stop(),n.callback.apply(n.context||this,n.params)}})),i.max_delay&&(n.max_delay=new BetaJS.Timers.Timer({delay:i.max_delay,once:!0,start:!1,context:this,fire:function(){n.min_delay&&n.min_delay.stop(),n.callback.apply(n.context||this,n.params)}})),n},__destroy_event_object:function(t){t.min_delay&&t.min_delay.destroy(),t.max_delay&&t.max_delay.destroy()},__call_event_object:function(t,e){t.min_delay&&t.min_delay.restart(),t.max_delay&&t.max_delay.start(),t.min_delay||t.max_delay?t.params=e:t.callback.apply(t.context||this,e)},on:function(t,e,i,n){this.__events_mixin_events=this.__events_mixin_events||{},t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var s;s=t.shift();)this.__events_mixin_events[s]=this.__events_mixin_events[s]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[s].add(this.__create_event_object(e,i,n));return this},off:function(t,e,i){if(this.__events_mixin_events=this.__events_mixin_events||{},t){t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var n;n=t.shift();)this.__events_mixin_events[n]&&(this.__events_mixin_events[n].remove_by_filter(function(t){var n=!(e&&t.callback!=e||i&&t.context!=i);return n&&this.__destroy_event_object&&this.__destroy_event_object(t),n}),0==this.__events_mixin_events[n].count()&&(this.__events_mixin_events[n].destroy(),delete this.__events_mixin_events[n]))}else for(n in this.__events_mixin_events)this.__events_mixin_events[n].remove_by_filter(function(t){var n=!(e&&t.callback!=e||i&&t.context!=i);return n&&this.__destroy_event_object&&this.__destroy_event_object(t),n}),0==this.__events_mixin_events[n].count()&&(this.__events_mixin_events[n].destroy(),delete this.__events_mixin_events[n]);return this},trigger:function(t){var e=this;t=t.split(BetaJS.Events.EVENT_SPLITTER);var i,n=Array.prototype.slice.call(arguments,1);if(this.__events_mixin_events){for(;i=t.shift();)this.__events_mixin_events&&this.__events_mixin_events[i]&&this.__events_mixin_events[i].iterate(function(t){e.__call_event_object(t,n)});return this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(t){e.__call_event_object(t,n)}),this}},once:function(t,e,i,n){var s=this,r=BetaJS.Functions.once(function(){s.off(t,r),e.apply(this,arguments)});return r._callback=e,this.on(name,r,i,n)}},BetaJS.Events.Events=BetaJS.Class.extend("Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(t,e,i,n){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]=t,t.on(e,i,this,n)},listenOnce:function(t,e,i,n){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]=t,t.once(e,i,this,n)},listenOff:function(t,e,i){this.__listen_mixin_listen&&(t?(t.off(e,i,this),e||i||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(t){t.off(e,i,this),e||i||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]},this))}},BetaJS.Events.Listen=BetaJS.Class.extend("Listen",BetaJS.Events.ListenMixin),BetaJS.Properties={},BetaJS.Properties.TYPE_VALUE=0,BetaJS.Properties.TYPE_BINDING=1,BetaJS.Properties.TYPE_COMPUTED=2,BetaJS.Properties.PropertiesMixin={get:function(t){return t in this.__properties?this.__properties[t].value:null},_canSet:function(){return!0},_afterSet:function(){},has:function(t){return t in this.__properties},setAll:function(t,e){for(var i in t)this.set(i,t[i],e)},keys:function(t){return BetaJS.Objs.keys(this.__properties,t)},binding:function(t){return{type:BetaJS.Properties.TYPE_BINDING,bindee:this,property:t}},computed:function(t,e){return{type:BetaJS.Properties.TYPE_COMPUTED,func:t,dependencies:e||[]}},_isBinding:function(t){return BetaJS.Types.is_object(t)&&t&&t.type&&t.type==BetaJS.Properties.TYPE_BINDING&&t.bindee&&t.property},_isComputed:function(t){return BetaJS.Types.is_object(t)&&t&&t.type&&t.type==BetaJS.Properties.TYPE_COMPUTED&&t.func&&t.dependencies},getAll:function(){var t={};for(var e in this.__properties)t[e]=this.get(e);return t},unset:function(t){if(t in this.__properties){var e=this.__properties[t];if(e.type==BetaJS.Properties.TYPE_BINDING)e.bindee.off("change:"+e.property,null,this.__properties[t]);else if(e.type==BetaJS.Properties.TYPE_COMPUTED){var i=this;BetaJS.Objs.iter(e.dependencies,function(n){this._isBinding(n)?n.bindee.off("change:"+n.property,null,this.__properties[t]):this._isTimer(n)?e.timers[n].destroy:i.off("change:"+n,null,this.__properties[t])},this)}delete this.__properties[t]}},_set_changed:function(t,e,i){this._afterSet(t,this.get(t),e,i),this.trigger("change",t,this.get(t),e,i),this.trigger("change:"+t,this.get(t),e,i)},_isTimer:function(){return BetaJS.Strings.starts_with("dep","timer:")},_parseTimer:function(){return parseInt(BetaJS.Strings.strip_start("timer:"))},set:function(t,e,i){var n=this.get(t);if(n!=e){var s=this;this.__properties[t],this._isBinding(e)?(this.unset(t),this.__properties[t]={type:BetaJS.Properties.TYPE_BINDING,bindee:e.bindee,property:e.property,value:e.bindee.get(e.property)},e.bindee.on("change:"+e.property,function(){var i=s.__properties[t].value;s.__properties[t].value=e.bindee.get(e.property),s._set_changed(t,i)},this.__properties[t]),this._set_changed(t,n,i)):this._isComputed(e)?(this.unset(t),this.__properties[t]={type:BetaJS.Properties.TYPE_COMPUTED,func:e.func,dependencies:e.dependencies,value:e.func.apply(s),timers:{}},BetaJS.Objs.iter(e.dependencies,function(i){this._isBinding(i)?i.bindee.on("change:"+i.property,function(){var i=s.__properties[t].value;s.__properties[t].value=e.func.apply(s),s._set_changed(t,i)},this.__properties[t]):this._isTimer(i)?this.__properties[t].timers[i]=new BetaJS.Timers.Timer({delay:this._parseTimer(i),fire:function(){var i=s.__properties[t].value;s.__properties[t].value=e.func.apply(s),s._set_changed(t,i)}}):s.on("change:"+i,function(){var i=s.__properties[t].value;s.__properties[t].value=e.func.apply(s),s._set_changed(t,i)},this.__properties[t])},this),this._set_changed(t,n)):this._canSet(t,e)&&(this.__properties[t]&&this.__properties[t].type==BetaJS.Properties.TYPE_BINDING?this.__properties[t].bindee.set(this.__properties[t].property,e):(this.unset(t),this.__properties[t]={type:BetaJS.Properties.TYPE_VALUE,value:e},this._set_changed(t,n,i)))}},_notifications:{construct:"__properties_construct",destroy:"__properties_destroy"},__properties_construct:function(){this.__properties={}},__properties_destroy:function(){for(var t in this.__properties)this.unset(t)}},BetaJS.Properties.Properties=BetaJS.Class.extend("Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(t){this._inherited(BetaJS.Properties.Properties,"constructor"),t&&this.setAll(t)}}]),BetaJS.Collections={},BetaJS.Collections.Collection=BetaJS.Class.extend("Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Collections.Collection,"constructor"),t=t||{};var e={};"compare"in t&&(e.compare=t.compare),this.__data=new BetaJS.Lists.ArrayList([],e);var i=this;this.__data._ident_changed=function(t,e){i._index_changed(t,e)},this.__data._re_indexed=function(t){i._re_indexed(t)},this.__data._sorted=function(){i._sorted()},"objects"in t&&this.add_objects(t.objects)},set_compare:function(t){this.__data.set_compare(t)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(t){"off"in t&&t.off(null,null,this)}),this.__data.destroy(),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(t,e){this.trigger("index",t,e)},_re_indexed:function(t){this.trigger("reindexed",t)},_sorted:function(){this.trigger("sorted")},_object_changed:function(t,e,i){this.trigger("change",t,e,i),this.trigger("change:"+e,t,i),this.__data.re_index(this.getIndex(t))},add:function(t){if(this.exists(t))return null;var e=this.__data.add(t);return null!=e&&(this.trigger("add",t),"on"in t&&t.on("change",function(e,i){this._object_changed(t,e,i)},this)),e},add_objects:function(t){BetaJS.Objs.iter(t,function(t){this.add(t)},this)},exists:function(t){return this.__data.exists(t)},remove:function(t){return this.exists(t)?(this.trigger("remove",t),"off"in t&&t.off(null,null,this),this.__data.remove(t)):null},getByIndex:function(t){return this.__data.get(t)},getById:function(t){return this.__data.get(this.__data.ident_by_id(t))},getIndex:function(t){return this.__data.get_ident(t)},iterate:function(t){this.__data.iterate(t)},clear:function(){var t=this;this.iterate(function(e){t.remove(e)})}}]),BetaJS.Collections.FilteredCollection=BetaJS.Collections.Collection.extend("FilteredCollection",{constructor:function(t,e){this.__parent=t,e=e||{},delete e.objects,e.compare=e.compare||t.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",e),"filter"in e&&(this.filter=e.filter);var i=this;this.__parent.iterate(function(t){return i.add(t),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(t,e,i){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",t,e,i),this.filter(t)||this.__selfRemove(t)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"add",t)},add:function(t){if(this.exists(t)||!this.filter(t))return null;var e=this.__selfAdd(t);return this.__parent.add(t),e},__selfRemove:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",t)},remove:function(t){if(!this.exists(t))return null;var e=this.__selfRemove(t);return null==e?null:this.__parent.remove(t)}}),BetaJS.Comparators={byObject:function(t){return function(e,i){for(key in t){var n=e[key]||null,s=i[key]||null,r=BetaJS.Comparators.byValue(n,s);if(0!=r)return r*t[key]}return 0}},byValue:function(t,e){return BetaJS.Types.is_string(t)?t.localCompare(e):e>t?-1:t>e?1:0}},BetaJS.Tokens={generate_token:function(){return Math.random().toString(36).substr(2)}},BetaJS.Locales={get:function(t){return t}},BetaJS.Time={now:function(){var t=new Date;return t.getTime()},ago:function(t){return this.now()-t},days_ago:function(t){return Math.round(this.ago(t)/1e3/60/60/24)},format_ago:function(t){return this.days_ago(t)>1?this.format(t,{time:!1}):this.format_period(this.ago(t))+" ago"},format_period:function(t){return t=Math.round(t/1e3),60>t?t+" "+BetaJS.Locales.get(1==t?"second":"seconds"):(t=Math.round(t/60),60>t?t+" "+BetaJS.Locales.get(1==t?"minute":"minutes"):(t=Math.round(t/60),24>t?t+" "+BetaJS.Locales.get(1==t?"hour":"hours"):(t=Math.round(t/24),t+" "+BetaJS.Locales.get(1==t?"day":"days"))))},format:function(t,e){e=BetaJS.Objs.extend({time:!0,date:!0,locale:!0},e||{});var i=new Date(t);return e.locale?e.date?e.time?i.toLocaleString():i.toLocaleDateString():i.toLocaleTimeString():e.date?e.time?""+i:i.toDateString():i.toTimeString()}},BetaJS.Timers={},BetaJS.Timers.Timer=BetaJS.Class.extend("Timer",{constructor:function(t){this._inherited(BetaJS.Timers.Timer,"constructor"),t=BetaJS.Objs.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1},t),this.__delay=t.delay,this.__destroy_on_fire=t.destroy_on_fire,this.__once=t.once,this.__fire=t.fire,this.__context=t.context,this.__started=!1,t.start&&this.start()},destroy:function(){this.stop(),this._inherited(BetaJS.Timers.Timer,"destroy")},fire:function(){this.__once&&(this.__started=!1),this.__fire&&this.__fire.apply(this.__context,[this]),this.__destroy_on_fire&&this.destroy()},stop:function(){this.__started&&(this.__once?clearTimeout(this.__timer):clearInterval(this.__timer),this.__started=!1)},start:function(){if(!this.__started){var t=this;this.__timer=this.__once?setTimeout(function(){t.fire()},this.__delay):setInterval(function(){t.fire()},this.__delay),this.__started=!0}},restart:function(){this.stop(),this.start()}}),BetaJS.Net={},BetaJS.Net.AbstractAjax=BetaJS.Class.extend("AbstractAjax",{constructor:function(t){this._inherited(BetaJS.Net.AbstractAjax,"constructor"),this.__options=BetaJS.Objs.extend({method:"GET",data:{}},t)},syncCall:function(t){var e=BetaJS.Objs.clone(this.__options,1);e=BetaJS.Objs.extend(e,t);var i=e.success_callback;delete e.success_callback;var n=e.failure_callback;delete e.failure_callback;var s=e.complete_callback;delete e.complete_callback;try{var r=this._syncCall(e);return i&&i(r),s&&s(),r}catch(_){if(_=BetaJS.Exceptions.ensure(_),_.assert(BetaJS.Net.AjaxException),!n)throw _;n(_.status_code(),_.status_text(),_.data())}},asyncCall:function(t){var e=BetaJS.Objs.clone(this.__options,1);e=BetaJS.Objs.extend(e,t);var i=e.success_callback;delete e.success_callback;var n=e.failure_callback;delete e.failure_callback;var s=e.complete_callback;delete e.complete_callback;try{var r=this._asyncCall(BetaJS.Objs.extend({success:function(t){i&&i(t),s&&s()},failure:function(t,e,i){if(!n)throw new BetaJS.Net.AjaxException(t,e,i);n(t,e,i),s&&s()}},e));return r}catch(_){if(_=BetaJS.Exceptions.ensure(_),_.assert(BetaJS.Net.AjaxException),!n)throw _;n(_.status_code(),_.status_text(),_.data())}},call:function(t){if(!("async"in t))return!1;var e=t.async;return delete t.async,e?this.asyncCall(t):this.syncCall(t)},_syncCall:function(){},_asyncCall:function(){}}),BetaJS.Net.AjaxException=BetaJS.Exceptions.Exception.extend("AjaxException",{constructor:function(t,e,i){this._inherited(BetaJS.Net.AjaxException,"constructor",t+": "+e),this.__status_code=t,this.__status_text=e,this.__data=i},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data}}),BetaJS.Net.JQueryAjax=BetaJS.Net.AbstractAjax.extend("JQueryAjax",{_syncCall:function(t){var e;return BetaJS.$.ajax({type:t.method,async:!1,url:t.uri,data:JSON.stringify(t.data),success:function(t){e=t},error:function(t,e,i){throw new BetaJS.Net.AjaxException(t.status,i,JSON.parse(t.responseText))}}),e},_asyncCall:function(t){BetaJS.$.ajax({type:t.method,async:!0,url:t.uri,data:JSON.stringify(t.data),success:function(e){t.success(e)},error:function(e,i,n){t.failure(e.status,n,JSON.parse(e.responseText))}})}}),BetaJS.Queries={__increase_dependency:function(t,e){return t in e?e[t]++:e[t]=1,e},__dependencies_queries:function(t,e){return BetaJS.Objs.iter(t,function(t){e=this.__dependencies_query(t,e)},this),e},__dependencies_query:function(t,e){for(key in t)e=this.__dependencies_pair(key,t[key],e);return e},__dependencies_pair:function(t,e,i){return"$or"==t||"$and"==t?this.__dependencies_queries(e,i):this.__increase_dependency(t,i)},dependencies:function(t){return this.__dependencies_query(t,{})},__evaluate_query:function(t,e){for(key in t)if(!this.__evaluate_pair(key,t[key],e))return!1;return!0},__evaluate_pair:function(t,e,i){return"$or"==t?this.__evaluate_or(e,i):"$and"==t?this.__evaluate_and(e,i):this.__evaluate_value(e,i[t])},__evaluate_value:function(t,e){if(BetaJS.Types.is_object(t)){var i=!0;return BetaJS.Objs.iter(t,function(t,n){"$in"==n&&(i=i&&BetaJS.Objs.contains_value(t,e)),"$gt"==n&&(i=i&&e>=t),"$lt"==n&&(i=i&&t>=e),"$sw"==n&&(i=i&&0==e.indexOf(t))},this),i}return t==e},__evaluate_or:function(t,e){return BetaJS.Objs.iter(t,function(t){return this.__evaluate_query(t,e)?!0:void 0},this),!1},__evaluate_and:function(t,e){return BetaJS.Objs.iter(t,function(t){return this.__evaluate_query(t,e)?void 0:!1},this),!0},format:function(t){return BetaJS.Class.is_class_instance(t)?t.format():JSON.stringify(t)},overloaded_evaluate:function(t,e){return BetaJS.Class.is_class_instance(t)?t.evaluate(e):BetaJS.Types.is_function(t)?t(e):this.evaluate(t,e)},evaluate:function(t,e){return this.__evaluate_query(t,e)},emulate:function(t,e,i){var n=e.apply(i||this,{}),s=n;return null==n?s=BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(n)&&(s=BetaJS.Iterators.ArrayIterator(n)),new BetaJS.Iterators.FilteredIterator(s,function(e){return BetaJS.Queries.evaluate(t,e)})}},BetaJS.Queries.Constrained={make:function(t,e){return{query:t,options:e||{}}},format:function(t){var e=t.query;t.query=BetaJS.Queries.format(e);var i=JSON.stringify(t);return t.query=e,i},emulate:function(t,e,i,n,s){var r=t.query,_=t.options,o={},a={};"sort"in _&&"sort"in e&&(a.sort=_.sort),o=r,("query"in e||BetaJS.Types.is_empty(r))&&(o=r,(!("sort"in _)||"sort"in e)&&("skip"in _&&"skip"in e&&(a.skip=_.skip),"limit"in _&&"limit"in e&&(a.limit=_.limit)));var c=[o,a];s&&c.push(s);var u=function(t){var i=t;return null==t?i=new BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(t)&&(i=new BetaJS.Iterators.ArrayIterator(t)),"query"in e||BetaJS.Types.is_empty(r)||(i=new BetaJS.Iterators.FilteredIterator(i,function(t){return BetaJS.Queries.evaluate(r,t)})),"sort"in _&&!("sort"in a)&&(i=new BetaJS.Iterators.SortedIterator(i,BetaJS.Comparators.byObject(_.sort))),"skip"in _&&!("skip"in a)&&(i=new BetaJS.Iterators.SkipIterator(i,_.skip)),"limit"in _&&!("limit"in a)&&(i=new BetaJS.Iterators.LimitIterator(i,_.limit)),s&&s.success&&s.success(i),i
},h=function(t){if(!s||!s.exception)throw t;s.exception(t)};if(s)i.apply(n||this,[o,a,{success:u,exception:h}]);else try{var l=i.apply(n||this,[o,a]);return u(l)}catch(d){h(d)}}},BetaJS.Collections.QueryCollection=BetaJS.Collections.Collection.extend("QueryCollection",{constructor:function(t){this._inherited(BetaJS.Collections.QueryCollection,"constructor",t),this.__query=BetaJS.Objs.extend({func:null,select:{},skip:0,limit:null,forward_steps:null,backward_steps:null,range:null,count:null,sort:{}},t.query),"objects"in t||(t.objects=this.__execute_query(this.__query.skip,this.__query.limit,!0))},__execute_query:function(t,e,i){t=Math.max(t,0);var n={};if(null==this.__query.sort||BetaJS.Types.is_empty(this.__query.sort)||(n.sort=this.__query.sort),i){t>0&&(n.skip=t),null!=e&&(n.limit=e);var s=this.__query.func(this.__query.select,n),r=s.asArray();this.__query.skip=t,this.__query.limit=e,this.__query.count=null==e||e>r.length?t+r.length:null,this.clear(),this.add_objects(r)}else if(this.__query.skip>t){e=this.__query.skip-t,t>0&&(n.skip=t),n.limit=e;var s=this.__query.func(this.__query.select,n),r=s.asArray();this.__query.skip=t,this.__query.limit=null==this.__query.limit?null:this.__query.limit+r.length,this.add_objects(r)}else if(t>=this.__query.skip&&null!=this.__query.limit&&(null==e||t+e>this.__query.skip+this.__query.limit)){e=t+e-(this.__query.skip+this.__query.limit),t=this.__query.skip+this.__query.limit,t>0&&(n.skip=t),null!=e&&(n.limit=e);var s=this.__query.func(this.__query.select,n),r=s.asArray();this.__query.limit=this.__query.limit+r.length,e>r.length&&(this.__query.count=t+r.length),this.add_objects(r)}},increase_forwards:function(t){t=null==t?this.__query.forward_steps:t,null!=t&&null!=this.__query.limit&&this.__execute_query(this.__query.skip+this.__query.limit,t,!1)},increase_backwards:function(t){if(t=null==t?this.__query.backward_steps:t,null!=t&&this.__query.skip>0){var t=Math.min(t,this.__query.skip);this.__execute_query(this.__query.skip-t,t,!1)}},paginate:function(t){this.__execute_query(this.__query.range*t,this.__query.range,!0)},paginate_index:function(){return null==this.__query.range?null:Math.floor(this.__query.skip/this.__query.range)},paginate_count:function(){return null==this.__query.count||null==this.__query.range?null:Math.ceil(this.__query.count/this.__query.range)},next:function(){var t=this.paginate_index();if(null!=t){var e=this.paginate_count();(null==e||this.paginate_count()-1>t)&&this.paginate(t+1)}},prev:function(){var t=this.paginate_index();null!=t&&t>0&&this.paginate(t-1)},isComplete:function(){return null!=this.__query.count}}),BetaJS.Queries.ActiveQueryEngine=BetaJS.Class.extend("ActiveQueryEngine",{constructor:function(){this._inherited(BetaJS.Queries.ActiveQueryEngine,"constructor"),this.__aqs={},this.__object_to_aqs={}},__valid_for_aq:function(t,e){return BetaJS.Queries.evaluate(e.query(),t)},insert:function(t){if(!this.__object_to_aqs[BetaJS.Ids.objectId(t)]){var e=t.getAll(),i={};this.__object_to_aqs[BetaJS.Ids.objectId(t)]=i,BetaJS.Objs.iter(this.__aqs,function(n){this.__valid_for_aq(e,n)&&(n._add(t),i[BetaJS.Ids.objectId(n)]=n)},this),t.on("change",function(){this.update(t)},this)}},remove:function(t){BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(t)],function(e){e._remove(t)},this),delete this.__object_to_aqs[BetaJS.Ids.objectId(t)],t.off(null,this,null)},update:function(t){var e=t.getAll(),i=this.__object_to_aqs[BetaJS.Ids.objectId(t)];BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(t)],function(n){this.__valid_for_aq(e,n)||(n._remove(t),delete i[BetaJS.Ids.objectId(n)])},this),BetaJS.Objs.iter(this.__aqs,function(n){this.__valid_for_aq(e,n)&&(n._add(t),i[BetaJS.Ids.objectId(n)]=n)},this)},register:function(t){this.__aqs[BetaJS.Ids.objectId(t)]=t;for(var e=t.query(),i=this._query(e);i.hasNext();){var n=i.next();this.__object_to_aqs[BetaJS.Ids.objectId(n)]?(this.__object_to_aqs[BetaJS.Ids.objectId(n)][BetaJS.Ids.objectId(t)]=t,t._add(n)):this.insert(n)}},unregister:function(t){delete this.__aqs[BetaJS.Ids.objectId(t)];var e=this;t.collection().iterate(function(i){delete e.__object_to_aqs[BetaJS.Ids.objectId(i)][BetaJS.Ids.objectId(t)]})},_query:function(){}}),BetaJS.Queries.ActiveQuery=BetaJS.Class.extend("ActiveQuery",{constructor:function(t,e){this._inherited(BetaJS.Queries.ActiveQuery,"constructor"),this.__engine=t,this.__query=e,this.__collection=new BetaJS.Collections.Collection,t.register(this)},destroy:function(){this.__engine.unregister(this),this._inherited(BetaJS.Queries.ActiveQuery,"destroy")},isUniform:function(){return BetaJS.Types.is_empty(this.query())},engine:function(){return this.__engine},query:function(){return this.__query},collection:function(){return this.__collection},_add:function(t){this.__collection.add(t)},_remove:function(t){this.__collection.remove(t)},change_query:function(t){this.__engine.unregister(this),this.__query=t,this.__collection.clear(),this.__engine.register(this)}}),BetaJS.Stores=BetaJS.Stores||{},BetaJS.Stores.StoreException=BetaJS.Exceptions.Exception.extend("StoreException"),BetaJS.Stores.BaseStore=BetaJS.Class.extend("BaseStore",[BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Stores.BaseStore,"constructor"),t=t||{},this._id_key=t.id_key||"id",this._create_ids=t.create_ids||!1,this._last_id=1,this._async_write="async_write"in t?t.async_write:!1,this._async_write=this._async_write&&this._supports_async_write(),this._async_read="async_read"in t?t.async_read:!1,this._async_read=this._async_read&&this._supports_async_read()},id_key:function(){return this._id_key},_supports_async_read:function(){return!1},async_read:function(){return this._async_read},_supports_async_write:function(){return!1},async_write:function(){return this._async_write},_insert:function(){},_remove:function(){},_get:function(){},_update:function(){},_query_capabilities:function(){return{}},_query:function(){},_new_id:function(){},insert:function(t,e){if(this._create_ids&&!(this._id_key in t)){if(this._async_write)throw new BetaJS.Stores.StoreException("Unsupported Creation of Ids");for(;this.get(this._last_id);)this._last_id++;t[this._id_key]=this._last_id}var i=this,n=function(t){i.trigger("insert",t),e&&e.success&&e.success(t)},s=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async_write)this._insert(t,{success:n,exception:s});else try{var r=this._insert(t);return n(r),r}catch(_){s(_)}},insert_all:function(t){if(!this._async_write){var e=!0;return BetaJS.Objs.iter(t,function(t){e=e&&this.insert(t,callbacks)},this),e}var i=-1,n=this,s=function(){i++,t.length>i&&n.insert(t[i],{success:s})};s()},remove:function(t,e){var i=this,n=function(){i.trigger("remove",t),e&&e.success&&e.success(t)},s=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async_write)this._remove(t,{success:n,exception:s});else try{this._remove(t),n()}catch(r){s(r)}},get:function(t,e){var i=function(t){e&&e.success&&e.success(t)},n=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async_read)this._get(t,{success:i,exception:n});else try{var s=this._get(t);return i(s),s}catch(r){n(r)}},update:function(t,e,i){var n=this,s=function(t){n.trigger("update",t,e),i&&i.success&&i.success(t,e)},r=function(t){if(!i||!i.exception)throw t;i.exception(t)};if(this._async_write)this._update(t,e,{success:s,exception:r});else try{var _=this._update(t,e);return s(_),_}catch(o){r(o)}},query:function(t,e,i){return BetaJS.Queries.Constrained.emulate(BetaJS.Queries.Constrained.make(t,e||{}),this._query_capabilities(),this._query,this,i)},_query_applies_to_id:function(t,e){var i=this.get(e);return i&&BetaJS.Queries.overloaded_evaluate(t,i)},clear:function(){for(var t=this.query({});t.hasNext();)this.remove(t.next().id)}}]),BetaJS.Stores.AssocStore=BetaJS.Stores.BaseStore.extend("AssocStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},_iterate:function(){},constructor:function(t){t=t||{},t.create_ids=!0,this._inherited(BetaJS.Stores.AssocStore,"constructor",t)},_insert:function(t){return this._write_key(t[this._id_key],t),t},_remove:function(t){var e=this._read_key(t);return e&&!this._remove_key(t)?null:e},_get:function(t){return this._read_key(t)},_update:function(t,e){var i=this._get(t);return i&&(delete e[this._id_key],BetaJS.Objs.extend(i,e),this._write_key(t,i)),i},_query:function(){return this._iterate()}}),BetaJS.Stores.MemoryStore=BetaJS.Stores.AssocStore.extend("MemoryStore",{constructor:function(t){this._inherited(BetaJS.Stores.MemoryStore,"constructor",t),this.__data={}},_read_key:function(t){return this.__data[t]},_write_key:function(t,e){this.__data[t]=e},_remove_key:function(t){delete this.__data[t]},_iterate:function(){return new BetaJS.Iterators.ObjectValuesIterator(this.__data)}}),BetaJS.Stores.DumbStore=BetaJS.Stores.BaseStore.extend("DumbStore",{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},constructor:function(t){t=t||{},t.create_ids=!0,this._inherited(BetaJS.Stores.DumbStore,"constructor",t)},_insert:function(t){var e=this._read_last_id(),i=t[this._id_key];return null!=e?(this._write_next_id(e,i),this._write_prev_id(i,e)):this._write_first_id(i),this._write_last_id(i),this._write_item(i,t),t},_remove:function(t){var e=this._read_item(t);if(e){this._remove_item(t);var i=this._read_next_id(t),n=this._read_prev_id(t);null!=i?(this._remove_next_id(t),null!=n?(this._remove_prev_id(t),this._write_next_id(n,i),this._write_prev_id(i,n)):(this._remove_prev_id(i),this._write_first_id(i))):null!=n?(this._remove_next_id(n),this._write_last_id(n)):(this._remove_first_id(),this._remove_last_id())}return e},_get:function(t){return this._read_item(t)},_update:function(t,e){var i=this._get(t);return i&&(delete e[this._id_key],BetaJS.Objs.extend(i,e),this._write_item(t,i)),i},_query_capabilities:function(){return{query:!0}},_query:function(t){var e=new BetaJS.Iterators.Iterator,i=this,n=this._read_first_id();return BetaJS.Objs.extend(e,{__id:null==n?1:n,__store:i,__query:t,hasNext:function(){var e=this.__store._read_last_id();if(null==e)return!1;for(;e>this.__id&&!this.__store._read_item(this.__id);)this.__id++;for(;e>=this.__id;){if(this.__store._query_applies_to_id(t,this.__id))return!0;e>this.__id?this.__id=this.__store._read_next_id(this.__id):this.__id++}return!1},next:function(){if(this.hasNext()){var t=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),t}return null}}),e}}),BetaJS.Stores.AssocDumbStore=BetaJS.Stores.DumbStore.extend("AssocDumbStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(t){var e=this._read_key(t);return e?parseInt(e):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(t){this._write_key("last_id",t)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(t){this._write_key("first_id",t)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(t){return this._read_key("item_"+t)},_write_item:function(t,e){this._write_key("item_"+t,e)},_remove_item:function(t){this._remove_key("item_"+t)},_read_next_id:function(t){return this.__read_id("next_"+t)},_write_next_id:function(t,e){this._write_key("next_"+t,e)},_remove_next_id:function(t){this._remove_key("next_"+t)},_read_prev_id:function(t){return this.__read_id("prev_"+t)},_write_prev_id:function(t,e){this._write_key("prev_"+t,e)},_remove_prev_id:function(t){this._remove_key("prev_"+t)}}),BetaJS.Stores.LocalStore=BetaJS.Stores.AssocDumbStore.extend("LocalStore",{constructor:function(t){this._inherited(BetaJS.Stores.LocalStore,"constructor",t),this.__prefix=t.prefix},__key:function(t){return this.__prefix+t},_read_key:function(t){var e=this.__key(t);return e in localStorage?JSON.parse(localStorage[e]):null},_write_key:function(t,e){localStorage[this.__key(t)]=JSON.stringify(e)},_remove_key:function(t){delete localStorage[this.__key(t)]}}),BetaJS.Stores.DualStore=BetaJS.Stores.BaseStore.extend("DualStore",{constructor:function(t,e,i){i=BetaJS.Objs.extend({create_options:{},update_options:{},delete_options:{},get_options:{},query_options:{}},i||{}),i.id_key=t._id_key,i.async_write=t.async_write(),this.__first=t,this.__second=e,this._inherited(BetaJS.Stores.DualStore,"constructor",i),this.__create_options=BetaJS.Objs.extend({start:"first",strategy:"then"},i.create_options),this.__update_options=BetaJS.Objs.extend({start:"first",strategy:"then"},i.update_options),this.__remove_options=BetaJS.Objs.extend({start:"first",strategy:"then"},i.delete_options),this.__get_options=BetaJS.Objs.extend({start:"first",strategy:"or",clone:!0,or_on_null:!0},i.get_options),this.__query_options=BetaJS.Objs.extend({start:"first",strategy:"or",clone:!0,or_on_null:!0},i.query_options)},first:function(){return this.__first},second:function(){return this.__second},_supports_async_read:function(){return!1},_supports_async_write:function(){return this.__first.async_write()},_insert:function(t,e){var i=this.__first,n=this.__second;"first"!=this.__create_options.start&&(i=this.__second,n=this.__first);var s=this.__create_options.strategy;if(this.async_write())if("then"==s)i.insert(t,{success:function(t){n.insert(t,e)},exception:e.exception});else{if("or"==s)return i.insert(t,{success:e.success,exception:function(){n.insert(t,e)}});i.insert(t,e)}else{if("then"==s)return n.insert(i.insert(t));if("or"!=s)return i.insert(t);try{return i.insert(t)}catch(r){return n.insert(t)}}},_update:function(t,e,i){var n=this.__first,s=this.__second;"first"!=this.__update_options.start&&(n=this.__second,s=this.__first);var r=this.__update_options.strategy;if(this.async_write())if("then"==r)n.update(t,e,{success:function(e){s.update(t,e,i)},exception:i.exception});else{if("or"==r)return n.update(t,e,{success:i.success,exception:function(){s.update(t,e,i)}});n.update(t,e,i)}else{if("then"==r)return s.update(t,n.update(t,e));if("or"!=r)return n.update(t,e);try{return n.update(t,e)}catch(_){return s.update(t,e)}}},_remove:function(t,e){var i=this.__first,n=this.__second;"first"!=this.__remove_options.start&&(i=this.__second,n=this.__first);var s=this.__remove_options.strategy;if(this.async_write())if("then"==s)i.remove(t,{success:function(){n.remove(t,e)},exception:e.exception});else{if("or"==s)return i.remove(t,{success:e.success,exception:function(){n.remove(t,e)}});i.remove(t,e)}else if("then"==s)i.remove(t),n.remove(t);else if("or"==s)try{i.remove(t)}catch(r){n.remove(t)}else i.remove(t)},_get:function(t){var e=this.__first,i=this.__second;"first"!=this.__get_options.start&&(e=this.__second,i=this.__first);var n=this.__get_options.strategy,s=this.__get_options.clone,r=this.__get_options.or_on_null;if("or"!=n)return e.get(t);try{var _=e.get(t);if(null==_&&r)throw new{};if(s){try{i.get(t)&&(s=!1)}catch(o){}s&&i.insert(_)}}catch(o){var _=i.get(t);return null!=_&&s&&e.insert(_),_}},_query_capabilities:function(){return{query:!0,sort:!0,limit:!0,skip:!0}},_query:function(t,e){var i=this.__first,n=this.__second;"first"!=this.__query_options.start&&(i=this.__second,n=this.__first);var s=this.__query_options.strategy,r=this.__query_options.clone,_=this.__query_options.or_on_null;if("or"!=s)return i.query(t,e);try{var o=i.query(t,e);if(null==o&&_)throw{};if(r){try{n.get(t,e)&&(r=!1)}catch(a){}r&&("cache_query"in n?n.cache_query(o):n.insert_all(o.asArray()))}return o}catch(a){var o=n.query(t,e);return null!=o&&r&&("cache_query"in i?i.cache_query(o):i.insert_all(o.asArray())),o}}}),BetaJS.Stores.StoreCacheException=BetaJS.Stores.StoreException.extend("StoreCacheException"),BetaJS.Stores.FullyCachedStore=BetaJS.Stores.DualStore.extend("FullyCachedStore",{constructor:function(t,e){e=e||{},this._inherited(BetaJS.Stores.FullyCachedStore,"constructor",t,new BetaJS.Stores.MemoryStore({id_key:t.id_key()}),BetaJS.Objs.extend({get_options:{start:"second",strategy:"single"},query_options:{start:"second",strategy:"single"}},e))},cache:function(){return this.second()},store:function(){return this.first()}}),BetaJS.Stores.QueryCachedInnerStore=BetaJS.Stores.MemoryStore.extend("QueryCachedInnerStore",{constructor:function(t){this._inherited(BetaJS.Stores.QueryCachedInnerStore,"constructor",t),this.__queries={}},_query_capabilities:function(){return{query:!0,sort:!0,limit:!0,skip:!0}},_query:function(t,e){var i=BetaJS.Queries.Constrained.make(t,e),n=BetaJS.Queries.Constrained.format(i);if(n in this.__queries)return new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__queries[n]));throw new BetaJS.Stores.StoreCacheException},cache_query:function(t,e,i){var n=BetaJS.Queries.Constrained.make(t,e),s=BetaJS.Queries.Constrained.format(n);this.__queries[s]={};for(var r=0;i.length>r;++r){var _=i[r];this.trigger("cache",_),this.insert(_),this.__queries[s][_[this.id_key()]]=_}}}),BetaJS.Stores.QueryCachedStore=BetaJS.Stores.DualStore.extend("QueryCachedStore",{constructor:function(t,e){e=e||{},this._inherited(BetaJS.Stores.QueryCachedStore,"constructor",t,new BetaJS.Stores.QueryCachedInnerStore({id_key:t.id_key()}),BetaJS.Objs.extend({get_options:{start:"second",strategy:"or"},query_options:{start:"second",strategy:"or",clone:!1,or_on_null:!1}},e))},cache:function(){return this.second()},store:function(){return this.first()}}),BetaJS.Stores.RemoteStoreException=BetaJS.Stores.StoreException.extend("RemoteStoreException",{constructor:function(t){t=BetaJS.Net.AjaxException.ensure(t),this._inherited(BetaJS.Stores.RemoteStoreException,"constructor",""+t),this.__source=t},source:function(){return this.__source}}),BetaJS.Stores.RemoteStore=BetaJS.Stores.BaseStore.extend("RemoteStore",{constructor:function(t,e,i){this._inherited(BetaJS.Stores.RemoteStore,"constructor",i),this._uri=t,this.__ajax=e,this.__options=BetaJS.Objs.extend({update_method:"PUT",uri_mappings:{}},i||{})},_supports_async_write:function(){return!0},_supports_async_read:function(){return!1},getUri:function(){return this._uri},prepare_uri:function(t,e){return this.__options.uri_mappings[t]?this.__options.uri_mappings[t](e):"remove"==t||"get"==t||"update"==t?this.getUri()+"/"+e[this._id_key]:this.getUri()},_include_callbacks:function(t,e,i){return t.failure=function(t,i,n){e(new BetaJS.Stores.RemoteStoreException(new BetaJS.Net.AjaxException(t,i,n)))},t.success=i,t},_insert:function(t,e){try{var i={method:"POST",uri:this.prepare_uri("insert",t),data:t};if(!this._async_write)return this.__ajax.syncCall(i);this.__ajax.asyncCall(this._include_callbacks(i,e.exception,e.success))}catch(n){throw new BetaJS.Stores.RemoteStoreException(n)}},_remove:function(t,e){try{var i={method:"DELETE",uri:this.prepare_uri("remove",data)};if(!this._async_write){var n=this.__ajax.syncCall(i);return n||(n={},n[this._id_key]=t),n}var s=this;i=this._include_callbacks(i,e.exception,function(i){i||(i={},i[s._id_key]=t),e.success(i)}),this.__ajax.asyncCall(i)}catch(r){throw new BetaJS.Stores.RemoteStoreException(r)}},_get:function(t,e){var i={};i[this._id_key]=t;try{var n={uri:this.prepare_uri("get",i)};if(!this._async_read)return this.__ajax.syncCall(n);this.__ajax.asyncCall(this._include_callbacks(n,e.exception,e.success))}catch(s){throw new BetaJS.Stores.RemoteStoreException(s)}},_update:function(t,e,i){var n=BetaJS.Objs.clone(e,1);n[this._id_key]=t;try{var s={method:this.__options.update_method,uri:this.prepare_uri("update",n),data:e};if(!this._async_write)return this.__ajax.syncCall(s);this.__ajax.asyncCall(this._include_callbacks(s,i.exception,i.success))}catch(r){throw new BetaJS.Stores.RemoteStoreException(r)}},_query:function(t,e,i){try{var n=this._encode_query(t,e);if(!this._async_read){var s=this.__ajax.syncCall(n);return BetaJS.Types.is_string(s)?JSON.parse(s):s}n=this._include_callbacks(n,i.exception,function(){i.success(BetaJS.Types.is_string(s)?JSON.parse(s):s)}),this.__ajax.asyncCall(n)}catch(r){throw new BetaJS.Stores.RemoteStoreException(r)}},_encode_query:function(){return{uri:this.prepare_uri("query")}}}),BetaJS.Stores.QueryGetParamsRemoteStore=BetaJS.Stores.RemoteStore.extend("QueryGetParamsRemoteStore",{constructor:function(t,e,i,n){this._inherited(BetaJS.Stores.QueryGetParamsRemoteStore,"constructor",t,e,n),this.__capability_params=i},_query_capabilities:function(){var t={};return"skip"in this.__capability_params&&(t.skip=!0),"limit"in this.__capability_params&&(t.limit=!0),t},_encode_query:function(t,e){e=e||{};var i=this.getUri()+"?";return e.skip&&"skip"in this.__capability_params&&(i+=this.__capability_params.skip+"="+e.skip+"&"),e.limit&&"limit"in this.__capability_params&&(i+=this.__capability_params.limit+"="+e.limit+"&"),{uri:i}}}),BetaJS.Stores.ConversionStore=BetaJS.Stores.BaseStore.extend("ConversionStore",{constructor:function(t,e){e=e||{},e.id_key=t._id_key,this._inherited(BetaJS.Stores.ConversionStore,"constructor",e),this.__store=t,this.__key_encoding=e.key_encoding||{},this.__key_decoding=e.key_decoding||{},this.__value_encoding=e.value_encoding||{},this.__value_decoding=e.value_decoding||{}},encode_object:function(t){var e={};for(var i in t)e[this.encode_key(i)]=this.encode_value(i,t[i]);return e},decode_object:function(t){var e={};for(var i in t)e[this.decode_key(i)]=this.decode_value(i,t[i]);return e},encode_key:function(t){return t in this.__key_encoding?this.__key_encoding[t]:t},decode_key:function(t){return t in this.__key_decoding?this.__key_decoding[t]:t},encode_value:function(t,e){return t in this.__value_encoding?this.__value_encoding[t](e):e},decode_value:function(t,e){return t in this.__value_decoding?this.__value_decoding[t](e):e},_insert:function(t){return this.decode_object(this.__store.insert(this.encode_object(t)))},_remove:function(t){return this.__store.remove(this.encode_value(this._id_key,t))},_get:function(t){return this.decode_object(this.__store.get(this.encode_value(this._id_key,t)))},_update:function(t,e){return this.decode_object(this.__store.update(this.encode_value(this._id_key,t),this.encode_object(e)))},_query_capabilities:function(){return this.__store._query_capabilities()},_query:function(t,e){var i=this,n=this.__store.query(this.encode_object(t),e);return new BetaJS.Iterators.MappedIterator(n,function(t){return i.decode_object(t)})}}),BetaJS.Net.HttpHeader={HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,format:function(t,e){var i="";return i=t==this.HTTP_STATUS_OK?"OK":t==this.HTTP.STATUS_CREATED?"Created":t==this.HTTP_STATUS_PAYMENT_REQUIRED?"Payment Required":t==this.HTTP_STATUS_FORBIDDEN?"Forbidden":t==this.HTTP_STATUS_NOT_FOUND?"Not found":t==this.HTTP_STATUS_PRECONDITION_FAILED?"Precondition Failed":t==this.HTTP_STATUS_INTERNAL_SERVER_ERROR?"Internal Server Error":"Other Error",e?t+" "+i:i}},BetaJS.Modelling=BetaJS.Modelling||{},BetaJS.Modelling.SchemedProperties=BetaJS.Properties.Properties.extend("SchemedProperties",{constructor:function(t,e){this._inherited(BetaJS.Modelling.SchemedProperties,"constructor");var i=this.cls.scheme();this._properties_changed={},this.__errors={},this.__unvalidated={};for(var n in i)"def"in i[n]?this.set(n,i[n].def):i[n].auto_create?this.set(n,i[n].auto_create(this)):this.set(n,null);e=e||{},this._properties_changed={},this.__errors={},this.__unvalidated={};for(n in t)this.set(n,t[n])},_unsetChanged:function(t){delete this._properties_changed[t]},_afterSet:function(t,e){var i=this.cls.scheme();t in i&&(this._properties_changed[t]=e,this.__unvalidated[t]=!0,delete this.__errors[t])},properties_changed:function(t){return BetaJS.Types.is_boolean(t)?BetaJS.Objs.filter(this._properties_changed,function(e,i){return this.validateAttr(i)==t},this):this._properties_changed},properties_by:function(t){return BetaJS.Types.is_boolean(t)?BetaJS.Objs.filter(this.getAll(),function(e,i){return this.validateAttr(i)==t},this):this.getAll()},validate:function(){this.trigger("validate");for(key in this.__unvalidated)this.validateAttr(key);return BetaJS.Types.is_empty(this.__errors)},validateAttr:function(t){if(t in this.__unvalidated){delete this.__unvalidated[t],delete this.__errors[t];var e=this.cls.scheme(),i=e[t];if("validate"in i){var n=i.validate;BetaJS.Types.is_array(n)||(n=[n]);var s=this.get(t);BetaJS.Objs.iter(n,function(e){var i=e.validate(s,this);return null!=i&&(this.__errors[t]=i),null==i},this)}this.trigger("validate:"+t,!(t in this.__errors),this.__errors[t])}return!(t in this.__errors)},setError:function(t,e){delete this.__unvalidated[t],this.__errors[t]=e},revalidate:function(){return this.__errors={},this.__unvalidated=this.keys(!0),this.validate()},errors:function(){return this.__errors},asRecord:function(t){var e={},i=this.cls.scheme(),n=this.getAll();t=t||{};for(var s in n)if(s in i){var r=i[s].tags||[],_={};BetaJS.Objs.iter(r,function(t){_[t]=!0});var o=!0;BetaJS.Objs.iter(t,function(t){o=o&&t in _},this),o&&(e[s]=n[s])}return e},setByTags:function(t,e){var i=this.cls.scheme();e=e||{};for(var n in t)if(n in i){var s=i[n].tags||[],r={};BetaJS.Objs.iter(s,function(t){r[t]=!0});var _=!0;BetaJS.Objs.iter(e,function(t){_=_&&t in r},this),_&&this.set(n,t[n])}}},{_initializeScheme:function(){var t={};return t[this.primary_key()]={type:"id"},t},asRecords:function(t,e){return t.map(function(t){return t.asRecord(e)})}},{scheme:function(){return this.__scheme=this.__scheme||this._initializeScheme(),this.__scheme}}),BetaJS.Modelling.AssociatedProperties=BetaJS.Modelling.SchemedProperties.extend("AssociatedProperties",{constructor:function(t,e){this._inherited(BetaJS.Modelling.AssociatedProperties,"constructor",t,e),this.assocs=this._initializeAssociations();for(var i in this.assocs)this.__addAssoc(i,this.assocs[i]);this.on("change:"+this.cls.primary_key(),function(t,e){this._change_id(t,e),this.trigger("change_id",t,e)},this)},_change_id:function(){},__addAssoc:function(t,e){this[t]=function(){return e.yield()}},_initializeAssociations:function(){return{}},destroy:function(){for(var t in this.assocs)this.assocs[t].destroy();this._inherited(BetaJS.Modelling.AssociatedProperties,"destroy")},id:function(){return this.get(this.cls.primary_key())},hasId:function(){return this.has(this.cls.primary_key())}},{primary_key:function(){return"id"}}),BetaJS.Modelling.Model=BetaJS.Modelling.AssociatedProperties.extend("Model",[BetaJS.Ids.ClientIdMixin,BetaJS.Classes.AutoDestroyMixin,{constructor:function(t,e){this._inherited(BetaJS.Modelling.Model,"constructor",t,e),this.__saved="saved"in e?e.saved:!1,this.__new="new"in e?e["new"]:!0,this.__removed=!1,this.__saved&&(this._properties_changed={}),this.__table=e.table,this.__table._model_register(this)},destroy:function(){this.__table._model_unregister(this),this.trigger("destroy"),this._inherited(BetaJS.Modelling.Model,"destroy")},isSaved:function(){return this.__saved},isNew:function(){return this.__new},isRemoved:function(){return this.__removed},update:function(t,e){this.setAll(t,{silent:!0}),this.save(e)},_afterSet:function(t,e,i,n){this._inherited(BetaJS.Modelling.Model,"_afterSet",t,e,i,n);var s=this.cls.scheme();t in s&&(n&&n.no_change?this._unsetChanged(t):this.__saved=!1,n&&n.silent||this.__table&&this.__table._model_set_value(this,t,e,n))},_after_create:function(){},save:function(t){var e=this,i=BetaJS.Objs.clone(t||{},1);return i.success=function(){e.trigger("save"),e.__saved=!0;var i=e.__new;e.__new=!1,i&&e._after_create(),t&&t.success&&t.success()},this.__table._model_save(this,i)},remove:function(t){var e=BetaJS.Objs.clone(t||{},1);return e.success=function(){this.trigger("remove"),this.__removed=!0,t&&t.success&&t.success()},this.__table._model_remove(this,e)}}]),BetaJS.Modelling.ModelException=BetaJS.Exceptions.Exception.extend("ModelException",{constructor:function(t,e){this._inherited(BetaJS.Modelling.ModelException,"constructor",e),this.__model=t},model:function(){return this.__model}}),BetaJS.Modelling.ModelInvalidException=BetaJS.Modelling.ModelException.extend("ModelInvalidException",{constructor:function(t){var e=BetaJS.Objs.values(t.errors()).join("\n");this._inherited(BetaJS.Modelling.ModelInvalidException,"constructor",t,e)}}),BetaJS.Modelling.ModelMissingIdException=BetaJS.Modelling.ModelException.extend("ModelMissingIdException",{constructor:function(t){this._inherited(BetaJS.Modelling.ModelMissingIdException,"constructor",t,"No id given.")}}),BetaJS.Modelling.Table=BetaJS.Class.extend("Table",[BetaJS.Events.EventsMixin,{constructor:function(t,e,i){this._inherited(BetaJS.Modelling.Table,"constructor"),this.__store=t,this.__model_type=e,this.__models_by_id={},this.__models_by_cid={},this.__models_changed={},this.__options=BetaJS.Objs.extend({type_column:null,remove_exception:!0,auto_create:!1,create_exception:!0,invalid_create_exception:!0,invalid_create_save:!1,greedy_create:!1,store_validation_conversion:!0,auto_update:!0,update_exception:!0,invalid_update_exception:!0,invalid_update_save:!1,greedy_update:!1},i||{})},async_read:function(){return this.__store.async_read()},async_write:function(){return this.__store.async_write()},_model_register:function(t){this.hasModel(t)||(this.trigger("register",t),this.__models_by_cid[t.cid()]=t,t.hasId()&&(this.__models_by_id[t.id()]=t),t.isNew()&&this.__options.auto_create&&this._model_create(t))},_model_unregister:function(t){this.hasModel(t)&&(t.save(),delete this.__models_by_cid[t.cid()],t.hasId()&&delete this.__models_by_id[t.id()],this.trigger("unregister",t))},hasModel:function(t){return t.cid()in this.__models_by_cid},_model_remove:function(t,e){if(!this.hasModel(t))return!1;var i=this,n={success:function(){return e&&e.success&&e.success(),e&&e.complete&&e.complete(),i.trigger("remove",t),t.destroy(),!0},exception:function(t){if(e&&e.exception&&e.exception(t),e&&e.complete&&e.complete(),(!e||!e.exception)&&i.__options.remove_exception)throw t;return!1}};if(this.async_write())this.__store.remove(t.id(),n);else try{return this.__store.remove(t.id()),n.success()}catch(s){return n.exception(s)}},_model_save:function(t,e){return t.isNew()?this._model_create(t,e):this._model_update(t,e)},__exception_conversion:function(t,e){if(this.__options.store_validation_conversion&&e.instance_of(BetaJS.Stores.RemoteStoreException)){var i=e.source();i.status_code()==BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&i.data()&&(BetaJS.Objs.iter(i.data(),function(e,i){t.setError(i,e)},this),e=new BetaJS.Modelling.ModelInvalidException(t))}return e},_model_create:function(t,e){if(!this.hasModel(t)||!t.isNew())return!1;var i=this,n=t.validate();if(!n){var s=new BetaJS.Modelling.ModelInvalidException(t);if(e&&e.exception&&e.exception(s),e&&e.complete&&e.complete(),(!e||!e.exception)&&i.__options.invalid_create_exception)throw s;if(!this.__options.invalid_create_save)return!1}var r=this.__options.greedy_create?t.properties_by(!0):t.getAll();this.__options.type_column&&(r[this.__options.type_column]=t.cls.classname);var _={success:function(s){if(!(t.cls.primary_key()in s))return _.exception(new BetaJS.Modelling.ModelMissingIdException(t));if(i.__models_by_id[s[t.cls.primary_key()]]=t,!i.__options.greedy_create)for(var r in t.properties_by(!1))delete s[r];return t.setAll(s,{no_change:!0,silent:!0}),n&&delete i.__models_changed[t.cid()],i.trigger("create",t),i.trigger("save",t),e&&e.success&&e.success(s),e&&e.complete&&e.complete(),!0},exception:function(n){if(n=BetaJS.Exceptions.ensure(n),n=i.__exception_conversion(t,n),e&&e.exception&&e.exception(n),e&&e.complete&&e.complete(),(!e||!e.exception)&&i.__options.create_exception)throw n;return!1}};if(this.async_write())this.__store.insert(r,_);
else try{var o=this.__store.insert(r);return _.success(o)}catch(s){return _.exception(s)}},_model_update:function(t,e){if(!this.hasModel(t)||t.isNew())return!1;var i=this,n=t.validate();if(!n){var s=new BetaJS.Modelling.ModelInvalidException(t);if(e&&e.exception&&e.exception(s),e&&e.complete&&e.complete(),(!e||!e.exception)&&i.__options.invalid_update_exception)throw s;if(!this.__options.invalid_update_save)return!1}var r=this.__options.greedy_update?t.properties_changed(!0):t.properties_changed(),_={success:function(s){if(!i.__options.greedy_update)for(var r in t.properties_changed(!1))delete s[r];return t.setAll(s,{no_change:!0,silent:!0}),n&&delete i.__models_changed[t.cid()],i.trigger("update",t),i.trigger("save",t),e&&e.success&&e.success(s),e&&e.complete&&e.complete(),!0},exception:function(t){if(e&&e.exception&&e.exception(t),e&&e.complete&&e.complete(),(!e||!e.exception)&&i.__options.update_exception)throw t;return!1}};if(this.async_write()&&!BetaJS.Types.is_empty(r))this.__store.update(t.id(),r,_);else try{var o=BetaJS.Types.is_empty(r)?{}:this.__store.update(t.id(),r);return _.success(o)}catch(s){return _.exception(s)}},_model_set_value:function(t,e,i,n){return this.__models_changed[t.cid()]=t,this.trigger("change",t,e,i),this.trigger("change:"+e,t,i),this.__options.auto_update?t.save(n):void 0},save:function(){var t=!0;return BetaJS.Objs.iter(this.__models_changed,function(e){t=e.save()&&t}),t},__materialize:function(t){if(!t)return null;var e=this.__model_type;this.__options.type_column&&t[this.__options.type_column]&&(e=t[this.__options.type_column]);var i=BetaJS.Scopes.resolve(e);if(this.__models_by_id[t[i.primary_key()]])return this.__models_by_id[t[i.primary_key()]];var n=new i(t,{table:this,saved:!0,"new":!1});return n},findById:function(t){return this.__models_by_id[t]?this.__models_by_id[t]:this.__materialize(this.__store.get(t))},findBy:function(t){return this.allBy(t,{limit:1}).next()},all:function(t){return this.allBy({},t)},allBy:function(t,e){var i=this.__store.query(t,e),n=this,s=new BetaJS.Iterators.MappedIterator(i,function(t){return n.__materialize(t)});return s},active_query_engine:function(){if(!this.__active_query_engine){var t=this;this._active_query_engine=new BetaJS.Queries.ActiveQueryEngine,this._active_query_engine._query=function(e){return t.allBy(e)},this.on("create",function(t){this._active_query_engine.insert(t)}),this.on("remove",function(){this._active_query_engine.insert(remove)}),this.on("change",function(t){this._active_query_engine.update(t)})}return this._active_query_engine}}]),BetaJS.Modelling.Associations={},BetaJS.Modelling.Associations.Association=BetaJS.Class.extend("Assocation",{constructor:function(t,e){this._inherited(BetaJS.Modelling.Associations.Association,"constructor"),this._model=t,this._options=e||{},this.__cache=null,e.delete_cascade&&t.on("remove",function(){this.__delete_cascade()},this),e.ignore_change_id||t.on("change_id",function(t,e){this._change_id(t,e)},this)},_change_id:function(){},__delete_cascade:function(){for(var t=BetaJS.Iterators.ensure(this.yield());t.hasNext();)t.next().remove()},yield:function(){if(this.__cache)return this.__cache;var t=this._yield();return this._options.cached&&(this.__cache=t),t},invalidate:function(){delete this.__cache}}),BetaJS.Modelling.Associations.TableAssociation=BetaJS.Modelling.Associations.Association.extend("TableAssociation",{constructor:function(t,e,i,n){this._inherited(BetaJS.Modelling.Associations.TableAssociation,"constructor",t,n),this._foreign_table=e,this._foreign_key=i},__delete_cascade:function(){for(var t=BetaJS.Iterators.ensure(this.yield());t.hasNext();)t.next().remove()},yield:function(){if(this.__cache)return this.__cache;var t=this._yield();return this._options.cached&&(this.__cache=t),t},invalidate:function(){delete this.__cache}}),BetaJS.Modelling.Associations.HasManyAssociation=BetaJS.Modelling.Associations.TableAssociation.extend("HasManyAssocation",{_yield:function(){var t={};return t[this._foreign_key]=this._model.id(),this._foreign_table.allBy(t)},yield:function(){return this._options.cached?(this.__cache||(this.__cache=this._yield().asArray()),new BetaJS.Iterators.ArrayIterator(this.__cache)):this._yield()},findBy:function(t){return t[this._foreign_key]=this._model.id(),this._foreign_table.findBy(t)},allBy:function(t){return t[this._foreign_key]=this._model.id(),this._foreign_table.allBy(t)},_change_id:function(t){for(var e=this._yield();e.hasNext();){var i=e.next();i.set(this._foreign_key,t),i.save()}}}),BetaJS.Modelling.Associations.HasManyThroughArrayAssociation=BetaJS.Modelling.Associations.HasManyAssociation.extend("HasManyThroughArrayAssociation",{_yield:function(){var t=[];return BetaJS.Objs.iter(this._model.get(this._foreign_key),function(e){var i=this._foreign_table.findById(e);i&&t.push(i)},this),t},yield:function(){return this._options.cached?(this.__cache||(this.__cache=this._yield()),new BetaJS.Iterators.ArrayIterator(this.__cache)):new BetaJS.Iterators.ArrayIterator(this._yield())}}),BetaJS.Modelling.Associations.HasOneAssociation=BetaJS.Modelling.Associations.TableAssociation.extend("HasOneAssocation",{_yield:function(t){var e={};return e[this._foreign_key]=t||this._model.id(),this._foreign_table.findBy(e)},_change_id:function(t,e){var i=this._yield(e);i&&(i.set(this._foreign_key,t),i.save())}}),BetaJS.Modelling.Associations.BelongsToAssociation=BetaJS.Modelling.Associations.TableAssociation.extend("BelongsToAssocation",{_yield:function(){return this._foreign_table.findById(this._model.get(this._foreign_key))}}),BetaJS.Modelling.Validators={},BetaJS.Modelling.Validators.Validator=BetaJS.Class.extend("Validator",{validate:function(){return null}}),BetaJS.Modelling.Validators.PresentValidator=BetaJS.Modelling.Validators.Validator.extend("PresentValidator",{constructor:function(t){this._inherited(BetaJS.Modelling.Validators.PresentValidator,"constructor"),this.__error_string=t?t:"Field is required"},validate:function(t){return BetaJS.Types.is_null(t)?this.__error_string:null}}),BetaJS.Net.HttpHeader={HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,format:function(t,e){var i="";return i=t==this.HTTP_STATUS_OK?"OK":t==this.HTTP.STATUS_CREATED?"Created":t==this.HTTP_STATUS_PAYMENT_REQUIRED?"Payment Required":t==this.HTTP_STATUS_FORBIDDEN?"Forbidden":t==this.HTTP_STATUS_NOT_FOUND?"Not found":t==this.HTTP_STATUS_PRECONDITION_FAILED?"Precondition Failed":t==this.HTTP_STATUS_INTERNAL_SERVER_ERROR?"Internal Server Error":"Other Error",e?t+" "+i:i}},BetaJS.Databases={},BetaJS.Databases.Database=BetaJS.Class.extend("Database",{_tableClass:function(){return null},getTable:function(t){var e=this._tableClass();return new e(this,t)}}),BetaJS.Databases.DatabaseTable=BetaJS.Class.extend("DatabaseTable",{constructor:function(t,e){this._inherited(BetaJS.Databases.DatabaseTable,"constructor"),this._database=t,this._table_name=e},_encode:function(t){return t},_decode:function(t){return t},_insertRow:function(){},_removeRow:function(){},_findOne:function(){},_updateRow:function(){},_find:function(){},insertRow:function(t){return this._decode(this._insertRow(this._encode(t)))},removeRow:function(t){return this._removeRow(this._encode(t))},findOne:function(t,e){var i=this._findOne(this._encode(t),e);return null==i?null:this._decode(i)},updateRow:function(t,e){return this._decode(this._updateRow(this._encode(t),this._encode(e)))},find:function(t,e){var i=this;return new BetaJS.Iterators.MappedIterator(this._find(this._encode(t),e),function(t){return i._decode(t)})},removeById:function(t){return this.removeRow({id:t})},findById:function(t){return this.findOne({id:t})},updateById:function(t,e){return this.updateRow({id:t},e)}}),BetaJS.Databases.MongoDatabase=BetaJS.Databases.Database.extend("MongoDatabase",{constructor:function(t,e,i,n){this._inherited(BetaJS.Databases.MongoDatabase,"constructor"),this.__server=i||"localhost",this.__port=n||27017,this.__database_name=e,this.__mongodb=null,this.__mongo_sync=t},_tableClass:function(){return BetaJS.Databases.MongoDatabaseTable},mongo_sync:function(){return this.__mongo_sync},mongodb:function(){return this.__mongodb||(this.__mongo_server=new this.__mongo_sync.Server(this.__server,this.__port),this.__mongodb=this.__mongo_server.db(this.__database_name)),this.__mongodb},destroy:function(){this.__mongo_server&&this.__mongo_server.close(),this._inherited(BetaJS.Databases.MongoDatabase,"destroy")}}),BetaJS.Databases.MongoDatabaseTable=BetaJS.Databases.DatabaseTable.extend("MongoDatabaseTable",{constructor:function(t,e){this._inherited(BetaJS.Databases.MongoDatabaseTable,"constructor",t,e),this.__table=null},table:function(){return this.__table||(this.__table=this._database.mongodb().getCollection(this._table_name)),this.__table},_encode:function(t){var e=BetaJS.Objs.clone(t,1);return"id"in t&&(delete e.id,e._id=t.id),e},_decode:function(t){var e=BetaJS.Objs.clone(t,1);return"_id"in t&&(delete e._id,e.id=t._id),e},_insertRow:function(t){return this.table().insert(t)},_removeRow:function(t){return this.table().remove(t)},_findOne:function(t,e){e=e||{},e.limit=1;var i=this._find(t,e);return i.next()},_updateRow:function(t,e){return this.table().update(t,e,!0,!1)},_find:function(t,e){e=e||{};var i=this.table().find(t);return"sort"in e&&(i=i.sort(e.sort)),"skip"in e&&(i=i.skip(e.skip)),"limit"in e&&(i=i.limit(e.limit)),new BetaJS.Iterators.ArrayIterator(i.toArray())}}),BetaJS.Stores.DatabaseStore=BetaJS.Stores.BaseStore.extend("DatabaseStore",{constructor:function(t,e){this._inherited(BetaJS.Stores.DatabaseStore,"constructor"),this.__database=t,this.__table_name=e,this.__table=null},table:function(){return this.__table||(this.__table=this.__database.getTable(this.__table_name)),this.__table},_insert:function(t){return this.table().insertRow(t)},_remove:function(t){return this.table().removeById(t)},_get:function(t){return this.table().findById(t)},_update:function(t,e){return this.table().updateById(t,e)},_query_capabilities:function(){return{query:!0,sort:!0,skip:!0,limit:!0}},_query:function(t,e){return this.table().find(t,e)}}),BetaJS.Stores.MongoDatabaseStore=BetaJS.Stores.ConversionStore.extend("MongoDatabaseStore",{constructor:function(t,e,i){var n=new BetaJS.Stores.DatabaseStore(t,e),s={},r={};i=i||{},i.id="id";var _=t.mongo_sync().ObjectId;for(var o in i)"id"==i[o]&&(s[o]=function(t){return new _(t)},r[o]=function(t){return t+""});this._inherited(BetaJS.Stores.MongoDatabaseStore,"constructor",n,{value_encoding:s,value_decoding:r})}});