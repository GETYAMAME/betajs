/*! betajs - v0.0.1 - 2013-07-26, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};"undefined"!=typeof module&&"exports"in module&&(module.exports=BetaJS),BetaJS.Types={is_object:function(a){return"object"==typeof a},is_array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null==a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){if(this.is_none(a))return!0;if(this.is_array(a))return 0==a.length;if(this.is_object(a)){for(var b in a)return!1;return!0}return!1},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(BetaJS.Types.is_boolean(a)&&BetaJS.Types.is_boolean(b))return a==b?0:a?1:-1;if(BetaJS.Types.is_array(a)&&BetaJS.Types.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!=g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)}},BetaJS.Strings={nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})}},BetaJS.Functions={as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}},BetaJS.Scopes={resolve:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=b||window||global,d=a.split("."),e=0;e<d.length;++e)c=c[d[e]];return c}},BetaJS.Objs={clone:function(a,b){return!b||0>=b?a:BetaJS.Types.is_array(a)?a.slice(0):BetaJS.Types.is_object(a)?this.extend({},a,b-1):a},extend:function(a,b,c){for(var d in b)a[d]=this.clone(b[d],c);return a},keys:function(a,b){if(BetaJS.Types.is_undefined(b)){var c=[];for(var d in a)c.push(d);return c}var c={};for(var d in a)c[d]=b;return c},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(a,b,c){if(BetaJS.Types.is_array(a)){for(var d=[],e=0;e<a.length;++e)(c?b.apply(c,[a[e],e]):b(a[e],e))&&d.push(a[e]);return d}var d={};for(var f in a)(c?b.apply(c,[a[f],f]):b(a[f],f))&&(d[f]=a[f]);return d},equals:function(a,b,c){if(c&&c>0){for(var d in a)if(!d in b||!this.equals(a[d],b[d],c-1))return!1;for(var d in b)if(!d in a)return!1;return!0}return a==b},iter:function(a,b,c){if(BetaJS.Types.is_array(a))for(var d=0;d<a.length;++d){var e=c?b.apply(c,[a[d],d]):b(a[d],d);if(BetaJS.Types.is_defined(e)&&!e)return}else for(var f in a){var e=c?b.apply(c,[a[f],f]):b(a[f],f);if(BetaJS.Types.is_defined(e)&&!e)return}}},BetaJS.Ids={__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a){return a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(a,b,c,d){b=b||[],BetaJS.Types.is_array(b)||(b=[b]),c=c||[],BetaJS.Types.is_array(c)||(c=[c]),d=d||[],BetaJS.Types.is_array(d)||(d=[d]);var e,f=this;BetaJS.Objs.iter(b,function(a){a.hasOwnProperty("constructor")&&(e=a.constructor)}),BetaJS.Types.is_defined(e)||(e=function(){f.apply(this,arguments)}),BetaJS.Objs.extend(e,f),BetaJS.Objs.iter(c,function(a){BetaJS.Objs.extend(e,a)});var g={};if(f.__class_statics_keys)for(var h in f.__class_statics_keys)e[h]=BetaJS.Objs.clone(f[h],1);BetaJS.Objs.iter(d,function(a){BetaJS.Objs.extend(e,a),BetaJS.Objs.extend(g,BetaJS.Objs.keys(a,!0))}),f.__class_statics_keys&&BetaJS.Objs.extend(g,f.__class_statics_keys),e.__class_statics_keys=g,e.parent=f,e.children=[],e.extend=this.extend,f.children||(f.children=[]),f.children.push(e);var i=function(){};return i.prototype=f.prototype,e.prototype=new i,e.prototype.cls=e,e.classname=a,e.__notifications={},f.__notifications&&BetaJS.Objs.extend(e.__notifications,f.__notifications),BetaJS.Objs.iter(b,function(a){if(BetaJS.Objs.extend(e.prototype,a),a._notifications)for(var b in a._notifications)e.__notifications[b]||(e.__notifications[b]=[]),e.__notifications[b].push(a._notifications[b])}),delete e.prototype._notifications,e},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype.as_method=function(a){return BetaJS.Functions.as_method(this[a],this)},BetaJS.Class.prototype._notify=function(a){if(this.cls.__notifications){var b=Array.prototype.slice.call(arguments,1),c=this.cls.__notifications[a];if(c)for(var d in c)this[c[d]].apply(this,b)}},BetaJS.Class.prototype.destroy=function(){this._notify("destroy");for(var a in this)delete this[a]},BetaJS.Class.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},BetaJS.Class.ancestor_of=function(a){return this==a||this!=BetaJS.Class&&this.parent.ancestor_of(a)},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Class.is_class_instance=function(a){return null!=a&&BetaJS.Types.is_object(a)&&"_inherited"in a&&"cls"in a},BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={enter:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count++},leave:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count--,this.__enter_count<1&&this.destroy()}},BetaJS.Exceptions={ensure:function(a){return null!=a&&BetaJS.Types.is_object(a)&&"instance_of"in a&&a.instance_of(BetaJS.Exceptions.Exception)?a:new BetaJS.Exceptions.NativeException(a)}},BetaJS.Exceptions.Exception=BetaJS.Class.extend("Exception",{constructor:function(a){this._inherited(BetaJS.Exceptions.Exception,"constructor"),this.__message=a},assert:function(a){if(!this.instance_of(a))throw this;return this},callstack:function(){for(var a=[],b=arguments.callee.caller;b;)a.push(b.toString()),b=b.caller;return a},callstack_to_string:function(){return this.callstack().join("\n")},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()+"\n\nCall Stack:\n"+this.callstack_to_string()}},{ensure:function(a){var a=BetaJS.Exceptions.ensure(a);return a.assert(this),a}}),BetaJS.Exceptions.NativeException=BetaJS.Exceptions.Exception.extend("NativeException",{constructor:function(a){this._inherited(BetaJS.Exceptions.NativeException,"constructor",a.toString()),this.__object=a},object:function(){return this.__object}}),BetaJS.Lists={},BetaJS.Lists.AbstractList=BetaJS.Class.extend("AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return null!=this.get_ident(a)},_ident_changed:function(){},constructor:function(a){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,a&&BetaJS.Objs.iter(a,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return BetaJS.Types.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){var a=this;this._iterate(function(b,c){return a.remove_by_ident(c),!0})},remove_by_ident:function(a){var b=this._remove(a);return BetaJS.Types.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){var b=this;this._iterate(function(c,d){return a(c)&&b.remove_by_ident(d),!0})},get:function(a){return this._get(a)},iterate:function(a){this._iterate(function(b,c){var d=a(b,c);return BetaJS.Types.is_defined(d)?d:!0})}}),BetaJS.Lists.LinkedList=BetaJS.Lists.AbstractList.extend("LinkedList",{constructor:function(a){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",a)},_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a){for(var b=this.__first;null!=b;){var c=b;if(b=b.next,!a(c.obj,c))return}}}),BetaJS.Lists.ObjectIdList=BetaJS.Lists.AbstractList.extend("ObjectIdList",{constructor:function(a){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",a)},_add:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]=a,b},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a){for(var b in this.__map)a(this.__map[b],b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]?b:null}}),BetaJS.Lists.ArrayList=BetaJS.Lists.AbstractList.extend("ArrayList",{constructor:function(a,b){this.__idToIndex={},this.__items=[],b=b||{},"compare"in b&&(this._compare=b.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",a)},set_sompare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!("_compare"in this))return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(){},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[BetaJS.Ids.objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[BetaJS.Ids.objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a){for(var b=BetaJS.Objs.clone(this.__items,1),c=0;c<b.length;++c)a(b[c],this.get_ident(b[c]))},__ident_changed:function(a,b){this.__idToIndex[BetaJS.Ids.objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null},ident_by_id:function(a){return this.__idToIndex[a]}}),BetaJS.Iterators={ensure:function(a){return null==a?new BetaJS.Iterators.ArrayIterator([]):a.instance_of(BetaJS.Iterators.Iterator)?a:BetaJS.Types.is_array(a)?new BetaJS.Iterators.ArrayIterator(a):new BetaJS.Iterators.ArrayIterator([a])}},BetaJS.Iterators.Iterator=BetaJS.Class.extend("Iterator",{asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a}}),BetaJS.Iterators.ArrayIterator=BetaJS.Iterators.Iterator.extend("ArrayIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__arr=a,this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Iterators.MappedIterator=BetaJS.Iterators.Iterator.extend("MappedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=a,this.__map=b},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map(this.__iterator.next()):null}}),BetaJS.Iterators.FilteredIterator=BetaJS.Iterators.Iterator.extend("FilteredIterator",{constructor:function(a,b,c){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=a,this.__filter=b,this.__context=c||this,this.__next=null},hasNext:function(){return this.__crawl(),null!=this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;null==this.__next&&this.__iterator.hasNext();){if(this.__next=this.__iterator.next(),this.__filter_func(this.__next))return;null==this.__next}},__filter_func:function(a){return this.__filter.apply(this.__context,a)}}),BetaJS.Iterators.SkipIterator=BetaJS.Iterators.Iterator.extend("SkipIterator",{constructor:function(a,b){for(this._inherited(BetaJS.Iterators.SkipIterator,"constructor"),this.__iterator=a;b>0;)a.next(),b--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}),BetaJS.Iterators.LimitIterator=BetaJS.Iterators.Iterator.extend("LimitIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.LimitIterator,"constructor"),this.__iterator=a,this.__limit=b},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}),BetaJS.Iterators.SortedIterator=BetaJS.Iterators.Iterator.extend("SortedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.SortedIterator,"constructor"),this.__arr=a.asArray(),this.__arr.sort(b),this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={on:function(a,b,c){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;d=a.shift();)this.__events_mixin_events[d]=this.__events_mixin_events[d]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[d].add({callback:b,context:c});return this},off:function(a,b,c){if(this.__events_mixin_events=this.__events_mixin_events||{},a){a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;d=a.shift();)this.__events_mixin_events[d]&&(this.__events_mixin_events[d].remove_by_filter(function(a){return!(b&&a.callback!=b||c&&a.context!=c)}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]))}else for(d in this.__events_mixin_events)this.__events_mixin_events[d].remove_by_filter(function(a){return!(b&&a.callback!=b||c&&a.context!=c)}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]);return this},trigger:function(a){var b=this;a=a.split(BetaJS.Events.EVENT_SPLITTER);var c,d=Array.prototype.slice.call(arguments,1);if(this.__events_mixin_events){for(;c=a.shift();)this.__events_mixin_events[c]&&this.__events_mixin_events[c].iterate(function(a){a.callback.apply(a.context||b,d)}),this.__events_mixin_events.all&&this.__events_mixin_events.all.iterate(function(a){a.callback.apply(a.context||b,d)});return this}},once:function(a,b,c){var d=this,e=BetaJS.Functions.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(name,e,c)}},BetaJS.Events.Events=BetaJS.Class.extend("Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(a,b,c){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.on(b,c,this)},listenOnce:function(a,b,c){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.once(b,c,this)},listenOff:function(a,b,c){this.__listen_mixin_listen&&(a?(a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(a){a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]},this))}},BetaJS.Events.Listen=BetaJS.Class.extend("Listen",BetaJS.Events.ListenMixin),BetaJS.Properties={},BetaJS.Properties.TYPE_VALUE=0,BetaJS.Properties.TYPE_BINDING=1,BetaJS.Properties.TYPE_COMPUTED=2,BetaJS.Properties.PropertiesMixin={get:function(a){return a in this.__properties?this.__properties[a].value:null},_canSet:function(){return!0},_afterSet:function(){},has:function(a){return a in this.__properties},setAll:function(a){for(var b in a)this.set(b,a[b])},keys:function(a){return BetaJS.Objs.keys(this.__properties,a)},binding:function(a){return{type:BetaJS.Properties.TYPE_BINDING,bindee:this,property:a}},computed:function(a,b){return{type:BetaJS.Properties.TYPE_COMPUTED,func:a,dependencies:b||[]}},_isBinding:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_BINDING&&a.bindee&&a.property},_isComputed:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_COMPUTED&&a.func&&a.dependencies},getAll:function(){var a={};for(var b in this.__properties)a[b]=this.get(b);return a},unset:function(a){if(a in this.__properties){var b=this.__properties[a];if(b.type==BetaJS.Properties.TYPE_BINDING)b.bindee.off("change:"+b.property,null,this.__properties[a]);else if(b.type==BetaJS.Properties.TYPE_COMPUTED){var c=this;BetaJS.Objs.iter(b.dependencies,function(b){c.off("change:"+b,null,this.__properties[a])})}delete this.__properties[a]}},set:function(a,b){if(this.get(a)!=b){var c=this;this.__properties[a],this._isBinding(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_BINDING,bindee:b.bindee,property:b.property,value:b.bindee.get(b.property)},b.bindee.on("change:"+b.property,function(){c.__properties[a].value=b.bindee.get(b.property),c.trigger("change"),c.trigger("change:"+a)},this.__properties[a]),this._afterSet(a,this.__properties[a].value),this.trigger("change"),this.trigger("change:"+a)):this._isComputed(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_COMPUTED,func:b.func,dependencies:b.dependencies,value:b.func.apply(c)},BetaJS.Objs.iter(b.dependencies,function(d){c.on("change:"+d,function(){c.__properties[a].value=b.func.apply(c),c.trigger("change"),c.trigger("change:"+a)},this.__properties[a])},this),this._afterSet(a,this.__properties[a].value),this.trigger("change"),this.trigger("change:"+a)):this._canSet(a,b)&&(this.__properties[a]&&this.__properties[a].type==BetaJS.Properties.TYPE_BINDING?this.__properties[a].bindee.set(this.__properties[a].property,b):(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_VALUE,value:b},this._afterSet(a,b),this.trigger("change"),this.trigger("change:"+a)))}},_notifications:{construct:"__properties_construct",destroy:"__properties_destroy"},__properties_construct:function(){this.__properties={}},__properties_destroy:function(){for(var a in this.__properties)this.unset(a)}},BetaJS.Properties.Properties=BetaJS.Class.extend("Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(a){this._inherited(BetaJS.Properties.Properties,"constructor"),a&&this.setAll(a)}}]),BetaJS.Collections={},BetaJS.Collections.Collection=BetaJS.Class.extend("Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Collections.Collection,"constructor"),a=a||{};var b={};"compare"in a&&(b.compare=a.compare),this.__data=new BetaJS.Lists.ArrayList([],b);var c=this;this.__data._ident_changed=function(a,b){c._index_changed(a,b)},this.__data._re_indexed=function(a){c._re_indexed(a)},this.__data._sorted=function(){c._sorted()},"objects"in a&&this.add_objects(a.objects)},set_compare:function(a){this.__data.set_compare(a)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(a){"off"in a&&a.off(null,null,this)}),this.__data.destroy(),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(a){if(this.exists(a))return null;var b=this.__data.add(a);return null!=b&&(this.trigger("add",a),"on"in a&&a.on("change",function(b,c){this._object_changed(a,b,c)},this)),b},add_objects:function(a){BetaJS.Objs.iter(a,function(a){this.add(a)},this)},exists:function(a){return this.__data.exists(a)},remove:function(a){return this.exists(a)?(this.trigger("remove",a),"off"in a&&a.off(null,null,this),this.__data.remove(a)):null},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a){this.__data.iterate(a)},clear:function(){var a=this;this.iterate(function(b){a.remove(b)})}}]),BetaJS.Collections.FilteredCollection=BetaJS.Collections.Collection.extend("FilteredCollection",{constructor:function(a,b){this.__parent=a,b=b||{},delete b.objects,b.compare=b.compare||a.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",b),"filter"in b&&(this.filter=b.filter);var c=this;this.__parent.iterate(function(a){return c.add(a),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(a,b,c){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",a,b,c),this.filter(a)||this.__selfRemove(a)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"add",a)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",a)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return null==b?null:this.__parent.remove(a)}}),BetaJS.Comparators={byObject:function(a){return function(b,c){for(key in a){var d=b[key]||null,e=c[key]||null;if(e>d)return a[key];if(d>e)return-a[key]}return 0}}},BetaJS.Tokens={generate_token:function(){return Math.random().toString(36).substr(2)}};