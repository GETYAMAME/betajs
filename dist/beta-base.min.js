/*! betajs - v0.0.1 - 2013-04-16, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};BetaJS.Types={is_object:function(t){return"object"==typeof t},is_array:function(t){return"[object Array]"==toString.call(t)},is_undefined:function(t){return t===void 0},is_null:function(t){return null==t},is_none:function(t){return this.is_undefined(t)||this.is_null(t)},is_defined:function(t){return t!==void 0},is_empty:function(t){if(this.is_none(t))return!0;if(this.is_array(t))return 0==t.length;if(this.is_object(t)){for(var e in t)return!1;return!0}return!1},is_string:function(t){return"string"==typeof t},is_function:function(t){return"function"==typeof t}},BetaJS.Strings={nl2br:function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(t){var e=this;return t.replace(this.JS_ESCAPER_REGEX(),function(t){return"\\"+e.JS_ESCAPES[t]})}},BetaJS.Functions={as_method:function(t,e){return function(){return t.apply(e,arguments)}},once:function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}},BetaJS.Objs={clone:function(t,e){return BetaJS.Types.is_object(t)&&e&&e>0?this.extend({},t,e-1):t},extend:function(t,e,i){for(var n in e)t[n]=this.clone(e[n],i);return t},keys:function(t,e){if(BetaJS.Types.is_undefined(e)){var i=[];for(var n in t)i.push(n);return i}var i={};for(var n in t)i[n]=e;return i},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},equals:function(t,e,i){if(i&&i>0){for(var n in t)if(!n in e||!this.equals(t[n],e[n],i-1))return!1;for(var n in e)if(!n in t)return!1;return!0}return t==e},iter:function(t,e,i){if(BetaJS.Types.is_array(t))for(var n=0;t.length>n;++n){var s=i?e.apply(i,[t[n],n]):e(t[n],n);if(BetaJS.Types.is_defined(s)&&!s)return}else for(var r in t){var s=i?e.apply(i,[t[r],r]):e(t[r],r);if(BetaJS.Types.is_defined(s)&&!s)return}}},BetaJS.Ids={__uniqueId:0,uniqueId:function(t){return(t||"")+this.__uniqueId++},objectId:function(t){return t.__cid||(t.__cid=this.uniqueId("cid_")),t.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(t,e,i,n){e=e||[],BetaJS.Types.is_array(e)||(e=[e]),i=i||[],BetaJS.Types.is_array(i)||(i=[i]),n=n||[],BetaJS.Types.is_array(n)||(n=[n]);var s,r=this;BetaJS.Objs.iter(e,function(t){t.hasOwnProperty("constructor")&&(s=t.constructor)}),BetaJS.Types.is_defined(s)||(s=function(){r.apply(this,arguments)}),BetaJS.Objs.extend(s,r),BetaJS.Objs.iter(i,function(t){BetaJS.Objs.extend(s,t)});var o={};if(r.__class_statics_keys)for(var _ in r.__class_statics_keys)s[_]=BetaJS.Objs.clone(r[_],1);BetaJS.Objs.iter(n,function(t){BetaJS.Objs.extend(s,t),BetaJS.Objs.extend(o,BetaJS.Objs.keys(t,!0))}),r.__class_statics_keys&&BetaJS.Objs.extend(o,r.__class_statics_keys),s.__class_statics_keys=o,s.parent=r,s.children=[],s.extend=this.extend,r.children||(r.children=[]),r.children.push(s);var a=function(){};return a.prototype=r.prototype,s.prototype=new a,s.prototype.cls=s,s.classname=t,s.__notifications={},r.__notifications&&BetaJS.Objs.extend(s.__notifications,r.__notifications),BetaJS.Objs.iter(e,function(t){if(BetaJS.Objs.extend(s.prototype,t),t._notifications)for(var e in t._notifications)s.__notifications[e]||(s.__notifications[e]=[]),s.__notifications[e].push(t._notifications[e])}),delete s.prototype._notifications,s},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype._notify=function(t){if(this.cls.__notifications){var e=Array.prototype.slice.call(arguments,1),i=this.cls.__notifications[t];if(i)for(var n in i)this[i[n]].apply(this,e)}},BetaJS.Class.prototype.destroy=function(){this._notify("destroy");for(var t in this)delete this[t]},BetaJS.Class.prototype._inherited=function(t,e){return t.parent.prototype[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(t,e){return t.parent[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={enter:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count++},leave:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count--,1>this.__enter_count&&this.destroy()}},BetaJS.Lists={},BetaJS.Lists.AbstractList=BetaJS.Class.extend("AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(t){var e=null;return this._iterate(function(i,n){return i==t?(e=n,!1):!0}),e},exists:function(t){return null!=this.get_ident(t)},_ident_changed:function(){},constructor:function(t){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,t&&BetaJS.Objs.iter(t,function(t){this.add(t)},this)},add:function(t){var e=this._add(t);return BetaJS.Types.is_defined(e)&&this.__count++,e},count:function(){return this.__count},clear:function(){var t=this;this._iterate(function(e,i){return t.remove_by_ident(i),!0})},remove_by_ident:function(t){var e=this._remove(t);return BetaJS.Types.is_defined(e)&&this.__count--,e},remove:function(t){return this.remove_by_ident(this.get_ident(t))},remove_by_filter:function(t){var e=this;this._iterate(function(i,n){return t(i)&&e.remove_by_ident(n),!0})},get:function(t){return this._get(t)},iterate:function(t){this._iterate(function(e,i){var n=t(e,i);return BetaJS.Types.is_defined(n)?n:!0})}}),BetaJS.Lists.LinkedList=BetaJS.Lists.AbstractList.extend("LinkedList",{constructor:function(t){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",t)},_add:function(t){return this.__last={obj:t,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(t){return t.next?t.next.prev=t.prev:this.__last=t.prev,t.prev?t.prev.next=t.next:this.__first=t.next,t.obj},_get:function(t){return t.obj},_iterate:function(t){for(var e=this.__first;null!=e;){var i=e;if(e=e.next,!t(i.obj,i))return}}}),BetaJS.Lists.ObjectIdList=BetaJS.Lists.AbstractList.extend("ObjectIdList",{constructor:function(t){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",t)},_add:function(t){var e=BetaJS.Ids.objectId(t);return this.__map[e]=t,e},_remove:function(t){var e=this.__map[t];return delete this.__map[t],e},_get:function(t){return this.__map[t]},_iterate:function(t){for(var e in this.__map)t(this.__map[e],e)},get_ident:function(t){return BetaJS.Ids.objectId(t)}}),BetaJS.Lists.ArrayList=BetaJS.Lists.AbstractList.extend("ArrayList",{constructor:function(t,e){this.__items=[],e=e||{},"compare"in e&&(this._compare=e.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",t)},set_sompare:function(t){this._compare=t,t&&this.sort()},get_compare:function(){return this._compare},sort:function(t){if(t=t||this._compare){this.__items.sort(t);for(var e=0;this.__items.length>e;++e)this._ident_changed(this.__items[e],e)}},re_index:function(t){if(!("_compare"in this))return t;var e=0,i=this.__items.length-1,n=this.__items[t];for(t>0&&this._compare(n,this.__items[t-1])>=0&&(e=t),i>t&&0>=this._compare(n,this.__items[t+1])&&(i=t);i-e>1;){var s=Math.floor((i+e)/2);this._compare(n,this.__items[s])>=0?e=s:i=s}for(var s=e;this._compare(n,this.__items[s])>0;)++s;if(t>s)for(var r=t;r>s;--r)this.__items[r]=this.__items[r-1],this._ident_changed(this.__items[r],r);else if(s>t)for(var r=t;s>r;++r)this.__items[r]=this.__items[r+1],this._ident_changed(this.__items[r],r);return this.__items[s]=n,s},_add:function(t){var e=this.__items.length;return this.__items.push(t),this.re_index(e)},_remove:function(t){for(var e=this.__items[t],i=t+1;this.__items.length>i;++i)this.__items[i-1]=this.__items[i],this._ident_changed(this.__items[i-1],i-1);return this.__items.pop(),e},_get:function(t){return this.__items[t]},_iterate:function(t){for(var e=0;this.__items.length>e;++e)t(this.__items[e],e)}}),BetaJS.Lists.IdArrayList=BetaJS.Lists.ArrayList.extend("IdArrayList",{constructor:function(t,e){this.__idToIndex={},this._inherited(BetaJS.Lists.IdArrayList,"constructor",t,e)},_ident_changed:function(t,e){this.__idToIndex[BetaJS.Ids.objectId(t)]=e},_add:function(t){var e=this._inherited(BetaJS.Lists.IdArrayList,"_add",t);return this.__idToIndex[BetaJS.Ids.objectId(t)]=e,e},_remove:function(t){var e=this._inherited(BetaJS.Lists.IdArrayList,"_remove",t);return delete this.__idToIndex[BetaJS.Ids.objectId(e)],e},get_ident:function(t){var e=BetaJS.Ids.objectId(t);return e in this.__idToIndex?this.__idToIndex[e]:null},ident_by_id:function(t){return this.__idToIndex[t]}}),BetaJS.Iterators={},BetaJS.Iterators.Iterator=BetaJS.Class.extend("Iterator"),BetaJS.Iterators.ArrayIterator=BetaJS.Iterators.Iterator.extend("ArrayIterator",{constructor:function(t){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__arr=t,this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Iterators.MappedIterator=BetaJS.Iterators.Iterator.extend("MappedIterator",{constructor:function(t,e){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=t,this.__map=e},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__map(this.__iterator.next())}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={on:function(t,e,i){this.__events=this.__events||{},t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var n;n=t.shift();)this.__events[n]=this.__events[n]||new BetaJS.Lists.LinkedList,this.__events[n].add({callback:e,context:i});return this},off:function(t,e,i){if(this.__events=this.__events||{},t){t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var n;n=t.shift();)this.__events[n]&&(this.__events[n].remove_by_filter(function(t){return!(e&&t.callback!=e||i&&t.context!=i)}),0==this.__events[n].count()&&(this.__events[n].destroy(),delete this.__events[n]))}else for(n in this.__events)this.__events[n].remove_by_filter(function(t){return!(e&&t.callback!=e||i&&t.context!=i)}),0==this.__events[n].count()&&(this.__events[n].destroy(),delete this.__events[n]);return this},trigger:function(t){var e=this;t=t.split(BetaJS.Events.EVENT_SPLITTER);var i,n=Array.prototype.slice.call(arguments,1);if(this.__events){for(;i=t.shift();)this.__events[i]&&this.__events[i].iterate(function(t){t.callback.apply(t.context||e,n)}),this.__events.all&&this.__events.all.iterate(function(t){t.callback.apply(t.context||e,n)});return this}},once:function(t,e,i){var n=this,s=BetaJS.Functions.once(function(){n.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(name,s,i)}},BetaJS.Events.Events=BetaJS.Class.extend("Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(t,e,i){this.__listen||(this.__listen={}),this.__listen[BetaJS.Ids.objectId(t)]=t,t.on(e,i,this)},listenOnce:function(t,e,i){this.__listen||(this.__listen={}),this.__listen[BetaJS.Ids.objectId(t)]=t,t.once(e,i,this)},listenOff:function(t,e,i){this.__listen&&(t?(t.off(e,i,this),e||i||delete this.__listen[BetaJS.Ids.objectId(t)]):BetaJS.Objs.iter(this.__listen,function(t){t.off(e,i,this),e||i||delete this.__listen[BetaJS.Ids.objectId(t)]},this))}},BetaJS.Events.Listen=BetaJS.Class.extend("Listen",BetaJS.Events.ListenMixin),BetaJS.Properties={},BetaJS.Properties.PropertiesMixin={get:function(t){return this.__properties[t]},set:function(t,e){this.__properties||(this.__properties={}),(!t in this.__properties||this.__properties[t]!=e)&&(this.__properties[t]=e,this.trigger("change",t,e),this.trigger("change:"+t,e))},getAll:function(){return BetaJS.Objs.clone(this.__properties||{},1)},setAll:function(t){for(var e in t)this.set(e,t[e])}},BetaJS.Properties.Properties=BetaJS.Class.extend("Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(t){this._inherited(BetaJS.Properties.Properties,"constructor"),t&&this.setAll(t)}}]),BetaJS.Properties.BindablePropertiesMixin={_notifications:{construct:"__bindable_properties_construct",destroy:"__bindable_properties_destroy"},__bindable_properties_construct:function(){this.__properties={}},__bindable_properties_destroy:function(){for(var t in this.__properties)this.__bindable_remove(t)},__bindable_remove:function(t){var e=this.__properties[t];e.bindee&&e.bindee.off("change:"+e.property,null,this),delete this.__properties[t]},get:function(t){var e=this.__properties[t];return null==e?null:e.bindee?e.bindee.get(e.property):e.value},set:function(t,e){if(this.get(t)!=e){var i=this.__properties[t];e.bindee&&e.property?(i&&this.__bindable_remove(t),this.__properties[t]=e,e.bindee.on("change:"+e.property,function(){this.trigger("change"),this.trigger("change:"+t)},this)):i&&i.bindee?i.bindee.set(i.property,e):this.__properties[t]={value:e},this.trigger("change"),this.trigger("change:"+t)}},binding:function(t){return{bindee:this,property:t}},getAll:function(){var t={};for(var e in this.__properties)t[e]=this.get(e);return t},setAll:function(t){for(var e in t)this.set(e,t[e])}},BetaJS.Properties.BindableProperties=BetaJS.Class.extend("BindableProperties",[BetaJS.Events.EventsMixin,BetaJS.Properties.BindablePropertiesMixin,{constructor:function(t){this._inherited(BetaJS.Properties.BindableProperties,"constructor"),t&&this.setAll(t)}}]),BetaJS.Collections={},BetaJS.Collections.Collection=BetaJS.Class.extend("Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Collections.Collection,"constructor"),t=t||{};var e={};"compare"in t&&(e.compare=t.compare),this.__data=new BetaJS.Lists.IdArrayList({},e);var i=this,n=this.__data._ident_changed;this.__data._ident_changed=function(t,e){n.apply(i.__data,arguments),i._index_changed(t,e)},t.objects&&this.addArray(t.objects)},set_compare:function(t){this.__data.set_compare(t)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(t){"off"in t&&t.off(null,null,this)}),this.__data.destroy(),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(t,e){this.trigger("index",t,e)},_object_changed:function(t,e,i){this.trigger("change",t,e,i),this.trigger("change:"+e,t,i),this.__data.re_index(t)},add:function(t){if(this.exists(t))return null;var e=this.__data.add(t);return null!=e&&(this.trigger("add",t),"on"in t&&t.on("change",function(e,i){this._object_changed(t,e,i)},this)),e},addArray:function(t){BetaJS.Objs.iter(t,function(t){this.add(t)},this)},exists:function(t){return this.__data.exists(t)},remove:function(t){return this.exists(t)?(this.trigger("remove",t),"off"in t&&t.off(null,null,this),this.__data.remove(t)):null},getByIndex:function(t){return this.__data.get(t)},getById:function(t){return this.__data.get(this.__data.ident_by_id(t))},getIndex:function(t){return this.__data.get_ident(t)},iterate:function(t){this.__data.iterate(t)}}]),BetaJS.Collections.FilteredCollection=BetaJS.Collections.Collection.extend("FilteredCollection",{constructor:function(t,e){this.__parent=t,e=e||{},delete e.objects,e.compare=e.compare||t.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",e),"filter"in e&&(this.filter=e.filter);var i=this;this.__parent.iterate(function(t){return i.add(t),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(t,e,i){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",t,e,i),this.filter(t)||this.__selfRemove(t)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"add",t)},add:function(t){if(this.exists(t)||!this.filter(t))return null;var e=this.__selfAdd(t);return this.__parent.add(t),e},__selfRemove:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",t)},remove:function(t){if(!this.exists(t))return null;var e=this.__selfRemove(t);return null==e?null:this.__parent.remove(t)}});