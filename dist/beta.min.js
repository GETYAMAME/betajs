/*! betajs - v0.0.1 - 2013-09-27, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};"undefined"!=typeof module&&"exports"in module&&(module.exports=BetaJS),BetaJS.Types={is_object:function(a){return"object"==typeof a},is_array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null==a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){if(this.is_none(a))return!0;if(this.is_array(a))return 0==a.length;if(this.is_object(a)){for(var b in a)return!1;return!0}return!1},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(BetaJS.Types.is_boolean(a)&&BetaJS.Types.is_boolean(b))return a==b?0:a?1:-1;if(BetaJS.Types.is_array(a)&&BetaJS.Types.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!=g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)},parseBool:function(a){return this.is_boolean(a)?a:"true"==a?!0:"false"==a?!1:null}},BetaJS.Strings={nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})},starts_with:function(a,b){return a.substring(0,b.length)==b},ends_with:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},strip_start:function(a,b){return this.starts_with(a,b)?a.substring(b.length):a},last_after:function(a,b){return a.substring(a.lastIndexOf(b)+b.length,a.length)}},BetaJS.Functions={as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}},BetaJS.Scopes={base:function(a,b){if(!BetaJS.Types.is_string(a))return a;if(b)return b[a];try{if(window)return window[a]}catch(c){}try{if(global&&global[a])return global[a]}catch(c){}try{if(module&&module.exports)return module.exports}catch(c){}return null},resolve:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=a.split("."),d=this.base(c[0],b),e=1;e<c.length;++e)d=d[c[e]];return d},touch:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=a.split("."),d=this.base(c[0],b),e=1;e<c.length;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d},set:function(a,b,c){if(!BetaJS.Types.is_string(b))return b;for(var d=b.split("."),e=this.base(d[0],c),f=1;f<d.length-1;++f)d[f]in e||(e[d[f]]={}),e=e[d[f]];return d.length>1&&(e[d[d.length-1]]=a),a}},BetaJS.Objs={count:function(a){if(BetaJS.Types.is_array(a))return a.length;var b=0;for(var c in a)++b;return b},clone:function(a,b){return!b||0>=b?a:BetaJS.Types.is_array(a)?a.slice(0):BetaJS.Types.is_object(a)?this.extend({},a,b-1):a},extend:function(a,b,c){for(var d in b)a[d]=this.clone(b[d],c);return a},keys:function(a,b){if(BetaJS.Types.is_undefined(b)){var c=[];for(var d in a)c.push(d);return c}var c={};for(var d in a)c[d]=b;return c},map:function(a,b,c){if(BetaJS.Types.is_array(a)){for(var d=[],e=0;e<a.length;++e)d.push(c?b.apply(c,a[e],e):b(a[e],e));return d}var d={};for(var f in a)d[f]=c?b.apply(c,a[f],f):b(a[f],f)},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(a,b,c){if(BetaJS.Types.is_array(a)){for(var d=[],e=0;e<a.length;++e)(c?b.apply(c,[a[e],e]):b(a[e],e))&&d.push(a[e]);return d}var d={};for(var f in a)(c?b.apply(c,[a[f],f]):b(a[f],f))&&(d[f]=a[f]);return d},equals:function(a,b,c){if(c&&c>0){for(var d in a)if(!d in b||!this.equals(a[d],b[d],c-1))return!1;for(var d in b)if(!d in a)return!1;return!0}return a==b},iter:function(a,b,c){if(BetaJS.Types.is_array(a))for(var d=0;d<a.length;++d){var e=c?b.apply(c,[a[d],d]):b(a[d],d);if(BetaJS.Types.is_defined(e)&&!e)return!1}else for(var f in a){var e=c?b.apply(c,[a[f],f]):b(a[f],f);if(BetaJS.Types.is_defined(e)&&!e)return!1}return!0},intersect:function(a,b){var c={};for(var d in a)d in b&&(c[d]=a[d]);return c},contains_key:function(a,b){return BetaJS.Types.is_array(a)?BetaJS.Types.is_defined(a[b]):b in a},contains_value:function(a,b){if(BetaJS.Types.is_array(a)){for(var c=0;c<a.length;++c)if(a[c]===b)return!0}else for(var d in a)if(a[d]===b)return!0;return!1}},BetaJS.Ids={__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a){return a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(a,b,c,d){b=b||[],BetaJS.Types.is_array(b)||(b=[b]),c=c||[],BetaJS.Types.is_array(c)||(c=[c]),d=d||[],BetaJS.Types.is_array(d)||(d=[d]);var e,f=this;BetaJS.Objs.iter(b,function(a){a.hasOwnProperty("constructor")&&(e=a.constructor)}),BetaJS.Types.is_defined(e)||(e=function(){f.apply(this,arguments)}),BetaJS.Objs.extend(e,f),BetaJS.Objs.iter(c,function(a){BetaJS.Objs.extend(e,a)});var g={};if(f.__class_statics_keys)for(var h in f.__class_statics_keys)e[h]=BetaJS.Objs.clone(f[h],1);BetaJS.Objs.iter(d,function(a){BetaJS.Objs.extend(e,a),BetaJS.Objs.extend(g,BetaJS.Objs.keys(a,!0))}),f.__class_statics_keys&&BetaJS.Objs.extend(g,f.__class_statics_keys),e.__class_statics_keys=g,e.parent=f,e.children=[],e.extend=this.extend,f.children||(f.children=[]),f.children.push(e);var i=function(){};return i.prototype=f.prototype,e.prototype=new i,e.prototype.cls=e,e.classname=a,a&&BetaJS.Scopes.set(e,a),e.__notifications={},f.__notifications&&BetaJS.Objs.extend(e.__notifications,f.__notifications,1),BetaJS.Objs.iter(b,function(a){if(BetaJS.Objs.extend(e.prototype,a),"constructor"in a&&(e.prototype.constructor=a.constructor),a._notifications)for(var b in a._notifications)e.__notifications[b]||(e.__notifications[b]=[]),e.__notifications[b].push(a._notifications[b])}),delete e.prototype._notifications,e},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype.as_method=function(a){return BetaJS.Functions.as_method(this[a],this)},BetaJS.Class.prototype._auto_destroy=function(a){return this.__auto_destroy_list||(this.__auto_destroy_list=[]),this.__auto_destroy_list.push(a),a},BetaJS.Class.prototype._notify=function(a){if(this.cls.__notifications){var b=Array.prototype.slice.call(arguments,1),c=this.cls.__notifications[a];if(c)for(var d in c)this[c[d]].apply(this,b)}},BetaJS.Class.prototype.destroy=function(){if(this._notify("destroy"),this.__auto_destroy_list)for(var a=0;a<this.__auto_destroy_list.length;++a)"destroy"in this.__auto_destroy_list[a]&&this.__auto_destroy_list[a].destroy();for(var b in this)delete this[b]},BetaJS.Class.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},BetaJS.Class.ancestor_of=function(a){return this==a||this!=BetaJS.Class&&this.parent.ancestor_of(a)},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Class.is_class_instance=function(a){return null!=a&&BetaJS.Types.is_object(a)&&"_inherited"in a&&"cls"in a},BetaJS.Exceptions={ensure:function(a){return null!=a&&BetaJS.Types.is_object(a)&&"instance_of"in a&&a.instance_of(BetaJS.Exceptions.Exception)?a:new BetaJS.Exceptions.NativeException(a)}},BetaJS.Class.extend("BetaJS.Exceptions.Exception",{constructor:function(a){this._inherited(BetaJS.Exceptions.Exception,"constructor"),this.__message=a},assert:function(a){if(!this.instance_of(a))throw this;return this},callstack:function(){for(var a=[],b=arguments.callee.caller;b;)a.push(b.toString()),b=b.caller;return a},callstack_to_string:function(){return this.callstack().join("\n")},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()+"\n\nCall Stack:\n"+this.callstack_to_string()}},{ensure:function(a){var a=BetaJS.Exceptions.ensure(a);return a.assert(this),a}}),BetaJS.Exceptions.Exception.extend("BetaJS.Exceptions.NativeException",{constructor:function(a){this._inherited(BetaJS.Exceptions.NativeException,"constructor",a.toString()),this.__object=a},object:function(){return this.__object}}),BetaJS.Class.extend("BetaJS.Lists.AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return null!=this.get_ident(a)},_ident_changed:function(){},constructor:function(a){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,a&&BetaJS.Objs.iter(a,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return BetaJS.Types.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){var a=this;this._iterate(function(b,c){return a.remove_by_ident(c),!0})},remove_by_ident:function(a){var b=this._remove(a);return BetaJS.Types.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){var b=this;this._iterate(function(c,d){return a(c)&&b.remove_by_ident(d),!0})},get:function(a){return this._get(a)},iterate:function(a){this._iterate(function(b,c){var d=a(b,c);return BetaJS.Types.is_defined(d)?d:!0})}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.LinkedList",{constructor:function(a){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",a)},_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a){for(var b=this.__first;null!=b;){var c=b;if(b=b.next,!a(c.obj,c))return}}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.ObjectIdList",{constructor:function(a){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",a)},_add:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]=a,b},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a){for(var b in this.__map)a(this.__map[b],b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]?b:null}}),BetaJS.Lists.AbstractList.extend("BetaJS.Lists.ArrayList",{constructor:function(a,b){this.__idToIndex={},this.__items=[],b=b||{},"compare"in b&&(this._compare=b.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",a)},set_compare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!("_compare"in this))return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(){},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[BetaJS.Ids.objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[BetaJS.Ids.objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a){for(var b=BetaJS.Objs.clone(this.__items,1),c=0;c<b.length;++c)a(b[c],this.get_ident(b[c]))},__ident_changed:function(a,b){this.__idToIndex[BetaJS.Ids.objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null},ident_by_id:function(a){return this.__idToIndex[a]}}),BetaJS.Iterators={ensure:function(a){return null==a?new BetaJS.Iterators.ArrayIterator([]):a.instance_of(BetaJS.Iterators.Iterator)?a:BetaJS.Types.is_array(a)?new BetaJS.Iterators.ArrayIterator(a):new BetaJS.Iterators.ArrayIterator([a])}},BetaJS.Class.extend("BetaJS.Iterators.Iterator",{asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.ArrayIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__array=a,this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){return this.__array[this.__i++]}}),BetaJS.Iterators.ArrayIterator.extend("BetaJS.Iterators.ObjectKeysIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ObjectKeysIterator,"constructor",BetaJS.Objs.keys(a))}}),BetaJS.Iterators.ArrayIterator.extend("BetaJS.Iterators.ObjectValuesIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ObjectValuesIterator,"constructor",BetaJS.Objs.values(a))}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.MappedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=a,this.__map=b},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map(this.__iterator.next()):null}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.FilteredIterator",{constructor:function(a,b,c){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=a,this.__filter=b,this.__context=c||this,this.__next=null},hasNext:function(){return this.__crawl(),null!=this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;null==this.__next&&this.__iterator.hasNext();){var a=this.__iterator.next();this.__filter_func(a)&&(this.__next=a)}},__filter_func:function(a){return this.__filter.apply(this.__context,[a])}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.SkipIterator",{constructor:function(a,b){for(this._inherited(BetaJS.Iterators.SkipIterator,"constructor"),this.__iterator=a;b>0;)a.next(),b--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.LimitIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.LimitIterator,"constructor"),this.__iterator=a,this.__limit=b},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}),BetaJS.Iterators.Iterator.extend("BetaJS.Iterators.SortedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.SortedIterator,"constructor"),this.__array=a.asArray(),this.__array.sort(b),this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){return this.__array[this.__i++]}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={__create_event_object:function(a,b,c){c=c||{};var d={callback:a,context:b};return c.min_delay&&(d.min_delay=new BetaJS.Timers.Timer({delay:c.min_delay,once:!0,start:!1,context:this,fire:function(){d.max_delay&&d.max_delay.stop(),d.callback.apply(d.context||this,d.params)}})),c.max_delay&&(d.max_delay=new BetaJS.Timers.Timer({delay:c.max_delay,once:!0,start:!1,context:this,fire:function(){d.min_delay&&d.min_delay.stop(),d.callback.apply(d.context||this,d.params)}})),d},__destroy_event_object:function(a){a.min_delay&&a.min_delay.destroy(),a.max_delay&&a.max_delay.destroy()},__call_event_object:function(a,b){a.min_delay&&a.min_delay.restart(),a.max_delay&&a.max_delay.start(),a.min_delay||a.max_delay?a.params=b:a.callback.apply(a.context||this,b)},on:function(a,b,c,d){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var e;e=a.shift();)this.__events_mixin_events[e]=this.__events_mixin_events[e]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[e].add(this.__create_event_object(b,c,d));return this},off:function(a,b,c){if(this.__events_mixin_events=this.__events_mixin_events||{},a){a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;d=a.shift();)this.__events_mixin_events[d]&&(this.__events_mixin_events[d].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]))}else for(d in this.__events_mixin_events)this.__events_mixin_events[d].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]);return this},trigger:function(a){var b=this;a=a.split(BetaJS.Events.EVENT_SPLITTER);var c,d=Array.prototype.slice.call(arguments,1);if(this.__events_mixin_events){for(;c=a.shift();)this.__events_mixin_events&&this.__events_mixin_events[c]&&this.__events_mixin_events[c].iterate(function(a){b.__call_event_object(a,d)}),this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(a){b.__call_event_object(a,d)});return this}},once:function(a,b,c,d){var e=this,f=BetaJS.Functions.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(name,f,c,d)},delegateEvents:function(a,b){BetaJS.Types.is_array(a)||(a=[a]),BetaJS.Objs.iter(a,function(a){b.on(a,function(){var b=Array.prototype.slice.call(arguments,0);this.trigger.apply(this,[a].concat(b))},this)},this)}},BetaJS.Class.extend("BetaJS.Events.Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(a,b,c,d){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.on(b,c,this,d)},listenOnce:function(a,b,c,d){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.once(b,c,this,d)},listenOff:function(a,b,c){this.__listen_mixin_listen&&(a?(a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(a){a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]},this))}},BetaJS.Class.extend("BetaJS.Events.Listen",BetaJS.Events.ListenMixin),BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={_notifications:{construct:"__initialize_auto_destroy",destroy:"__finalize_auto_destroy"},__initialize_auto_destroy:function(){this.__auto_destroy={}},__finalize_auto_destroy:function(){var a=this.__auto_destroy;this.__auto_destroy={},BetaJS.Objs.iter(a,function(a){a.unregister(this)},this)},register_auto_destroy:function(a){a.cid()in this.__auto_destroy||(this.__auto_destroy[a.cid()]=a,a.register(this),this._notify("register_auto_destroy",a))},unregister_auto_destroy:function(a){a.cid()in this.__auto_destroy&&(this._notify("unregister_auto_destroy",a),delete this.__auto_destroy[a.cid()],a.unregister(this),BetaJS.Types.is_empty(this.__auto_destroy)&&this.destroy())}},BetaJS.Class.extend("BetaJS.Classes.AutoDestroyObject",[BetaJS.Ids.ClientIdMixin,{constructor:function(){this._inherited(BetaJS.Classes.AutoDestroyObject,"constructor"),this.__objects={}},register:function(a){var b=BetaJS.Ids.objectId(a);b in this.__objects||(this.__objects[b]=a,a.register_auto_destroy(this))},unregister:function(a){var b=BetaJS.Ids.objectId(a);b in this.__objects&&(delete this.__objects[b],a.unregister_auto_destroy(this))},clear:function(){BetaJS.Objs.iter(this.__objects,function(a){this.unregister(a)},this)}}]),BetaJS.Class.extend("BetaJS.Classes.ObjectCache",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Classes.ObjectCache,"constructor"),this.__size="size"in a?a.size:null,this.__destroy_on_remove="destroy_on_remove"in a?a.destroy_on_remove:!0,this.__id_to_container={},this.__first=null,this.__last=null,this.__count=0},destroy:function(){this.clear(),this._inherited(BetaJS.Classes.ObjectCache,"destroy")},add:function(a){if(!this.get(a)){null!=this.__size&&this.__count>=this.__size&&this.__first&&this.remove(this.__first.object);var b={object:a,prev:this.__last,next:null};this.__id_to_container[BetaJS.Ids.objectId(a)]=b,this.__first?this.__last.next=b:this.__first=b,this.__last=b,this.__count++,this.trigger("cache",a)}},remove:function(a){BetaJS.Class.is_class_instance(a)&&(a=BetaJS.Ids.objectId(a));var b=this.__id_to_container[a];b&&(delete this.__id_to_container[a],b.next?b.next.prev=b.prev:this.__last=b.prev,b.prev?b.prev.next=b.next:this.__first=b.next,this.__count--,this.trigger("release",b.object),this.__destroy_on_remove&&b.object.destroy())},get:function(a){return BetaJS.Class.is_class_instance(a)&&(a=BetaJS.Ids.objectId(a)),this.__id_to_container[a]?this.__id_to_container[a].object:null},clear:function(){BetaJS.Objs.iter(this.__id_to_container,function(a){this.remove(a.object)},this)}}]),BetaJS.Properties={},BetaJS.Properties.TYPE_VALUE=0,BetaJS.Properties.TYPE_BINDING=1,BetaJS.Properties.TYPE_COMPUTED=2,BetaJS.Properties.PropertiesMixin={get:function(a){return a in this.__properties?this.__properties[a].value:null},_canSet:function(){return!0},_beforeSet:function(a,b){return b},_afterSet:function(){},has:function(a){return a in this.__properties},setAll:function(a,b){for(var c in a)this.set(c,a[c],b)},keys:function(a){return BetaJS.Objs.keys(this.__properties,a)},binding:function(a){return{type:BetaJS.Properties.TYPE_BINDING,bindee:this,property:a}},computed:function(a,b){return{type:BetaJS.Properties.TYPE_COMPUTED,func:a,dependencies:b||[]}},_isBinding:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_BINDING&&a.bindee&&a.property},_isComputed:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_COMPUTED&&a.func&&a.dependencies},getAll:function(){var a={};for(var b in this.__properties)a[b]=this.get(b);return a},unset:function(a){if(a in this.__properties){var b=this.__properties[a];if(b.type==BetaJS.Properties.TYPE_BINDING)b.bindee.off("change:"+b.property,null,this.__properties[a]);else if(b.type==BetaJS.Properties.TYPE_COMPUTED){var c=this;BetaJS.Objs.iter(b.dependencies,function(d){this._isBinding(d)?d.bindee.off("change:"+d.property,null,this.__properties[a]):this._isTimer(d)?b.timers[d].destroy:c.off("change:"+d,null,this.__properties[a])},this)}delete this.__properties[a]}},_set_changed:function(a,b,c){this._afterSet(a,this.get(a),b,c),this.trigger("change",a,this.get(a),b,c),this.trigger("change:"+a,this.get(a),b,c)},_isTimer:function(){return BetaJS.Strings.starts_with("dep","timer:")},_parseTimer:function(){return parseInt(BetaJS.Strings.strip_start("timer:"))},set:function(a,b,c){var d=this.get(a);if(d!=b){var e=this;this.__properties[a],this._isBinding(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_BINDING,bindee:b.bindee,property:b.property,value:b.bindee.get(b.property)},b.bindee.on("change:"+b.property,function(){var c=e.__properties[a].value;e.__properties[a].value=b.bindee.get(b.property),e._set_changed(a,c)},this.__properties[a]),this._set_changed(a,d,c)):this._isComputed(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_COMPUTED,func:b.func,dependencies:b.dependencies,value:b.func.apply(e),timers:{}},BetaJS.Objs.iter(b.dependencies,function(c){this._isBinding(c)?c.bindee.on("change:"+c.property,function(){var c=e.__properties[a].value;e.__properties[a].value=b.func.apply(e),e._set_changed(a,c)},this.__properties[a]):this._isTimer(c)?this.__properties[a].timers[c]=new BetaJS.Timers.Timer({delay:this._parseTimer(c),fire:function(){var c=e.__properties[a].value;e.__properties[a].value=b.func.apply(e),e._set_changed(a,c)}}):e.on("change:"+c,function(){var c=e.__properties[a].value;e.__properties[a].value=b.func.apply(e),e._set_changed(a,c)},this.__properties[a])},this),this._set_changed(a,d)):(b=this._beforeSet(a,b),this._canSet(a,b)&&(this.__properties[a]&&this.__properties[a].type==BetaJS.Properties.TYPE_BINDING?this.__properties[a].bindee.set(this.__properties[a].property,b):(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_VALUE,value:b},this._set_changed(a,d,c))))}},_notifications:{construct:"__properties_construct",destroy:"__properties_destroy"},__properties_construct:function(){this.__properties={}},__properties_destroy:function(){for(var a in this.__properties)this.unset(a)}},BetaJS.Class.extend("BetaJS.Properties.Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(a){this._inherited(BetaJS.Properties.Properties,"constructor"),a&&this.setAll(a)}}]),BetaJS.Class.extend("BetaJS.Collections.Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Collections.Collection,"constructor"),a=a||{};var b={};"compare"in a&&(b.compare=a.compare),this.__data=new BetaJS.Lists.ArrayList([],b);var c=this;this.__data._ident_changed=function(a,b){c._index_changed(a,b)},this.__data._re_indexed=function(a){c._re_indexed(a)},this.__data._sorted=function(){c._sorted()},"objects"in a&&this.add_objects(a.objects)},set_compare:function(a){this.__data.set_compare(a)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(a){"off"in a&&a.off(null,null,this)}),this.__data.destroy(),this.trigger("destroy"),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(a){if(this.exists(a))return null;var b=this.__data.add(a);return null!=b&&(this.trigger("add",a),"on"in a&&a.on("change",function(b,c){this._object_changed(a,b,c)},this)),b},add_objects:function(a){BetaJS.Objs.iter(a,function(a){this.add(a)},this)},exists:function(a){return this.__data.exists(a)},remove:function(a){if(!this.exists(a))return null;this.trigger("remove",a),"off"in a&&a.off(null,null,this);var b=this.__data.remove(a);return b},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a){this.__data.iterate(a)},clear:function(){var a=this;this.iterate(function(b){a.remove(b)})}}]),BetaJS.Collections.Collection.extend("BetaJS.Collections.FilteredCollection",{constructor:function(a,b){this.__parent=a,b=b||{},delete b.objects,b.compare=b.compare||a.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",b),"filter"in b&&(this.filter=b.filter);var c=this;this.__parent.iterate(function(a){return c.add(a),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(a,b,c){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",a,b,c),this.filter(a)||this.__selfRemove(a)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"add",a)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",a)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return null==b?null:this.__parent.remove(a)}}),BetaJS.Comparators={byObject:function(a){return function(b,c){for(key in a){var d=b[key]||null,e=c[key]||null,f=BetaJS.Comparators.byValue(d,e);if(0!=f)return f*a[key]}return 0}},byValue:function(a,b){return BetaJS.Types.is_string(a)?a.localCompare(b):b>a?-1:a>b?1:0}},BetaJS.Sort={dependency_sort:function(a,b,c,d){for(var e=BetaJS.Types.is_string(b)?function(a){return a[b]}:b,f=BetaJS.Types.is_string(c)?function(a){return a[c]}:c,g=BetaJS.Types.is_string(d)?function(a){return a[d]}:d,h=a.length,i=[],j={},k={},l=0;h>l;++l){k[l]=!0;var m=e(a[l],l);j[m]=l,i.push({before:{},after:{}})}for(var l=0;h>l;++l)BetaJS.Objs.iter(f(a[l],l)||[],function(a){var b=j[a];BetaJS.Types.is_defined(b)&&(i[l].before[b]=!0,i[b].after[l]=!0)}),BetaJS.Objs.iter(g(a[l])||[],function(a){var b=j[a];BetaJS.Types.is_defined(b)&&(i[l].after[b]=!0,i[b].before[l]=!0)});for(var n=[];!BetaJS.Types.is_empty(k);)for(var l in k)if(BetaJS.Types.is_empty(i[l].after)){delete k[l],n.push(a[l]);for(var c in i[l].before)delete i[c].after[l]}return n}},BetaJS.Tokens={generate_token:function(a){a=a||16;for(var b="";b.length<a;)b+=Math.random().toString(36).substr(2);return b.substr(0,a)}},BetaJS.Locales={__data:{},get:function(a){return a in this.__data?this.__data[a]:a},register:function(a,b){b=b?b+".":"";for(var c in a)this.__data[b+c]=a[c]}},BetaJS.Time={format_time:function(a,b){var c=this.seconds(a),d=this.minutes(a),e=this.hours(a),f={hh:10>e?"0"+e:e,h:e,mm:10>d?"0"+d:d,m:d,ss:10>c?"0"+c:c,s:c};for(var g in f)b=b.replace(g,f[g]);return b},make:function(a){var b=0,c={hours:60,minutes:60,seconds:60,milliseconds:1e3};for(var d in c)b*=c[d],d in a&&(b+=a[d]);return b},seconds:function(a){return Math.floor(a/1e3)%60},minutes:function(a){return Math.floor(a/60/1e3)%60},hours:function(a){return Math.floor(a/60/60/1e3)%24},days:function(a){return Math.floor(a/24/60/60/1e3)},now:function(){var a=new Date;return a.getTime()},ago:function(a){return this.now()-a},days_ago:function(a){return this.days(this.ago(a))},format_ago:function(a){return this.days_ago(a)>1?this.format(a,{time:!1}):this.format_period(Math.max(this.ago(a),0))+" ago"},format_period:function(a){return a=Math.round(a/1e3),60>a?a+" "+BetaJS.Locales.get(1==a?"second":"seconds"):(a=Math.round(a/60),60>a?a+" "+BetaJS.Locales.get(1==a?"minute":"minutes"):(a=Math.round(a/60),24>a?a+" "+BetaJS.Locales.get(1==a?"hour":"hours"):(a=Math.round(a/24),a+" "+BetaJS.Locales.get(1==a?"day":"days"))))},format:function(a,b){b=BetaJS.Objs.extend({time:!0,date:!0,locale:!0},b||{});var c=new Date(a);return b.locale?b.date?b.time?c.toLocaleString():c.toLocaleDateString():c.toLocaleTimeString():b.date?b.time?c.toString():c.toDateString():c.toTimeString()}},BetaJS.Class.extend("BetaJS.Timers.Timer",{constructor:function(a){this._inherited(BetaJS.Timers.Timer,"constructor"),a=BetaJS.Objs.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1},a),this.__delay=a.delay,this.__destroy_on_fire=a.destroy_on_fire,this.__once=a.once,this.__fire=a.fire,this.__context=a.context,this.__started=!1,a.start&&this.start()},destroy:function(){this.stop(),this._inherited(BetaJS.Timers.Timer,"destroy")},fire:function(){this.__once&&(this.__started=!1),this.__fire&&this.__fire.apply(this.__context,[this]),this.__destroy_on_fire&&this.destroy()},stop:function(){this.__started&&(this.__once?clearTimeout(this.__timer):clearInterval(this.__timer),this.__started=!1)
},start:function(){if(!this.__started){var a=this;this.__timer=this.__once?setTimeout(function(){a.fire()},this.__delay):setInterval(function(){a.fire()},this.__delay),this.__started=!0}},restart:function(){this.stop(),this.start()}}),BetaJS.Net=BetaJS.Net||{},BetaJS.Net.Uri={encodeUriParams:function(a,b){b=b||"";var c=[];return BetaJS.Objs.iter(a,function(a,d){BetaJS.Types.is_object(a)?c=c.concat(this.encodeUriParams(a,b+d+"_")):c.push(b+d+"="+encodeURI(a))},this),c.join("&")},parse:function(a,b){for(var c=b?this.__parse_strict_regex:this.__parse_loose_regex,d=c.exec(a),e={},f=14;f--;)e[this.__parse_key[f]]=d[f]||"";return e.queryKey={},e[this.__parse_key[12]].replace(this.__parse_key_parser,function(a,b,c){b&&(e.queryKey[b]=c)}),e},__parse_strict_regex:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_loose_regex:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,__parse_key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],__parse_key_parser:/(?:^|&)([^&=]*)=?([^&]*)/g},BetaJS.Class.extend("BetaJS.Net.AbstractAjax",{constructor:function(a){this._inherited(BetaJS.Net.AbstractAjax,"constructor"),this.__options=BetaJS.Objs.extend({method:"GET",data:{}},a)},syncCall:function(a){var b=BetaJS.Objs.clone(this.__options,1);b=BetaJS.Objs.extend(b,a);var c=b.success_callback;delete b.success_callback;var d=b.failure_callback;delete b.failure_callback;var e=b.complete_callback;delete b.complete_callback;try{var f=this._syncCall(b);return c&&c(f),e&&e(),f}catch(g){if(g=BetaJS.Exceptions.ensure(g),g.assert(BetaJS.Net.AjaxException),!d)throw g;d(g.status_code(),g.status_text(),g.data())}},asyncCall:function(a){var b=BetaJS.Objs.clone(this.__options,1);b=BetaJS.Objs.extend(b,a);var c=b.success_callback;delete b.success_callback;var d=b.failure_callback;delete b.failure_callback;var e=b.complete_callback;delete b.complete_callback;try{var f=this._asyncCall(BetaJS.Objs.extend({success:function(a){c&&c(a),e&&e()},failure:function(a,b,c){if(!d)throw new BetaJS.Net.AjaxException(a,b,c);d(a,b,c),e&&e()}},b));return f}catch(g){if(g=BetaJS.Exceptions.ensure(g),g.assert(BetaJS.Net.AjaxException),!d)throw g;d(g.status_code(),g.status_text(),g.data())}},call:function(a){if(!("async"in a))return!1;var b=a.async;return delete a.async,b?this.asyncCall(a):this.syncCall(a)},_syncCall:function(){},_asyncCall:function(){}}),BetaJS.Exceptions.Exception.extend("BetaJS.Net.AjaxException",{constructor:function(a,b,c){this._inherited(BetaJS.Net.AjaxException,"constructor",a+": "+b),this.__status_code=a,this.__status_text=b,this.__data=c},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data}}),BetaJS.Net.AbstractAjax.extend("BetaJS.Net.JQueryAjax",{_syncCall:function(a){var b;return BetaJS.$.ajax({type:a.method,async:!1,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){b=a},error:function(a,b,c){throw new BetaJS.Net.AjaxException(a.status,c,JSON.parse(a.responseText))}}),b},_asyncCall:function(a){BetaJS.$.ajax({type:a.method,async:!0,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(b){a.success(b)},error:function(b,c,d){a.failure(b.status,d,JSON.parse(b.responseText))}})}}),BetaJS.Queries={__increase_dependency:function(a,b){return a in b?b[a]++:b[a]=1,b},__dependencies_queries:function(a,b){return BetaJS.Objs.iter(a,function(a){b=this.__dependencies_query(a,b)},this),b},__dependencies_query:function(a,b){for(key in a)b=this.__dependencies_pair(key,a[key],b);return b},__dependencies_pair:function(a,b,c){return"$or"==a||"$and"==a?this.__dependencies_queries(b,c):this.__increase_dependency(a,c)},dependencies:function(a){return this.__dependencies_query(a,{})},__evaluate_query:function(a,b){for(var c in a)if(!this.__evaluate_pair(c,a[c],b))return!1;return!0},__evaluate_pair:function(a,b,c){return"$or"==a?this.__evaluate_or(b,c):"$and"==a?this.__evaluate_and(b,c):this.__evaluate_value(b,c[a])},__evaluate_value:function(a,b){if(BetaJS.Types.is_object(a)){var c=!0;return BetaJS.Objs.iter(a,function(a,d){"$in"==d&&(c=c&&BetaJS.Objs.contains_value(a,b)),"$gt"==d&&(c=c&&b>=a),"$gtic"==d&&(c=c&&b.toLowerCase()>=a.toLowerCase()),"$lt"==d&&(c=c&&a>=b),"$ltic"==d&&(c=c&&b.toLowerCase()<=a.toLowerCase()),"$sw"==d&&(c=c&&0==b.indexOf(a)),"$swic"==d&&(c=c&&0==b.toLowerCase().indexOf(a.toLowerCase()))},this),c}return a==b},__evaluate_or:function(a,b){return BetaJS.Objs.iter(a,function(a){return this.__evaluate_query(a,b)?!0:void 0},this),!1},__evaluate_and:function(a,b){return BetaJS.Objs.iter(a,function(a){return this.__evaluate_query(a,b)?void 0:!1},this),!0},format:function(a){return BetaJS.Class.is_class_instance(a)?a.format():JSON.stringify(a)},overloaded_evaluate:function(a,b){return BetaJS.Class.is_class_instance(a)?a.evaluate(b):BetaJS.Types.is_function(a)?a(b):this.evaluate(a,b)},evaluate:function(a,b){return this.__evaluate_query(a,b)},emulate:function(a,b,c){var d=b.apply(c||this,{}),e=d;return null==d?e=BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(d)&&(e=BetaJS.Iterators.ArrayIterator(d)),new BetaJS.Iterators.FilteredIterator(e,function(b){return BetaJS.Queries.evaluate(a,b)})}},BetaJS.Queries.Constrained={make:function(a,b){return{query:a,options:b||{}}},format:function(a){var b=a.query;a.query=BetaJS.Queries.format(b);var c=JSON.stringify(a);return a.query=b,c},emulate:function(a,b,c,d,e){var f=a.query,g=a.options,h={},i={};"sort"in g&&"sort"in b&&(i.sort=g.sort),h=f,("query"in b||BetaJS.Types.is_empty(f))&&(h=f,(!("sort"in g)||"sort"in b)&&("skip"in g&&"skip"in b&&(i.skip=g.skip),"limit"in g&&"limit"in b&&(i.limit=g.limit)));var j=[h,i];e&&j.push(e);var k=function(a){var c=a;return null==a?c=new BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(a)&&(c=new BetaJS.Iterators.ArrayIterator(a)),"query"in b||BetaJS.Types.is_empty(f)||(c=new BetaJS.Iterators.FilteredIterator(c,function(a){return BetaJS.Queries.evaluate(f,a)})),"sort"in g&&!("sort"in i)&&(c=new BetaJS.Iterators.SortedIterator(c,BetaJS.Comparators.byObject(g.sort))),"skip"in g&&!("skip"in i)&&(c=new BetaJS.Iterators.SkipIterator(c,g.skip)),"limit"in g&&!("limit"in i)&&(c=new BetaJS.Iterators.LimitIterator(c,g.limit)),e&&e.success&&e.success(c),c},l=function(a){if(!e||!e.exception)throw a;e.exception(a)};if(e)c.apply(d||this,[h,i,{success:k,exception:l}]);else try{var m=c.apply(d||this,[h,i]);return k(m)}catch(n){l(n)}}},BetaJS.Collections.Collection.extend("BetaJS.Collections.QueryCollection",{constructor:function(a){this._inherited(BetaJS.Collections.QueryCollection,"constructor",a),this.__query=BetaJS.Objs.extend({func:null,select:{},skip:0,limit:null,forward_steps:null,backward_steps:null,range:null,count:null,sort:{}},a.query),"objects"in a||(a.objects=this.__execute_query(this.__query.skip,this.__query.limit,!0))},__execute_query:function(a,b,c){a=Math.max(a,0);var d={};if(null==this.__query.sort||BetaJS.Types.is_empty(this.__query.sort)||(d.sort=this.__query.sort),c){a>0&&(d.skip=a),null!=b&&(d.limit=b);var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.skip=a,this.__query.limit=b,this.__query.count=null==b||f.length<b?a+f.length:null,this.clear(),this.add_objects(f)}else if(a<this.__query.skip){b=this.__query.skip-a,a>0&&(d.skip=a),d.limit=b;var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.skip=a,this.__query.limit=null==this.__query.limit?null:this.__query.limit+f.length,this.add_objects(f)}else if(a>=this.__query.skip&&null!=this.__query.limit&&(null==b||a+b>this.__query.skip+this.__query.limit)){b=a+b-(this.__query.skip+this.__query.limit),a=this.__query.skip+this.__query.limit,a>0&&(d.skip=a),null!=b&&(d.limit=b);var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.limit=this.__query.limit+f.length,b>f.length&&(this.__query.count=a+f.length),this.add_objects(f)}},increase_forwards:function(a){a=null==a?this.__query.forward_steps:a,null!=a&&null!=this.__query.limit&&this.__execute_query(this.__query.skip+this.__query.limit,a,!1)},increase_backwards:function(a){if(a=null==a?this.__query.backward_steps:a,null!=a&&this.__query.skip>0){var a=Math.min(a,this.__query.skip);this.__execute_query(this.__query.skip-a,a,!1)}},paginate:function(a){this.__execute_query(this.__query.range*a,this.__query.range,!0)},paginate_index:function(){return null==this.__query.range?null:Math.floor(this.__query.skip/this.__query.range)},paginate_count:function(){return null==this.__query.count||null==this.__query.range?null:Math.ceil(this.__query.count/this.__query.range)},next:function(){var a=this.paginate_index();if(null!=a){var b=this.paginate_count();(null==b||a<this.paginate_count()-1)&&this.paginate(a+1)}},prev:function(){var a=this.paginate_index();null!=a&&a>0&&this.paginate(a-1)},isComplete:function(){return null!=this.__query.count}}),BetaJS.Class.extend("BetaJS.Queries.ActiveQueryEngine",{constructor:function(){this._inherited(BetaJS.Queries.ActiveQueryEngine,"constructor"),this.__aqs={},this.__object_to_aqs={}},__valid_for_aq:function(a,b){return BetaJS.Queries.evaluate(b.query(),a)},insert:function(a){if(!this.__object_to_aqs[BetaJS.Ids.objectId(a)]){var b=a.getAll(),c={};this.__object_to_aqs[BetaJS.Ids.objectId(a)]=c,BetaJS.Objs.iter(this.__aqs,function(d){this.__valid_for_aq(b,d)&&(d._add(a),c[d.cid()]=d)},this),a.on("change",function(){this.update(a)},this)}},remove:function(a){BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(a)],function(b){b._remove(a)},this),delete this.__object_to_aqs[BetaJS.Ids.objectId(a)],a.off(null,this,null)},update:function(a){var b=a.getAll(),c=this.__object_to_aqs[BetaJS.Ids.objectId(a)];BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(a)],function(d){this.__valid_for_aq(b,d)||(d._remove(a),delete c[d.cid()])},this),BetaJS.Objs.iter(this.__aqs,function(d){this.__valid_for_aq(b,d)&&(d._add(a),c[d.cid()]=d)},this)},register:function(a){this.__aqs[a.cid()]=a;for(var b=a.query(),c=this._query(b);c.hasNext();){var d=c.next();this.__object_to_aqs[BetaJS.Ids.objectId(d)]?(this.__object_to_aqs[BetaJS.Ids.objectId(d)][a.cid()]=a,a._add(d)):this.insert(d)}},unregister:function(a){delete this.__aqs[a.cid()];var b=this;a.collection().iterate(function(c){delete b.__object_to_aqs[BetaJS.Ids.objectId(c)][a.cid()]})},_query:function(){}}),BetaJS.Class.extend("BetaJS.Queries.ActiveQuery",[BetaJS.Ids.ClientIdMixin,{constructor:function(a,b){this._inherited(BetaJS.Queries.ActiveQuery,"constructor"),this.__engine=a,this.__query=b,this.__collection=new BetaJS.Collections.Collection,this.__collection.on("destroy",function(){this.destroy()},this),a.register(this)},destroy:function(){this.__engine.unregister(this),this._inherited(BetaJS.Queries.ActiveQuery,"destroy")},isUniform:function(){return BetaJS.Types.is_empty(this.query())},engine:function(){return this.__engine},query:function(){return this.__query},collection:function(){return this.__collection},_add:function(a){this.__collection.add(a)},_remove:function(a){this.__collection.remove(a)},change_query:function(a){this.__engine.unregister(this),this.__query=a,this.__collection.clear(),this.__engine.register(this)}}]),BetaJS.Exceptions.Exception.extend("BetaJS.Stores.StoreException"),BetaJS.Class.extend("BetaJS.Stores.BaseStore",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Stores.BaseStore,"constructor"),a=a||{},this._id_key=a.id_key||"id",this._create_ids=a.create_ids||!1,this._last_id=1,this._async_write="async_write"in a?a.async_write:!1,this._async_write=this._async_write&&this._supports_async_write(),this._async_read="async_read"in a?a.async_read:!1,this._async_read=this._async_read&&this._supports_async_read()},id_key:function(){return this._id_key},_supports_async_read:function(){return!1},async_read:function(){return this._async_read},_supports_async_write:function(){return!1},async_write:function(){return this._async_write},_insert:function(){},_remove:function(){},_get:function(){},_update:function(){},_query_capabilities:function(){return{}},_query:function(){},_new_id:function(){},insert:function(a,b){if(this._create_ids&&!(this._id_key in a)){if(this._async_write)throw new BetaJS.Stores.StoreException("Unsupported Creation of Ids");for(;this.get(this._last_id);)this._last_id++;a[this._id_key]=this._last_id}var c=this,d=function(a){c.trigger("insert",a),b&&b.success&&b.success(a)},e=function(a){if(!b||!b.exception)throw a;b.exception(a)};if(this._async_write)this._insert(a,{success:d,exception:e});else try{var f=this._insert(a);return d(f),f}catch(g){e(g)}},insert_all:function(a){if(!this._async_write){var b=!0;return BetaJS.Objs.iter(a,function(a){b=b&&this.insert(a)},this),b}var c=-1,d=this,e=function(){c++,c<a.length&&d.insert(a[c],{success:e})};e()},remove:function(a,b){var c=this,d=function(){c.trigger("remove",a),b&&b.success&&b.success(a)},e=function(a){if(!b||!b.exception)throw a;b.exception(a)};if(this._async_write)this._remove(a,{success:d,exception:e});else try{this._remove(a),d()}catch(f){e(f)}},get:function(a,b){var c=function(a){b&&b.success&&b.success(a)},d=function(a){if(!b||!b.exception)throw a;b.exception(a)};if(this._async_read)this._get(a,{success:c,exception:d});else try{var e=this._get(a);return c(e),e}catch(f){d(f)}},update:function(a,b,c){var d=this,e=function(a){d.trigger("update",a,b),c&&c.success&&c.success(a,b)},f=function(a){if(!c||!c.exception)throw a;c.exception(a)};if(this._async_write)this._update(a,b,{success:e,exception:f});else try{var g=this._update(a,b);return e(g),g}catch(h){f(h)}},query:function(a,b,c){return BetaJS.Queries.Constrained.emulate(BetaJS.Queries.Constrained.make(a,b||{}),this._query_capabilities(),this._query,this,c)},_query_applies_to_id:function(a,b){var c=this.get(b);return c&&BetaJS.Queries.overloaded_evaluate(a,c)},clear:function(){for(var a=this.query({});a.hasNext();)this.remove(a.next().id)}}]),BetaJS.Class.extend("BetaJS.Stores.StoresMonitor",[BetaJS.Events.EventsMixin,{attach:function(a,b){b.on("insert",function(c){this.trigger("insert",a,b,c),this.trigger("write","insert",a,b,c)},this),b.on("remove",function(c){this.trigger("remove",a,b,c),this.trigger("write","remove",a,b,c)},this),b.on("update",function(c,d){this.trigger("update",a,b,c,d),this.trigger("write","update",a,b,c,d)},this)}}]),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.AssocStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},_iterate:function(){},constructor:function(a){a=a||{},a.create_ids=!0,this._inherited(BetaJS.Stores.AssocStore,"constructor",a)},_insert:function(a){return this._write_key(a[this._id_key],a),a},_remove:function(a){var b=this._read_key(a);return b&&!this._remove_key(a)?null:b},_get:function(a){return this._read_key(a)},_update:function(a,b){var c=this._get(a);return c&&(delete b[this._id_key],BetaJS.Objs.extend(c,b),this._write_key(a,c)),c},_query:function(){return this._iterate()}}),BetaJS.Stores.AssocStore.extend("BetaJS.Stores.MemoryStore",{constructor:function(a){this._inherited(BetaJS.Stores.MemoryStore,"constructor",a),this.__data={}},_read_key:function(a){return this.__data[a]},_write_key:function(a,b){this.__data[a]=b},_remove_key:function(a){delete this.__data[a]},_iterate:function(){return new BetaJS.Iterators.ObjectValuesIterator(this.__data)}}),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.DumbStore",{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},constructor:function(a){a=a||{},a.create_ids=!0,this._inherited(BetaJS.Stores.DumbStore,"constructor",a)},_insert:function(a){var b=this._read_last_id(),c=a[this._id_key];return null!=b?(this._write_next_id(b,c),this._write_prev_id(c,b)):this._write_first_id(c),this._write_last_id(c),this._write_item(c,a),a},_remove:function(a){var b=this._read_item(a);if(b){this._remove_item(a);var c=this._read_next_id(a),d=this._read_prev_id(a);null!=c?(this._remove_next_id(a),null!=d?(this._remove_prev_id(a),this._write_next_id(d,c),this._write_prev_id(c,d)):(this._remove_prev_id(c),this._write_first_id(c))):null!=d?(this._remove_next_id(d),this._write_last_id(d)):(this._remove_first_id(),this._remove_last_id())}return b},_get:function(a){return this._read_item(a)},_update:function(a,b){var c=this._get(a);return c&&(delete b[this._id_key],BetaJS.Objs.extend(c,b),this._write_item(a,c)),c},_query_capabilities:function(){return{query:!0}},_query:function(a){var b=new BetaJS.Iterators.Iterator,c=this,d=this._read_first_id();return BetaJS.Objs.extend(b,{__id:null==d?1:d,__store:c,__query:a,hasNext:function(){var b=this.__store._read_last_id();if(null==b)return!1;for(;this.__id<b&&!this.__store._read_item(this.__id);)this.__id++;for(;this.__id<=b;){if(this.__store._query_applies_to_id(a,this.__id))return!0;this.__id<b?this.__id=this.__store._read_next_id(this.__id):this.__id++}return!1},next:function(){if(this.hasNext()){var a=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),a}return null}}),b}}),BetaJS.Stores.DumbStore.extend("BetaJS.Stores.AssocDumbStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(a){var b=this._read_key(a);return b?parseInt(b):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(a){this._write_key("last_id",a)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(a){this._write_key("first_id",a)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(a){return this._read_key("item_"+a)},_write_item:function(a,b){this._write_key("item_"+a,b)},_remove_item:function(a){this._remove_key("item_"+a)},_read_next_id:function(a){return this.__read_id("next_"+a)},_write_next_id:function(a,b){this._write_key("next_"+a,b)},_remove_next_id:function(a){this._remove_key("next_"+a)},_read_prev_id:function(a){return this.__read_id("prev_"+a)},_write_prev_id:function(a,b){this._write_key("prev_"+a,b)},_remove_prev_id:function(a){this._remove_key("prev_"+a)}}),BetaJS.Stores.AssocDumbStore.extend("BetaJS.Stores.LocalStore",{constructor:function(a){this._inherited(BetaJS.Stores.LocalStore,"constructor",a),this.__prefix=a.prefix},__key:function(a){return this.__prefix+a},_read_key:function(a){var b=this.__key(a);return b in localStorage?JSON.parse(localStorage[b]):null},_write_key:function(a,b){localStorage[this.__key(a)]=JSON.stringify(b)},_remove_key:function(a){delete localStorage[this.__key(a)]}}),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.DualStore",{constructor:function(a,b,c){c=BetaJS.Objs.extend({create_options:{},update_options:{},delete_options:{},get_options:{},query_options:{}},c||{}),c.id_key=a._id_key,c.async_write=a.async_write(),this.__first=a,this.__second=b,this._inherited(BetaJS.Stores.DualStore,"constructor",c),this.__create_options=BetaJS.Objs.extend({start:"first",strategy:"then"},c.create_options),this.__update_options=BetaJS.Objs.extend({start:"first",strategy:"then"},c.update_options),this.__remove_options=BetaJS.Objs.extend({start:"first",strategy:"then"},c.delete_options),this.__get_options=BetaJS.Objs.extend({start:"first",strategy:"or",clone:!0,clone_second:!1,or_on_null:!0},c.get_options),this.__query_options=BetaJS.Objs.extend({start:"first",strategy:"or",clone:!0,clone_second:!1,or_on_null:!0},c.query_options)},first:function(){return this.__first},second:function(){return this.__second},_supports_async_read:function(){return!1},_supports_async_write:function(){return this.__first.async_write()},_insert:function(a,b){var c=this.__first,d=this.__second;"first"!=this.__create_options.start&&(c=this.__second,d=this.__first);var e=this.__create_options.strategy;if(this.async_write())if("then"==e)c.insert(a,{success:function(a){d.insert(a,b)},exception:b.exception});else{if("or"==e)return c.insert(a,{success:b.success,exception:function(){d.insert(a,b)}});c.insert(a,b)}else{if("then"==e)return d.insert(c.insert(a));if("or"!=e)return c.insert(a);try{return c.insert(a)}catch(f){return d.insert(a)}}},_update:function(a,b,c){var d=this.__first,e=this.__second;"first"!=this.__update_options.start&&(d=this.__second,e=this.__first);var f=this.__update_options.strategy;if(this.async_write())if("then"==f)d.update(a,b,{success:function(b){e.update(a,b,c)},exception:c.exception});else{if("or"==f)return d.update(a,b,{success:c.success,exception:function(){e.update(a,b,c)}});d.update(a,b,c)}else{if("then"==f)return e.update(a,d.update(a,b));if("or"!=f)return d.update(a,b);try{return d.update(a,b)}catch(g){return e.update(a,b)}}},_remove:function(a,b){var c=this.__first,d=this.__second;"first"!=this.__remove_options.start&&(c=this.__second,d=this.__first);var e=this.__remove_options.strategy;if(this.async_write())if("then"==e)c.remove(a,{success:function(){d.remove(a,b)},exception:b.exception});else{if("or"==e)return c.remove(a,{success:b.success,exception:function(){d.remove(a,b)}});c.remove(a,b)}else if("then"==e)c.remove(a),d.remove(a);else if("or"==e)try{c.remove(a)}catch(f){d.remove(a)}else c.remove(a)},_get:function(a){var b=this.__first,c=this.__second;"first"!=this.__get_options.start&&(b=this.__second,c=this.__first);var d=this.__get_options.strategy,e=this.__get_options.clone,f=this.__get_options.clone_second,g=this.__get_options.or_on_null;if("or"!=d)return b.get(a);try{var h=b.get(a);if(null==h&&g)throw new{};if(f){try{c.get(a)&&(f=!1)}catch(i){}f&&c.insert(h)}return h}catch(i){var h=c.get(a);return null!=h&&e&&b.insert(h),h}},_query_capabilities:function(){return{query:!0,sort:!0,limit:!0,skip:!0}},_query:function(a,b){var c=this.__first,d=this.__second;"first"!=this.__query_options.start&&(c=this.__second,d=this.__first);var e=this.__query_options.strategy,f=this.__query_options.clone,g=this.__get_options.clone_second,h=this.__query_options.or_on_null;if("or"!=e)return c.query(a,b);try{var i=c.query(a,b);if(null==i&&h)throw{};if(g){try{d.get(a,b)&&(f=!1)}catch(j){}g&&(i=i.asArray(),"cache_query"in d?d.cache_query(a,b,i):d.insert_all(i),i=new BetaJS.Iterators.ArrayIterator(i))}return i}catch(j){var i=d.query(a,b);return null!=i&&f&&(i=i.asArray(),"cache_query"in c?c.cache_query(a,b,i):c.insert_all(i),i=new BetaJS.Iterators.ArrayIterator(i)),i}}}),BetaJS.Stores.StoreException.extend("BetaJS.Stores.StoreCacheException"),BetaJS.Stores.DualStore.extend("BetaJS.Stores.FullyCachedStore",{constructor:function(a,b){b=b||{},this._inherited(BetaJS.Stores.FullyCachedStore,"constructor",a,new BetaJS.Stores.MemoryStore({id_key:a.id_key()}),BetaJS.Objs.extend({get_options:{start:"second",strategy:"single"},query_options:{start:"second",strategy:"single"}},b))},cache:function(){return this.second()},store:function(){return this.first()}}),BetaJS.Stores.DualStore.extend("BetaJS.Stores.QueryCachedStore",{constructor:function(a,b){b=b||{},this._inherited(BetaJS.Stores.QueryCachedStore,"constructor",a,new BetaJS.Stores.QueryCachedStore.InnerStore({id_key:a.id_key()}),BetaJS.Objs.extend({get_options:{start:"second",strategy:"or"},query_options:{start:"second",strategy:"or",clone:!0,or_on_null:!0}},b))},cache:function(){return this.second()},store:function(){return this.first()}}),BetaJS.Stores.MemoryStore.extend("BetaJS.Stores.QueryCachedStore.InnerStore",{constructor:function(a){this._inherited(BetaJS.Stores.QueryCachedStore.InnerStore,"constructor",a),this.__queries={}},_query_capabilities:function(){return{query:!0,sort:!0,limit:!0,skip:!0}},_query:function(a,b){var c=BetaJS.Queries.Constrained.make(a,b),d=BetaJS.Queries.Constrained.format(c);if(d in this.__queries)return new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__queries[d]));throw new BetaJS.Stores.StoreCacheException},cache_query:function(a,b,c){var d=BetaJS.Queries.Constrained.make(a,b),e=BetaJS.Queries.Constrained.format(d);this.__queries[e]={};for(var f=0;f<c.length;++f){var g=c[f];this.insert(g),this.__queries[e][g[this.id_key()]]=g}},insert:function(a,b){return this.trigger("cache",a),this._inherited(BetaJS.Stores.QueryCachedStore.InnerStore,"insert",a,b)}}),BetaJS.Stores.StoreException.extend("BetaJS.Stores.RemoteStoreException",{constructor:function(a){a=BetaJS.Net.AjaxException.ensure(a),this._inherited(BetaJS.Stores.RemoteStoreException,"constructor",a.toString()),this.__source=a},source:function(){return this.__source}}),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.RemoteStore",{constructor:function(a,b,c){this._inherited(BetaJS.Stores.RemoteStore,"constructor",c),this._uri=a,this.__ajax=b,this.__options=BetaJS.Objs.extend({update_method:"PUT",uri_mappings:{}},c||{})},_supports_async_write:function(){return!0},_supports_async_read:function(){return!1},getUri:function(){return this._uri},prepare_uri:function(a,b){return this.__options.uri_mappings[a]?this.__options.uri_mappings[a](b):"remove"==a||"get"==a||"update"==a?this.getUri()+"/"+b[this._id_key]:this.getUri()},_include_callbacks:function(a,b,c){return a.failure=function(a,c,d){b(new BetaJS.Stores.RemoteStoreException(new BetaJS.Net.AjaxException(a,c,d)))},a.success=c,a},_insert:function(a,b){try{var c={method:"POST",uri:this.prepare_uri("insert",a),data:a};if(!this._async_write)return this.__ajax.syncCall(c);this.__ajax.asyncCall(this._include_callbacks(c,b.exception,b.success))}catch(d){throw new BetaJS.Stores.RemoteStoreException(d)}},_remove:function(a,b){try{var c={};c[this._id_key]=a;var d={method:"DELETE",uri:this.prepare_uri("remove",c)};if(!this._async_write){var e=this.__ajax.syncCall(d);return e||(e={},e[this._id_key]=a),e}var f=this;d=this._include_callbacks(d,b.exception,function(c){c||(c={},c[f._id_key]=a),b.success(c)}),this.__ajax.asyncCall(d)}catch(g){throw new BetaJS.Stores.RemoteStoreException(g)}},_get:function(a,b){var c={};c[this._id_key]=a;try{var d={uri:this.prepare_uri("get",c)};if(!this._async_read)return this.__ajax.syncCall(d);this.__ajax.asyncCall(this._include_callbacks(d,b.exception,b.success))}catch(e){throw new BetaJS.Stores.RemoteStoreException(e)}},_update:function(a,b,c){var d=BetaJS.Objs.clone(b,1);d[this._id_key]=a;try{var e={method:this.__options.update_method,uri:this.prepare_uri("update",d),data:b};if(!this._async_write)return this.__ajax.syncCall(e);this.__ajax.asyncCall(this._include_callbacks(e,c.exception,c.success))}catch(f){throw new BetaJS.Stores.RemoteStoreException(f)}},_query:function(a,b,c){try{var d=this._encode_query(a,b);if(!this._async_read){var e=this.__ajax.syncCall(d);return BetaJS.Types.is_string(e)?JSON.parse(e):e}d=this._include_callbacks(d,c.exception,function(){c.success(BetaJS.Types.is_string(e)?JSON.parse(e):e)}),this.__ajax.asyncCall(d)}catch(f){throw new BetaJS.Stores.RemoteStoreException(f)}},_encode_query:function(){return{uri:this.prepare_uri("query")}}}),BetaJS.Stores.RemoteStore.extend("BetaJS.Stores.QueryGetParamsRemoteStore",{constructor:function(a,b,c,d){this._inherited(BetaJS.Stores.QueryGetParamsRemoteStore,"constructor",a,b,d),this.__capability_params=c},_query_capabilities:function(){var a={};return"skip"in this.__capability_params&&(a.skip=!0),"limit"in this.__capability_params&&(a.limit=!0),a},_encode_query:function(a,b){b=b||{};var c=this.getUri()+"?";return b.skip&&"skip"in this.__capability_params&&(c+=this.__capability_params.skip+"="+b.skip+"&"),b.limit&&"limit"in this.__capability_params&&(c+=this.__capability_params.limit+"="+b.limit+"&"),{uri:c}}}),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.ConversionStore",{constructor:function(a,b){b=b||{},b.id_key=a._id_key,this._inherited(BetaJS.Stores.ConversionStore,"constructor",b),this.__store=a,this.__key_encoding=b.key_encoding||{},this.__key_decoding=b.key_decoding||{},this.__value_encoding=b.value_encoding||{},this.__value_decoding=b.value_decoding||{}},encode_object:function(a){var b={};for(var c in a)b[this.encode_key(c)]=this.encode_value(c,a[c]);return b},decode_object:function(a){var b={};for(var c in a)b[this.decode_key(c)]=this.decode_value(c,a[c]);return b},encode_key:function(a){return a in this.__key_encoding?this.__key_encoding[a]:a},decode_key:function(a){return a in this.__key_decoding?this.__key_decoding[a]:a},encode_value:function(a,b){return a in this.__value_encoding?this.__value_encoding[a](b):b},decode_value:function(a,b){return a in this.__value_decoding?this.__value_decoding[a](b):b},_insert:function(a){return this.decode_object(this.__store.insert(this.encode_object(a)))},_remove:function(a){return this.__store.remove(this.encode_value(this._id_key,a))},_get:function(a){return this.decode_object(this.__store.get(this.encode_value(this._id_key,a)))},_update:function(a,b){return this.decode_object(this.__store.update(this.encode_value(this._id_key,a),this.encode_object(b)))},_query_capabilities:function(){return this.__store._query_capabilities()},_query:function(a,b){var c=this,d=this.__store.query(this.encode_object(a),b);return new BetaJS.Iterators.MappedIterator(d,function(a){return c.decode_object(a)})}}),BetaJS.Stores.BaseStore.extend("BetaJS.Stores.PassthroughStore",{constructor:function(a,b){this.__store=a,b=b||{},b.id_key=a.id_key(),b.async_read=a.async_read,b.async_write=a.async_write,this._inherited(BetaJS.Stores.PassthroughStore,"constructor",b)},_supports_async_read:function(){return this.__store._supports_async_read()},_supports_async_write:function(){return this.__store._supports_async_read()},_query_capabilities:function(){return this.__store._query_capabilities()},_insert:function(a,b){return this.__store.insert(a,b)},_remove:function(a,b){return this.__store.remove(a,b)},_get:function(a){return this.__store.get(a)},_update:function(a,b,c){return this.__store.update(a,b,c)},_query:function(a,b){return this.__store.query(a,b)}}),BetaJS.Stores.PassthroughStore.extend("BetaJS.Stores.WriteQueueStore",{constructor:function(a,b){this._inherited(BetaJS.Stores.WriteQueueStore,"constructor",a,b),b=b||{},this.__update_queue={},this.__revision_id=1,this.__id_to_queue={},this.__combine_updates="combine_updates"in b?b.combine_updates:!0,this.__auto_clear_updates="auto_clear_updates"in b?b.auto_clear_updates:!0,this.__cache={},this.__auto_clear_updates&&this.on("remove",function(a){this.__remove_update(a)},this)},update:function(a,b,c){return this.__insert_update(a,b),c&&c.success&&c.success(a,b,b),b},__remove_update:function(a){this.__id_to_queue[a],delete this.__id_to_queue[a];for(var b in b)delete this.__update_queue[b];delete this.__cache[a]},__insert_update:function(a,b){if(this.__combine_updates&&this.__id_to_queue[a]){var c={};for(var d in this.__id_to_queue[a])c=BetaJS.Objs.extend(c,this.__update_queue[d].data),delete this.__update_queue[d];c=BetaJS.Objs.extend(c,b),this.__id_to_queue[a]={}}this.__id_to_queue[a]=this.__id_to_queue[a]||{},this.__id_to_queue[a][this.__revision_id]=!0,this.__update_queue[this.__revision_id]={id:a,data:b,revision_id:this.__revision_id},this.__cache[a]=BetaJS.Objs.extend(this.__cache[a]||{},b),this.__revision_id++,this.trigger("queue","update",a,b),this.trigger("queue:update",a,b)},flush:function(a,b){if(b||(b=this.__revision_id),this.async_write()){var c=null,d=this;for(var e in this.__update_queue){c=this.__update_queue[e];break}if(!c)return a&&a.success(),!0;if(c.revision_id>=b)return;this.__store.update(c.id,c.data,{exception:a.exception,success:function(){delete this.__update_queue[c.revision_id],delete this.__id_to_queue[c.id][c.revision_id],d.flush(a,b)
}})}else try{BetaJS.Objs.iter(this.__update_queue,function(a){return a.revision_id>=b?!1:(this.__store.update(a.id,a.data),void 0)},this),a&&a.success&&a.success()}catch(f){if(!a||!a.exception)throw f;a.exception(f)}},changed:function(){return!BetaJS.Types.is_empty(this.__update_queue)},get:function(a){var b=this.__store.get(a);return b&&this.__cache[a]?BetaJS.Objs.extend(b,this.__cache[a]):b},query:function(a,b){var c=this;return new BetaJS.Iterators.MappedIterator(this.__store.query(a,b),function(a){return c.__cache[a[c.id_key()]]?BetaJS.Objs.extend(a,c.__cache[a[c.id_key()]]):a})}}),BetaJS.Class.extend("BetaJS.Stores.WriteQueueStoreManager",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Stores.WriteQueueStoreManager,"constructor"),a=a||{},this.__stores={},this.__changed=!1,this.__min_delay=a.min_delay?a.min_delay:null,this.__max_delay=a.max_delay?a.max_delay:null,(this.__min_delay||this.__max_delay)&&this.on("changed",function(){this.flush()},this,{min_delay:this.__min_delay,max_delay:this.__max_delay})},destroy:function(){this.off(null,null,this),BetaJS.Objs.iter(this.__stores,function(a){this.unregister(a)},this),this._inherited(BetaJS.Stores.WriteQueueStoreManager,"destroy")},__get:function(a){return a},register:function(a){a=this.__get(a),this.__stores[BetaJS.Ids.objectId(a)]=a,a.on("queue:update",function(){this.__changed=!0,this.trigger("changed")},this)},unregister:function(a){a=this.__get(a),delete this.__stores[BetaJS.Ids.objectId(a)],a.off(null,null,this)},flush:function(a){this.trigger("flush_start"),this.trigger("flush");var b=0,c=BetaJS.Objs.count(this.__stores),d=this;BetaJS.Objs.iter(this.__stores,function(e){e.flush({exception:function(b){if(d.trigger("flush_error"),!a||!a.exception)throw b;a.exception(b)},success:function(){b++,b==c&&(d.trigger("flush_end"),a&&a.success&&a.success())}})},this),this.__changed=!1,BetaJS.Objs.iter(this.__stores,function(a){this.__changed=this.__changed||a.changed()},this)}}]),BetaJS.Net=BetaJS.Net||{},BetaJS.Net.HttpHeader={HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,format:function(a,b){var c="";return c=a==this.HTTP_STATUS_OK?"OK":a==this.HTTP_STATUS_CREATED?"Created":a==this.HTTP_STATUS_PAYMENT_REQUIRED?"Payment Required":a==this.HTTP_STATUS_FORBIDDEN?"Forbidden":a==this.HTTP_STATUS_NOT_FOUND?"Not found":a==this.HTTP_STATUS_PRECONDITION_FAILED?"Precondition Failed":a==this.HTTP_STATUS_INTERNAL_SERVER_ERROR?"Internal Server Error":"Other Error",b?a+" "+c:c}},BetaJS.Properties.Properties.extend("BetaJS.Modelling.SchemedProperties",{constructor:function(a,b){this._inherited(BetaJS.Modelling.SchemedProperties,"constructor");var c=this.cls.scheme();this._properties_changed={},this.__errors={},this.__unvalidated={};for(var d in c)"def"in c[d]?this.set(d,c[d].def):c[d].auto_create?this.set(d,c[d].auto_create(this)):this.set(d,null);b=b||{},this._properties_changed={},this.__errors={},this.__unvalidated={};for(d in a)this.set(d,a[d])},_unsetChanged:function(a){delete this._properties_changed[a]},_beforeSet:function(a,b){var c=this.cls.scheme();if(!(a in c))return b;var d=c[a];return"boolean"==d.type?BetaJS.Types.parseBool(b):b},_afterSet:function(a,b){var c=this.cls.scheme();a in c&&(this._properties_changed[a]=b,this.__unvalidated[a]=!0,delete this.__errors[a])},properties_changed:function(a){return BetaJS.Types.is_boolean(a)?BetaJS.Objs.filter(this._properties_changed,function(b,c){return this.validateAttr(c)==a},this):this._properties_changed},properties_by:function(a){return BetaJS.Types.is_boolean(a)?BetaJS.Objs.filter(this.getAll(),function(b,c){return this.validateAttr(c)==a},this):this.getAll()},validate:function(){this.trigger("validate");for(var a in this.__unvalidated)this.validateAttr(a);return BetaJS.Types.is_empty(this.__errors)},validateAttr:function(a){if(a in this.__unvalidated){delete this.__unvalidated[a],delete this.__errors[a];var b=this.cls.scheme(),c=b[a];if("validate"in c){var d=c.validate;BetaJS.Types.is_array(d)||(d=[d]);var e=this.get(a);BetaJS.Objs.iter(d,function(b){var c=b.validate(e,this);return null!=c&&(this.__errors[a]=c),null==c},this)}this.trigger("validate:"+a,!(a in this.__errors),this.__errors[a])}return!(a in this.__errors)},setError:function(a,b){delete this.__unvalidated[a],this.__errors[a]=b},revalidate:function(){return this.__errors={},this.__unvalidated=this.keys(!0),this.validate()},errors:function(){return this.__errors},asRecord:function(a){var b={},c=this.cls.scheme(),d=this.getAll();a=a||{};for(var e in d)if(e in c){var f=c[e].tags||[],g={};BetaJS.Objs.iter(f,function(a){g[a]=!0});var h=!0;BetaJS.Objs.iter(a,function(a){h=h&&a in g},this),h&&(b[e]=d[e])}return b},setByTags:function(a,b){var c=this.cls.scheme();b=b||{};for(var d in a)if(d in c){var e=c[d].tags||[],f={};BetaJS.Objs.iter(e,function(a){f[a]=!0});var g=!0;BetaJS.Objs.iter(b,function(a){g=g&&a in f},this),g&&this.set(d,a[d])}}},{_initializeScheme:function(){var a={};return a[this.primary_key()]={type:"id"},a},asRecords:function(a,b){return a.map(function(a){return a.asRecord(b)})}},{scheme:function(){return this.__scheme=this.__scheme||this._initializeScheme(),this.__scheme}}),BetaJS.Modelling.SchemedProperties.extend("BetaJS.Modelling.AssociatedProperties",{constructor:function(a,b){this._inherited(BetaJS.Modelling.AssociatedProperties,"constructor",a,b),this.assocs=this._initializeAssociations();for(var c in this.assocs)this.__addAssoc(c,this.assocs[c]);this.on("change:"+this.cls.primary_key(),function(a,b){this._change_id(a,b),this.trigger("change_id",a,b)},this)},_change_id:function(){},__addAssoc:function(a,b){this[a]=function(){return b.yield()}},_initializeAssociations:function(){return{}},destroy:function(){for(var a in this.assocs)this.assocs[a].destroy();this._inherited(BetaJS.Modelling.AssociatedProperties,"destroy")},id:function(){return this.get(this.cls.primary_key())},hasId:function(){return this.has(this.cls.primary_key())}},{primary_key:function(){return"id"}}),BetaJS.Modelling.AssociatedProperties.extend("BetaJS.Modelling.Model",[BetaJS.Ids.ClientIdMixin,{constructor:function(a,b){this._inherited(BetaJS.Modelling.Model,"constructor",a,b),this.__saved="saved"in b?b.saved:!1,this.__new="new"in b?b["new"]:!0,this.__removed=!1,this.__saved&&(this._properties_changed={}),this.__table=b.table,this.__table._model_register(this)},destroy:function(){this.__table._model_unregister(this),this.trigger("destroy"),this._inherited(BetaJS.Modelling.Model,"destroy")},isSaved:function(){return this.__saved},isNew:function(){return this.__new},isRemoved:function(){return this.__removed},update:function(a,b){this.setAll(a,{silent:!0}),this.save(b)},_afterSet:function(a,b,c,d){this._inherited(BetaJS.Modelling.Model,"_afterSet",a,b,c,d);var e=this.cls.scheme();a in e&&(d&&d.no_change?this._unsetChanged(a):this.__saved=!1,d&&d.silent||this.__table&&this.__table._model_set_value(this,a,b,d))},_after_create:function(){},save:function(a){var b=this,c=BetaJS.Objs.clone(a||{},1);return c.success=function(){b.trigger("save"),b.__saved=!0;var c=b.__new;b.__new=!1,c&&b._after_create(),a&&a.success&&a.success()},this.__table._model_save(this,c)},remove:function(a){var b=this,c=BetaJS.Objs.clone(a||{},1);return c.success=function(){b.trigger("remove"),b.__removed=!0,a&&a.success&&a.success()},this.__table._model_remove(this,c)}}]),BetaJS.Exceptions.Exception.extend("BetaJS.Modelling.ModelException",{constructor:function(a,b){this._inherited(BetaJS.Modelling.ModelException,"constructor",b),this.__model=a},model:function(){return this.__model}}),BetaJS.Modelling.ModelException.extend("BetaJS.Modelling.ModelInvalidException",{constructor:function(a){var b=BetaJS.Objs.values(a.errors()).join("\n");this._inherited(BetaJS.Modelling.ModelInvalidException,"constructor",a,b)}}),BetaJS.Modelling.ModelException.extend("BetaJS.Modelling.ModelMissingIdException",{constructor:function(a){this._inherited(BetaJS.Modelling.ModelMissingIdException,"constructor",a,"No id given.")}}),BetaJS.Class.extend("BetaJS.Modelling.Table",[BetaJS.Events.EventsMixin,{constructor:function(a,b,c){this._inherited(BetaJS.Modelling.Table,"constructor"),this.__store=a,this.__model_type=b,this.__models_by_id={},this.__models_changed={},this.__options=BetaJS.Objs.extend({model_cache_size:null,type_column:null,remove_exception:!0,auto_create:!1,create_exception:!0,invalid_create_exception:!0,invalid_create_save:!1,greedy_create:!1,store_validation_conversion:!0,auto_update:!0,update_exception:!0,invalid_update_exception:!0,invalid_update_save:!1,greedy_update:!1},c||{}),this.__models_by_cid=new BetaJS.Classes.ObjectCache({size:this.__options.model_cache_size}),this._auto_destroy(this.__models_by_cid),this.__models_by_cid.on("release",function(a){a.hasId()&&delete this.__models_by_id[a.id()]},this)},async_read:function(){return this.__store.async_read()},async_write:function(){return this.__store.async_write()},_model_register:function(a){this.hasModel(a)||(this.trigger("register",a),this.__models_by_cid.add(a),a.hasId()&&(this.__models_by_id[a.id()]=a),a.isNew()&&this.__options.auto_create&&this._model_create(a))},_model_unregister:function(a){this.hasModel(a)&&(a.save(),this.__models_by_cid.remove(a),a.hasId()&&delete this.__models_by_id[a.id()],this.trigger("unregister",a))},hasModel:function(a){return null!=this.__models_by_cid.get(a)},_model_remove:function(a,b){if(!this.hasModel(a))return!1;var c=this,d={success:function(){return b&&b.success&&b.success(),b&&b.complete&&b.complete(),c.trigger("remove",a),a.destroy(),!0},exception:function(a){if(b&&b.exception&&b.exception(a),b&&b.complete&&b.complete(),(!b||!b.exception)&&c.__options.remove_exception)throw a;return!1}};if(this.async_write())this.__store.remove(a.id(),d);else try{return this.__store.remove(a.id()),d.success()}catch(e){return d.exception(e)}},_model_save:function(a,b){return a.isNew()?this._model_create(a,b):this._model_update(a,b)},__exception_conversion:function(a,b){if(this.__options.store_validation_conversion&&b.instance_of(BetaJS.Stores.RemoteStoreException)){var c=b.source();c.status_code()==BetaJS.Net.HttpHeader.HTTP_STATUS_PRECONDITION_FAILED&&c.data()&&(BetaJS.Objs.iter(c.data(),function(b,c){a.setError(c,b)},this),b=new BetaJS.Modelling.ModelInvalidException(a))}return b},_model_create:function(a,b){if(!this.hasModel(a)||!a.isNew())return!1;var c=this,d=a.validate();if(!d){var e=new BetaJS.Modelling.ModelInvalidException(a);if(b&&b.exception&&b.exception(e),b&&b.complete&&b.complete(),(!b||!b.exception)&&c.__options.invalid_create_exception)throw e;if(!this.__options.invalid_create_save)return!1}var f=this.__options.greedy_create?a.properties_by(!0):a.getAll();this.__options.type_column&&(f[this.__options.type_column]=a.cls.classname);var g={success:function(e){if(!(a.cls.primary_key()in e))return g.exception(new BetaJS.Modelling.ModelMissingIdException(a));if(c.__models_by_id[e[a.cls.primary_key()]]=a,!c.__options.greedy_create)for(var f in a.properties_by(!1))delete e[f];return a.setAll(e,{no_change:!0,silent:!0}),d&&delete c.__models_changed[a.cid()],c.trigger("create",a),c.trigger("save",a),b&&b.success&&b.success(e),b&&b.complete&&b.complete(),!0},exception:function(d){if(d=BetaJS.Exceptions.ensure(d),d=c.__exception_conversion(a,d),b&&b.exception&&b.exception(d),b&&b.complete&&b.complete(),(!b||!b.exception)&&c.__options.create_exception)throw d;return!1}};if(this.async_write())this.__store.insert(f,g);else try{var h=this.__store.insert(f);return g.success(h)}catch(e){return g.exception(e)}},_model_update:function(a,b){if(!this.hasModel(a)||a.isNew())return!1;var c=this,d=a.validate();if(!d){var e=new BetaJS.Modelling.ModelInvalidException(a);if(b&&b.exception&&b.exception(e),b&&b.complete&&b.complete(),(!b||!b.exception)&&c.__options.invalid_update_exception)throw e;if(!this.__options.invalid_update_save)return!1}var f=this.__options.greedy_update?a.properties_changed(!0):a.properties_changed(),g={success:function(e){if(!c.__options.greedy_update)for(var f in a.properties_changed(!1))delete e[f];return a.setAll(e,{no_change:!0,silent:!0}),d&&delete c.__models_changed[a.cid()],c.trigger("update",a),c.trigger("save",a),b&&b.success&&b.success(e),b&&b.complete&&b.complete(),!0},exception:function(a){if(b&&b.exception&&b.exception(a),b&&b.complete&&b.complete(),(!b||!b.exception)&&c.__options.update_exception)throw a;return!1}};if(this.async_write()&&!BetaJS.Types.is_empty(f))this.__store.update(a.id(),f,g);else try{var h=BetaJS.Types.is_empty(f)?{}:this.__store.update(a.id(),f);return g.success(h)}catch(e){return g.exception(e)}},_model_set_value:function(a,b,c,d){return this.__models_changed[a.cid()]=a,this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__options.auto_update?a.save(d):void 0},save:function(){var a=!0;return BetaJS.Objs.iter(this.__models_changed,function(b){a=b.save()&&a}),a},primary_key:function(){return BetaJS.Scopes.resolve(this.__model_type).primary_key()},__materialize:function(a){if(!a)return null;var b=this.__model_type;this.__options.type_column&&a[this.__options.type_column]&&(b=a[this.__options.type_column]);var c=BetaJS.Scopes.resolve(b);if(this.__models_by_id[a[this.primary_key()]])return this.__models_by_id[a[this.primary_key()]];var d=new c(a,{table:this,saved:!0,"new":!1});return d},findById:function(a){return this.__models_by_id[a]?this.__models_by_id[a]:this.__materialize(this.__store.get(a))},findBy:function(a){return this.allBy(a,{limit:1}).next()},all:function(a){return this.allBy({},a)},allBy:function(a,b){var c=this.__store.query(a,b),d=this,e=new BetaJS.Iterators.MappedIterator(c,function(a){return d.__materialize(a)});return e},active_query_engine:function(){if(!this._active_query_engine){var a=this;this._active_query_engine=new BetaJS.Queries.ActiveQueryEngine,this._active_query_engine._query=function(b){return a.allBy(b)},this.on("create",function(a){this._active_query_engine.insert(a)}),this.on("remove",function(a){this._active_query_engine.remove(a)}),this.on("change",function(a){this._active_query_engine.update(a)})}return this._active_query_engine}}]),BetaJS.Class.extend("BetaJS.Modelling.Associations.Association",{constructor:function(a,b){this._inherited(BetaJS.Modelling.Associations.Association,"constructor"),this._model=a,this._options=b||{},this.__cache=null,b.delete_cascade&&a.on("remove",function(){this.__delete_cascade()},this),b.ignore_change_id||a.on("change_id",function(a,b){this._change_id(a,b)},this)},_change_id:function(){},__delete_cascade:function(){for(var a=BetaJS.Iterators.ensure(this.yield());a.hasNext();)a.next().remove()},yield:function(){if(this.__cache)return this.__cache;var a=this._yield();return this._options.cached&&(this.__cache=a),a},invalidate:function(){delete this.__cache}}),BetaJS.Modelling.Associations.Association.extend("BetaJS.Modelling.Associations.TableAssociation",{constructor:function(a,b,c,d){this._inherited(BetaJS.Modelling.Associations.TableAssociation,"constructor",a,d),this._foreign_table=b,this._foreign_key=c,d.primary_key&&(this._primary_key=d.primary_key),this._options.cached&&this._foreign_table.on("create update remove",function(){this.invalidate()},this)},destroy:function(){this._foreign_table.off(null,null,this),this._inherited(BetaJS.Modelling.Associations.TableAssociation,"destroy")}}),BetaJS.Modelling.Associations.TableAssociation.extend("BetaJS.Modelling.Associations.HasManyAssociation",{_id:function(){return this._primary_key?this._model.get(this._primary_key):this._model.id()},_yield:function(){return this.allBy({})},yield:function(){return this._options.cached?(this.__cache||(this.__cache=this._yield().asArray()),BetaJS.Objs.iter(this.__cache,function(a){a.on("destroy",function(){this.invalidate()},this)},this),new BetaJS.Iterators.ArrayIterator(this.__cache)):this._yield()},invalidate:function(){BetaJS.Objs.iter(this.__cache,function(a){a.off(null,null,this)},this),this._inherited(BetaJS.Modelling.Associations.HasManyAssociation,"invalidate")},findBy:function(a){return a[this._foreign_key]=this._id(),this._foreign_table.findBy(a)},allBy:function(a){return a[this._foreign_key]=this._id(),this._foreign_table.allBy(a)},_change_id:function(a){for(var b=this._yield();b.hasNext();){var c=b.next();c.set(this._foreign_key,a),c.save()}}}),BetaJS.Modelling.Associations.HasManyAssociation.extend("BetaJS.Modelling.Associations.HasManyThroughArrayAssociation",{_yield:function(){var a=[];return BetaJS.Objs.iter(this._model.get(this._foreign_key),function(b){var c=this._foreign_table.findById(b);c&&a.push(c)},this),a},yield:function(){return this._options.cached?(this.__cache||(this.__cache=this._yield()),BetaJS.Objs.iter(this.__cache,function(a){a.on("destroy",function(){this.invalidate()},this)},this),new BetaJS.Iterators.ArrayIterator(this.__cache)):new BetaJS.Iterators.ArrayIterator(this._yield())}}),BetaJS.Modelling.Associations.TableAssociation.extend("BetaJS.Modelling.Associations.HasOneAssociation",{_yield:function(a){var b={};b[this._foreign_key]=a?a:this._primary_key?this._model.get(this._primary_key):this._model.id();var c=this._foreign_table.findBy(b);return c&&c.on("destroy",function(){this.invalidate()},this),c},_change_id:function(a,b){var c=this._yield(b);c&&(c.set(this._foreign_key,a),c.save())}}),BetaJS.Modelling.Associations.TableAssociation.extend("BetaJS.Modelling.Associations.BelongsToAssociation",{_yield:function(){var a=null;if(this._primary_key){var b={};b[this._primary_key]=this._model.get(this._foreign_key),a=this._foreign_table.findBy(b)}else a=this._foreign_table.findById(this._model.get(this._foreign_key));return a&&a.on("destroy",function(){this.invalidate()},this),a}}),BetaJS.Class.extend("BetaJS.Modelling.Validators.Validator",{validate:function(){return null}}),BetaJS.Modelling.Validators.Validator.extend("BetaJS.Modelling.Validators.PresentValidator",{constructor:function(a){this._inherited(BetaJS.Modelling.Validators.PresentValidator,"constructor"),this.__error_string=a?a:"Field is required"},validate:function(a){return BetaJS.Types.is_null(a)?this.__error_string:null}}),BetaJS.Net.Browser={getNavigator:function(){return{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent}},__flash:null,__isiOS:null,__isAndroid:null,__iOSversion:null,__isWebOS:null,__isWindowsPhone:null,__isBlackberry:null,__isMobile:null,__isInternetExplorer:null,flash:function(){return this.__flash||(this.__flash=new BetaJS.Net.FlashDetect),this.__flash},isiOS:function(){return null==this.__isiOS&&(this.__isiOS=-1!=navigator.userAgent.indexOf("iPhone")||-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPad")),this.__isiOS},isChrome:function(){return"chrome"in window},isAndroid:function(){return null==this.__isAndroid&&(this.__isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android")),this.__isAndroid},isWebOS:function(){return null==this.__isWebOS&&(this.__isWebOS=-1!=navigator.userAgent.toLowerCase().indexOf("webos")),this.__isWebOS},isWindowsPhone:function(){return null==this.__isWindowsPhone&&(this.__isWindowsPhone=-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")),this.__isWindowsPhone},isBlackberry:function(){return null==this.__isBlackberry&&(this.__isBlackberry=-1!=navigator.userAgent.toLowerCase().indexOf("blackberry")),this.__isBlackberry},iOSversion:function(){if(null==this.__iOSversion&&this.isiOS()){var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);this.__iOSversion={major:parseInt(a[1],10),minor:parseInt(a[2],10),revision:parseInt(a[3]||0,10)}}return this.__iOSversion},isMobile:function(){return null==this.__isMobile&&(this.__isMobile=this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()),this.__isMobile},isInternetExplorer:function(){return null==this.__isInternetExplorer&&(this.__isInternetExplorer="Microsoft Internet Explorer"==navigator.appName),this.__isInternetExplorer}},BetaJS.Class.extend("BetaJS.Net.FlashDetect",{constructor:function(){if(this._inherited(BetaJS.Net.FlashDetect,"constructor"),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var a="application/x-shockwave-flash",b=navigator.mimeTypes;b&&b[a]&&b[a].enabledPlugin&&b[a].enabledPlugin.description&&(this.__version=this.parseVersion(b[a].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var c=0;c<this.__activeXDetectRules.length;c++)try{var d=new ActiveXObject(this.__activeXDetectRules[c].name),e=this.__activeXDetectRules[c].version(d);if(e){this.__version=this.parseActiveXVersion(e);break}}catch(f){}},parseVersion:function(a){var b=a.split(/ +/),c=b[2].split(/\./),d=b[3];return{raw:a,major:parseInt(c[0],10),minor:parseInt(c[1],10),revisionStr:d,revision:parseInt(d.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(a){var b=a.split(",");return{raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],10),revision:parseInt(b[2],10),revisionStr:b[2]}},version:function(){return this.__version},installed:function(){return null!=this.__version},supported:function(){return this.installed()&&!BetaJS.Net.Browser.is_iOS()},majorAtLeast:function(a){return this.installed()&&this.version().major>=a},minorAtLeast:function(a){return this.installed()&&this.version().minor>=a},revisionAtLeast:function(a){return this.installed()&&this.version().revision>=a},versionAtLeast:function(){if(!this.installed())return!1;var a=[this.version().major,this.version().minor,this.version().revision],b=Math.min(a.length,arguments.length);for(i=0;b>i;i++)if(a[i]!=arguments[i])return a[i]>arguments[i];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(a){try{a.AllowScriptAccess="always";try{return a.GetVariable("$version")}catch(b){return null}}catch(b){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}}]}),BetaJS.Net.Browser.Loader={loadScript:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.apply(c||this,[a]))},e.appendChild(f)}},BetaJS.Templates={tokenize:function(a){if(BetaJS.Types.is_array(a))return a;var b=[],c=0;return a.replace(BetaJS.Templates.SYNTAX_REGEX(),function(d,e,f,g,h){return h>c&&b.push({type:BetaJS.Templates.TOKEN_STRING,data:BetaJS.Strings.js_escape(a.slice(c,h))}),g&&b.push({type:BetaJS.Templates.TOKEN_CODE,data:g}),e&&b.push({type:BetaJS.Templates.TOKEN_EXPR,data:e}),f&&b.push({type:BetaJS.Templates.TOKEN_ESC,data:f}),c=h+d.length,d}),b},compile:function(a,b){BetaJS.Types.is_string(a)&&(a=this.tokenize(a)),b=b||{};for(var c=b.start_index||0,d=b.end_index||a.length,e="__p+='",f=c;d>f;++f)switch(a[f].type){case BetaJS.Templates.TOKEN_STRING:e+=a[f].data;break;case BetaJS.Templates.TOKEN_CODE:e+="';\n"+a[f].data+"\n__p+='";break;case BetaJS.Templates.TOKEN_EXPR:e+="'+\n((__t=("+a[f].data+"))==null?'':__t)+\n'";break;case BetaJS.Templates.TOKEN_ESC:e+="'+\n((__t=("+a[f].data+"))==null?'':BetaJS.Strings.htmlentities(__t))+\n'"}e+="';\n",e="with(obj||{}){\n"+e+"}\n",e="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";var g=new Function("obj",e),h=function(a){return g.call(this,a)};return h.source="function(obj){\n"+e+"}",h}},BetaJS.Templates.SYNTAX={OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},BetaJS.Templates.SYNTAX_REGEX=function(){var a=BetaJS.Templates.SYNTAX;return BetaJS.Templates.SYNTAX_REGEX_CACHED||(BetaJS.Templates.SYNTAX_REGEX_CACHED=new RegExp(a.OPEN+a.MODIFIER_EXPR+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_ESC+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_CODE+"([\\s\\S]+?)"+a.CLOSE+"|"+"$","g")),BetaJS.Templates.SYNTAX_REGEX_CACHED},BetaJS.Templates.TOKEN_STRING=1,BetaJS.Templates.TOKEN_CODE=2,BetaJS.Templates.TOKEN_EXPR=3,BetaJS.Templates.TOKEN_ESC=4,BetaJS.Class.extend("BetaJS.Templates.Template",{constructor:function(a){this._inherited(BetaJS.Templates.Template,"constructor"),this.__tokens=BetaJS.Templates.tokenize(a),this.__compiled=BetaJS.Templates.compile(this.__tokens)},evaluate:function(a){return this.__compiled.apply(this,[a])}},{bySelector:function(a){return new this(BetaJS.$(a).html())}}),BetaJS.$=jQuery||null,BetaJS.Class.extend("BetaJS.Views.View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Ids.ClientIdMixin,BetaJS.Properties.PropertiesMixin,{_templates:function(){return{}},_dynamics:function(){return{}},_events:function(){return[]},_css:function(){return{}},css:function(a){if(this.__css[a])return this.__css[a];if(this.__parent){var b=this.__parent.css(a);if(b&&b!=a)return b}var b=this._css();return b[a]?b[a]:a},_render:function(){this.__html?this.$el.html(this.__html):this.__templates["default"]?this.$el.html(this.evaluateTemplate("default",{})):this.__dynamics["default"]&&this.evaluateDynamics("default",this.$el,{},{name:"default"})},templates:function(a){return a in this.__templates?this.__templates[a]:null},dynamics:function(a){return a in this.__dynamics?this.__dynamics[a]:null},_supp:function(){return{__context:this,css:function(a){return this.__context.css(a)},attrs:function(a){var b="";for(var c in a)b+=(null==a[c]?c:c+"='"+a[c]+"'")+" ";return b},styles:function(a){var b="";for(var c in a)b+=c+":"+a[c]+";";return b},selector:function(a){return"data-selector='"+a+"' "},view_id:this.cid()}},templateArguments:function(){var a=this.getAll();return a.supp=this._supp(),a},evaluateTemplate:function(a,b){return b=b||{},this.__templates[a].evaluate(BetaJS.Objs.extend(b,this.templateArguments()))},evaluateDynamics:function(a,b,c,d){return this.__dynamics[a].renderInstance(b,BetaJS.Objs.extend(d||{},{args:c||{}}))},_setOption:function(a,b,c,d){var d=d?d:"__";this[d+b]=b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c},_setOptionProperty:function(a,b,c){this.set(b,b in a&&BetaJS.Types.is_defined(a[b])?a[b]:c)},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.View,"constructor"),this._setOption(a,"el",null),this._setOption(a,"visible",!0),this._setOption(a,"html",null),this._setOption(a,"events",[]),this._setOption(a,"attributes",{}),this._setOption(a,"hide_on_leave",!1),this._setOption(a,"vertical_center",!1),this._setOption(a,"horizontal_center",!1),this._setOption(a,"invalidate_on_show",!1),this._setOption(a,"append_to_el",!1),this.__old_attributes={},this._setOption(a,"el_classes",[]),BetaJS.Types.is_string(this.__el_classes)&&(this.__el_classes=this.__el_classes.split(" ")),this.__added_el_classes=[],this._setOption(a,"el_styles",{}),this._setOption(a,"children_styles",{}),this._setOption(a,"children_classes",[]),BetaJS.Types.is_string(this.__children_classes)&&(this.__children_classes=this.__children_classes.split(" ")),this._setOption(a,"invalidate_on_change",!1),this.__old_el_styles={},this._setOption(a,"css",{}),this.__parent=null,this.__children={},this.__active=!1,this.$el=null,this.__events=this._events().concat(this.__events);var b=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,a.templates||{});"template"in a&&(b["default"]=a.template),this.__templates={};for(var c in b)this.__templates[c]=new BetaJS.Templates.Template(BetaJS.Types.is_string(b[c])?b[c]:b[c].html());var d=BetaJS.Objs.extend(BetaJS.Types.is_function(this._dynamics)?this._dynamics():this._dynamics,a.dynamics||{});"dynamic"in a&&(d["default"]=a.dynamic),this.__dynamics={};for(var c in d)this.__dynamics[c]=new BetaJS.Views.DynamicTemplate(this,BetaJS.Types.is_string(d[c])?d[c]:d[c].html());this.setAll(a.properties||{}),this.__invalidate_on_change&&this.on("change",function(){this.invalidate()},this)},isActive:function(){return this.__active},activate:function(){if(this.isActive())return this;if(null==this.__el)return null;if(this.__parent&&!this.__parent.isActive())return null;if(this.$el=this.__parent?""==this.__el?this.__parent.$el:this.__parent.$(this.__el):BetaJS.$(this.__el),0==this.$el.size()&&(this.$el=null),!this.$el)return null;this.__append_to_el&&(this.$el.append("<div data-view-id='"+this.cid()+"'></div>"),this.$el=this.$el.find("[data-view-id='"+this.cid()+"']")),this.__old_attributes={};for(var a in this.__attributes){var b=this.$el.attr(a);this.__old_attributes[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.attr(a,this.__attributes[a])}this.__added_el_classes=[];for(var c=BetaJS.Objs.extend(this._el_classes(),this.__el_classes),d=0;d<c.length;++d)this.$el.hasClass(c[d])||(this.$el.addClass(c[d]),this.__added_el_classes.push(c[d]));this.__old_el_styles={};var e=BetaJS.Objs.extend(this._el_styles(),this.__el_styles);for(var a in e){var b=this.$el.css(a);this.__old_el_styles[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.css(a,e[a])}return this.__bind(),this.__visible||this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),this.__visible&&this.__bind_hide_on_leave(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}),this.__visible&&this._after_show(),this.__updateViewPosition(),this._notify("activate"),this},__updateViewPosition:function(){this.__vertical_center&&(this.$el.css("top","50%"),this.$el.css("margin-top",Math.round(-this.$el.height()/2)+"px")),this.__horizontal_center&&(this.$el.css("left","50%"),this.$el.css("margin-left",Math.round(-this.$el.width()/2)+"px"))},deactivate:function(){if(!this.isActive())return!1;this._notify("deactivate"),BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),this.__active=!1,this.__visible&&(this.__unbind_hide_on_leave(),this._after_hide()),BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__unbind(),this.$el.html("");for(var a in this.__old_attributes)this.$el.attr(a,this.__old_attributes[a]);for(var b=0;b<this.__added_el_classes.length;++b)this.$el.removeClass(this.__added_el_classes[b]);for(var a in this.__old_el_styles)this.$el.css(a,this.__old_el_styles[a]);return this.__append_to_el&&this.$el.remove(),this.$el=null,!0},_el_styles:function(){return{}},_el_classes:function(){return[]},$:function(a){return this.$el.find(a)},$data:function(a,b){b||(b=this.$el);var c="";for(var d in a)c+="[data-"+d+"='"+a[d]+"']";return b.find(c)},destroy:function(){this.deactivate(),BetaJS.Objs.iter(this.__children,function(a){a.view.destroy()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.destroy()},this),BetaJS.Objs.iter(this.__templates,function(a){a.destroy()},this),this.trigger("destroy"),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},isVisible:function(){return this.__visible},setVisibility:function(a){a!=this.__visible&&(this.__visible=a,this.isActive()&&(this.$el.css("display",this.__visible?"":"none"),this.__visible?(this.__bind_hide_on_leave(),this._after_show()):(this.__unbind_hide_on_leave(),this._after_hide())),this.__parent&&this.__parent.updateChildVisibility(this))},updateChildVisibility:function(){},_after_show:function(){this.__invalidate_on_show&&this.invalidate()},_after_hide:function(){},toggle:function(){this.setVisibility(!this.isVisible())},__bind:function(){var a=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=BetaJS.Types.is_function(b)?b:a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?a.$el.on(f,h):a.$el.on(f,g,h)})})},__unbind:function(){this.$el.off(".events"+this.cid())
},__render:function(){if(this.isActive()){this._render();var a=this.$el.children();if(!BetaJS.Types.is_empty(this.__children_styles))for(var b in this.__children_styles)a.css(b,this.__children_styles[b]);BetaJS.Objs.iter(this.__children_classes,function(b){a.addClass(b)})}},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__render(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}))},setEl:function(a){this.isActive()?(this.deactivate(),this.__el=a,this.activate()):this.__el=a},getParent:function(){return this.__parent},hasChild:function(a){return a&&a.cid()in this.__children},setParent:function(a){if(a!=this.__parent){if(this.deactivate(),this.__parent){this._unbindParent(this.__parent);var b=this.__parent;this.__parent.off(null,null,this),this.__parent=null,b.removeChild(this)}a&&(this.__parent=a,a.addChild(this),this._bindParent(a),a.isActive()&&this.activate())}},_bindParent:function(){},_unbindParent:function(){},children:function(){var a={};return BetaJS.Objs.iter(this.__children,function(b,c){a[c]=b.view},this),a},childOptions:function(a){return this.__children[a.cid()].options},addChildren:function(a){BetaJS.Objs.iter(a,function(a){this.addChild(a)},this)},addChild:function(a,b){return this.hasChild(a)?null:(b=b||{},this.__children[a.cid()]={view:a,options:b},this._notify("addChild",a,b),a.setParent(this),this.isActive()&&this.__updateViewPosition(),a)},removeChildren:function(a){BetaJS.Objs.iter(a,function(a){this.removeChild(a)},this)},removeChild:function(a){this.hasChild(a)&&(delete this.__children[a.cid()],a.setParent(null),a.off(null,null,this),this._notify("removeChild",a),this.isActive()&&this.__updateViewPosition())},width:function(){return this.$el.width()},innerWidth:function(){return this.$el.innerWidth()},outerWidth:function(){return this.$el.outerWidth()},height:function(){return this.$el.height()},innerHeight:function(){return this.$el.innerHeight()},outerHeight:function(){return this.$el.outerHeight()},__bind_hide_on_leave:function(){if(this.__hide_on_leave&&!this.__hide_on_leave_func){var a=this.$el.get(0),b=this;this.__hide_on_leave_func=function(c){return b.__hide_on_leave_skip?(b.__hide_on_leave_skip=!1,void 0):(document.contains(c.target)&&c.target!==a&&!$.contains(a,c.target)&&b.hide(),void 0)},this.__hide_on_leave_skip=!0,BetaJS.$(document.body).on("click",this.__hide_on_leave_func)}},__unbind_hide_on_leave:function(){this.__hide_on_leave&&this.__hide_on_leave_func&&($(document.body).unbind("click",this.__hide_on_leave_func),delete this.__hide_on_leave_func)}}]),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Class.extend("BetaJS.Views.DynamicTemplate",{constructor:function(a,b){this._inherited(BetaJS.Views.DynamicTemplate,"constructor"),this.__parent=a,this.__template=new BetaJS.Templates.Template(b),this.__instances={},this.__instances_by_name={}},reset:function(){BetaJS.Objs.iter(this.__instances,function(a){this.removeInstance(a)},this)},destroy:function(){this.reset(),this._inherited(BetaJS.Views.DynamicTemplate,"destroy")},renderInstance:function(a,b){b=b||{},b.name&&this.removeInstanceByName(b.name);var c=new BetaJS.Views.DynamicTemplateInstance(this,a,b);this.__instances[c.cid()]=c,b.name&&(this.__instances_by_name[name]=c)},removeInstanceByName:function(a){a in this.__instances_by_name&&this.removeInstance(this.__instances_by_name[a])},removeInstance:function(a){delete this.__instances[a.cid()],delete this.__instances_by_name[a.name()],a.destroy()},view:function(){return this.__parent},template:function(){return this.__template}}),BetaJS.Class.extend("BetaJS.Views.DynamicTemplateInstance",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.ListenMixin,{__bind:{attr:function(a,b){return this.__context.__bind_attribute(a,b)},attrs:function(a){var b="";for(attribute in a)b+=this.attr(attribute,a[attribute])+" ";return b},value:function(a){return this.__context.__bind_value(a)},inner:function(a){return this.__context.__bind_inner(a)},css_if:function(a,b){return this.__context.__bind_css_if(a,b,!0)},css_if_not:function(a,b){return this.__context.__bind_css_if(a,b,!1)}},__new_element:function(a){var b=BetaJS.Ids.uniqueId();return this.__elements[b]=BetaJS.Objs.extend({id:b,$el:null},a),this.__elements[b]},__decompose_variable:function(a){var b=a.split(".");return{object:1==b.length?this.__parent.view():this.__args[b[0]],key:1==b.length?a:b[1]}},__get_variable:function(a){var b=this.__decompose_variable(a);return b.object.get(b.key)},__set_variable:function(a,b){var c=this.__decompose_variable(a);return c.object.set(c.key,b)},__update_element:function(a){var b=this.__get_variable(a.variable);"inner"==a.type?a.$el.html(b):"value"==a.type?a.$el.val()!=b&&a.$el.val(b):"attribute"==a.type?a.$el.attr(a.attribute,b):"css"==a.type&&(a.positive||(b=!b),b?a.$el.addClass(this.__parent.view().css(a.css)):a.$el.removeClass(this.__parent.view().css(a.css)))},__prepare_element:function(a){var b=this;a.$el=this.$el.find(a.selector),"inner"==a.type||"css"==a.type?this.__update_element(a):"value"==a.type&&a.$el.on("change input keyup paste",function(){b.__set_variable(a.variable,a.$el.val())})},__bind_attribute:function(a,b){var c=this.__new_element({type:"attribute",attribute:a,variable:b}),d="data-bind-"+a+"='"+c.id+"'";c.selector="["+d+"]";var e=this.__decompose_variable(b);return this.listenOn(e.object,"change:"+e.key,function(){this.__update_element(c)},this),d+" "+a+"='"+e.object.get(e.key)+"'"},__bind_css_if:function(a,b,c){var d=this.__new_element({type:"css",css:a,variable:b,positive:c}),e="data-bind-css-"+a+"='"+d.id+"'";d.selector="["+e+"]";var f=this.__decompose_variable(b);return this.listenOn(f.object,"change:"+f.key,function(){this.__update_element(d)},this),e},__bind_value:function(a){var b=this.__new_element({type:"value",variable:a}),c="data-bind-value='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c+" value='"+d.object.get(d.key)+"'"},__bind_inner:function(a){var b=this.__new_element({type:"inner",variable:a}),c="data-bind-inner='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c},constructor:function(a,b,c){this._inherited(BetaJS.Views.DynamicTemplateInstance,"constructor"),this.__elements={},this.__inners={},c=c||{},c.name&&(this.__name=name),this.__parent=a,this.$el=b,this.__args=BetaJS.Objs.extend(c.args||{},this.__parent.view().templateArguments()),this.__args.bind=BetaJS.Objs.extend({__context:this},this.__bind),this.$el.html(a.template().evaluate(this.__args)),BetaJS.Objs.iter(this.__elements,function(a){this.__prepare_element(a)},this)},destroy:function(){BetaJS.Objs.iter(this.__elements,function(a){a.$el.off()},this),this._inherited(BetaJS.Views.DynamicTemplateInstance,"destroy")},name:function(){return this.__name}}]),BetaJS.Class.extend("BetaJS.Routers.Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(a){this._inherited(BetaJS.Routers.Router,"constructor");var b=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(b)||(b=[b]),"routes"in a&&(BetaJS.Types.is_array(a.routes)?b=b.concat(a.routes):b.push(a.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(b,function(a){BetaJS.Objs.iter(a,function(a,b){BetaJS.Types.is_string(a)&&(a={action:a}),a.key=b,a.route=new RegExp("^"+b+"$"),"applicable"in a?BetaJS.Types.is_array(a.applicable)||(a.applicable=[a.applicable]):a.applicable=[],"valid"in a?BetaJS.Types.is_array(a.valid)||(a.valid=[a.valid]):a.valid=[],"path"in a||(a.path=a.key),this.__routes.push(a),this.__paths[a.path]=a},this)},this),"actions"in a&&BetaJS.Objs.iter(a.actions,function(a,b){this[b]=a},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Routers.Router,"destroy")},parse:function(a){for(var b=0;b<this.__routes.length;++b){var c=this.__routes[b],d=c.route.exec(a);if(null!=d){d.shift(1);var e=!0;if(BetaJS.Objs.iter(c.applicable,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;e=e&&b.apply(this,d)},this),!e)continue;var f=!0;return BetaJS.Objs.iter(c.valid,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;f=f&&b.apply(this,d)},this),f?{object:c,params:d}:null}}return null},object:function(a){return this.__paths[a]},path:function(a){for(var b=this.object(a).key,c=Array.prototype.slice.apply(arguments,[1]),d=/\(.*?\)/;arg=c.shift();)b=b.replace(d,arg);return b},navigate:function(a){this.trigger("navigate",a);var b=this.parse(a);return null==b?(this.trigger("navigate-fail",a),!1):(this.trigger("navigate-success",b.object,b.params),this.invoke(b.object,b.params,a))},invoke:function(a,b,c){c=c||this.path(a.key,b),this.trigger("before_invoke",a,b,c),this.__enter(a,b,c),this.trigger("after_invoke",a,b,c);var d=this._invoke(a,b);return d},_invoke:function(a,b){var c=a.action;return BetaJS.Types.is_string(c)&&(c=this[c]),c.apply(this,b)},__leave:function(){null!=this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(a,b,c){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=c,this.__current.object=a,this.__current.params=b,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Class.extend("BetaJS.Routers.RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Routers.RouterHistory,"constructor"),this.__router=a,this.__history=[],a.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouterHistory,"destroy")},__after_invoke:function(a,b){this.__history.push({object:a,params:b}),this.trigger("change")},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this.__history.length},get:function(a){return a=a||0,this.__history[a]},getRoute:function(a){var b=this.get(a);return this.__router.path(b.object.path,b.params)},back:function(a){if(!(this.count()<2)){for(a=a||0;a>=0&&this.count()>1;)this.__history.pop(),--a;var b=this.__history.pop();return this.trigger("change"),this.__router.invoke(b.object,b.params)}}}]),BetaJS.Class.extend("BetaJS.Routers.RouteBinder",{constructor:function(a){this._inherited(BetaJS.Routers.RouteBinder,"constructor"),this.__router=a,this.__router.on("after_invoke",function(a,b,c){this._getExternalRoute()!=c&&this._setExternalRoute(c)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouteBinder,"destroy")},current:function(){return this._getExternalRoute()},_setRoute:function(a){var b=this.__router.current();b&&b.route==a||this.__router.navigate(a)},_getExternalRoute:function(){return""},_setExternalRoute:function(){}}),BetaJS.Routers.RouteBinder.extend("BetaJS.Routers.HashRouteBinder",[BetaJS.Ids.ClientIdMixin,{constructor:function(a){this._inherited(BetaJS.Routers.HashRouteBinder,"constructor",a);var b=this;BetaJS.$(window).on("hashchange.events"+this.cid(),function(){b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Routers.HashRouteBinder,"destroy")},_getExternalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setExternalRoute:function(a){window.location.hash="#"+a}}]),BetaJS.Routers.RouteBinder.extend("BetaJS.Routers.HistoryRouteBinder",[BetaJS.Ids.ClientIdMixin,{constructor:function(a){this._inherited(BetaJS.Routers.HistoryRouteBinder,"constructor",a);var b=this;this.__used=!1,BetaJS.$(window).on("popstate.events"+this.cid(),function(){b.__used&&b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("popstate.events"+this.cid()),this._inherited(BetaJS.Routers.HistoryRouteBinder,"destroy")},_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.history.pushState({},document.title,a),this.__used=!0}}],{supported:function(){return window.history&&window.history.pushState}}),BetaJS.Routers.RouteBinder.extend("BetaJS.Routers.LocationRouteBinder",{_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.location.pathname=a}}),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="  <div data-selector=\"right\" class='holygrail-view-right-container'></div>  <div data-selector=\"left\" class='holygrail-view-left-container'></div>  <div data-selector=\"center\" class='holygrail-view-center-container'></div> ",BetaJS.Templates.Cached["list-container-view-item-template"]='  <div data-view-id="{%= cid %}"></div> ',BetaJS.Templates.Cached["switch-container-view-item-template"]='  <div data-view-id="{%= cid %}" class="switch-container" data-selector="switch-container-item"></div> ',BetaJS.Templates.Cached["button-view-template"]='   <{%= button_container_element %} data-selector="button-inner" class="{%= supp.css("default") %}"    {%= bind.css_if("disabled", "disabled") %}    {%= bind.inner("label") %}>   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["check-box-view-template"]='  <input type="checkbox" {%= checked ? "checked" : "" %} />  {%= label %} ',BetaJS.Templates.Cached["input-view-template"]='  <input class="input-view" {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %} /> ',BetaJS.Templates.Cached["label-view-template"]='  <{%= element %} class="{%= supp.css(\'label\') %}" {%= bind.inner("label") %}></{%= element %}> ',BetaJS.Templates.Cached["link-view-template"]='  <a href="javascript:{}" {%= bind.inner("label") %}></a> ',BetaJS.Templates.Cached["text-area-template"]='   <textarea {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %}             {%= bind.css_if_not("text-area-no-resize", "resizable") %}             {%= readonly ? \'readonly\' : \'\' %}             style="resize: {%= horizontal_resize ? (vertical_resize ? \'both\' : \'horizontal\') : (vertical_resize ? \'vertical\' : \'none\') %}"             {%= bind.css_if("text-area-horizontal-fill", "horizontal_fill") %}></textarea>  ',BetaJS.Templates.Cached["progress-template"]='  <div class="{%= supp.css(\'outer\') %}">   <div data-selector="inner" class="{%= supp.css(\'inner\') %}" style="{%= horizontal ? \'width\': \'height\' %}:{%= value*100 %}%">   </div>   <div class="progress-view-overlay" data-selector="label">    {%= label %}   </div>  </div> ',BetaJS.Templates.Cached["list-view-template"]='   <{%= list_container_element %}    {%= supp.attrs(list_container_attrs) %}    class="{%= list_container_classes %}"    data-selector="list">   </{%= list_container_element %}>  ',BetaJS.Templates.Cached["list-view-item-container-template"]='   <{%= item_container_element %}    {%= supp.attrs(item_container_attrs) %}    class="{%= item_container_classes %}"    {%= supp.list_item_attr(item) %}>   </{%= item_container_element %}>  ',BetaJS.Templates.Cached["overlay-view-template"]='  <div data-selector="container"></div> ',BetaJS.Templates.Cached["fullscreen-overlay-view-template"]='  <div class="fullscreen-overlay-background" data-selector="outer"></div>  <div class="fullscreen-overlay" data-selector="inner"></div> ',BetaJS.Views.View.extend("BetaJS.Views.HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.HolygrailView,"constructor",a),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(a){return this.__setView("left",a)},getCenter:function(){return this.__center},setCenter:function(a){return this.__setView("center",a)},getRight:function(){return this.__right},setRight:function(a){return this.__setView("right",a)},__setView:function(a,b){return this.removeChild(this["__"+a]),this["__"+a]=null,b&&(b.setEl('[data-selector="'+a+'"]'),this["__"+a]=this.addChild(b)),b}}),BetaJS.Views.View.extend("BetaJS.Views.ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.ListContainerView,"constructor",a),this._setOption(a,"alignment","horizontal"),this._setOption(a,"positioning","float")},isHorizontal:function(){return"horizontal"==this.__alignment},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){var b=this.childOptions(a);if(this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),!this.isHorizontal()||"float"in b||"float"!=this.__positioning||(b["float"]="left"),this.isActive()&&"float"in b&&"float"==this.__positioning){var c=this.$("[data-view-id='"+a.cid()+"']");c.css("float",b["float"])}},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove()},__updatePositioningHelper:function(a,b,c){var d=0;BetaJS.Objs.iter(a,function(a){var e=this.childOptions(a);return e.type&&"ignore"==e.type||(a.$el.css(b,d+"px"),a.isVisible()&&(d+=parseInt(a.$el.css(c))),!e.type||"dynamic"!=e.type)?void 0:!1},this)},__updatePositioning:function(){var a=BetaJS.Objs.values(this.children()),b=BetaJS.Objs.clone(a,1).reverse(),c=this.isHorizontal()?"left":"top",d=this.isHorizontal()?"right":"bottom",e=this.isHorizontal()?"width":"height";this.__updatePositioningHelper(b,d,e),this.__updatePositioningHelper(a,c,e)},updateChildVisibility:function(a){this._inherited(BetaJS.Views.ListContainerView,"updateChildVisibility",a),"computed"==this.__positioning&&this.__updatePositioning()},_after_show:function(){this._inherited(BetaJS.Views.ListContainerView,"_after_show"),"computed"==this.__positioning&&this.__updatePositioning()}}),BetaJS.Views.View.extend("BetaJS.Views.SingleContainerView",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),this.__view=null},getView:function(){return this.__view},setView:function(a){this.removeChild(this.__view),a&&(a.setEl(""),this.__view=this.addChild(a))}}),BetaJS.Views.View.extend("BetaJS.Views.SwitchContainerView",{_templates:{item:BetaJS.Templates.Cached["switch-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){this._inherited(BetaJS.Views.SwitchContainerView,"constructor",a),this.__selected=null},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),this.__selected=this.__selected||a,a.setVisibility(this.__selected==a)},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove(),this.__selected==a&&(this.__selected=null)},select:function(a){this.__selected=a,BetaJS.Objs.iter(this.children(),function(a){a.setVisibility(this.__selected==a)},this)},selected:function(){return this.__selected}}),BetaJS.Views.View.extend("BetaJS.Views.ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["button-view-template"]},_css:function(){return{disabled:"","default":""}},constructor:function(a){this._inherited(BetaJS.Views.ButtonView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"button_container_element","button"),this._setOptionProperty(a,"disabled",!1)},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click [data-selector='button-inner']":"__clickButton"}])},__clickButton:function(){this.get("disabled")||this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.InputView",{_dynamics:{"default":BetaJS.Templates.Cached["input-view-template"]},_events:function(){return[{"keyup input":"__keyupEvent","blur input":"__leaveEvent"},{"keyup input":"__changeEvent","change input":"__changeEvent","input input":"__changeEvent","paste input":"__changeEvent"}]},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.InputView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder","")},__keyupEvent:function(a){var b=a.keyCode||a.which;13==b&&this.trigger("enter_key",this.get("value"))},__leaveEvent:function(){this.trigger("leave")},__changeEvent:function(){this.trigger("change",this.get("value"))},focus:function(a){this.$("input").focus(),this.$("input").focus(),a&&this.$("input").select()}}),BetaJS.Views.View.extend("BetaJS.Views.CheckBoxView",{_templates:{"default":BetaJS.Templates.Cached["check-box-view-template"]},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click input":"__click"}])},constructor:function(a){a=a||{},a.invalidate_on_change=!0,this._inherited(BetaJS.Views.CheckBoxView,"constructor",a),this._setOptionProperty(a,"checked",!1),this._setOptionProperty(a,"label","")},__click:function(){this.set("checked",this.$("input").is(":checked")),this.trigger("check",this.get("checked"))}}),BetaJS.Views.View.extend("BetaJS.Views.LabelView",{_dynamics:{"default":BetaJS.Templates.Cached["label-view-template"]},_css:function(){return{label:"label-view-class"}},_events:function(){return[{click:"__clickEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.LabelView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"element","span")},__clickEvent:function(){this.trigger("click")}}),BetaJS.Views.SwitchContainerView.extend("BetaJS.Views.InputLabelView",{constructor:function(a){this._inherited(BetaJS.Views.InputLabelView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOption(a,"edit_on_click",!0),this._setOption(a,"label_mode",!0),this._setOption(a,"read_only",!1),this.label=this.addChild(new BetaJS.Views.LabelView({label:this.binding("value"),el_classes:a.label_el_classes,children_classes:a.label_children_classes})),this.input=this.addChild(new BetaJS.Views.InputView({value:this.binding("value"),placeholder:this.binding("placeholder")})),this.__label_mode||this.select(this.input),this.input.on("leave enter_key",function(){this.label_mode()},this),this.__edit_on_click&&this.label.on("click",function(){this.edit_mode()},this)},is_label_mode:function(){return this.__label_mode},is_edit_mode:function(){return!this.__label_mode},label_mode:function(){this.is_label_mode()||(this.__label_mode=!0,this.select(this.label))},edit_mode:function(){this.is_edit_mode()||this.__read_only||(this.__label_mode=!1,this.select(this.input),this.input.focus(!0))}}),BetaJS.Views.View.extend("BetaJS.Views.LinkView",{_dynamics:{"default":BetaJS.Templates.Cached["link-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.LinkView,"constructor",a),this._setOptionProperty(a,"label","")},_events:function(){return this._inherited(BetaJS.Views.LinkView,"_events").concat([{"click a":"__click"}])},__click:function(){this.trigger("click")}}),BetaJS.Views.View.extend("BetaJS.Views.TextAreaView",{_dynamics:{"default":BetaJS.Templates.Cached["text-area-template"]},constructor:function(a){this._inherited(BetaJS.Views.TextAreaView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOptionProperty(a,"horizontal_resize",!1),this._setOptionProperty(a,"vertical_resize",!0),this._setOptionProperty(a,"horizontal_fill",!1),this._setOptionProperty(a,"readonly",!1),this.on("change:readonly",function(){this.get("readonly")?this.$("textarea").attr("readonly","readonly"):this.$("textarea").removeAttr("readonly")},this)}}),BetaJS.Views.View.extend("BetaJS.Views.ProgressView",{_templates:{"default":BetaJS.Templates.Cached["progress-template"]},_css:function(){return{outer:"",inner:""}},constructor:function(a){this._inherited(BetaJS.Views.ProgressView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"horizontal",!0),this._setOptionProperty(a,"value",1),this.on("change:value",function(a){this.isActive()&&this.$("[data-selector='inner']").css(this.get("horizontal")?"width":"height",100*a+"%")},this),this.on("change:label",function(a){this.isActive()&&this.$("[data-selector='label']").html(a)},this)}}),BetaJS.Views.View.extend("BetaJS.Views.CustomListView",{_templates:function(){return{"default":BetaJS.Templates.Cached["list-view-template"],"item-container":BetaJS.Templates.Cached["list-view-item-container-template"]}},_supp:function(){return BetaJS.Objs.extend(this._inherited(BetaJS.Views.CustomListView,"_supp"),{list_item_attr:function(a){return this.attrs({"data-view-id":this.__context.cid(),"data-cid":BetaJS.Ids.objectId(a),"data-index":this.__context.__collection.getIndex(a)})}})},constructor:function(a){if(this._inherited(BetaJS.Views.CustomListView,"constructor",a),this._setOption(a,"list_container_element","ul"),this._setOption(a,"list_container_attrs",{}),this._setOption(a,"list_container_classes",""),this._setOption(a,"item_container_element","li"),this._setOption(a,"item_container_classes",""),this.__itemData={},"collection"in a)this.__collection=a.collection,this.__destroy_collection="destroy_collection"in a?a.destroy_collection:!1,"compare"in a&&this.__collection.set_compare(a.compare);else{var b={};"objects"in a&&(b.objects=a.objects),"compare"in a&&(b.compare=a.compare),this.__collection=new BetaJS.Collections.Collection(b),this.__destroy_collection=!0}this.__collection.on("add",function(a){this.__addItem(a,!0)},this),this.__collection.on("remove",function(a){this.__removeItem(a)},this),this.__collection.on("change",function(a){this.__changeItem(a)},this),this.__collection.on("index",function(a,b){this.__updateItemIndex(a,b)},this),this.__collection.on("reindexed",function(a){this.__reIndexItem(a)},this),this.__collection.on("sorted",function(){this.__sorted()},this)},destroy:function(){for(var a in this.__itemData)this._destroyItemData(this.__itemData[a]);this.__itemData=null,this.__collection.off(null,null,this),this.__destroy_collection&&this.__collection.destroy(),this._inherited(BetaJS.Views.CustomListView,"destroy")},collection:function(){return this.__collection},add:function(a){this.__collection.add(a)},remove:function(a){this.__collection.remove(a)},_render:function(){this.$selector_list=this._renderListContainer();var a=this;this.__collection.iterate(function(b){a.__addItem(b,!1)})},_renderListContainer:function(){return this.$el.html(this.evaluateTemplate("default",{list_container_element:this.__list_container_element,list_container_attrs:this.__list_container_attrs,list_container_classes:this.__list_container_classes})),this.$data({selector:"list"})},_findItemElement:function(a){return this.$data({"view-id":this.cid(),cid:BetaJS.Ids.objectId(a)},this.$selector_list)},_findIndexElement:function(a){return this.$data({"view-id":this.cid(),index:a},this.$selector_list)},__changeItem:function(a){this.isActive()&&this._changeItem(a)},_newItemData:function(){return{}},_destroyItemData:function(){},itemData:function(a){return this.__itemData[BetaJS.Ids.objectId(a)]},_changeItem:function(){},__addItem:function(a,b){if(this.isActive()){var c=this.evaluateTemplate("item-container",{item:a,item_container_element:this.__item_container_element,item_container_attrs:this.__item_container_attrs,item_container_classes:this.__item_container_classes}),d=this.__collection.getIndex(a);if(0==d)this.$selector_list.prepend(c);else{var e=this._findIndexElement(d-1);if(e.length>0)e.after(c);else{var f=this._findIndexElement(d+1);f.length>0?f.before(c):this.$selector_list.append(c)}}var g=this._findItemElement(a);this.__itemData[BetaJS.Ids.objectId(a)]&&this._destroyItemData(this.__itemData[BetaJS.Ids.objectId(a)]),this.__itemData[BetaJS.Ids.objectId(a)]=this._newItemData(a),this._addItem(a,g,b),this._addElement(g,b)}},_addElement:function(){},_addItem:function(){},__removeItem:function(a){if(this.isActive()){var b=this._findItemElement(a);this._removeItem(a,b),this._destroyItemData(this.__itemData[BetaJS.Ids.objectId(a)]),delete this.__itemData[BetaJS.Ids.objectId(a)],this._removeElement(b)}},_removeElement:function(a){a.remove()},_removeItem:function(){},__updateItemIndex:function(a,b){var c=this._findItemElement(a);c.attr("data-index",b),this._updateItemIndex(a,c)},__reIndexItem:function(a){var b=this._findItemElement(a),c=this.collection().getIndex(a);if(0==c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);d.after(b)}},_updateItemIndex:function(){},__sort:function(){for(var a=this.collection().count()-1;a>=0;a--)this.$selector_list.prepend(this._findIndexElement(a))}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.ListView",{constructor:function(a){this._inherited(BetaJS.Views.ListView,"constructor",a),this._setOption(a,"item_label","label"),this._setOption(a,"render_item_on_change",null==this.dynamics("item"))},_changeItem:function(a){if(this.__render_item_on_change){var b=this._findItemElement(a);this._renderItem(a,b,!1)}},_addItem:function(a,b,c){this._renderItem(a,b,c)},_renderItem:function(a,b){null!=this.templates("item")?b.html(this.evaluateTemplate("item",{item:a})):null!=this.dynamics("item")?this.evaluateDynamics("item",b,{item:a},{name:"item-"+BetaJS.Ids.objectId(a)}):b.html(a.get(this.__item_label))},_removeItem:function(a){null!=this.dynamics("item")&&this.dynamics("item").removeInstanceByName("item-"+BetaJS.Ids.objectId(a))}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.SubViewListView",{constructor:function(a){this._inherited(BetaJS.Views.SubViewListView,"constructor",a),"create_view"in a&&(this._create_view=a.create_view),this._setOption(a,"sub_view",BetaJS.Views.LabelView),this._setOption(a,"item_label","label");var b=this;this._setOption(a,"sub_view_options",function(a){return{label:a.binding(b.__item_label)}})},_create_view:function(a,b){var c=this.__sub_view_options(a);return c.el=b,new this.__sub_view(c)},_addItem:function(a,b){var c=this._create_view(a,b);this.itemData(a).view=c,this.addChild(c)},_destroyItemData:function(a){this.removeChild(a.view),a.view.destroy()}}),BetaJS.Views.View.extend("BetaJS.Views.ItemListItemView",{constructor:function(a){this._inherited(BetaJS.Views.ItemListItemView,"constructor",a),this._setOptionProperty(a,"item",null),this._setOptionProperty(a,"_selected",!1)},_events:function(){return[{click:"__click"}]},isSelected:function(){return this.get("_selected")},__click:function(){this.getParent().__click_select&&this.select()},select:function(){this.getParent().select(this.get("item"))},unselect:function(){this.getParent().unselect(this.get("item"))}}),BetaJS.Views.CustomListView.extend("BetaJS.Views.ItemListView",{constructor:function(a){if(this._inherited(BetaJS.Views.ItemListView,"constructor",a),this._setOption(a,"sub_view",BetaJS.Views.ItemListItemView),this._sub_view_options||(this._sub_view_options={}),this._sub_view_options&&!BetaJS.Types.is_function(this._sub_view_options)){var b=this._sub_view_options;this._sub_view_options=function(){return b}}if(a.sub_view_options){if(!BetaJS.Types.is_function(a.sub_view_options)){var b=a.sub_view_options;a.sub_view_options=function(){return b}}this.__sub_view_options=a.sub_view_options;var c=this;this._sub_view_options&&(this.__sub_view_options=function(b){return BetaJS.Objs.extend(c._sub_view_options(b),a.sub_view_options(b))})}else this.__sub_view_options=this._sub_view_options;this._setOption(a,"selectable",!0),this._setOption(a,"multi_select",!1),this._setOption(a,"click_select",!0)},_addItem:function(a,b){var c=new this.__sub_view(BetaJS.Objs.extend({el:b,item:a},this.__sub_view_options(a)));this.itemData(a).view=c,this.addChild(c)},_destroyItemData:function(a){this.removeChild(a.view),a.view.destroy()},isSelected:function(a){return this.itemData(a).view.get("_selected")
},select:function(a){if(this.itemData(a)){var b=this;return this.__selectable&&!this.isSelected(a)&&(this.__multi_select||this.collection().iterate(function(a){b.unselect(a)}),this.itemData(a).view.set("_selected",!0),this.trigger("select",a)),this.itemData(a).view}},unselect:function(a){return this.__selectable&&this.isSelected(a)&&(this.itemData(a).view.set("_selected",!1),this.trigger("unselect",a)),this.itemData(a).view}}),BetaJS.Views.View.extend("BetaJS.Views.OverlayView",{_templates:{"default":BetaJS.Templates.Cached["overlay-view-template"]},constructor:function(a){a=a||{},a.anchor=a.anchor||"absolute",a.hide_on_leave="hide_on_leave"in a?a.hide_on_leave:!0,a.visible="visible"in a?a.visible:!1,a.children_classes=a.children_classes||[],BetaJS.Types.is_string(a.children_classes)&&(a.children_classes=a.children_classes.split(" ")),a.children_classes.push("overlay-container-class"),this._inherited(BetaJS.Views.OverlayView,"constructor",a),this._setOption(a,"anchor","none"),this._setOption(a,"element",""),this._setOption(a,"overlay_left",0),this._setOption(a,"overlay_top",0),this._setOption(a,"overlay_align_vertical","top"),this._setOption(a,"overlay_align_horizontal","left"),this._setOption(a,"element_align_vertical","bottom"),this._setOption(a,"element_align_horizontal","left"),a.overlay_inner&&(a.overlay_inner.setEl('[data-selector="container"]'),this.overlay_inner=this.addChild(a.overlay_inner))},_after_show:function(){if("none"!=this.__anchor){var a=this.$(".overlay-container-class"),b=a.outerWidth(),c=a.outerHeight(),d=this.__overlay_left,e=this.__overlay_top;"bottom"==this.__overlay_align_vertical?e-=c:"center"==this.__overlay_align_vertical&&(e-=Math.round(c/2)),"right"==this.__overlay_align_horizontal?d-=b:"center"==this.__overlay_align_horizontal&&(d-=Math.round(b/2));var f=this.$el;"element"==this.__anchor&&this.__element&&(f=this.__element,BetaJS.Types.is_string(f)?f=BetaJS.$(f):BetaJS.Class.is_class_instance(f)&&(f=f.$el)),("relative"==this.__anchor||"element"==this.__anchor)&&(element_width=f.outerWidth(),element_height=f.outerHeight(),d+=f.offset().left-$(window).scrollLeft(),e+=f.offset().top-$(window).scrollTop(),"bottom"==this.__element_align_vertical?e+=element_height:"center"==this.__element_align_vertical&&(e+=Math.round(element_height/2)),"right"==this.__element_align_horizontal?d+=element_width:"center"==this.__element_align_horizontal&&(d+=Math.round(element_width/2))),a.css("left",d+"px"),a.css("top",e+"px")}}}),BetaJS.Views.View.extend("BetaJS.Views.FullscreenOverlayView",{_templates:{"default":BetaJS.Templates.Cached["fullscreen-overlay-view-template"]},_events:function(){return[{'click [data-selector="outer"]':function(){this.__destroy_on_unfocus?this.destroy():this.__hide_on_unfocus&&this.hide()}}]},constructor:function(a){a=a||{},a.el=a.el||"body",a.append_to_el="append_to_el"in a?a.append_to_el:!0,a.visible="visible"in a?a.visible:!1,this._inherited(BetaJS.Views.FullscreenOverlayView,"constructor",a),a.overlay_inner.setEl('[data-selector="inner"]'),this.overlay_inner=this.addChild(a.overlay_inner),this._setOption(a,"hide_on_unfocus",!0),this._setOption(a,"destroy_on_unfocus",!1)},_after_show:function(){this._inherited(BetaJS.Views.FullscreenOverlayView,"_after_show");var a=this.$('[data-selector="outer"]'),b=this.$('[data-selector="inner"]');b.removeClass("fullscreen-overlay-float"),b.removeClass("fullscreen-overlay-fit");var c=a.outerWidth(),d=a.outerHeight(),e=b.outerWidth(),f=b.outerHeight(),g=Math.floor((c-e)/2),h=Math.floor((d-f)/2);g>=0&&h>=0?(b.css("left",g+"px"),b.css("top",h+"px"),b.addClass("fullscreen-overlay-float")):(b.css("left","0px"),b.css("top","0px"),b.addClass("fullscreen-overlay-fit")),BetaJS.$("body").addClass("fullscreen-overlay-body")},_after_hide:function(){BetaJS.$("body").removeClass("fullscreen-overlay-body"),this._inherited(BetaJS.Views.FullscreenOverlayView,"_after_hide")}});