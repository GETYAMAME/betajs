/*! betajs - v0.0.1 - 2013-07-31, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};"undefined"!=typeof module&&"exports"in module&&(module.exports=BetaJS),BetaJS.Types={is_object:function(a){return"object"==typeof a},is_array:function(a){return"[object Array]"===Object.prototype.toString.call(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null==a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){if(this.is_none(a))return!0;if(this.is_array(a))return 0==a.length;if(this.is_object(a)){for(var b in a)return!1;return!0}return!1},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(BetaJS.Types.is_boolean(a)&&BetaJS.Types.is_boolean(b))return a==b?0:a?1:-1;if(BetaJS.Types.is_array(a)&&BetaJS.Types.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!=g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)}},BetaJS.Strings={nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})}},BetaJS.Functions={as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}},BetaJS.Scopes={resolve:function(a,b){if(!BetaJS.Types.is_string(a))return a;for(var c=b||window||global,d=a.split("."),e=0;e<d.length;++e)c=c[d[e]];return c}},BetaJS.Objs={clone:function(a,b){return!b||0>=b?a:BetaJS.Types.is_array(a)?a.slice(0):BetaJS.Types.is_object(a)?this.extend({},a,b-1):a},extend:function(a,b,c){for(var d in b)a[d]=this.clone(b[d],c);return a},keys:function(a,b){if(BetaJS.Types.is_undefined(b)){var c=[];for(var d in a)c.push(d);return c}var c={};for(var d in a)c[d]=b;return c},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(a,b,c){if(BetaJS.Types.is_array(a)){for(var d=[],e=0;e<a.length;++e)(c?b.apply(c,[a[e],e]):b(a[e],e))&&d.push(a[e]);return d}var d={};for(var f in a)(c?b.apply(c,[a[f],f]):b(a[f],f))&&(d[f]=a[f]);return d},equals:function(a,b,c){if(c&&c>0){for(var d in a)if(!d in b||!this.equals(a[d],b[d],c-1))return!1;for(var d in b)if(!d in a)return!1;return!0}return a==b},iter:function(a,b,c){if(BetaJS.Types.is_array(a))for(var d=0;d<a.length;++d){var e=c?b.apply(c,[a[d],d]):b(a[d],d);if(BetaJS.Types.is_defined(e)&&!e)return}else for(var f in a){var e=c?b.apply(c,[a[f],f]):b(a[f],f);if(BetaJS.Types.is_defined(e)&&!e)return}}},BetaJS.Ids={__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a){return a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(a,b,c,d){b=b||[],BetaJS.Types.is_array(b)||(b=[b]),c=c||[],BetaJS.Types.is_array(c)||(c=[c]),d=d||[],BetaJS.Types.is_array(d)||(d=[d]);var e,f=this;BetaJS.Objs.iter(b,function(a){a.hasOwnProperty("constructor")&&(e=a.constructor)}),BetaJS.Types.is_defined(e)||(e=function(){f.apply(this,arguments)}),BetaJS.Objs.extend(e,f),BetaJS.Objs.iter(c,function(a){BetaJS.Objs.extend(e,a)});var g={};if(f.__class_statics_keys)for(var h in f.__class_statics_keys)e[h]=BetaJS.Objs.clone(f[h],1);BetaJS.Objs.iter(d,function(a){BetaJS.Objs.extend(e,a),BetaJS.Objs.extend(g,BetaJS.Objs.keys(a,!0))}),f.__class_statics_keys&&BetaJS.Objs.extend(g,f.__class_statics_keys),e.__class_statics_keys=g,e.parent=f,e.children=[],e.extend=this.extend,f.children||(f.children=[]),f.children.push(e);var i=function(){};return i.prototype=f.prototype,e.prototype=new i,e.prototype.cls=e,e.classname=a,e.__notifications={},f.__notifications&&BetaJS.Objs.extend(e.__notifications,f.__notifications),BetaJS.Objs.iter(b,function(a){if(BetaJS.Objs.extend(e.prototype,a),a._notifications)for(var b in a._notifications)e.__notifications[b]||(e.__notifications[b]=[]),e.__notifications[b].push(a._notifications[b])}),delete e.prototype._notifications,e},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype.as_method=function(a){return BetaJS.Functions.as_method(this[a],this)},BetaJS.Class.prototype._notify=function(a){if(this.cls.__notifications){var b=Array.prototype.slice.call(arguments,1),c=this.cls.__notifications[a];if(c)for(var d in c)this[c[d]].apply(this,b)}},BetaJS.Class.prototype.destroy=function(){this._notify("destroy");for(var a in this)delete this[a]},BetaJS.Class.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},BetaJS.Class.ancestor_of=function(a){return this==a||this!=BetaJS.Class&&this.parent.ancestor_of(a)},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Class.is_class_instance=function(a){return null!=a&&BetaJS.Types.is_object(a)&&"_inherited"in a&&"cls"in a},BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={enter:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count++},leave:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count--,this.__enter_count<1&&this.destroy()}},BetaJS.Exceptions={ensure:function(a){return null!=a&&BetaJS.Types.is_object(a)&&"instance_of"in a&&a.instance_of(BetaJS.Exceptions.Exception)?a:new BetaJS.Exceptions.NativeException(a)}},BetaJS.Exceptions.Exception=BetaJS.Class.extend("Exception",{constructor:function(a){this._inherited(BetaJS.Exceptions.Exception,"constructor"),this.__message=a},assert:function(a){if(!this.instance_of(a))throw this;return this},callstack:function(){for(var a=[],b=arguments.callee.caller;b;)a.push(b.toString()),b=b.caller;return a},callstack_to_string:function(){return this.callstack().join("\n")},message:function(){return this.__message},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()+"\n\nCall Stack:\n"+this.callstack_to_string()}},{ensure:function(a){var a=BetaJS.Exceptions.ensure(a);return a.assert(this),a}}),BetaJS.Exceptions.NativeException=BetaJS.Exceptions.Exception.extend("NativeException",{constructor:function(a){this._inherited(BetaJS.Exceptions.NativeException,"constructor",a.toString()),this.__object=a},object:function(){return this.__object}}),BetaJS.Lists={},BetaJS.Lists.AbstractList=BetaJS.Class.extend("AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return null!=this.get_ident(a)},_ident_changed:function(){},constructor:function(a){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,a&&BetaJS.Objs.iter(a,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return BetaJS.Types.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){var a=this;this._iterate(function(b,c){return a.remove_by_ident(c),!0})},remove_by_ident:function(a){var b=this._remove(a);return BetaJS.Types.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){var b=this;this._iterate(function(c,d){return a(c)&&b.remove_by_ident(d),!0})},get:function(a){return this._get(a)},iterate:function(a){this._iterate(function(b,c){var d=a(b,c);return BetaJS.Types.is_defined(d)?d:!0})}}),BetaJS.Lists.LinkedList=BetaJS.Lists.AbstractList.extend("LinkedList",{constructor:function(a){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",a)},_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a){for(var b=this.__first;null!=b;){var c=b;if(b=b.next,!a(c.obj,c))return}}}),BetaJS.Lists.ObjectIdList=BetaJS.Lists.AbstractList.extend("ObjectIdList",{constructor:function(a){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",a)},_add:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]=a,b},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a){for(var b in this.__map)a(this.__map[b],b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return this.__map[b]?b:null}}),BetaJS.Lists.ArrayList=BetaJS.Lists.AbstractList.extend("ArrayList",{constructor:function(a,b){this.__idToIndex={},this.__items=[],b=b||{},"compare"in b&&(this._compare=b.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",a)},set_sompare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!("_compare"in this))return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(){},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[BetaJS.Ids.objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[BetaJS.Ids.objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a){for(var b=BetaJS.Objs.clone(this.__items,1),c=0;c<b.length;++c)a(b[c],this.get_ident(b[c]))},__ident_changed:function(a,b){this.__idToIndex[BetaJS.Ids.objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=BetaJS.Ids.objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null},ident_by_id:function(a){return this.__idToIndex[a]}}),BetaJS.Iterators={ensure:function(a){return null==a?new BetaJS.Iterators.ArrayIterator([]):a.instance_of(BetaJS.Iterators.Iterator)?a:BetaJS.Types.is_array(a)?new BetaJS.Iterators.ArrayIterator(a):new BetaJS.Iterators.ArrayIterator([a])}},BetaJS.Iterators.Iterator=BetaJS.Class.extend("Iterator",{asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a}}),BetaJS.Iterators.ArrayIterator=BetaJS.Iterators.Iterator.extend("ArrayIterator",{constructor:function(a){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__arr=a,this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Iterators.MappedIterator=BetaJS.Iterators.Iterator.extend("MappedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=a,this.__map=b},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map(this.__iterator.next()):null}}),BetaJS.Iterators.FilteredIterator=BetaJS.Iterators.Iterator.extend("FilteredIterator",{constructor:function(a,b,c){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=a,this.__filter=b,this.__context=c||this,this.__next=null},hasNext:function(){return this.__crawl(),null!=this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;null==this.__next&&this.__iterator.hasNext();){if(this.__next=this.__iterator.next(),this.__filter_func(this.__next))return;null==this.__next}},__filter_func:function(a){return this.__filter.apply(this.__context,a)}}),BetaJS.Iterators.SkipIterator=BetaJS.Iterators.Iterator.extend("SkipIterator",{constructor:function(a,b){for(this._inherited(BetaJS.Iterators.SkipIterator,"constructor"),this.__iterator=a;b>0;)a.next(),b--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}),BetaJS.Iterators.LimitIterator=BetaJS.Iterators.Iterator.extend("LimitIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.LimitIterator,"constructor"),this.__iterator=a,this.__limit=b},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}),BetaJS.Iterators.SortedIterator=BetaJS.Iterators.Iterator.extend("SortedIterator",{constructor:function(a,b){this._inherited(BetaJS.Iterators.SortedIterator,"constructor"),this.__arr=a.asArray(),this.__arr.sort(b),this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={on:function(a,b,c){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;d=a.shift();)this.__events_mixin_events[d]=this.__events_mixin_events[d]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[d].add({callback:b,context:c});return this},off:function(a,b,c){if(this.__events_mixin_events=this.__events_mixin_events||{},a){a=a.split(BetaJS.Events.EVENT_SPLITTER);for(var d;d=a.shift();)this.__events_mixin_events[d]&&(this.__events_mixin_events[d].remove_by_filter(function(a){return!(b&&a.callback!=b||c&&a.context!=c)}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]))}else for(d in this.__events_mixin_events)this.__events_mixin_events[d].remove_by_filter(function(a){return!(b&&a.callback!=b||c&&a.context!=c)}),0==this.__events_mixin_events[d].count()&&(this.__events_mixin_events[d].destroy(),delete this.__events_mixin_events[d]);return this},trigger:function(a){var b=this;a=a.split(BetaJS.Events.EVENT_SPLITTER);var c,d=Array.prototype.slice.call(arguments,1);if(this.__events_mixin_events){for(;c=a.shift();)this.__events_mixin_events[c]&&this.__events_mixin_events[c].iterate(function(a){a.callback.apply(a.context||b,d)}),this.__events_mixin_events.all&&this.__events_mixin_events.all.iterate(function(a){a.callback.apply(a.context||b,d)});return this}},once:function(a,b,c){var d=this,e=BetaJS.Functions.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(name,e,c)}},BetaJS.Events.Events=BetaJS.Class.extend("Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(a,b,c){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.on(b,c,this)},listenOnce:function(a,b,c){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]=a,a.once(b,c,this)},listenOff:function(a,b,c){this.__listen_mixin_listen&&(a?(a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(a){a.off(b,c,this),b||c||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(a)]},this))}},BetaJS.Events.Listen=BetaJS.Class.extend("Listen",BetaJS.Events.ListenMixin),BetaJS.Properties={},BetaJS.Properties.TYPE_VALUE=0,BetaJS.Properties.TYPE_BINDING=1,BetaJS.Properties.TYPE_COMPUTED=2,BetaJS.Properties.PropertiesMixin={get:function(a){return a in this.__properties?this.__properties[a].value:null},_canSet:function(){return!0},_afterSet:function(){},has:function(a){return a in this.__properties},setAll:function(a){for(var b in a)this.set(b,a[b])},keys:function(a){return BetaJS.Objs.keys(this.__properties,a)},binding:function(a){return{type:BetaJS.Properties.TYPE_BINDING,bindee:this,property:a}},computed:function(a,b){return{type:BetaJS.Properties.TYPE_COMPUTED,func:a,dependencies:b||[]}},_isBinding:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_BINDING&&a.bindee&&a.property},_isComputed:function(a){return BetaJS.Types.is_object(a)&&a&&a.type&&a.type==BetaJS.Properties.TYPE_COMPUTED&&a.func&&a.dependencies},getAll:function(){var a={};for(var b in this.__properties)a[b]=this.get(b);return a},unset:function(a){if(a in this.__properties){var b=this.__properties[a];if(b.type==BetaJS.Properties.TYPE_BINDING)b.bindee.off("change:"+b.property,null,this.__properties[a]);else if(b.type==BetaJS.Properties.TYPE_COMPUTED){var c=this;BetaJS.Objs.iter(b.dependencies,function(b){c.off("change:"+b,null,this.__properties[a])})}delete this.__properties[a]}},set:function(a,b){if(this.get(a)!=b){var c=this;this.__properties[a],this._isBinding(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_BINDING,bindee:b.bindee,property:b.property,value:b.bindee.get(b.property)},b.bindee.on("change:"+b.property,function(){c.__properties[a].value=b.bindee.get(b.property),c.trigger("change"),c.trigger("change:"+a)},this.__properties[a]),this._afterSet(a,this.__properties[a].value),this.trigger("change"),this.trigger("change:"+a)):this._isComputed(b)?(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_COMPUTED,func:b.func,dependencies:b.dependencies,value:b.func.apply(c)},BetaJS.Objs.iter(b.dependencies,function(d){c.on("change:"+d,function(){c.__properties[a].value=b.func.apply(c),c.trigger("change"),c.trigger("change:"+a)},this.__properties[a])},this),this._afterSet(a,this.__properties[a].value),this.trigger("change"),this.trigger("change:"+a)):this._canSet(a,b)&&(this.__properties[a]&&this.__properties[a].type==BetaJS.Properties.TYPE_BINDING?this.__properties[a].bindee.set(this.__properties[a].property,b):(this.unset(a),this.__properties[a]={type:BetaJS.Properties.TYPE_VALUE,value:b},this._afterSet(a,b),this.trigger("change"),this.trigger("change:"+a)))}},_notifications:{construct:"__properties_construct",destroy:"__properties_destroy"},__properties_construct:function(){this.__properties={}},__properties_destroy:function(){for(var a in this.__properties)this.unset(a)}},BetaJS.Properties.Properties=BetaJS.Class.extend("Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(a){this._inherited(BetaJS.Properties.Properties,"constructor"),a&&this.setAll(a)}}]),BetaJS.Collections={},BetaJS.Collections.Collection=BetaJS.Class.extend("Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Collections.Collection,"constructor"),a=a||{};var b={};"compare"in a&&(b.compare=a.compare),this.__data=new BetaJS.Lists.ArrayList([],b);var c=this;this.__data._ident_changed=function(a,b){c._index_changed(a,b)},this.__data._re_indexed=function(a){c._re_indexed(a)},this.__data._sorted=function(){c._sorted()},"objects"in a&&this.add_objects(a.objects)},set_compare:function(a){this.__data.set_compare(a)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(a){"off"in a&&a.off(null,null,this)}),this.__data.destroy(),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(a){if(this.exists(a))return null;var b=this.__data.add(a);return null!=b&&(this.trigger("add",a),"on"in a&&a.on("change",function(b,c){this._object_changed(a,b,c)},this)),b},add_objects:function(a){BetaJS.Objs.iter(a,function(a){this.add(a)},this)},exists:function(a){return this.__data.exists(a)},remove:function(a){return this.exists(a)?(this.trigger("remove",a),"off"in a&&a.off(null,null,this),this.__data.remove(a)):null},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a){this.__data.iterate(a)},clear:function(){var a=this;this.iterate(function(b){a.remove(b)})}}]),BetaJS.Collections.FilteredCollection=BetaJS.Collections.Collection.extend("FilteredCollection",{constructor:function(a,b){this.__parent=a,b=b||{},delete b.objects,b.compare=b.compare||a.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",b),"filter"in b&&(this.filter=b.filter);var c=this;this.__parent.iterate(function(a){return c.add(a),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(a,b,c){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",a,b,c),this.filter(a)||this.__selfRemove(a)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"add",a)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(a){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",a)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return null==b?null:this.__parent.remove(a)}}),BetaJS.Comparators={byObject:function(a){return function(b,c){for(key in a){var d=b[key]||null,e=c[key]||null,f=BetaJS.Comparators.byValue(d,e);if(0!=f)return f*a[key]}return 0}},byValue:function(a,b){return BetaJS.Types.is_string(a)?a.localCompare(b):b>a?-1:a>b?1:0}},BetaJS.Tokens={generate_token:function(){return Math.random().toString(36).substr(2)}},BetaJS.Net={},BetaJS.Net.AbstractAjax=BetaJS.Class.extend("AbstractAjax",{constructor:function(a){this._inherited(BetaJS.Net.AbstractAjax,"constructor"),this.__options=BetaJS.Objs.extend({method:"GET",data:{}},a)},syncCall:function(a){var b=BetaJS.Objs.clone(this.__options,1);b=BetaJS.Objs.extend(b,a);var c=b.success_callback;delete b.success_callback;var d=b.failure_callback;delete b.failure_callback;var e=b.complete_callback;delete b.complete_callback;try{var f=this._syncCall(b);return c&&c(f),e&&e(),f}catch(g){if(g=BetaJS.Exceptions.ensure(g),g.assert(BetaJS.Net.AjaxException),!d)throw g;d(g.status_code(),g.status_text(),g.data())}},asyncCall:function(a){var b=BetaJS.Objs.clone(this.__options,1);b=BetaJS.Objs.extend(b,a);var c=b.success_callback;delete b.success_callback;var d=b.failure_callback;delete b.failure_callback;var e=b.complete_callback;delete b.complete_callback;try{var f=this._asyncCall(BetaJS.Objs.extend({success:function(a){c&&c(a),e&&e()},failure:function(a,b,c){if(!d)throw new BetaJS.Net.AjaxException(a,b,c);d(a,b,c),e&&e()}},b));return f}catch(g){if(g=BetaJS.Exceptions.ensure(g),g.assert(BetaJS.Net.AjaxException),!d)throw g;d(g.status_code(),g.status_text(),g.data())}},call:function(a){if(!("async"in a))return!1;var b=a.async;return delete a.async,b?this.asyncCall(a):this.syncCall(a)},_syncCall:function(){},_asyncCall:function(){}}),BetaJS.Net.AjaxException=BetaJS.Exceptions.Exception.extend("AjaxException",{constructor:function(a,b,c){this._inherited(BetaJS.Net.AjaxException,"constructor",a+": "+b),this.__status_code=a,this.__status_text=b,this.__data=c},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data}}),BetaJS.Net.JQueryAjax=BetaJS.Net.AbstractAjax.extend("JQueryAjax",{_syncCall:function(a){var b;return BetaJS.$.ajax({type:a.method,async:!1,url:a.uri,data:JSON.stringify(a.data),success:function(a){b=a},error:function(a,b,c){throw new BetaJS.Net.AjaxException(c,b,a)}}),b},_asyncCall:function(a){BetaJS.$.ajax({type:a.method,async:!0,url:a.uri,data:JSON.stringify(a.data),success:function(b){a.success(b)},error:function(b,c,d){a.failure(d,c,b)}})}}),BetaJS.Queries={__dependencies:function(a,b){if(BetaJS.Types.is_array(a)){if(0==a.length)throw"Malformed Query";var c=a[0];if("Or"==c||"And"==c){for(var d=1;d<a.length;++d)b=this.__dependencies(a[d],b);return b}if(3!=a.length)throw"Malformed Query";var e=a[1];return e in b?b[e]++:b[e]=1,b}if(BetaJS.Types.is_object(a)){for(e in a)e in b?b[e]++:b[e]=1;return b}throw"Malformed Query"},dependencies:function(a){return this.__dependencies(a,{})},format:function(a){return BetaJS.Class.is_class_instance(a)?a.format():JSON.stringify(a)},overloaded_evaluate:function(a,b){return BetaJS.Class.is_class_instance(a)?a.evaluate(b):BetaJS.Types.is_function(a)?a(b):this.evaluate(a,b)},evaluate:function(a,b){if(null==b)return!1;if(BetaJS.Types.is_array(a)){if(0==a.length)throw"Malformed Query";var c=a[0];if("Or"==c){for(var d=1;d<a.length;++d)if(this.evaluate(a[d],b))return!0;return!1}if("And"==c){for(var d=1;d<a.length;++d)if(!this.evaluate(a[d],b))return!1;return!0}if(3!=a.length)throw"Malformed Query";var e=a[1],f=b[e],g=a[2];if("=="==c)return f==g;if("!="==c)return f!=g;if(">"==c)return f>g;if(">="==c)return f>=g;if("<"==c)return g>f;if("<="==c)return g>=f;throw"Malformed Query"}if(BetaJS.Types.is_object(a)){for(e in a)if(a[e]!=b[e])return!1;return!0}throw"Malformed Query"},__compile:function(a){if(BetaJS.Types.is_array(a)){if(0==a.length)throw"Malformed Query";var b=a[0];if("Or"==b){for(var c="false",d=1;d<a.length;++d)c+=" || ("+this.__compile(a[d])+")";return c}if("And"==b){for(var c="true",d=1;d<a.length;++d)c+=" && ("+this.__compile(a[d])+")";return c}if(3!=a.length)throw"Malformed Query";var e=a[1],f=a[2],g="object['"+e+"']",h=BetaJS.Types.is_string(f)?"'"+f+"'":f;return g+" "+b+" "+h}if(BetaJS.Types.is_object(a)){var c="true";for(e in a)c+=" && (object['"+e+"'] == "+(BetaJS.Types.is_string(a[e])?"'"+a[e]+"'":a[e])+")";return c}throw"Malformed Query"},compile:function(a){var b=this.__compile(a),c=new Function("object",b),d=function(a){return c.call(this,a)};return d.source="function(object){\n return "+b+"; }",d},emulate:function(a,b,c){var d=b.apply(c||this,{}),e=d;return null==d?e=BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(d)&&(e=BetaJS.Iterators.ArrayIterator(d)),new BetaJS.Iterators.FilteredIterator(e,function(b){return BetaJS.Queries.evaluate(a,b)})}},BetaJS.Queries.CompiledQuery=BetaJS.Class.extend("CompiledQuery",{constructor:function(a){this.__query=a,this.__dependencies=BetaJS.Query.dependencies(a),this.__compiled=BetaJS.Query.compile(a)},query:function(){return this.__query},dependencies:function(){return this.__dependencies},compiled:function(){return this.__compiled},evaluate:function(a){return this.__compiled(a)},format:function(){return BetaJS.Query.format(this.__query)}}),BetaJS.Queries.Constrained={make:function(a,b){return{query:a,options:b||{}}},format:function(a){var b=a.query;a.query=BetaJS.Queries.format(b);var c=JSON.stringify(a);return a.query=b,c},emulate:function(a,b,c,d){var e=a.query,f=a.options,g={},h={};"sort"in f&&"sort"in b&&(h.sort=f.sort),("query"in b||BetaJS.Types.is_empty(e))&&(g=e,(!("sort"in f)||"sort"in b)&&("skip"in f&&"skip"in b&&(h.skip=f.skip),"limit"in f&&"limit"in b&&(h.limit=f.limit)));var i=c.apply(d||this,[g,h]),j=i;return null==i?j=new BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(i)&&(j=new BetaJS.Iterators.ArrayIterator(i)),"query"in b||BetaJS.Types.is_empty(e)||(j=new BetaJS.Iterators.FilteredIterator(j,function(a){return BetaJS.Queries.evaluate(e,a)})),"sort"in f&&!("sort"in h)&&(j=new BetaJS.Iterators.SortedIterator(j,BetaJS.Comparators.byObject(f.sort))),"skip"in f&&!("skip"in h)&&(j=new BetaJS.Iterators.SkipIterator(j,f.skip)),"limit"in f&&!("limit"in h)&&(j=new BetaJS.Iterators.LimitIterator(j,f.limit)),j}},BetaJS.Collections.QueryCollection=BetaJS.Collections.Collection.extend("QueryCollection",{constructor:function(a){this._inherited(BetaJS.Collections.QueryCollection,"constructor",a),this.__query=BetaJS.Objs.extend({func:null,select:{},skip:0,limit:null,forward_steps:null,backward_steps:null,range:null,count:null,sort:{}},a.query),"objects"in a||(a.objects=this.__execute_query(this.__query.skip,this.__query.limit,!0))},__execute_query:function(a,b,c){a=Math.max(a,0);var d={};if(null==this.__query.sort||BetaJS.Types.is_empty(this.__query.sort)||(d.sort=this.__query.sort),c){a>0&&(d.skip=a),null!=b&&(d.limit=b);var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.skip=a,this.__query.limit=b,this.__query.count=null==b||f.length<b?a+f.length:null,this.clear(),this.add_objects(f)}else if(a<this.__query.skip){b=this.__query.skip-a,a>0&&(d.skip=a),d.limit=b;var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.skip=a,this.__query.limit=null==this.__query.limit?null:this.__query.limit+f.length,this.add_objects(f)}else if(a>=this.__query.skip&&null!=this.__query.limit&&(null==b||a+b>this.__query.skip+this.__query.limit)){b=a+b-(this.__query.skip+this.__query.limit),a=this.__query.skip+this.__query.limit,a>0&&(d.skip=a),null!=b&&(d.limit=b);var e=this.__query.func(this.__query.select,d),f=e.asArray();this.__query.limit=this.__query.limit+f.length,b>f.length&&(this.__query.count=a+f.length),this.add_objects(f)}},increase_forwards:function(a){a=null==a?this.__query.forward_steps:a,null!=a&&null!=this.__query.limit&&this.__execute_query(this.__query.skip+this.__query.limit,a,!1)},increase_backwards:function(a){if(a=null==a?this.__query.backward_steps:a,null!=a&&this.__query.skip>0){var a=Math.min(a,this.__query.skip);this.__execute_query(this.__query.skip-a,a,!1)}},paginate:function(a){this.__execute_query(this.__query.range*a,this.__query.range,!0)},paginate_index:function(){return null==this.__query.range?null:Math.floor(this.__query.skip/this.__query.range)},paginate_count:function(){return null==this.__query.count||null==this.__query.range?null:Math.ceil(this.__query.count/this.__query.range)},next:function(){var a=this.paginate_index();if(null!=a){var b=this.paginate_count();(null==b||a<this.paginate_count()-1)&&this.paginate(a+1)}},prev:function(){var a=this.paginate_index();null!=a&&a>0&&this.paginate(a-1)},isComplete:function(){return null!=this.__query.count}}),BetaJS.Stores=BetaJS.Stores||{},BetaJS.Stores.StoreException=BetaJS.Exceptions.Exception.extend("StoreException"),BetaJS.Stores.BaseStore=BetaJS.Class.extend("BaseStore",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Stores.BaseStore,"constructor"),a=a||{},this._id_key=a.id_key||"id"},_insert:function(){},_remove:function(){},_get:function(){},_update:function(){},_query_capabilities:function(){return{}},_query:function(){},insert:function(a){var b=this._insert(a);return b&&this.trigger("insert",b),b},remove:function(a){var b=this._remove(a);return b&&this.trigger("remove",b),b},get:function(a){return this._get(a)},update:function(a,b){var c=this._update(a,b);return c&&this.trigger("update",c,b),c},query:function(a,b){return BetaJS.Queries.Constrained.emulate(BetaJS.Queries.Constrained.make(a,b||{}),this._query_capabilities(),this._query,this)},_query_applies_to_id:function(a,b){var c=this.get(b);return c&&BetaJS.Queries.overloaded_evaluate(a,c)
},clear:function(){for(var a=this.query({});a.hasNext();)this.remove(a.next().id)}}]),BetaJS.Stores.DumbStore=BetaJS.Stores.BaseStore.extend("DumbStore",{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},_insert:function(a){var b=this._read_last_id(),c=1;return null!=b?(c=b+1,this._write_next_id(b,c),this._write_prev_id(c,b)):this._write_first_id(c),a[this._id_key]=c,this._write_last_id(c),this._write_item(c,a),a},_remove:function(a){var b=this._read_item(a);if(b){this._remove_item(a);var c=this._read_next_id(a),d=this._read_prev_id(a);null!=c?(this._remove_next_id(a),null!=d?(this._remove_prev_id(a),this._write_next_id(d,c),this._write_prev_id(c,d)):(this._remove_prev_id(c),this._write_first_id(c))):null!=d?(this._remove_next_id(d),this._write_last_id(d)):(this._remove_first_id(),this._remove_last_id())}return b},_get:function(a){return this._read_item(a)},_update:function(a,b){var c=this._get(a);return c&&(delete b[this._id_key],BetaJS.Objs.extend(c,b),this._write_item(a,c)),c},_query_capabilities:function(){return{query:!0}},_query:function(a){var b=new BetaJS.Iterators.Iterator,c=this,d=this._read_first_id();return BetaJS.Objs.extend(b,{__id:null==d?1:d,__store:c,__query:a,hasNext:function(){var b=this.__store._read_last_id();if(null==b)return!1;for(;this.__id<b&&!this.__store._read_item(this.__id);)this.__id++;for(;this.__id<=b;){if(this.__store._query_applies_to_id(a,this.__id))return!0;this.__id<b?this.__id=this.__store._read_next_id(this.__id):this.__id++}return!1},next:function(){if(this.hasNext()){var a=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),a}return null}}),b}}),BetaJS.Stores.AssocStore=BetaJS.Stores.DumbStore.extend("AssocStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(a){var b=this._read_key(a);return b?parseInt(b):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(a){this._write_key("last_id",a)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(a){this._write_key("first_id",a)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(a){return this._read_key("item_"+a)},_write_item:function(a,b){this._write_key("item_"+a,b)},_remove_item:function(a){this._remove_key("item_"+a)},_read_next_id:function(a){return this.__read_id("next_"+a)},_write_next_id:function(a,b){this._write_key("next_"+a,b)},_remove_next_id:function(a){this._remove_key("next_"+a)},_read_prev_id:function(a){return this.__read_id("prev_"+a)},_write_prev_id:function(a,b){this._write_key("prev_"+a,b)},_remove_prev_id:function(a){this._remove_key("prev_"+a)}}),BetaJS.Stores.LocalStore=BetaJS.Stores.AssocStore.extend("LocalStore",{constructor:function(a){this._inherited(BetaJS.Stores.LocalStore,"constructor",a),this.__prefix=a.prefix},__key:function(a){return this.__prefix+a},_read_key:function(a){var b=this.__key(a);return b in localStorage?JSON.parse(localStorage[b]):null},_write_key:function(a,b){localStorage[this.__key(a)]=JSON.stringify(b)},_remove_key:function(a){delete localStorage[this.__key(a)]}}),BetaJS.Stores.MemoryStore=BetaJS.Stores.AssocStore.extend("MemoryStore",{_read_key:function(a){return this[a]},_write_key:function(a,b){this[a]=b},_remove_key:function(a){delete this[a]}}),BetaJS.Stores.QueryCachedStore=BetaJS.Stores.BaseStore.extend("QueryCachedStore",{constructor:function(a,b){b=b||{},b.id_key=a._id_key,this._inherited(BetaJS.Stores.QueryCachedStore,"constructor",b),this.__parent=a,this.__cache={},this.__queries={}},invalidate:function(){this.__cache={},this.__queries={}},_insert:function(a){var b=this.__parent.insert(a);return b&&(this.__cache[a[this._id_key]]=a),b},_remove:function(a){var b=this.__parent.remove(a);return b&&delete this.__cache[a],b},_update:function(a,b){var c=this.__parent.update(a,b);return c&&(this.__cache[a]=BetaJS.Objs.extend(this.__cache[a],b)),c},_get:function(a){return a in this.__cache||(this.__cache[a]=this.__parent.get(a)),this.__cache[a]},_query_capabilities:function(){return this.__parent._query_capabilities()},_query:function(a,b){var c=BetaJS.Queries.Constrained.make(a,b),d=BetaJS.Queries.Constrained.format(c);if(d in this.__queries)return new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__queries[d]));var e=this.__parent.query(a,b).asArray();this.__queries[d]={};for(var f=0;f<e.length;++f)this.__cache[e[f][this._id_key]]=e[f],this.__queries[d][e[f][this._id_key]]=e[f];return new BetaJS.Iterators.ArrayIterator(e)},cache:function(a,b,c){var d=BetaJS.Queries.Constrained.make(a,b),e=BetaJS.Queries.Constrained.format(d);this.__queries[e]={};for(var f=0;f<c.length;++f)this.__cache[c[f][this._id_key]]=c[f],this.__queries[e][c[f][this._id_key]]=c[f]}}),BetaJS.Stores.FullyCachedStore=BetaJS.Stores.BaseStore.extend("FullyCachedStore",{constructor:function(a,b,c){c=c||{},c.id_key=a._id_key,this._inherited(BetaJS.Stores.FullyCachedStore,"constructor",c),this.__parent=a,this.__cache={},this.__cached=!1,b&&this.invalidate(b)},invalidate:function(a){for(this.__cache={},a||(a=this.__parent.query({})),BetaJS.Types.is_array(a)&&(a=new BetaJS.Iterators.ArrayIterator(a));a.hasNext();){var b=a.next();this.cache(b)}this.__cached=!0},cache:function(a){this.__cache[a[this._id_key]]=a,this.trigger("cache",a)},_insert:function(a){this.__cached||this.invalidate({});var b=this.__parent.insert(a);return b&&(this.__cache[a[this._id_key]]=a),b},_remove:function(a){this.__cached||this.invalidate({});var b=this.__parent.remove(a);return b&&delete this.__cache[a],b},_get:function(a){return this.__cached||this.invalidate({}),this.__cache[a]},_update:function(a,b){this.__cached||this.invalidate({});var c=this.__parent.update(a,b);return c&&(this.__cache[a]=BetaJS.Objs.extend(this.__cache[a],b)),c},_query:function(){return this.__cached||this.invalidate(),new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__cache))}}),BetaJS.Stores.RemoteStore=BetaJS.Stores.BaseStore.extend("RemoteStore",{constructor:function(a,b,c){this._inherited(BetaJS.Stores.RemoteStore,"constructor",c),this.__uri=a,this.__ajax=b,this.__options=BetaJS.Objs.extend({update_method:"PUT"},c||{})},getUri:function(){return this.__uri},_insert:function(a){try{return this.__ajax.syncCall({method:"POST",uri:this.__uri,data:a})}catch(b){throw new BetaJS.Stores.StoreException(BetaJS.Net.AjaxException.ensure(b).toString())}},_remove:function(a){try{var b=this.__ajax.syncCall({method:"DELETE",uri:this.__uri+"/"+a});return b?b:(b={},b[this._id_key]=a,b)}catch(c){throw new BetaJS.Stores.StoreException(BetaJS.Net.AjaxException.ensure(c).toString())}},_get:function(a){try{return this.__ajax.syncCall({uri:this.__uri+"/"+a})}catch(b){throw new BetaJS.Stores.StoreException(BetaJS.Net.AjaxException.ensure(b).toString())}},_update:function(a,b){try{return this.__ajax.syncCall({method:this.__options.update_method,uri:this.__uri+"/"+a,data:b})}catch(c){throw new BetaJS.Stores.StoreException(BetaJS.Net.AjaxException.ensure(c).toString())}},_query:function(a,b){try{var c=this.__ajax.syncCall(this._encode_query(a,b));return BetaJS.Types.is_string(c)?JSON.parse(c):c}catch(d){throw new BetaJS.Stores.StoreException(BetaJS.Net.AjaxException.ensure(d).toString())}},_encode_query:function(){return{uri:this.getUri()}}}),BetaJS.Stores.QueryGetParamsRemoteStore=BetaJS.Stores.RemoteStore.extend("QueryGetParamsRemoteStore",{constructor:function(a,b,c,d){this._inherited(BetaJS.Stores.QueryGetParamsRemoteStore,"constructor",a,b,d),this.__capability_params=c},_query_capabilities:function(){var a={};return"skip"in this.__capability_params&&(a.skip=!0),"limit"in this.__capability_params&&(a.limit=!0),a},_encode_query:function(a,b){b=b||{};var c=this.getUri()+"?";return b.skip&&"skip"in this.__capability_params&&(c+=this.__capability_params.skip+"="+b.skip+"&"),b.limit&&"limit"in this.__capability_params&&(c+=this.__capability_params.limit+"="+b.limit+"&"),{uri:c}}}),BetaJS.Stores.ConversionStore=BetaJS.Stores.BaseStore.extend("ConversionStore",{constructor:function(a,b){b=b||{},b.id_key=a._id_key,this._inherited(BetaJS.Stores.ConversionStore,"constructor",b),this.__store=a,this.__key_encoding=b.key_encoding||{},this.__key_decoding=b.key_decoding||{},this.__value_encoding=b.value_encoding||{},this.__value_decoding=b.value_decoding||{}},encode_object:function(a){var b={};for(var c in a)b[this.encode_key(c)]=this.encode_value(c,a[c]);return b},decode_object:function(a){var b={};for(var c in a)b[this.decode_key(c)]=this.decode_value(c,a[c]);return b},encode_key:function(a){return a in this.__key_encoding?this.__key_encoding[a]:a},decode_key:function(a){return a in this.__key_decoding?this.__key_decoding[a]:a},encode_value:function(a,b){return a in this.__value_encoding?this.__value_encoding[a](b):b},decode_value:function(a,b){return a in this.__value_decoding?this.__value_decoding[a](b):b},_insert:function(a){return this.decode_object(this.__store.insert(this.encode_object(a)))},_remove:function(a){return this.__store.remove(this.encode_value(this._id_key,a))},_get:function(a){return this.decode_object(this.__store.get(this.encode_value(this._id_key,a)))},_update:function(a,b){return this.decode_object(this.__store.update(this.encode_value(this._id_key,a),this.encode_object(b)))},_query_capabilities:function(){return this.__store._query_capabilities()},_query:function(a,b){var c=this,d=this.__store.query(this.encode_object(a),b);return new BetaJS.Iterators.MappedIterator(d,function(a){return c.decode_object(a)})}}),BetaJS.Modelling=BetaJS.Modelling||{},BetaJS.Modelling.Model=BetaJS.Properties.Properties.extend("Model",[BetaJS.Ids.ClientIdMixin,BetaJS.Classes.AutoDestroyMixin,{constructor:function(a,b){this._inherited(BetaJS.Modelling.Model,"constructor");var c=this.cls.scheme();this.__properties_changed={},this.__errors={},this.__unvalidated={};for(var d in c)c[d].def?this.set(d,c[d].def):c[d].auto_create?this.set(d,c[d].auto_create(this)):this.set(d,null);b=b||{},this.__properties_changed={},this.__errors={},this.__unvalidated={},this.__enter_table_count=0;for(d in a)this.set(d,a[d]);this.__saved="saved"in b?b.saved:!1,this.__new="new"in b?b["new"]:!0,this.__saved&&(this.__properties_changed={}),"table"in b&&(this.__table=b.table),this.__canCallTable()&&this.__table.__modelCreate(this),this.assocs=this._initializeAssociations();for(var d in this.assocs)this.__addAssoc(d,this.assocs[d])},__addAssoc:function(a,b){this[a]=function(){return b.yield()}},_initializeAssociations:function(){return{}},destroy:function(){if(this.__canCallTable()&&!this.__table.__modelDestroy(this))return!1;this.trigger("destroy");for(var a in this.assocs)this.assocs[a].destroy();this._inherited(BetaJS.Modelling.Model,"destroy")},__canCallTable:function(){return this.__table&&this.__enter_table_count>=0},__enterTable:function(){this.__enter_table_count=this.__enter_table_count+1},__leaveTable:function(){this.__enter_table_count=this.__enter_table_count-1},__unsetChanged:function(a){delete this.__properties_changed[a]},_afterSet:function(a,b){var c=this.cls.scheme();a in c&&(this.__properties_changed[a]=b,this.__unvalidated[a]=!0,this.__saved=!1,delete this.__errors[a],this.__canCallTable()&&this.__table.__modelSetAttr(this,a,b))},update:function(a){this.setAll(a),this.__canCallTable()&&this.__table.__modelUpdate(this)},properties_changed:function(a){return BetaJS.Types.is_boolean(a)?BetaJS.Objs.filter(this.__properties_changed,function(b,c){return this.validateAttr(c)==a},this):this.__properties_changed},validate:function(){for(key in this.__unvalidated)this.validateAttr(key);return BetaJS.Types.is_empty(this.__errors)},validateAttr:function(a){if(a in this.__unvalidated){delete this.__unvalidated[a],delete this.__errors[a];var b=this.cls.scheme(),c=b[a];if("validate"in c){var d=c.validate;BetaJS.Types.is_array(d)||(d=[d]);var e=this.get(a);BetaJS.Objs.iter(d,function(b){var c=b.validate(e,this);return null!=c&&(this.__errors[a]=c),null==c},this)}}return!(a in this.__errors)},revalidate:function(){return this.__errors={},this.__unvalidated=this.keys(!0),this.validate()},errors:function(){return this.__errors},save:function(){if(this.__saved)return!0;if(this.__canCallTable()&&!this.__table.__modelSave(this))return!1;this.trigger("save"),this.__saved=!0;var a=this.__new;return this.__new=!1,a&&this._after_create(),!0},_after_create:function(){},isSaved:function(){return this.__saved},isNew:function(){return this.__new},remove:function(){return this.__canCallTable()&&!this.__table.__modelRemove(this)?!1:(this.trigger("remove"),this.destroy(),!0)},asRecord:function(a){var b={},c=this.cls.scheme(),d=this.getAll();a=a||{};for(var e in d)if(e in c){var f=c[e].tags||[],g={};BetaJS.Objs.iter(f,function(a){g[a]=!0});var h=!0;BetaJS.Objs.iter(a,function(a){h=h&&a in g},this),h&&(b[e]=d[e])}return b},setByTags:function(a,b){var c=this.cls.scheme();b=b||{};for(var d in a)if(d in c){var e=c[d].tags||[],f={};BetaJS.Objs.iter(e,function(a){f[a]=!0});var g=!0;BetaJS.Objs.iter(b,function(a){g=g&&a in f},this),g&&this.set(d,a[d])}},id:function(){return this.get(this.cls.primary_key())},hasId:function(){return this.has(this.cls.primary_key())}}],{primary_key:function(){return"id"},_initializeScheme:function(){var a={};return a[this.primary_key()]={type:"id"},a},asRecords:function(a,b){return a.map(function(a){return a.asRecord(b)})}},{scheme:function(){return this.__scheme=this.__scheme||this._initializeScheme(),this.__scheme}}),BetaJS.Modelling.Table=BetaJS.Class.extend("Table",[BetaJS.Events.EventsMixin,{constructor:function(a,b,c){this._inherited(BetaJS.Modelling.Table,"constructor"),this.__store=a,this.__model_type=b,this.__models_by_id={},this.__models_by_cid={},this.__models_changed={},this.__options=BetaJS.Objs.extend({type_column:null,auto_update:!0,auto_update_attr:!1,auto_create:!1,save_invalid:!1,greedy_save:!0},c||{})},__enterModel:function(a){this.trigger("enter",a),this.__models_by_cid[a.cid()]=a,a.hasId()&&(this.__models_by_id[a.id()]=a)},__leaveModel:function(a){this.trigger("leave",a),delete this.__models_by_cid[a.cid()],a.hasId()&&delete this.__models_by_id[a.id()]},__hasModel:function(a){return a.cid()in this.__models_by_cid},__modelCreate:function(a){return this.__hasModel(a)?!1:this.__enterModel(a)&&(!this.__options.auto_create||a.save())},__modelDestroy:function(a){if(!this.__hasModel(a))return!0;var b=a.save();return this.__leaveModel(a)&&b},__modelRemove:function(a){if(!this.__hasModel(a))return!1;var b=this.__store.remove(a.id());return b&&this.trigger("remove",a),this.__leaveModel(a)&&b},__modelSetAttr:function(a,b,c){return this.__models_changed[a.cid()]=a,this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),!this.__options.auto_update_attr||a.save()},__modelUpdate:function(a){return this.trigger("update",a),!this.__options.auto_update||a.save()},__modelSave:function(a){if(a.isSaved())return!0;var b=a.validate();if(!b&&!this.__options.save_invalid&&!this.__options.greedy_save)return!1;var c={},d=a.isNew();c=d?a.getAll():this.__options.save_invalid?a.properties_changed():a.properties_changed(!0);var e={};if(d){if(this.__options.type_column&&(c[this.__options.type_column]=a.cls.classname),e=this.__store.insert(c),!(a.cls.primary_key()in e))return!1;this.__models_by_id[e[a.cls.primary_key()]]=a}else if(!BetaJS.Types.is_empty(c)&&(e=this.__store.update(a.id(),c),BetaJS.Types.is_empty(e)))return!1;if(!this.__options.save_invalid)for(var f in a.properties_changed(!1))delete e[f];a.__leaveTable(),a.setAll(e),a.__enterTable();for(var f in e)a.__unsetChanged(f);return b&&delete this.__models_changed[a.cid()],d&&this.trigger("create",a),this.trigger("save",a),this.__options.save_invalid||b},save:function(){var a=!0;return BetaJS.Objs.iter(this.__models_changed,function(b){a=b.save()&&a}),a},findById:function(a){return this.__models_by_id[a]?this.__models_by_id[a]:this.__materialize(this.__store.get(a))},findBy:function(a){return this.allBy(a,{limit:1}).next()},all:function(a){return this.allBy({},a)},allBy:function(a,b){var c=this.__store.query(a,b),d=this,e=new BetaJS.Iterators.MappedIterator(c,function(a){return d.__materialize(a)});return e},__materialize:function(a){if(!a)return null;var b=this.__model_type;this.__options.type_column&&a[this.__options.type_column]&&(b=a[this.__options.type_column]);var c=BetaJS.Scopes.resolve(b);if(this.__models_by_id[a[c.primary_key()]])return this.__models_by_id[a[c.primary_key()]];var d=new c(a,{table:this,saved:!0,"new":!1});return this.__enterModel(d),d}}]),BetaJS.Modelling.Associations={},BetaJS.Modelling.Associations.Association=BetaJS.Class.extend("Assocation",{constructor:function(a,b,c,d){this._inherited(BetaJS.Modelling.Associations.Association,"constructor"),this._model=a,this._foreign_table=b,this._foreign_key=c,this._options=d||{},this.__cache=null,d.delete_cascade&&a.on("remove",function(){this.__delete_cascade()},this)},__delete_cascade:function(){for(var a=BetaJS.Iterators.ensure(this.yield());a.hasNext();)a.next().remove()},yield:function(){if(this.__cache)return this.__cache;var a=this._yield();return this._options.cached&&(this.__cache=a),a},invalidate:function(){delete this.__cache}}),BetaJS.Modelling.Associations.HasManyAssociation=BetaJS.Modelling.Associations.Association.extend("HasManyAssocation",{_yield:function(){var a={};return a[this._foreign_key]=this._model.id(),this._foreign_table.allBy(a)},yield:function(){return this._options.cached?(this.__cache||(this.__cache=this._yield().asArray()),new BetaJS.Iterators.ArrayIterator(this.__cache)):this._yield()}}),BetaJS.Modelling.Associations.HasOneAssociation=BetaJS.Modelling.Associations.Association.extend("HasOneAssocation",{_yield:function(){var a={};return a[this._foreign_key]=this._model.id(),this._foreign_table.findBy(a)}}),BetaJS.Modelling.Associations.BelongsToAssociation=BetaJS.Modelling.Associations.Association.extend("BelongsToAssocation",{_yield:function(){return this._foreign_table.findById(this._model.get(this._foreign_key))}}),BetaJS.Modelling.Validators={},BetaJS.Modelling.Validators.Validator=BetaJS.Class.extend("Validator",{validate:function(){return null}}),BetaJS.Modelling.Validators.PresentValidator=BetaJS.Modelling.Validators.Validator.extend("PresentValidator",{constructor:function(a){this._inherited(BetaJS.Modelling.Validators.PresentValidator,"constructor"),this.__error_string=a?a:"Field is required"},validate:function(a){return BetaJS.Types.is_null(a)?this.__error_string:null}}),BetaJS.Templates={tokenize:function(a){if(BetaJS.Types.is_array(a))return a;var b=[],c=0;return a.replace(BetaJS.Templates.SYNTAX_REGEX(),function(d,e,f,g,h){return h>c&&b.push({type:BetaJS.Templates.TOKEN_STRING,data:BetaJS.Strings.js_escape(a.slice(c,h))}),g&&b.push({type:BetaJS.Templates.TOKEN_CODE,data:g}),e&&b.push({type:BetaJS.Templates.TOKEN_EXPR,data:e}),f&&b.push({type:BetaJS.Templates.TOKEN_ESC,data:f}),c=h+d.length,d}),b},compile:function(a,b){BetaJS.Types.is_string(a)&&(a=this.tokenize(a)),b=b||{};for(var c=b.start_index||0,d=b.end_index||a.length,e="__p+='",f=c;d>f;++f)switch(a[f].type){case BetaJS.Templates.TOKEN_STRING:e+=a[f].data;break;case BetaJS.Templates.TOKEN_CODE:e+="';\n"+a[f].data+"\n__p+='";break;case BetaJS.Templates.TOKEN_EXPR:e+="'+\n((__t=("+a[f].data+"))==null?'':__t)+\n'";break;case BetaJS.Templates.TOKEN_ESC:e+="'+\n((__t=("+a[f].data+"))==null?'':BetaJS.Strings.htmlentities(__t))+\n'"}e+="';\n",e="with(obj||{}){\n"+e+"}\n",e="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+e+"return __p;\n";var g=new Function("obj",e),h=function(a){return g.call(this,a)};return h.source="function(obj){\n"+e+"}",h}},BetaJS.Templates.SYNTAX={OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},BetaJS.Templates.SYNTAX_REGEX=function(){var a=BetaJS.Templates.SYNTAX;return BetaJS.Templates.SYNTAX_REGEX_CACHED||(BetaJS.Templates.SYNTAX_REGEX_CACHED=new RegExp(a.OPEN+a.MODIFIER_EXPR+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_ESC+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_CODE+"([\\s\\S]+?)"+a.CLOSE+"|"+"$","g")),BetaJS.Templates.SYNTAX_REGEX_CACHED},BetaJS.Templates.TOKEN_STRING=1,BetaJS.Templates.TOKEN_CODE=2,BetaJS.Templates.TOKEN_EXPR=3,BetaJS.Templates.TOKEN_ESC=4,BetaJS.Templates=BetaJS.Templates||{},BetaJS.Templates.Template=BetaJS.Class.extend("Template",{constructor:function(a){this._inherited(BetaJS.Templates.Template,"constructor"),this.__tokens=BetaJS.Templates.tokenize(a),this.__compiled=BetaJS.Templates.compile(this.__tokens)},evaluate:function(a){return this.__compiled.apply(this,[a])}},{bySelector:function(a){return new this(BetaJS.$(a).html())}}),BetaJS.Views=BetaJS.Views||{},BetaJS.$=jQuery||null,BetaJS.Views.View=BetaJS.Class.extend("View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Ids.ClientIdMixin,BetaJS.Properties.PropertiesMixin,{_templates:function(){return{}},_dynamics:function(){return{}},_events:function(){return[]},_css:function(){return{}},css:function(a){if(this.__css[a])return this.__css[a];if(this.__parent){var b=this.__parent.css(a);if(b&&b!=a)return b}var b=this._css();return b[a]?b[a]:a},_render:function(){this.__render_string?this.$el.html(this.__render_string):this.__templates["default"]?this.$el.html(this.evaluateTemplate("default",{})):this.__dynamics["default"]&&this.evaluateDynamics("default",this.$el,{},{name:"default"})},templates:function(a){return a in this.__templates?this.__templates[a]:null},dynamics:function(a){return a in this.__dynamics?this.__dynamics[a]:null},_supp:function(){return{__context:this,css:function(a){return this.__context.css(a)},attrs:function(a){var b="";for(var c in a)b+=(null==a[c]?c:c+"='"+a[c]+"'")+" ";return b},styles:function(a){var b="";for(var c in a)b+=c+":"+a[c]+";";return b},selector:function(a){return"data-selector='"+a+"' "}}},templateArguments:function(){var a=this.getAll();return a.supp=this._supp(),a},evaluateTemplate:function(a,b){return b=b||{},this.__templates[a].evaluate(BetaJS.Objs.extend(b,this.templateArguments()))},evaluateDynamics:function(a,b,c,d){return this.__dynamics[a].renderInstance(b,BetaJS.Objs.extend(d||{},{args:c||{}}))},_setOption:function(a,b,c,d){var d=d?d:"__";this[d+b]=b in a?a[b]:c},_setOptionProperty:function(a,b,c){this.set(b,b in a?a[b]:c)},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.View,"constructor"),this._setOption(a,"el",null),this._setOption(a,"visible",!0),this._setOption(a,"render_string",null),this._setOption(a,"events",[]),this._setOption(a,"attributes",{}),this.__old_attributes={},this._setOption(a,"el_classes",[]),this.__added_el_classes=[],this._setOption(a,"el_styles",{}),this._setOption(a,"children_styles",{}),this._setOption(a,"invalidate_on_change",!1),this.__old_el_styles={},this._setOption(a,"css",{}),this.__parent=null,this.__children={},this.__active=!1,this.$el=null,this.__events=this._events().concat(this.__events);var b=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,a.templates||{});"template"in a&&(b["default"]=a.template),this.__templates={};for(var c in b)this.__templates[c]=new BetaJS.Templates.Template(BetaJS.Types.is_string(b[c])?b[c]:b[c].html());var d=BetaJS.Objs.extend(BetaJS.Types.is_function(this._dynamics)?this._dynamics():this._dynamics,a.dynamics||{});"dynamic"in a&&(d["default"]=a.dynamic),this.__dynamics={};for(var c in d)this.__dynamics[c]=new BetaJS.Views.DynamicTemplate(this,BetaJS.Types.is_string(d[c])?d[c]:d[c].html());this.setAll(a.properties||{}),this.__invalidate_on_change&&this.on("change",function(){this.invalidate()},this)},isActive:function(){return this.__active},activate:function(){if(this.isActive())return!0;if(null==this.__el)return!1;if(this.__parent&&!this.__parent.isActive())return!1;if(this.$el=this.__parent?""==this.__el?this.__parent.$el:this.__parent.$(this.__el):BetaJS.$(this.__el),0==this.$el.size()&&(this.$el=null),!this.$el)return!1;this.__old_attributes={};for(var a in this.__attributes){var b=this.$el.attr(a);this.__old_attributes[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.attr(a,this.__attributes[a])}this.__added_el_classes=[];for(var c=BetaJS.Objs.extend(this._el_classes(),this.__el_classes),d=0;d<c.length;++d)this.$el.hasClass(c[d])||(this.$el.addClass(c[d]),this.__added_el_classes.push(c[d]));this.__old_el_styles={};var e=BetaJS.Objs.extend(this._el_styles(),this.__el_styles);for(var a in e){var b=this.$el.css(a);this.__old_el_styles[a]=BetaJS.Types.is_defined(b)?b:null,this.$el.css(a,e[a])}return this.__bind(),this.__visible||this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}),!0},deactivate:function(){if(!this.isActive())return!1;BetaJS.Objs.iter(this.__children,function(a){a.deactivate()}),this.__active=!1,BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__unbind(),this.$el.html("");for(var a in this.__old_attributes)this.$el.attr(a,this.__old_attributes[a]);for(var b=0;b<this.__added_el_classes.length;++b)this.$el.removeClass(this.__added_el_classes[b]);for(var a in this.__old_el_styles)this.$el.css(a,this.__old_el_styles[a]);return this.$el=null,!0},_el_styles:function(){return{}},_el_classes:function(){return[]},$:function(a){return this.$el.find(a)},$data:function(a,b){b||(b=this.$el);var c="";for(var d in a)c+="[data-"+d+"='"+a[d]+"']";return b.find(c)},destroy:function(){this.deactivate(),BetaJS.Objs.iter(this.__children,function(a){a.view.destroy()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.destroy()},this),BetaJS.Objs.iter(this.__templates,function(a){a.destroy()},this),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},isVisible:function(){return this.__visible},setVisibility:function(a){a!=this.__visible&&(this.__visible=a,this.isActive()&&this.$el.css("display",this.__visible?"":"none"))},toggle:function(){this.setVisibility(!this.isVisible())},__bind:function(){var a=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(b){BetaJS.Objs.iter(b,function(b,c){var d=a[b],e=c.match(BetaJS.Views.BIND_EVENT_SPLITTER),f=e[1],g=e[2];f=f+".events"+a.cid();var h=BetaJS.Functions.as_method(d,a);""===g?a.$el.on(f,h):a.$el.on(f,g,h)})})},__unbind:function(){this.$el.off(".events"+this.cid())},__render:function(){if(this.isActive()&&(this._render(),!BetaJS.Types.is_empty(this.__children_styles)))for(var a in this.__children_styles)this.$el.children().css(a,this.__children_styles[a])},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(a){a.view.deactivate()}),BetaJS.Objs.iter(this.__dynamics,function(a){a.reset()},this),this.__render(),BetaJS.Objs.iter(this.__children,function(a){a.view.activate()}))},setEl:function(a){this.isActive()?(this.deactivate(),this.__el=a,this.activate()):this.__el=a},getParent:function(){return this.__parent},hasChild:function(a){return a&&a.cid()in this.__children},setParent:function(a){if(a!=this.__parent){if(this.deactivate(),this.__parent){var b=this.__parent;this.__parent=null,b.removeChild(this)}a&&(this.__parent=a,a.addChild(this),a.isActive()&&this.activate())}},children:function(){var a={};return BetaJS.Objs.iter(this.__children,function(b,c){a[c]=b.view},this),a},childOptions:function(a){return this.__children[a.cid()].options},addChildren:function(a){BetaJS.Objs.iter(a,function(a){this.addChild(a)},this)},addChild:function(a,b){return this.hasChild(a)?null:(b=b||{},this.__children[a.cid()]={view:a,options:b},this._notify("addChild",a,b),a.setParent(this),a)},removeChildren:function(a){BetaJS.Objs.iter(a,function(a){this.removeChild(a)},this)},removeChild:function(a){this.hasChild(a)&&(delete this.__children[a.cid()],a.setParent(null),this._notify("removeChild",a))},width:function(){return this.$el.width()},innerWidth:function(){return this.$el.innerWidth()},outerWidth:function(){return this.$el.outerWidth()},height:function(){return this.$el.height()},innerHeight:function(){return this.$el.innerHeight()},outerHeight:function(){return this.$el.outerHeight()}}]),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Views.DynamicTemplate=BetaJS.Class.extend("DynamicTemplate",{constructor:function(a,b){this._inherited(BetaJS.Views.DynamicTemplate,"constructor"),this.__parent=a,this.__template=new BetaJS.Templates.Template(b),this.__instances={},this.__instances_by_name={}},reset:function(){BetaJS.Objs.iter(this.__instances,function(a){this.removeInstance(a)},this)},destroy:function(){this.reset(),this._inherited(BetaJS.Views.DynamicTemplate,"destroy")},renderInstance:function(a,b){b=b||{},b.name&&this.removeInstanceByName(b.name);var c=new BetaJS.Views.DynamicTemplateInstance(this,a,b);this.__instances[c.cid()]=c,b.name&&(this.__instances_by_name[name]=c)},removeInstanceByName:function(a){a in this.__instances_by_name&&this.removeInstance(this.__instances_by_name[a])},removeInstance:function(a){delete this.__instances[a.cid()],delete this.__instances_by_name[a.name()],a.destroy()},view:function(){return this.__parent},template:function(){return this.__template}}),BetaJS.Views.DynamicTemplateInstance=BetaJS.Class.extend("DynamicTemplateInstance",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.ListenMixin,{__bind:{attr:function(a,b){return this.__context.__bind_attribute(a,b)},attrs:function(a){var b="";for(attribute in a)b+=this.attr(attribute,a[attribute])+" ";return b},value:function(a){return this.__context.__bind_value(a)},inner:function(a){return this.__context.__bind_inner(a)},css_if:function(a,b){return this.__context.__bind_css_if(a,b,!0)},css_if_not:function(a,b){return this.__context.__bind_css_if(a,b,!1)}},__new_element:function(a){var b=BetaJS.Ids.uniqueId();return this.__elements[b]=BetaJS.Objs.extend({id:b,$el:null},a),this.__elements[b]},__decompose_variable:function(a){var b=a.split(".");return{object:1==b.length?this.__parent.view():this.__args[b[0]],key:1==b.length?a:b[1]}},__get_variable:function(a){var b=this.__decompose_variable(a);return b.object.get(b.key)},__set_variable:function(a,b){var c=this.__decompose_variable(a);return c.object.set(c.key,b)},__update_element:function(a){var b=this.__get_variable(a.variable);"inner"==a.type?a.$el.html(b):"value"==a.type?a.$el.val()!=b&&a.$el.val(b):"attribute"==a.type?a.$el.attr(a.attribute,b):"css"==a.type&&(a.positive||(b=!b),b?a.$el.addClass(this.__parent.view().css(a.css)):a.$el.removeClass(this.__parent.view().css(a.css)))},__prepare_element:function(a){var b=this;a.$el=this.$el.find(a.selector),"inner"==a.type||"css"==a.type?this.__update_element(a):"value"==a.type&&a.$el.on("change input keyup paste",function(){b.__set_variable(a.variable,a.$el.val())})},__bind_attribute:function(a,b){var c=this.__new_element({type:"attribute",attribute:a,variable:b}),d="data-bind-"+a+"='"+c.id+"'";c.selector="["+d+"]";var e=this.__decompose_variable(b);return this.listenOn(e.object,"change:"+e.key,function(){this.__update_element(c)},this),d+" "+a+"='"+e.object.get(e.key)+"'"},__bind_css_if:function(a,b,c){var d=this.__new_element({type:"css",css:a,variable:b,positive:c}),e="data-bind-css-"+a+"='"+d.id+"'";d.selector="["+e+"]";var f=this.__decompose_variable(b);return this.listenOn(f.object,"change:"+f.key,function(){this.__update_element(d)},this),e},__bind_value:function(a){var b=this.__new_element({type:"value",variable:a}),c="data-bind-value='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)
},this),c+" value='"+d.object.get(d.key)+"'"},__bind_inner:function(a){var b=this.__new_element({type:"inner",variable:a}),c="data-bind-inner='"+b.id+"'";b.selector="["+c+"]";var d=this.__decompose_variable(a);return this.listenOn(d.object,"change:"+d.key,function(){this.__update_element(b)},this),c},constructor:function(a,b,c){this._inherited(BetaJS.Views.DynamicTemplateInstance,"constructor"),this.__elements={},this.__inners={},c=c||{},c.name&&(this.__name=name),this.__parent=a,this.$el=b,this.__args=BetaJS.Objs.extend(c.args||{},this.__parent.view().templateArguments()),this.__args.bind=BetaJS.Objs.extend({__context:this},this.__bind),this.$el.html(a.template().evaluate(this.__args)),BetaJS.Objs.iter(this.__elements,function(a){this.__prepare_element(a)},this)},destroy:function(){BetaJS.Objs.iter(this.__elements,function(a){a.$el.off()},this),this._inherited(BetaJS.Views.DynamicTemplateInstance,"destroy")},name:function(){return this.__name}}]),BetaJS.Routers=BetaJS.Routers||{},BetaJS.Routers.Router=BetaJS.Class.extend("Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(a){this._inherited(BetaJS.Routers.Router,"constructor");var b=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(b)||(b=[b]),"routes"in a&&(BetaJS.Types.is_array(a.routes)?b=b.concat(a.routes):b.push(a.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(b,function(a){BetaJS.Objs.iter(a,function(a,b){BetaJS.Types.is_string(a)&&(a={action:a}),a.key=b,a.route=new RegExp("^"+b+"$"),"applicable"in a?BetaJS.Types.is_array(a.applicable)||(a.applicable=[a.applicable]):a.applicable=[],"valid"in a?BetaJS.Types.is_array(a.valid)||(a.valid=[a.valid]):a.valid=[],"path"in a||(a.path=a.key),this.__routes.push(a),this.__paths[a.path]=a},this)},this),"actions"in a&&BetaJS.Objs.iter(a.actions,function(a,b){this[b]=a},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Routers.Router,"destroy")},parse:function(a){for(var b=0;b<this.__routes.length;++b){var c=this.__routes[b],d=c.route.exec(a);if(null!=d){d.shift(1);var e=!0;if(BetaJS.Objs.iter(c.applicable,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;e=e&&b.apply(this,d)},this),!e)continue;var f=!0;return BetaJS.Objs.iter(c.valid,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;f=f&&b.apply(this,d)},this),f?{object:c,params:d}:null}}return null},object:function(a){return this.__paths[a]},path:function(a){for(var b=this.object(a).key,c=Array.prototype.slice.apply(arguments,[1]),d=/\(.*?\)/;arg=c.shift();)b=b.replace(d,arg);return b},navigate:function(a){this.trigger("navigate",a);var b=this.parse(a);return null==b?(this.trigger("navigate-fail",a),!1):(this.trigger("navigate-success",b.object,b.params),this.invoke(b.object,b.params,a))},invoke:function(a,b,c){c=c||this.path(a.key,b),this.trigger("before_invoke",a,b,c),this.__enter(a,b,c);var d=this._invoke(a,b);return this.trigger("after_invoke",a,b,c),d},_invoke:function(a,b){var c=a.action;return BetaJS.Types.is_string(c)&&(c=this[c]),c.apply(this,b)},__leave:function(){null!=this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(a,b,c){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=c,this.__current.object=a,this.__current.params=b,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Routers.RouterHistory=BetaJS.Class.extend("RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Routers.RouterHistory,"constructor"),this.__router=a,this.__history=[],a.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouterHistory,"destroy")},__after_invoke:function(a,b){this.__history.push({object:a,params:b}),this.trigger("change")},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this.__history.length},get:function(a){return a=a||0,this.__history[a]},getRoute:function(a){var b=this.get(a);return this.__router.path(b.object.path,b.params)},back:function(a){if(!(this.count()<2)){for(a=a||0;a>=0&&this.count()>1;)this.__history.pop(),--a;var b=this.__history.pop();return this.trigger("change"),this.__router.invoke(b.object,b.params)}}}]),BetaJS.Routers.RouteBinder=BetaJS.Class.extend("RouteBinder",{constructor:function(a){this._inherited(BetaJS.Routers.RouteBinder,"constructor"),this.__router=a,this.__router.on("after_invoke",function(a,b,c){this._getExternalRoute()!=c&&this._setExternalRoute(c)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouteBinder,"destroy")},_setRoute:function(a){var b=this.__router.current();b&&b.route==a||this.__router.navigate(a)},_getExternalRoute:function(){return""},_setExternalRoute:function(){}}),BetaJS.Routers.HashRouteBinder=BetaJS.Routers.RouteBinder.extend("HashRouteBinder",[BetaJS.Ids.ClientIdMixin,{constructor:function(a){this._inherited(BetaJS.Routers.HashRouteBinder,"constructor",a);var b=this;BetaJS.$(window).on("hashchange.events"+this.cid(),function(){b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Routers.HashRouteBinder,"destroy")},_getExternalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setExternalRoute:function(a){window.location.hash="#"+a}}]),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="  <div data-selector=\"right\" class='holygrail-view-right-container'></div>  <div data-selector=\"left\" class='holygrail-view-left-container'></div>  <div data-selector=\"center\" class='holygrail-view-center-container'></div> ",BetaJS.Templates.Cached["list-container-view-item-template"]='  <div data-view-id="{%= cid %}"></div> ',BetaJS.Templates.Cached["switch-container-view-item-template"]='  <div data-view-id="{%= cid %}" class="switch-container" data-selector="switch-container-item"></div> ',BetaJS.Templates.Cached["button-view-template"]='   <{%= button_container_element %}    {%= bind.inner("label") %}>   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["check-box-view-template"]='  <input type="checkbox" {%= checked ? "checked" : "" %} />  {%= label %} ',BetaJS.Templates.Cached["input-view-template"]='  <input class="input-view" {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %} /> ',BetaJS.Templates.Cached["label-view-template"]='  <{%= element %} class="label" {%= bind.inner("label") %}></{%= element %}> ',BetaJS.Templates.Cached["link-view-template"]='  <a href="javascript:{}" {%= bind.inner("label") %}></a> ',BetaJS.Templates.Cached["text-area-template"]='   <textarea {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %}></textarea>  ',BetaJS.Templates.Cached["list-view-template"]='   <{%= list_container_element %}    {%= supp.attrs(list_container_attrs) %}    class="{%= list_container_classes %}"    data-selector="list">   </{%= list_container_element %}>  ',BetaJS.Templates.Cached["list-view-item-container-template"]='   <{%= item_container_element %}    {%= supp.attrs(item_container_attrs) %}    class="{%= item_container_classes %}"    {%= supp.list_item_attr(item) %}>   </{%= item_container_element %}>  ',BetaJS.Views.HolygrailView=BetaJS.Views.View.extend("HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.HolygrailView,"constructor",a),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(a){return this.__setView("left",a)},getCenter:function(){return this.__center},setCenter:function(a){return this.__setView("center",a)},getRight:function(){return this.__right},setRight:function(a){return this.__setView("right",a)},__setView:function(a,b){return this.removeChild(this["__"+a]),this["__"+a]=null,b&&(b.setEl('[data-selector="'+a+'"]'),this["__"+a]=this.addChild(b)),b}}),BetaJS.Views.ListContainerView=BetaJS.Views.View.extend("ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){a=a||{},this._inherited(BetaJS.Views.ListContainerView,"constructor",a),this._setOption(a,"alignment","horizontal")},isHorizontal:function(){return"horizontal"==this.__alignment},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){var b=this.childOptions(a);if(this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),!this.isHorizontal()||"float"in b||(b["float"]="left"),this.isActive()&&"float"in b){var c=this.$("[data-view-id='"+a.cid()+"']");c.css("float",b["float"])}},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove()}}),BetaJS.Views.SingleContainerView=BetaJS.Views.View.extend("SingleContainerView",{constructor:function(a){this._inherited(BetaJS.Views.SingleContainerView,"constructor",a),this.__view=null},getView:function(){return this.__view},setView:function(a){this.removeChild(this.__view),a&&(a.setEl(""),this.__view=this.addChild(a))}}),BetaJS.Views.SwitchContainerView=BetaJS.Views.View.extend("SwitchContainerView",{_templates:{item:BetaJS.Templates.Cached["switch-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},constructor:function(a){this._inherited(BetaJS.Views.SwitchContainerView,"constructor",a),this.__selected=null},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(a){this.__addChildContainer(a)},this)},__addChildContainer:function(a){this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:a.cid()})),a.setEl("[data-view-id='"+a.cid()+"']"),this.__selected=this.__selected||a,a.setVisibility(this.__selected==a)},__removeChildContainer:function(a){this.$data({"view-id":a.cid()}).remove(),this.__selected==a&&(this.__selected=null)},select:function(a){this.__selected=a,BetaJS.Objs.iter(this.children(),function(a){a.setVisibility(this.__selected==a)},this)}}),BetaJS.Views.ButtonView=BetaJS.Views.View.extend("ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["button-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.ButtonView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"button_container_element","button")},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click button":"__clickButton"}])},__clickButton:function(){this.trigger("clicked")}}),BetaJS.Views.InputView=BetaJS.Views.View.extend("InputView",{_dynamics:{"default":BetaJS.Templates.Cached["input-view-template"]},_events:function(){return[{"keyup input":"__keyupEvent","blur input":"__leaveEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.InputView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder","")},__keyupEvent:function(a){var b=a.keyCode||a.which;13==b&&this.trigger("enter_key")},__leaveEvent:function(){this.trigger("leave")},focus:function(){this.$("input").focus(),this.$("input").focus()}}),BetaJS.Views.CheckBoxView=BetaJS.Views.View.extend("CheckBoxView",{_templates:{"default":BetaJS.Templates.Cached["check-box-view-template"]},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click input":"__click"}])},constructor:function(a){a=a||{},a.invalidate_on_change=!0,this._inherited(BetaJS.Views.CheckBoxView,"constructor",a),this._setOptionProperty(a,"checked",!1),this._setOptionProperty(a,"label","")},__click:function(){this.set("checked",this.$("input").is(":checked")),this.trigger("check",this.get("checked"))}}),BetaJS.Views.LabelView=BetaJS.Views.View.extend("LabelView",{_dynamics:{"default":BetaJS.Templates.Cached["label-view-template"]},_events:function(){return[{click:"__clickEvent"}]},constructor:function(a){this._inherited(BetaJS.Views.LabelView,"constructor",a),this._setOptionProperty(a,"label",""),this._setOptionProperty(a,"element","span")},__clickEvent:function(){this.trigger("click")}}),BetaJS.Views.InputLabelView=BetaJS.Views.SwitchContainerView.extend("LabelInputView",{constructor:function(a){this._inherited(BetaJS.Views.InputLabelView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder",""),this._setOption(a,"edit_on_click",!0),this._setOption(a,"label_mode",!0),this.label=this.addChild(new BetaJS.Views.LabelView({label:this.binding("value")})),this.input=this.addChild(new BetaJS.Views.InputView({value:this.binding("value"),placeholder:this.binding("placeholder")})),this.__label_mode||this.select(this.input),this.input.on("leave enter_key",function(){this.label_mode()},this),this.__edit_on_click&&this.label.on("click",function(){this.edit_mode()},this)},label_mode:function(){this.select(this.label)},edit_mode:function(){this.select(this.input),this.input.focus()}}),BetaJS.Views.LinkView=BetaJS.Views.View.extend("LinkView",{_dynamics:{"default":BetaJS.Templates.Cached["link-view-template"]},constructor:function(a){this._inherited(BetaJS.Views.LinkView,"constructor",a),this._setOptionProperty(a,"label","")},_events:function(){return this._inherited(BetaJS.Views.LinkView,"_events").concat([{"click a":"__click"}])},__click:function(){this.trigger("click")}}),BetaJS.Views.TextAreaView=BetaJS.Views.View.extend("TextAreaView",{_dynamics:{"default":BetaJS.Templates.Cached["text-area-template"]},constructor:function(a){this._inherited(BetaJS.Views.TextAreaView,"constructor",a),this._setOptionProperty(a,"value",""),this._setOptionProperty(a,"placeholder","")}}),BetaJS.Views.CustomListView=BetaJS.Views.View.extend("CustomListView",{_templates:function(){return{"default":BetaJS.Templates.Cached["list-view-template"],"item-container":BetaJS.Templates.Cached["list-view-item-container-template"]}},_supp:function(){return BetaJS.Objs.extend(this._inherited(BetaJS.Views.CustomListView,"_supp"),{list_item_attr:function(a){return this.attrs({"data-view-id":this.__context.cid(),"data-cid":BetaJS.Ids.objectId(a),"data-index":this.__context.__collection.getIndex(a)})}})},constructor:function(a){if(this._inherited(BetaJS.Views.CustomListView,"constructor",a),this._setOption(a,"list_container_element","ul"),this._setOption(a,"list_container_attrs",{}),this._setOption(a,"list_container_classes",""),this._setOption(a,"item_container_element","li"),this._setOption(a,"item_container_classes",""),this.__itemData={},"collection"in a)this.__collection=a.collection,this.__destroy_collection=!1;else{var b={};"objects"in a&&(b.objects=a.objects),"compare"in a&&(b.compare=a.compare),this.__collection=new BetaJS.Collections.Collection(b),this.__destroy_collection=!0}this.__collection.on("add",function(a){this.__addItem(a,!0)},this),this.__collection.on("remove",function(a){this.__removeItem(a)},this),this.__collection.on("change",function(a){this.__changeItem(a)},this),this.__collection.on("index",function(a,b){this.__updateItemIndex(a,b)},this),this.__collection.on("reindexed",function(a){this.__reIndexItem(a)},this),this.__collection.on("sorted",function(){this.__sorted()},this)},destroy:function(){for(var a in this.__itemData)this._destroyItemData(this.__itemData[a]);this.__itemData=null,this.__collection.off(null,null,this),this.__destroy_collection&&this.__collection.destroy(),this._inherited(BetaJS.Views.CustomListView,"destroy")},collection:function(){return this.__collection},add:function(a){this.__collection.add(a)},remove:function(a){this.__collection.remove(a)},_render:function(){this.$selector_list=this._renderListContainer();var a=this;this.__collection.iterate(function(b){a.__addItem(b,!1)})},_renderListContainer:function(){return this.$el.html(this.evaluateTemplate("default",{list_container_element:this.__list_container_element,list_container_attrs:this.__list_container_attrs,list_container_classes:this.__list_container_classes})),this.$data({selector:"list"})},_findItemElement:function(a){return this.$data({"view-id":this.cid(),cid:BetaJS.Ids.objectId(a)},this.$selector_list)},_findIndexElement:function(a){return this.$data({"view-id":this.cid(),index:a},this.$selector_list)},__changeItem:function(a){this.isActive()&&this._changeItem(a)},_newItemData:function(){return{}},_destroyItemData:function(){},itemData:function(a){return this.__itemData[BetaJS.Ids.objectId(a)]},_changeItem:function(){},__addItem:function(a,b){if(this.isActive()){var c=this.evaluateTemplate("item-container",{item:a,item_container_element:this.__item_container_element,item_container_attrs:this.__item_container_attrs,item_container_classes:this.__item_container_classes}),d=this.__collection.getIndex(a);if(0==d)this.$selector_list.prepend(c);else{var e=this._findIndexElement(d-1);if(e.length>0)e.after(c);else{var f=this._findIndexElement(d+1);f.length>0?f.before(c):this.$selector_list.append(c)}}var g=this._findItemElement(a);this.__itemData[BetaJS.Ids.objectId(a)]=this._newItemData(a),this._addItem(a,g,b),this._addElement(g,b)}},_addElement:function(){},_addItem:function(){},__removeItem:function(a){if(this.isActive()){var b=this._findItemElement(a);this._removeItem(a,b),this._destroyItemData(this.__itemData[BetaJS.Ids.objectId(a)]),delete this.__itemData[BetaJS.Ids.objectId(a)],this._removeElement(b)}},_removeElement:function(a){a.remove()},_removeItem:function(){},__updateItemIndex:function(a,b){var c=this._findItemElement(a);c.attr("data-index",b),this._updateItemIndex(a,c)},__reIndexItem:function(a){var b=this._findItemElement(a),c=this.collection().getIndex(a);if(0==c)this.$selector_list.prepend(b);else{var d=this._findIndexElement(c-1);d.after(b)}},_updateItemIndex:function(){},__sort:function(){for(var a=this.collection().count()-1;a>=0;a--)this.$selector_list.prepend(this._findIndexElement(a))}}),BetaJS.Views.ListView=BetaJS.Views.CustomListView.extend("ListView",{constructor:function(a){this._inherited(BetaJS.Views.ListView,"constructor",a),this._setOption(a,"item_label","label"),this._setOption(a,"render_item_on_change",null==this.dynamics("item"))},_changeItem:function(a){if(this.__render_item_on_change){var b=this._findItemElement(a);this._renderItem(a,b,!1)}},_addItem:function(a,b,c){this._renderItem(a,b,c)},_renderItem:function(a,b){null!=this.templates("item")?b.html(this.evaluateTemplate("item",{item:a})):null!=this.dynamics("item")?this.evaluateDynamics("item",b,{item:a},{name:"item-"+BetaJS.Ids.objectId(a)}):b.html(a.get(this.__item_label))},_removeItem:function(a){null!=this.dynamics("item")&&this.dynamics("item").removeInstanceByName("item-"+BetaJS.Ids.objectId(a))}}),BetaJS.Views.SubViewListView=BetaJS.Views.CustomListView.extend("SubViewListView",{constructor:function(a){this._inherited(BetaJS.Views.SubViewListView,"constructor",a),"create_view"in a&&(this._create_view=a.create_view),this._setOption(a,"sub_view",BetaJS.Views.LabelView),this._setOption(a,"item_label","label");var b=this;this._setOption(a,"sub_view_options",function(a){return{label:a.binding(b.__item_label)}})},_create_view:function(a,b){var c=this.__sub_view_options(a);return c.el=b,new this.__sub_view(c)},_addItem:function(a,b){var c=this._create_view(a,b);this.itemData(a).view=c,this.addChild(c)},_destroyItemData:function(a){this.removeChild(a.view),a.view.destroy()}}),BetaJS.Views.ItemListItemView=BetaJS.Views.View.extend("ItemListItemView",{constructor:function(a){this._inherited(BetaJS.Views.ItemListItemView,"constructor",a),this._setOptionProperty(a,"item",null),this._setOptionProperty(a,"_selected")},_events:function(){return[{click:"__click"}]},isSelected:function(){return this.get("_selected")},__click:function(){this.getParent().__click_select&&this.select()},select:function(){this.getParent().select(this.get("item"))},unselect:function(){this.getParent().unselect(this.get("item"))}}),BetaJS.Views.ItemListView=BetaJS.Views.CustomListView.extend("ItemListView",{constructor:function(a){this._inherited(BetaJS.Views.ItemListView,"constructor",a),this._setOption(a,"sub_view",BetaJS.Views.ItemListItemView),this._setOption(a,"sub_view_options",this._sub_view_options||{}),this._setOption(a,"selectable",!0),this._setOption(a,"multi_select",!1),this._setOption(a,"click_select",!0)},_addItem:function(a,b){var c=new this.__sub_view(BetaJS.Objs.extend({el:b,item:a},this.__sub_view_options));this.itemData(a).view=c,this.addChild(c)},_destroyItemData:function(a){this.removeChild(a.view),a.view.destroy()},isSelected:function(a){return this.itemData(a).view.get("_selected")},select:function(a){var b=this;return this.__selectable&&!this.isSelected(a)&&(this.__multi_select||this.collection().iterate(function(a){b.unselect(a)}),this.itemData(a).view.set("_selected",!0),this.trigger("select",a)),this.itemData(a).view},unselect:function(a){return this.__selectable&&this.isSelected(a)&&(this.itemData(a).view.set("_selected",!1),this.trigger("unselect",a)),this.itemData(a).view}});