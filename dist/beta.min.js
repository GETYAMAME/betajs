/*! betajs - v0.0.1 - 2013-05-09, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */var BetaJS=BetaJS||{};BetaJS.Types={is_object:function(t){return"object"==typeof t},is_array:function(t){return"[object Array]"==toString.call(t)},is_undefined:function(t){return t===void 0},is_null:function(t){return null==t},is_none:function(t){return this.is_undefined(t)||this.is_null(t)},is_defined:function(t){return t!==void 0},is_empty:function(t){if(this.is_none(t))return!0;if(this.is_array(t))return 0==t.length;if(this.is_object(t)){for(var e in t)return!1;return!0}return!1},is_string:function(t){return"string"==typeof t},is_function:function(t){return"function"==typeof t},is_boolean:function(t){return"boolean"==typeof t},compare:function(t,e){if(BetaJS.Types.is_boolean(t)&&BetaJS.Types.is_boolean(e))return t==e?0:t?1:-1;if(BetaJS.Types.is_array(t)&&BetaJS.Types.is_array(e)){for(var i=t.length,n=e.length,s=Math.min(i,n),r=0;s>r;++r){var _=this.compare(t[r],e[r]);if(0!=_)return _}return i==n?0:i>n?1:-1}return t.localeCompare(e)}},BetaJS.Strings={nl2br:function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=RegExp(BetaJS.Objs.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(t){var e=this;return t.replace(this.JS_ESCAPER_REGEX(),function(t){return"\\"+e.JS_ESCAPES[t]})}},BetaJS.Functions={as_method:function(t,e){return function(){return t.apply(e,arguments)}},once:function(t){var e,i=!1;return function(){return i?e:(i=!0,e=t.apply(this,arguments),t=null,e)}}},BetaJS.Objs={clone:function(t,e){return!e||0>=e?t:BetaJS.Types.is_array(t)?t.slice(0):BetaJS.Types.is_object(t)?this.extend({},t,e-1):t},extend:function(t,e,i){for(var n in e)t[n]=this.clone(e[n],i);return t},keys:function(t,e){if(BetaJS.Types.is_undefined(e)){var i=[];for(var n in t)i.push(n);return i}var i={};for(var n in t)i[n]=e;return i},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},equals:function(t,e,i){if(i&&i>0){for(var n in t)if(!n in e||!this.equals(t[n],e[n],i-1))return!1;for(var n in e)if(!n in t)return!1;return!0}return t==e},iter:function(t,e,i){if(BetaJS.Types.is_array(t))for(var n=0;t.length>n;++n){var s=i?e.apply(i,[t[n],n]):e(t[n],n);if(BetaJS.Types.is_defined(s)&&!s)return}else for(var r in t){var s=i?e.apply(i,[t[r],r]):e(t[r],r);if(BetaJS.Types.is_defined(s)&&!s)return}}},BetaJS.Ids={__uniqueId:0,uniqueId:function(t){return(t||"")+this.__uniqueId++},objectId:function(t){return t.__cid||(t.__cid=this.uniqueId("cid_")),t.__cid}},BetaJS.Ids.ClientIdMixin={cid:function(){return BetaJS.Ids.objectId(this)}},BetaJS.Class=function(){},BetaJS.Class.classname="Class",BetaJS.Class.extend=function(t,e,i,n){e=e||[],BetaJS.Types.is_array(e)||(e=[e]),i=i||[],BetaJS.Types.is_array(i)||(i=[i]),n=n||[],BetaJS.Types.is_array(n)||(n=[n]);var s,r=this;BetaJS.Objs.iter(e,function(t){t.hasOwnProperty("constructor")&&(s=t.constructor)}),BetaJS.Types.is_defined(s)||(s=function(){r.apply(this,arguments)}),BetaJS.Objs.extend(s,r),BetaJS.Objs.iter(i,function(t){BetaJS.Objs.extend(s,t)});var _={};if(r.__class_statics_keys)for(var a in r.__class_statics_keys)s[a]=BetaJS.Objs.clone(r[a],1);BetaJS.Objs.iter(n,function(t){BetaJS.Objs.extend(s,t),BetaJS.Objs.extend(_,BetaJS.Objs.keys(t,!0))}),r.__class_statics_keys&&BetaJS.Objs.extend(_,r.__class_statics_keys),s.__class_statics_keys=_,s.parent=r,s.children=[],s.extend=this.extend,r.children||(r.children=[]),r.children.push(s);var o=function(){};return o.prototype=r.prototype,s.prototype=new o,s.prototype.cls=s,s.classname=t,s.__notifications={},r.__notifications&&BetaJS.Objs.extend(s.__notifications,r.__notifications),BetaJS.Objs.iter(e,function(t){if(BetaJS.Objs.extend(s.prototype,t),t._notifications)for(var e in t._notifications)s.__notifications[e]||(s.__notifications[e]=[]),s.__notifications[e].push(t._notifications[e])}),delete s.prototype._notifications,s},BetaJS.Class.prototype.constructor=function(){this._notify("construct")},BetaJS.Class.prototype._notify=function(t){if(this.cls.__notifications){var e=Array.prototype.slice.call(arguments,1),i=this.cls.__notifications[t];if(i)for(var n in i)this[i[n]].apply(this,e)}},BetaJS.Class.prototype.destroy=function(){this._notify("destroy");for(var t in this)delete this[t]},BetaJS.Class.prototype._inherited=function(t,e){return t.parent.prototype[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class._inherited=function(t,e){return t.parent[e].apply(this,Array.prototype.slice.apply(arguments,[2]))},BetaJS.Class.prototype.cls=BetaJS.Class,BetaJS.Class.__notifications={},BetaJS.Classes={},BetaJS.Classes.AutoDestroyMixin={enter:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count++},leave:function(){this.__enter_count||(this.__enter_count=0),this.__enter_count--,1>this.__enter_count&&this.destroy()}},BetaJS.Lists={},BetaJS.Lists.AbstractList=BetaJS.Class.extend("AbstractList",{_add:function(){},_remove:function(){},_get:function(){},_iterate:function(){},get_ident:function(t){var e=null;return this._iterate(function(i,n){return i==t?(e=n,!1):!0}),e},exists:function(t){return null!=this.get_ident(t)},_ident_changed:function(){},constructor:function(t){this._inherited(BetaJS.Lists.AbstractList,"constructor"),this.__count=0,t&&BetaJS.Objs.iter(t,function(t){this.add(t)},this)},add:function(t){var e=this._add(t);return BetaJS.Types.is_defined(e)&&this.__count++,e},count:function(){return this.__count},clear:function(){var t=this;this._iterate(function(e,i){return t.remove_by_ident(i),!0})},remove_by_ident:function(t){var e=this._remove(t);return BetaJS.Types.is_defined(e)&&this.__count--,e},remove:function(t){return this.remove_by_ident(this.get_ident(t))},remove_by_filter:function(t){var e=this;this._iterate(function(i,n){return t(i)&&e.remove_by_ident(n),!0})},get:function(t){return this._get(t)},iterate:function(t){this._iterate(function(e,i){var n=t(e,i);return BetaJS.Types.is_defined(n)?n:!0})}}),BetaJS.Lists.LinkedList=BetaJS.Lists.AbstractList.extend("LinkedList",{constructor:function(t){this.__first=null,this.__last=null,this._inherited(BetaJS.Lists.LinkedList,"constructor",t)},_add:function(t){return this.__last={obj:t,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(t){return t.next?t.next.prev=t.prev:this.__last=t.prev,t.prev?t.prev.next=t.next:this.__first=t.next,t.obj},_get:function(t){return t.obj},_iterate:function(t){for(var e=this.__first;null!=e;){var i=e;if(e=e.next,!t(i.obj,i))return}}}),BetaJS.Lists.ObjectIdList=BetaJS.Lists.AbstractList.extend("ObjectIdList",{constructor:function(t){this.__map={},this._inherited(BetaJS.Lists.ObjectIdList,"constructor",t)},_add:function(t){var e=BetaJS.Ids.objectId(t);return this.__map[e]=t,e},_remove:function(t){var e=this.__map[t];return delete this.__map[t],e},_get:function(t){return this.__map[t]},_iterate:function(t){for(var e in this.__map)t(this.__map[e],e)},get_ident:function(t){return BetaJS.Ids.objectId(t)}}),BetaJS.Lists.ArrayList=BetaJS.Lists.AbstractList.extend("ArrayList",{constructor:function(t,e){this.__idToIndex={},this.__items=[],e=e||{},"compare"in e&&(this._compare=e.compare),this._inherited(BetaJS.Lists.ArrayList,"constructor",t)},set_sompare:function(t){this._compare=t,t&&this.sort()},get_compare:function(){return this._compare},sort:function(t){if(t=t||this._compare){this.__items.sort(t);for(var e=0;this.__items.length>e;++e)this.__ident_changed(this.__items[e],e);this._sorted()}},_sorted:function(){},re_index:function(t){if(!("_compare"in this))return t;for(var e=this.__items.length-1,i=this.__items[t],n=t;e>n&&this._compare(this.__items[n],this.__items[n+1])>0;)this.__items[n]=this.__items[n+1],this.__ident_changed(this.__items[n],n),this.__items[n+1]=i,++n;if(n==t)for(;n>0&&0>this._compare(this.__items[n],this.__items[n-1]);)this.__items[n]=this.__items[n-1],this.__ident_changed(this.__items[n],n),this.__items[n-1]=i,--n;return n!=t&&(this.__ident_changed(i,n),this._re_indexed(i)),n},_re_indexed:function(){},_add:function(t){var e=this.__items.length;this.__items.push(t);var i=this.re_index(e);return this.__idToIndex[BetaJS.Ids.objectId(t)]=i,i},_remove:function(t){for(var e=this.__items[t],i=t+1;this.__items.length>i;++i)this.__items[i-1]=this.__items[i],this.__ident_changed(this.__items[i-1],i-1);return this.__items.pop(),delete this.__idToIndex[BetaJS.Ids.objectId(e)],e},_get:function(t){return this.__items[t]},_iterate:function(t){for(var e=BetaJS.Objs.clone(this.__items,1),i=0;e.length>i;++i)t(e[i],this.get_ident(e[i]))},__ident_changed:function(t,e){this.__idToIndex[BetaJS.Ids.objectId(t)]=e,this._ident_changed(t,e)},get_ident:function(t){var e=BetaJS.Ids.objectId(t);return e in this.__idToIndex?this.__idToIndex[e]:null},ident_by_id:function(t){return this.__idToIndex[t]}}),BetaJS.Iterators={},BetaJS.Iterators.Iterator=BetaJS.Class.extend("Iterator"),BetaJS.Iterators.ArrayIterator=BetaJS.Iterators.Iterator.extend("ArrayIterator",{constructor:function(t){this._inherited(BetaJS.Iterators.ArrayIterator,"constructor"),this.__arr=t,this.__i=0},hasNext:function(){return this.__i<this.__arr.length},next:function(){return this.__arr[this.__i++]}}),BetaJS.Iterators.MappedIterator=BetaJS.Iterators.Iterator.extend("MappedIterator",{constructor:function(t,e){this._inherited(BetaJS.Iterators.MappedIterator,"constructor"),this.__iterator=t,this.__map=e},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__map(this.__iterator.next())}}),BetaJS.Iterators.FilteredIterator=BetaJS.Iterators.Iterator.extend("FilteredIterator",{constructor:function(t,e,i){this._inherited(BetaJS.Iterators.FilteredIterator,"constructor"),this.__iterator=t,this.__filter=e,this.__context=i||this,this.__next=null,this.__has_next=!0},hasNext:function(){return this.__crawl(),null!=this.__next},next:function(){this.__crawl();var t=this.__next;return this.__next=null,t},__crawl:function(){for(;null==this.__next&&this.__iterator.hasNext();)if(this.__next=this.__iterator.next(),this.__filter_func(this.__next))return;this.__has_next=!1,this.__next=!1},__filter_func:function(t){return filter.apply(this.__context,t)}}),BetaJS.Events={},BetaJS.Events.EVENT_SPLITTER=/\s+/,BetaJS.Events.EventsMixin={on:function(t,e,i){this.__events_mixin_events=this.__events_mixin_events||{},t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var n;n=t.shift();)this.__events_mixin_events[n]=this.__events_mixin_events[n]||new BetaJS.Lists.LinkedList,this.__events_mixin_events[n].add({callback:e,context:i});return this},off:function(t,e,i){if(this.__events_mixin_events=this.__events_mixin_events||{},t){t=t.split(BetaJS.Events.EVENT_SPLITTER);for(var n;n=t.shift();)this.__events_mixin_events[n]&&(this.__events_mixin_events[n].remove_by_filter(function(t){return!(e&&t.callback!=e||i&&t.context!=i)}),0==this.__events_mixin_events[n].count()&&(this.__events_mixin_events[n].destroy(),delete this.__events_mixin_events[n]))}else for(n in this.__events_mixin_events)this.__events_mixin_events[n].remove_by_filter(function(t){return!(e&&t.callback!=e||i&&t.context!=i)}),0==this.__events_mixin_events[n].count()&&(this.__events_mixin_events[n].destroy(),delete this.__events_mixin_events[n]);return this},trigger:function(t){var e=this;t=t.split(BetaJS.Events.EVENT_SPLITTER);var i,n=Array.prototype.slice.call(arguments,1);if(this.__events_mixin_events){for(;i=t.shift();)this.__events_mixin_events[i]&&this.__events_mixin_events[i].iterate(function(t){t.callback.apply(t.context||e,n)}),this.__events_mixin_events.all&&this.__events_mixin_events.all.iterate(function(t){t.callback.apply(t.context||e,n)});return this}},once:function(t,e,i){var n=this,s=BetaJS.Functions.once(function(){n.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(name,s,i)}},BetaJS.Events.Events=BetaJS.Class.extend("Events",BetaJS.Events.EventsMixin),BetaJS.Events.ListenMixin={_notifications:{destroy:"listenOff"},listenOn:function(t,e,i){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]=t,t.on(e,i,this)},listenOnce:function(t,e,i){this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]=t,t.once(e,i,this)},listenOff:function(t,e,i){this.__listen_mixin_listen&&(t?(t.off(e,i,this),e||i||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]):BetaJS.Objs.iter(this.__listen_mixin_listen,function(t){t.off(e,i,this),e||i||delete this.__listen_mixin_listen[BetaJS.Ids.objectId(t)]},this))}},BetaJS.Events.Listen=BetaJS.Class.extend("Listen",BetaJS.Events.ListenMixin),BetaJS.Properties={},BetaJS.Properties.PropertiesMixin={get:function(t){return this.__properties[t]},set:function(t,e){this.__properties||(this.__properties={}),(!t in this.__properties||this.__properties[t]!=e)&&(this.__properties[t]=e,this.trigger("change",t,e),this.trigger("change:"+t,e))},getAll:function(){return BetaJS.Objs.clone(this.__properties||{},1)},setAll:function(t){for(var e in t)this.set(e,t[e])}},BetaJS.Properties.Properties=BetaJS.Class.extend("Properties",[BetaJS.Events.EventsMixin,BetaJS.Properties.PropertiesMixin,{constructor:function(t){this._inherited(BetaJS.Properties.Properties,"constructor"),t&&this.setAll(t)}}]),BetaJS.Properties.BindablePropertiesMixin={_notifications:{construct:"__bindable_properties_construct",destroy:"__bindable_properties_destroy"},__bindable_properties_construct:function(){this.__properties={}},__bindable_properties_destroy:function(){for(var t in this.__properties)this.__bindable_remove(t)},__bindable_remove:function(t){var e=this.__properties[t];e.bindee&&e.bindee.off("change:"+e.property,null,this),delete this.__properties[t]},get:function(t){var e=this.__properties[t];return null==e?null:e.bindee?e.bindee.get(e.property):e.value},set:function(t,e){if(this.get(t)!=e){var i=this.__properties[t];e.bindee&&e.property?(i&&this.__bindable_remove(t),this.__properties[t]=e,e.bindee.on("change:"+e.property,function(){this.trigger("change"),this.trigger("change:"+t)},this)):i&&i.bindee?i.bindee.set(i.property,e):this.__properties[t]={value:e},this.trigger("change"),this.trigger("change:"+t)}},binding:function(t){return{bindee:this,property:t}},getAll:function(){var t={};for(var e in this.__properties)t[e]=this.get(e);return t},setAll:function(t){for(var e in t)this.set(e,t[e])}},BetaJS.Properties.BindableProperties=BetaJS.Class.extend("BindableProperties",[BetaJS.Events.EventsMixin,BetaJS.Properties.BindablePropertiesMixin,{constructor:function(t){this._inherited(BetaJS.Properties.BindableProperties,"constructor"),t&&this.setAll(t)}}]),BetaJS.Collections={},BetaJS.Collections.Collection=BetaJS.Class.extend("Collection",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Collections.Collection,"constructor"),t=t||{};var e={};"compare"in t&&(e.compare=t.compare),this.__data=new BetaJS.Lists.ArrayList([],e);var i=this;this.__data._ident_changed=function(t,e){i._index_changed(t,e)},this.__data._re_indexed=function(t){i._re_indexed(t)},this.__data._sorted=function(){i._sorted()},"objects"in t&&BetaJS.Objs.iter(t.objects,function(t){this.add(t)},this)},set_compare:function(t){this.__data.set_compare(t)},get_compare:function(){this.__data.get_compare()},destroy:function(){this.__data.iterate(function(t){"off"in t&&t.off(null,null,this)}),this.__data.destroy(),this._inherited(BetaJS.Collections.Collection,"destroy")},count:function(){return this.__data.count()},_index_changed:function(t,e){this.trigger("index",t,e)},_re_indexed:function(t){this.trigger("reindexed",t)},_sorted:function(){this.trigger("sorted")},_object_changed:function(t,e,i){this.trigger("change",t,e,i),this.trigger("change:"+e,t,i),this.__data.re_index(this.getIndex(t))},add:function(t){if(this.exists(t))return null;var e=this.__data.add(t);return null!=e&&(this.trigger("add",t),"on"in t&&t.on("change",function(e,i){this._object_changed(t,e,i)},this)),e},exists:function(t){return this.__data.exists(t)},remove:function(t){return this.exists(t)?(this.trigger("remove",t),"off"in t&&t.off(null,null,this),this.__data.remove(t)):null},getByIndex:function(t){return this.__data.get(t)},getById:function(t){return this.__data.get(this.__data.ident_by_id(t))},getIndex:function(t){return this.__data.get_ident(t)},iterate:function(t){this.__data.iterate(t)}}]),BetaJS.Collections.FilteredCollection=BetaJS.Collections.Collection.extend("FilteredCollection",{constructor:function(t,e){this.__parent=t,e=e||{},delete e.objects,e.compare=e.compare||t.get_compare(),this._inherited(BetaJS.Collections.FilteredCollection,"constructor",e),"filter"in e&&(this.filter=e.filter);var i=this;this.__parent.iterate(function(t){return i.add(t),!0}),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.remove,this)},filter:function(){return!0},_object_changed:function(t,e,i){this._inherited(BetaJS.Collections.FilteredCollection,"_object_changed",t,e,i),this.filter(t)||this.__selfRemove(t)},destroy:function(){this.__parent.off(null,null,this),this._inherited(BetaJS.Collections.FilteredCollection,"destroy")},__selfAdd:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"add",t)},add:function(t){if(this.exists(t)||!this.filter(t))return null;var e=this.__selfAdd(t);return this.__parent.add(t),e},__selfRemove:function(t){return this._inherited(BetaJS.Collections.FilteredCollection,"remove",t)},remove:function(t){if(!this.exists(t))return null;var e=this.__selfRemove(t);return null==e?null:this.__parent.remove(t)}}),BetaJS.Stores=BetaJS.Stores||{},BetaJS.Stores.BaseStore=BetaJS.Class.extend("BaseStore",[BetaJS.Events.EventsMixin,{_insert:function(){},_remove:function(){},_get:function(){},_update:function(){},_query:function(){},_insertEvent:function(t,e){this.trigger("insert",t,e),this.trigger("external",t)},_updateEvent:function(t,e,i){this.trigger("update",t,e,i),this.trigger("external",t,e)},_removeEvent:function(t,e){this.trigger("remove",t,e),this.trigger("external",t)},insert:function(t){var e=this._insert(t);return e&&this._insertEvent(e,!0),e},remove:function(t){var e=this._remove(t);return e&&this._removeEvent(e,!0),e},get:function(t){return this._get(t)},update:function(t,e){var i=this._update(t,e);return i&&this._updateEvent(i,e,!0),i},query:function(t,e){return this._query(t,e)},_query_applies_to_id:function(t,e){var i=this.get(e);return i&&BetaJS.Queries.evaluate(t,i)},clear:function(){for(var t=this.query({});t.hasNext();)this.remove(t.next().id)}}]),BetaJS.Stores.DumbStore=BetaJS.Stores.BaseStore.extend("DumbStore",{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},_insert:function(t){var e=this._read_last_id(),i=1;return null!=e?(i=e+1,this._write_next_id(e,i),this._write_prev_id(i,e)):this._write_first_id(i),t.id=i,this._write_last_id(i),this._write_item(i,t),t},_remove:function(t){var e=this._read_item(t);if(e){this._remove_item(t);var i=this._read_next_id(t),n=this._read_prev_id(t);null!=i?(this._remove_next_id(t),null!=n?(this._remove_prev_id(t),this._write_next_id(n,i),this._write_prev_id(i,n)):(this._remove_prev_id(i),this._write_first_id(i))):null!=n?(this._remove_next_id(n),this._write_last_id(n)):(this._remove_first_id(),this._remove_last_id())}return e},_get:function(t){return this._read_item(t)},_update:function(t,e){var i=this._get(t);return i&&(delete e.id,BetaJS.Objs.extend(i,e),this._write_item(t,i)),i},_query:function(t){var e=new BetaJS.Iterators.Iterator,i=this,n=this._read_first_id();return BetaJS.Objs.extend(e,{__id:null==n?1:n,__store:i,__query:t,hasNext:function(){var e=this.__store._read_last_id();if(null==e)return!1;for(;e>this.__id&&!this.__store._read_item(this.__id);)this.__id++;for(;e>=this.__id;){if(this.__store._query_applies_to_id(t,this.__id))return!0;e>this.__id?this.__id=this.__store._read_next_id(this.__id):this.__id++}return!1},next:function(){if(this.hasNext()){var t=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),t}return null}}),e}}),BetaJS.Stores.AssocStore=BetaJS.Stores.DumbStore.extend("AssocStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(t){var e=this._read_key(t);return e?parseInt(e):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(t){this._write_key("last_id",t)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(t){this._write_key("first_id",t)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(t){return this._read_key("item_"+t)},_write_item:function(t,e){this._write_key("item_"+t,e)},_remove_item:function(t){this._remove_key("item_"+t)},_read_next_id:function(t){return this.__read_id("next_"+t)},_write_next_id:function(t,e){this._write_key("next_"+t,e)},_remove_next_id:function(t){this._remove_key("next_"+t)},_read_prev_id:function(t){return this.__read_id("prev_"+t)},_write_prev_id:function(t,e){this._write_key("prev_"+t,e)},_remove_prev_id:function(t){this._remove_key("prev_"+t)}}),BetaJS.Stores.LocalStore=BetaJS.Stores.AssocStore.extend("LocalStore",{constructor:function(t){this._inherited(BetaJS.Stores.LocalStore,"constructor"),this.__prefix=t},__key:function(t){return this.__prefix+t},_read_key:function(t){var e=this.__key(t);return e in localStorage?JSON.parse(localStorage[e]):null},_write_key:function(t,e){localStorage[this.__key(t)]=JSON.stringify(e)},_remove_key:function(t){delete localStorage[this.__key(t)]}}),BetaJS.Stores.MemoryStore=BetaJS.Stores.AssocStore.extend("MemoryStore",{_read_key:function(t){return this[t]},_write_key:function(t,e){this[t]=e},_remove_key:function(t){delete this[t]}}),BetaJS.Stores.CachedStore=BetaJS.Stores.BaseStore.extend("CachedStore",{constructor:function(t){this._inherited(BetaJS.Stores.CachedStore,"constructor"),this.__parent=t,this.__cache=[]},_insert:function(t){var e=this.__parent._insert(t);return e&&(this.__cache[e.id]={data:e,exists:!0}),e},_remove:function(t){return t in this._cache||(this.__cache[t]={}),this.__cache[t].exists=!1,this.__parent._remove(t)},_get:function(t){if(t in this.__cache)return this.__cache[t].exists;var e=this.__parent.get(t);return this.__cache[t]=e?{exists:!0,data:e}:{exists:!1},e},_update:function(t,e){var i=this.__parent.update(t,e);return i&&(this.__cache[t]={exists:!0,data:e}),i},invalidate:function(t){delete this.__cache[t]},_query:function(t,e){return this.__parent.query(t,e)}}),BetaJS.Stores.RemoteStore=BetaJS.Stores.BaseStore.extend("RemoteStore",{constructor:function(t){this._inherited(BetaJS.Stores.RemoteStore,"constructor"),this.__uri=t},_insert:function(t){var e=null;return $.ajax({type:"POST",async:!1,url:this.__uri,data:JSON.stringify(t),success:function(t){e=t}}),e},_remove:function(t){var e=null;return $.ajax({type:"DELETE",async:!1,url:this.__uri+"/"+t,success:function(i){e=i?i:{id:t}}}),e},_get:function(t){var e=null;return $.ajax({type:"GET",async:!1,url:this.__uri+"/"+t,data:JSON.stringify(data),success:function(t){e=t}}),e},_update:function(t,e){var i=null;return $.ajax({type:"PUT",async:!1,url:this.__uri+"/"+t,data:JSON.stringify(e),success:function(t){i=t}}),i},_query:function(t){var e=null;return $.ajax({type:"GET",async:!1,url:this.__uri,success:function(t){e=t}}),null==e?BetaJS.Iterators.ArrayIterator([]):new BetaJS.Iterators.FilteredIterator(new BetaJS.Iterators.ArrayIterator(e),function(e){return BetaJS.Queries.evaluate(t,e)})}}),BetaJS.Templates={tokenize:function(t){if(BetaJS.Types.is_array(t))return t;var e=[],i=0;return t.replace(BetaJS.Templates.SYNTAX_REGEX(),function(n,s,r,_,a){return a>i&&e.push({type:BetaJS.Templates.TOKEN_STRING,data:BetaJS.Strings.js_escape(t.slice(i,a))}),_&&e.push({type:BetaJS.Templates.TOKEN_CODE,data:_}),s&&e.push({type:BetaJS.Templates.TOKEN_EXPR,data:s}),r&&e.push({type:BetaJS.Templates.TOKEN_ESC,data:r}),i=a+n.length,n}),e},compile:function(t,e){BetaJS.Types.is_string(t)&&(t=this.tokenize(t)),e=e||{};for(var i=e.start_index||0,n=e.end_index||t.length,s="__p+='",r=i;n>r;++r)switch(t[r].type){case BetaJS.Templates.TOKEN_STRING:s+=t[r].data;break;case BetaJS.Templates.TOKEN_CODE:s+="';\n"+t[r].data+"\n__p+='";break;case BetaJS.Templates.TOKEN_EXPR:s+="'+\n((__t=("+t[r].data+"))==null?'':__t)+\n'";break;case BetaJS.Templates.TOKEN_ESC:s+="'+\n((__t=("+t[r].data+"))==null?'':BetaJS.Strings.htmlentities(__t))+\n'"}s+="';\n",s="with(obj||{}){\n"+s+"}\n",s="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";var _=Function("obj",s),a=function(t){return _.call(this,t)};return a.source="function(obj){\n"+s+"}",a}},BetaJS.Templates.SYNTAX={OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},BetaJS.Templates.SYNTAX_REGEX=function(){var t=BetaJS.Templates.SYNTAX;return BetaJS.Templates.SYNTAX_REGEX_CACHED||(BetaJS.Templates.SYNTAX_REGEX_CACHED=RegExp(t.OPEN+t.MODIFIER_EXPR+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_ESC+"([\\s\\S]+?)"+t.CLOSE+"|"+t.OPEN+t.MODIFIER_CODE+"([\\s\\S]+?)"+t.CLOSE+"|"+"$","g")),BetaJS.Templates.SYNTAX_REGEX_CACHED},BetaJS.Templates.TOKEN_STRING=1,BetaJS.Templates.TOKEN_CODE=2,BetaJS.Templates.TOKEN_EXPR=3,BetaJS.Templates.TOKEN_ESC=4,BetaJS.Templates=BetaJS.Templates||{},BetaJS.Templates.Template=BetaJS.Class.extend("Template",{constructor:function(t){this._inherited(BetaJS.Templates.Template,"constructor"),this.__tokens=BetaJS.Templates.tokenize(t),this.__compiled=BetaJS.Templates.compile(this.__tokens)},evaluate:function(t){return this.__compiled.apply(this,[t])}},{bySelector:function(t){return new this($(t).html())}}),BetaJS.Views=BetaJS.Views||{},BetaJS.Views.View=BetaJS.Class.extend("View",[BetaJS.Events.EventsMixin,BetaJS.Events.ListenMixin,BetaJS.Ids.ClientIdMixin,BetaJS.Properties.BindablePropertiesMixin,{_templates:function(){return{}},_dynamics:function(){return{}},_events:function(){return[]},_css:function(){return{}},css:function(t){if(this.__css[t])return this.__css[t];if(this.__parent){var e=this.__parent.css(t);if(e)return e}var e=this._css();return e[t]?e[t]:null},_render:function(){this.__render_string?this.$el.html(this.__render_string):this.__templates["default"]?this.$el.html(this.evaluateTemplate("default",{})):this.__dynamics["default"]&&this.evaluateDynamics("default",this.$el,{},{name:"default"})},templates:function(t){return t in this.__templates?this.__templates[t]:null},dynamics:function(t){return t in this.__dynamics?this.__dynamics[t]:null},_supp:function(){return{__context:this,css:function(t){return this.__context.css(t)},attrs:function(t){var e="";for(var i in t)e+=(null==t[i]?i:i+"='"+t[i]+"'")+" ";return e},styles:function(t){var e="";for(var i in t)e+=i+":"+t[i]+";";return e},selector:function(t){return"data-selector='"+t+"' "}}},templateArguments:function(){var t=this.getAll();return t.supp=this._supp(),t},evaluateTemplate:function(t,e){return e=e||{},this.__templates[t].evaluate(BetaJS.Objs.extend(e,this.templateArguments()))},evaluateDynamics:function(t,e,i,n){return this.__dynamics[t].renderInstance(e,BetaJS.Objs.extend(n||{},{args:i||{}}))},_setOption:function(t,e,i,n){var n=n?n:"__";this[n+e]=e in t?t[e]:i},_setOptionProperty:function(t,e,i){this.set(e,e in t?t[e]:i)},constructor:function(t){this._inherited(BetaJS.Views.View,"constructor"),this._setOption(t,"el",null),this._setOption(t,"visible",!0),this._setOption(t,"render_string",null),this._setOption(t,"events",[]),this._setOption(t,"attributes",{}),this.__old_attributes={},this._setOption(t,"el_classes",[]),this.__added_el_classes=[],this._setOption(t,"el_styles",{}),this._setOption(t,"children_styles",{}),this._setOption(t,"invalidate_on_change",!1),this.__old_el_styles={},this._setOption(t,"css",{}),this.__parent=null,this.__children={},this.__active=!1,this.$el=null,this.__events=this._events().concat(this.__events);var e=BetaJS.Objs.extend(BetaJS.Types.is_function(this._templates)?this._templates():this._templates,t.templates||{});"template"in t&&(e["default"]=t.template),this.__templates={};for(var i in e)this.__templates[i]=new BetaJS.Templates.Template(BetaJS.Types.is_string(e[i])?e[i]:e[i].html());var n=BetaJS.Objs.extend(BetaJS.Types.is_function(this._dynamics)?this._dynamics():this._dynamics,t.dynamics||{});"dynamic"in t&&(n["default"]=t.dynamic),this.__dynamics={};for(var i in n)this.__dynamics[i]=new BetaJS.Views.DynamicTemplate(this,BetaJS.Types.is_string(n[i])?n[i]:n[i].html());this.setAll(t.properties||{}),this.__invalidate_on_change&&this.on("change",function(){this.invalidate()},this)},isActive:function(){return this.__active},activate:function(){if(this.isActive())return!0;if(!this.__el)return!1;if(this.__parent&&!this.__parent.isActive())return!1;if(this.$el=this.__parent?this.__parent.$(this.__el):$(this.__el),0==this.$el.size()&&(this.$el=null),!this.$el)return!1;this.__old_attributes={};for(var t in this.__attributes){var e=this.$el.attr(t);this.__old_attributes[t]=BetaJS.Types.is_defined(e)?e:null,this.$el.attr(t,this.__attributes[t])}this.__added_el_classes=[];for(var i;this.__el_classes>i;++i)this.$el.hasClass(this.__el_classes[i])||(this.$el.addClass(this.__el_classes[i]),this.__added_el_classes.push(this.__el_classes[i]));this.__old_el_styles={};var n=BetaJS.Objs.extend(this._el_styles(),this.__el_styles);for(var t in n){var e=this.$el.css(t);this.__old_el_styles[t]=BetaJS.Types.is_defined(e)?e:null,this.$el.css(t,n[t])}return this.__bind(),this.$el.css("display",this.__visible?"":"none"),this.__active=!0,this.__render(),BetaJS.Objs.iter(this.__children,function(t){t.activate()}),!0},deactivate:function(){if(!this.isActive())return!1;BetaJS.Objs.iter(this.__children,function(t){t.deactivate()}),this.__active=!1,BetaJS.Objs.iter(this.__dynamics,function(t){t.reset()},this),this.__unbind(),this.$el.html("");for(var t in this.__old_attributes)this.$el.attr(t,this.__old_attributes[t]);for(var e;this.__added_el_classes>e;++e)this.$el.removeClass(this.__added_el_classes[e]);for(var t in this.__old_el_styles)this.$el.css(t,this.__old_el_styles[t]);return this.$el=null,!0},_el_styles:function(){return{}},$:function(t){return this.$el.find(t)},$data:function(t,e){e||(e=this.$el);var i="";for(var n in t)i+="[data-"+n+"='"+t[n]+"']";return e.find(i)},destroy:function(){this.deactivate(),BetaJS.Objs.iter(this.__children,function(t){t.destroy()}),BetaJS.Objs.iter(this.__dynamics,function(t){t.destroy()},this),BetaJS.Objs.iter(this.__templates,function(t){t.destroy()},this),this._inherited(BetaJS.Views.View,"destroy")},show:function(){this.setVisibility(!0)},hide:function(){this.setVisibility(!1)},setVisibility:function(t){t!=this.__visible&&(this.__visible=t,this.isActive()&&this.$el.css("display",this.__visible?"":"none"))},__bind:function(){var t=this;this.__unbind(),BetaJS.Objs.iter(this.__events,function(e){BetaJS.Objs.iter(e,function(e,i){var n=t[e],s=i.match(BetaJS.Views.BIND_EVENT_SPLITTER),r=s[1],_=s[2];r=r+".events"+t.cid();var a=BetaJS.Functions.as_method(n,t);""===_?t.$el.on(r,a):t.$el.on(r,_,a)})})},__unbind:function(){this.$el.off(".events"+this.cid())},__render:function(){if(this.isActive()&&(this._render(),!BetaJS.Types.is_empty(this.__children_styles)))for(var t in this.__children_styles)this.$el.children().css(t,this.__children_styles[t])
},invalidate:function(){this.isActive()&&(BetaJS.Objs.iter(this.__children,function(t){t.deactivate()}),BetaJS.Objs.iter(this.__dynamics,function(t){t.reset()},this),this.__render(),BetaJS.Objs.iter(this.__children,function(t){t.activate()}))},setEl:function(t){this.isActive()?(this.deactivate(),this.__el=t,this.activate()):this.__el=t},getParent:function(){return this.__parent},hasChild:function(t){return t&&t.cid()in this.__children},setParent:function(t){if(t!=this.__parent){if(this.deactivate(),this.__parent){var e=this.__parent;this.__parent=null,e.removeChild(this)}t&&(this.__parent=t,t.addChild(this),t.isActive()&&this.activate())}},children:function(){return BetaJS.Objs.values(this.__children)},addChildren:function(t){BetaJS.Objs.iter(t,function(t){this.addChild(t)},this)},addChild:function(t){return this.hasChild(t)?null:(this.__children[t.cid()]=t,this._notify("addChild",t),t.setParent(this),t)},removeChildren:function(t){BetaJS.Objs.iter(t,function(t){this.removeChild(t)},this)},removeChild:function(t){this.hasChild(t)&&(delete this.__children[t.cid()],t.setParent(null),this._notify("removeChild",t))},width:function(){return this.$el.width()},innerWidth:function(){return this.$el.innerWidth()},outerWidth:function(){return this.$el.outerWidth()},height:function(){return this.$el.height()},innerHeight:function(){return this.$el.innerHeight()},outerHeight:function(){return this.$el.outerHeight()}}]),BetaJS.Views.BIND_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,BetaJS.Views.DynamicTemplate=BetaJS.Class.extend("DynamicTemplate",{constructor:function(t,e){this._inherited(BetaJS.Views.DynamicTemplate,"constructor"),this.__parent=t,this.__template=new BetaJS.Templates.Template(e),this.__instances={},this.__instances_by_name={}},reset:function(){BetaJS.Objs.iter(this.__instances,function(t){this.removeInstance(t)},this)},destroy:function(){this.reset(),this._inherited(BetaJS.Views.DynamicTemplate,"destroy")},renderInstance:function(t,e){e=e||{},e.name&&this.removeInstanceByName(e.name);var i=new BetaJS.Views.DynamicTemplateInstance(this,t,e);this.__instances[i.cid()]=i,e.name&&(this.__instances_by_name[name]=i)},removeInstanceByName:function(t){t in this.__instances_by_name&&this.removeInstance(this.__instances_by_name[t])},removeInstance:function(t){delete this.__instances[t.cid()],delete this.__instances_by_name[t.name()],t.destroy()},view:function(){return this.__parent},template:function(){return this.__template}}),BetaJS.Views.DynamicTemplateInstance=BetaJS.Class.extend("DynamicTemplateInstance",[BetaJS.Ids.ClientIdMixin,BetaJS.Events.ListenMixin,{__bind:{attr:function(t,e){return this.__context.__bind_attribute(t,e)},attrs:function(t){var e="";for(attribute in t)e+=this.attr(attribute,t[attribute])+" ";return e},value:function(t){return this.__context.__bind_value(t)},inner:function(t){return this.__context.__bind_inner(t)}},__new_element:function(t){var e=BetaJS.Ids.uniqueId();return this.__elements[e]=BetaJS.Objs.extend({id:e,$el:null},t),this.__elements[e]},__decompose_variable:function(t){var e=t.split(".");return{object:1==e.length?this.__parent.view():this.__args[e[0]],key:1==e.length?t:e[1]}},__get_variable:function(t){var e=this.__decompose_variable(t);return e.object.get(e.key)},__set_variable:function(t,e){var i=this.__decompose_variable(t);return i.object.set(i.key,e)},__update_element:function(t){var e=this.__get_variable(t.variable);"inner"==t.type?t.$el.html(e):"value"==t.type?t.$el.val(e):"attribute"==t.type&&t.$el.attr(t.attribute,e)},__prepare_element:function(t){var e=this;t.$el=this.$el.find(t.selector),"inner"==t.type?this.__update_element(t):"value"==t.type&&t.$el.on("change input keyup paste",function(){e.__set_variable(t.variable,t.$el.val())})},__bind_attribute:function(t,e){var i=this.__new_element({type:"attribute",attribute:t,variable:e}),n="data-bind-"+t+"='"+i.id+"'";i.selector="["+n+"]";var s=this.__decompose_variable(e);return this.listenOn(s.object,"change:"+s.key,function(){this.__update_element(i)},this),n+" "+t+"='"+s.object.get(s.key)+"'"},__bind_value:function(t){var e=this.__new_element({type:"value",variable:t}),i="data-bind-value='"+e.id+"'";e.selector="["+i+"]";var n=this.__decompose_variable(t);return this.listenOn(n.object,"change:"+n.key,function(){this.__update_element(e)},this),i+" value='"+n.object.get(n.key)+"'"},__bind_inner:function(t){var e=this.__new_element({type:"inner",variable:t}),i="data-bind-inner='"+e.id+"'";e.selector="["+i+"]";var n=this.__decompose_variable(t);return this.listenOn(n.object,"change:"+n.key,function(){this.__update_element(e)},this),i},constructor:function(t,e,i){this._inherited(BetaJS.Views.DynamicTemplateInstance,"constructor"),this.__elements={},this.__inners={},i=i||{},i.name&&(this.__name=name),this.__parent=t,this.$el=e,this.__args=BetaJS.Objs.extend(i.args||{},this.__parent.view().templateArguments()),this.__args.bind=BetaJS.Objs.extend({__context:this},this.__bind),this.$el.html(t.template().evaluate(this.__args)),BetaJS.Objs.iter(this.__elements,function(t){this.__prepare_element(t)},this)},destroy:function(){BetaJS.Objs.iter(this.__elements,function(t){t.$el.off()},this),this._inherited(BetaJS.Views.DynamicTemplateInstance,"destroy")},name:function(){return this.__name}}]),BetaJS.Routers=BetaJS.Routers||{},BetaJS.Routers.Router=BetaJS.Class.extend("Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(t){this._inherited(BetaJS.Routers.Router,"constructor");var e=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(e)||(e=[e]),"routes"in t&&(BetaJS.Types.is_array(t.routes)?e=e.concat(t.routes):e.push(t.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(e,function(t){BetaJS.Objs.iter(t,function(t,e){BetaJS.Types.is_string(t)&&(t={action:t}),t.key=e,t.route=RegExp("^"+e+"$"),"applicable"in t?BetaJS.Types.is_array(t.applicable)||(t.applicable=[t.applicable]):t.applicable=[],"valid"in t?BetaJS.Types.is_array(t.valid)||(t.valid=[t.valid]):t.valid=[],"path"in t||(t.path=t.key),this.__routes.push(t),this.__paths[t.path]=t},this)},this),"actions"in t&&BetaJS.Objs.iter(t.actions,function(t,e){this[e]=t},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Routers.Router,"destroy")},parse:function(t){for(var e=0;this.__routes.length>e;++e){var i=this.__routes[e],n=i.route.exec(t);if(null!=n){n.shift(1);var s=!0;if(BetaJS.Objs.iter(i.applicable,function(t){var e=BetaJS.Types.is_string(t)?this[t]:t;s=s&&e.apply(this,n)},this),!s)continue;var r=!0;return BetaJS.Objs.iter(i.valid,function(t){var e=BetaJS.Types.is_string(t)?this[t]:t;r=r&&e.apply(this,n)},this),r?{object:i,params:n}:null}}return null},object:function(t){return this.__paths[t]},path:function(t){for(var e=this.object(t).key,i=Array.prototype.slice.apply(arguments,[1]),n=/\(.*?\)/;arg=i.shift();)e=e.replace(n,arg);return e},navigate:function(t){this.trigger("navigate",t);var e=this.parse(t);return null==e?(this.trigger("navigate-fail",t),!1):(this.trigger("navigate-success",e.object,e.params),this.invoke(e.object,e.params,t))},invoke:function(t,e,i){i=i||this.path(t.key,e),this.trigger("before_invoke",t,e,i),this.__enter(t,e,i);var n=this._invoke(t,e);return this.trigger("after_invoke",t,e,i),n},_invoke:function(t,e){var i=t.action;return BetaJS.Types.is_string(i)&&(i=this[i]),i.apply(this,e)},__leave:function(){null!=this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(t,e,i){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=i,this.__current.object=t,this.__current.params=e,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Routers.RouterHistory=BetaJS.Class.extend("RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Routers.RouterHistory,"constructor"),this.__router=t,this.__history=[],t.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouterHistory,"destroy")},__after_invoke:function(t,e){this.__history.push({object:t,params:e}),this.trigger("change")},last:function(t){return t=t||0,this.get(this.count()-1-t)},count:function(){return this.__history.length},get:function(t){return t=t||0,this.__history[t]},getRoute:function(t){var e=this.get(t);return this.__router.path(e.object.path,e.params)},back:function(t){if(!(2>this.count())){for(t=t||0;t>=0&&this.count()>1;)this.__history.pop(),--t;var e=this.__history.pop();return this.trigger("change"),this.__router.invoke(e.object,e.params)}}}]),BetaJS.Routers.RouteBinder=BetaJS.Class.extend("RouteBinder",{constructor:function(t){this._inherited(BetaJS.Routers.RouteBinder,"constructor"),this.__router=t,this.__router.on("after_invoke",function(t,e,i){this._getExternalRoute()!=i&&this._setExternalRoute(i)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Routers.RouteBinder,"destroy")},_setRoute:function(t){var e=this.__router.current();e&&e.route==t||this.__router.navigate(t)},_getExternalRoute:function(){return""},_setExternalRoute:function(){}}),BetaJS.Routers.HashRouteBinder=BetaJS.Routers.RouteBinder.extend("HashRouteBinder",[BetaJS.Ids.ClientIdMixin,{constructor:function(t){this._inherited(BetaJS.Routers.HashRouteBinder,"constructor",t);var e=this;$(window).on("hashchange.events"+this.cid(),function(){e._setRoute(e._getExternalRoute())})},destroy:function(){$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Routers.HashRouteBinder,"destroy")},_getExternalRoute:function(){var t=window.location.hash;return t.length&&"#"==t[0]?t.slice(1):t},_setExternalRoute:function(t){window.location.hash="#"+t}}]),BetaJS.Templates.Cached=BetaJS.Templates.Cached||{},BetaJS.Templates.Cached["holygrail-view-template"]="  <div data-selector=\"right\" class='holygrail-view-right-container'></div>  <div data-selector=\"left\" class='holygrail-view-left-container'></div>  <div data-selector=\"center\" class='holygrail-view-center-container'></div> ",BetaJS.Templates.Cached["list-container-view-item-template"]='  <div data-view-id="{%= cid %}" class="list-container-item"></div> ',BetaJS.Templates.Cached["icon-button-view-template"]='  <div class="icon-button-view" {%= supp.selector("button") %}>   <div class="icon ui-icon-{%= icon %}"></div>  </div> ',BetaJS.Templates.Cached["button-view-template"]='   <{%= button_container_element %}    class="button-view" {%= bind.inner("label") %}>   </{%= button_container_element %}>  ',BetaJS.Templates.Cached["check-box-view-template"]='  <input type="checkbox" class="check-box-view" {%= checked ? "checked" : "" %} />  {%= label %} ',BetaJS.Templates.Cached["input-view-template"]='  <input class="input-view"         {%= bind.value("value") %}         {%= bind.attr("placeholder", "placeholder") %}  /> ',BetaJS.Templates.Cached["label-view-template"]='  <label class="label-view" {%= bind.inner("label") %}></label> ',BetaJS.Templates.Cached["text-area-template"]='   <textarea class="text-area-view" {%= bind.value("value") %} {%= bind.attr("placeholder", "placeholder") %}></textarea>  ',BetaJS.Templates.Cached["list-view-template"]='   <{%= list_container_element %}    {%= supp.attrs(list_container_attrs) %}    {%= supp.css("list-view-function")%}    {%= supp.css("list-view-layout")%}    {%= supp.css("list-view-styling")%}    data-selector="list">   </{%= list_container_element %}>  ',BetaJS.Templates.Cached["list-view-item-container-template"]="   <{%= item_container_element %}    {%= supp.attrs(item_container_attrs) %}    {%= supp.list_item_attr(item) %}>   </{%= item_container_element %}>  ",BetaJS.Views.HolygrailView=BetaJS.Views.View.extend("HolygrailView",{_templates:{"default":BetaJS.Templates.Cached["holygrail-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.HolygrailView,"constructor",t),this.__left=null,this.__center=null,this.__right=null},getLeft:function(){return this.__left},setLeft:function(t){this.__setView("left",t)},getCenter:function(){return this.__center},setCenter:function(t){this.__setView("center",t)},getRight:function(){return this.__right},setRight:function(t){this.__setView("right",t)},__setView:function(t,e){this.removeChild(this["__"+t]),this["__"+t]=null,e&&(e.setEl('[data-selector="'+t+'"]'),this["__"+t]=this.addChild(e))}}),BetaJS.Views.ListContainerView=BetaJS.Views.View.extend("ListContainerView",{_templates:{item:BetaJS.Templates.Cached["list-container-view-item-template"]},_notifications:{addChild:"__addChildContainer",removeChild:"__removeChildContainer"},_render:function(){this.$el.html(""),BetaJS.Objs.iter(this.children(),function(t){this.__addChildContainer(t)},this)},__addChildContainer:function(t){this.isActive()&&this.$el.append(this.evaluateTemplate("item",{cid:t.cid()})),t.setEl("[data-view-id='"+t.cid()+"']")},__removeChildContainer:function(t){this.$data({"view-id":t.cid()}).remove()}}),BetaJS.Views.ButtonView=BetaJS.Views.View.extend("ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["button-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.ButtonView,"constructor",t),this._setOptionProperty(t,"label",""),this._setOptionProperty(t,"button_container_element","button")},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click button":"__clickButton"}])},__clickButton:function(){this.trigger("clicked")}}),BetaJS.Views.IconButtonView=BetaJS.Views.View.extend("ButtonView",{_dynamics:{"default":BetaJS.Templates.Cached["icon-button-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.ButtonView,"constructor",t),this._setOptionProperty(t,"label",""),this._setOptionProperty(t,"icon","question"),this._setOptionProperty(t,"button_container_element","div"),this._setOptionProperty(t,"button_container_element","div"),this._setOption(t,"size",null),this._setOption(t,"width",this.__size),this._setOption(t,"heigth",this.__size)},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click [data-selector='button']":"__clickButton"}])},__clickButton:function(){this.trigger("clicked")},_el_styles:function(){var t={};return this.__width&&(t.width=this.__width+"px"),t}}),BetaJS.Views.InputView=BetaJS.Views.View.extend("InputView",{_dynamics:{"default":BetaJS.Templates.Cached["input-view-template"]},_events:function(){return[{"keyup input":"__keyupEvent"}]},constructor:function(t){this._inherited(BetaJS.Views.InputView,"constructor",t),this._setOptionProperty(t,"value",""),this._setOptionProperty(t,"placeholder","")},__keyupEvent:function(t){var e=t.keyCode||t.which;13==e&&this.trigger("enter_key")}}),BetaJS.Views.CheckBoxView=BetaJS.Views.View.extend("CheckBoxView",{_templates:{"default":BetaJS.Templates.Cached["check-box-view-template"]},_events:function(){return this._inherited(BetaJS.Views.ButtonView,"_events").concat([{"click input":"__click"}])},constructor:function(t){t=t||{},t.invalidate_on_change=!0,this._inherited(BetaJS.Views.CheckBoxView,"constructor",t),this._setOptionProperty(t,"checked",!1),this._setOptionProperty(t,"label","")},__click:function(){this.set("checked",this.$("input").is(":checked")),this.trigger("check",this.get("checked"))}}),BetaJS.Views.LabelView=BetaJS.Views.View.extend("LabelView",{_dynamics:{"default":BetaJS.Templates.Cached["label-view-template"]},constructor:function(t){this._inherited(BetaJS.Views.LabelView,"constructor",t),this._setOptionProperty(t,"label","")}}),BetaJS.Views.TextAreaView=BetaJS.Views.View.extend("TextAreaView",{_dynamics:{"default":BetaJS.Templates.Cached["text-area-template"]},constructor:function(t){this._inherited(BetaJS.Views.TextAreaView,"constructor",t),this._setOptionProperty(t,"value",""),this._setOptionProperty(t,"placeholder","")}}),BetaJS.Views.CustomListView=BetaJS.Views.View.extend("CustomListView",{_templates:function(){return{"default":BetaJS.Templates.Cached["list-view-template"],"item-container":BetaJS.Templates.Cached["list-view-item-container-template"]}},_supp:function(){return BetaJS.Objs.extend(this._inherited(BetaJS.Views.CustomListView,"_supp"),{list_item_attr:function(t){return this.attrs({"data-view-id":this.__context.cid(),"data-cid":BetaJS.Ids.objectId(t),"data-index":this.__context.__collection.getIndex(t)})}})},constructor:function(t){if(this._inherited(BetaJS.Views.CustomListView,"constructor",t),this._setOption(t,"list_container_element","ul"),this._setOption(t,"list_container_attrs",{}),this._setOption(t,"item_container_element","li"),this._setOption(t,"item_container_attrs",{}),this.__itemData={},"collection"in t)this.__collection=t.collection,this.__destroy_collection=!1;else{var e={};"objects"in t&&(e.objects=t.objects),"compare"in t&&(e.compare=t.compare),this.__collection=new BetaJS.Collections.Collection(e),this.__destroy_collection=!0}this.__collection.on("add",function(t){this.__addItem(t,!0)},this),this.__collection.on("remove",function(t){this.__removeItem(t)},this),this.__collection.on("change",function(t){this.__changeItem(t)},this),this.__collection.on("index",function(t,e){this.__updateItemIndex(t,e)},this),this.__collection.on("reindexed",function(t){this.__reIndexItem(t)},this),this.__collection.on("sorted",function(){this.__sorted()},this)},destroy:function(){for(var t in this.__itemData)this._destroyItemData(this.__itemData[t]);this.__itemData=null,this.__collection.off(null,null,this),this.__destroy_collection&&this.__collection.destroy(),this._inherited(BetaJS.Views.CustomListView,"destroy")},getCollection:function(){return this.__collection},add:function(t){this.__collection.add(t)},remove:function(t){this.__collection.remove(t)},_render:function(){this.$selector_list=this._renderListContainer();var t=this;this.__collection.iterate(function(e){t.__addItem(e,!1)})},_renderListContainer:function(){return this.$el.html(this.evaluateTemplate("default",{list_container_element:this.__list_container_element,list_container_attrs:this.__list_container_attrs})),this.$data({selector:"list"})},_findItemElement:function(t){return this.$data({"view-id":this.cid(),cid:BetaJS.Ids.objectId(t)},this.$selector_list)},_findIndexElement:function(t){return this.$data({"view-id":this.cid(),index:t},this.$selector_list)},__changeItem:function(t){this.isActive()&&this._changeItem(t)},_newItemData:function(){return{}},_destroyItemData:function(){},itemData:function(t){return this.__itemData[BetaJS.Ids.objectId(t)]},_changeItem:function(){},__addItem:function(t,e){if(this.isActive()){var i=this.evaluateTemplate("item-container",{item:t,item_container_element:this.__item_container_element,item_container_attrs:this.__item_container_attrs}),n=this.__collection.getIndex(t);if(0==n)this.$selector_list.prepend(i);else{var s=this._findIndexElement(n-1);if(s.length>0)s.after(i);else{var r=this._findIndexElement(n+1);r.length>0?r.before(i):this.$selector_list.append(i)}}var _=this._findItemElement(t);this.__itemData[BetaJS.Ids.objectId(t)]=this._newItemData(t),this._addItem(t,_,e),this._addElement(_,e)}},_addElement:function(){},_addItem:function(){},__removeItem:function(t){if(this.isActive()){var e=this._findItemElement(t);this._removeItem(t,e),this._destroyItemData(this.__itemData[BetaJS.Ids.objectId(t)]),delete this.__itemData[BetaJS.Ids.objectId(t)],this._removeElement(e)}},_removeElement:function(t){t.remove()},_removeItem:function(){},__updateItemIndex:function(t,e){var i=this._findItemElement(t);i.attr("data-index",e),this._updateItemIndex(t,i)},__reIndexItem:function(t){var e=this._findItemElement(t),i=this.getCollection().getIndex(t);if(0==i)this.$selector_list.prepend(e);else{var n=this._findIndexElement(i-1);n.after(e)}},_updateItemIndex:function(){},__sort:function(){for(var t=this.getCollection().count()-1;t>=0;t--)this.$selector_list.prepend(this._findIndexElement(t))}}),BetaJS.Views.ListView=BetaJS.Views.CustomListView.extend("ListView",{constructor:function(t){this._inherited(BetaJS.Views.ListView,"constructor",t),this._setOption(t,"item_label","label"),this._setOption(t,"render_item_on_change",null==this.dynamics("item"))},_changeItem:function(t){if(this.__render_item_on_change){var e=this._findItemElement(t);this._renderItem(t,e,!1)}},_addItem:function(t,e,i){this._renderItem(t,e,i)},_renderItem:function(t,e){null!=this.templates("item")?e.html(this.evaluateTemplate("item",{item:t})):null!=this.dynamics("item")?this.evaluateDynamics("item",e,{item:t},{name:"item-"+BetaJS.Ids.objectId(t)}):e.html(t.get(this.__item_label))},_removeItem:function(t){null!=this.dynamics("item")&&this.dynamics("item").removeInstanceByName("item-"+BetaJS.Ids.objectId(t))}}),BetaJS.Views.SubViewListView=BetaJS.Views.CustomListView.extend("SubViewListView",{constructor:function(t){this._inherited(BetaJS.Views.SubViewListView,"constructor",t),"create_view"in t&&(this._create_view=t.create_view),this._setOption(t,"sub_view",BetaJS.Views.LabelView),this._setOption(t,"item_label","label");var e=this;this._setOption(t,"sub_view_options",function(t){return{label:t.binding(e.__item_label)}})},_create_view:function(t,e){var i=this.__sub_view_options(t);return i.el=e,new this.__sub_view(i)},_addItem:function(t,e){var i=this._create_view(t,e);this.itemData(t).view=i,this.addChild(i)},_destroyItemData:function(t){this.removeChild(t.view),t.view.destroy()}});