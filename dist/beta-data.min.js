/*! betajs - v0.0.1 - 2013-08-08, Copyright (c) Oliver Friedmann & Victor Lingenthal, MIT Software License. */BetaJS.Net={},BetaJS.Net.AbstractAjax=BetaJS.Class.extend("AbstractAjax",{constructor:function(t){this._inherited(BetaJS.Net.AbstractAjax,"constructor"),this.__options=BetaJS.Objs.extend({method:"GET",data:{}},t)},syncCall:function(t){var e=BetaJS.Objs.clone(this.__options,1);e=BetaJS.Objs.extend(e,t);var i=e.success_callback;delete e.success_callback;var n=e.failure_callback;delete e.failure_callback;var r=e.complete_callback;delete e.complete_callback;try{var s=this._syncCall(e);return i&&i(s),r&&r(),s}catch(_){if(_=BetaJS.Exceptions.ensure(_),_.assert(BetaJS.Net.AjaxException),!n)throw _;n(_.status_code(),_.status_text(),_.data())}},asyncCall:function(t){var e=BetaJS.Objs.clone(this.__options,1);e=BetaJS.Objs.extend(e,t);var i=e.success_callback;delete e.success_callback;var n=e.failure_callback;delete e.failure_callback;var r=e.complete_callback;delete e.complete_callback;try{var s=this._asyncCall(BetaJS.Objs.extend({success:function(t){i&&i(t),r&&r()},failure:function(t,e,i){if(!n)throw new BetaJS.Net.AjaxException(t,e,i);n(t,e,i),r&&r()}},e));return s}catch(_){if(_=BetaJS.Exceptions.ensure(_),_.assert(BetaJS.Net.AjaxException),!n)throw _;n(_.status_code(),_.status_text(),_.data())}},call:function(t){if(!("async"in t))return!1;var e=t.async;return delete t.async,e?this.asyncCall(t):this.syncCall(t)},_syncCall:function(){},_asyncCall:function(){}}),BetaJS.Net.AjaxException=BetaJS.Exceptions.Exception.extend("AjaxException",{constructor:function(t,e,i){this._inherited(BetaJS.Net.AjaxException,"constructor",t+": "+e),this.__status_code=t,this.__status_text=e,this.__data=i},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data}}),BetaJS.Net.JQueryAjax=BetaJS.Net.AbstractAjax.extend("JQueryAjax",{_syncCall:function(t){var e;return BetaJS.$.ajax({type:t.method,async:!1,url:t.uri,data:JSON.stringify(t.data),success:function(t){e=t},error:function(t,e,i){throw new BetaJS.Net.AjaxException(i,e,t)}}),e},_asyncCall:function(t){BetaJS.$.ajax({type:t.method,async:!0,url:t.uri,data:JSON.stringify(t.data),success:function(e){t.success(e)},error:function(e,i,n){t.failure(n,i,e)}})}}),BetaJS.Queries={__increase_dependency:function(t,e){return t in e?e[t]++:e[t]=1,e},__dependencies_queries:function(t,e){return BetaJS.Objs.iter(t,function(t){e=this.__dependencies_query(t,e)},this),e},__dependencies_query:function(t,e){for(key in t)e=this.__dependencies_pair(key,t[key],e);return e},__dependencies_pair:function(t,e,i){return"$or"==t||"$and"==t?this.__dependencies_queries(e,i):this.__increase_dependency(t,i)},dependencies:function(t){return this.__dependencies_query(t,{})},__evaluate_query:function(t,e){for(key in t)if(!this.__evaluate_pair(key,t[key],e))return!1;return!0},__evaluate_pair:function(t,e,i){return"$or"==t?this.__evaluate_or(e,i):"$and"==t?this.__evaluate_and(e,i):this.__evaluate_value(e,i[t])},__evaluate_value:function(t,e){if(BetaJS.Types.is_object(t)){var i=!0;return BetaJS.Objs.iter(t,function(t,n){"$in"==n&&(i=i&&BetaJS.Objs.contains_value(t,e)),"$gt"==n&&(i=i&&e>=t),"$lt"==n&&(i=i&&t>=e),"$sw"==n&&(i=i&&0==e.indexOf(t))},this),i}return t==e},__evaluate_or:function(t,e){return BetaJS.Objs.iter(t,function(t){return this.__evaluate_query(t,e)?!0:void 0},this),!1},__evaluate_and:function(t,e){return BetaJS.Objs.iter(t,function(t){return this.__evaluate_query(t,e)?void 0:!1},this),!0},format:function(t){return BetaJS.Class.is_class_instance(t)?t.format():JSON.stringify(t)},overloaded_evaluate:function(t,e){return BetaJS.Class.is_class_instance(t)?t.evaluate(e):BetaJS.Types.is_function(t)?t(e):this.evaluate(t,e)},evaluate:function(t,e){return this.__evaluate_query(t,e)},emulate:function(t,e,i){var n=e.apply(i||this,{}),r=n;return null==n?r=BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(n)&&(r=BetaJS.Iterators.ArrayIterator(n)),new BetaJS.Iterators.FilteredIterator(r,function(e){return BetaJS.Queries.evaluate(t,e)})}},BetaJS.Queries.Constrained={make:function(t,e){return{query:t,options:e||{}}},format:function(t){var e=t.query;t.query=BetaJS.Queries.format(e);var i=JSON.stringify(t);return t.query=e,i},emulate:function(t,e,i,n,r){var s=t.query,_=t.options,a={},o={};"sort"in _&&"sort"in e&&(o.sort=_.sort),a=s,("query"in e||BetaJS.Types.is_empty(s))&&(a=s,(!("sort"in _)||"sort"in e)&&("skip"in _&&"skip"in e&&(o.skip=_.skip),"limit"in _&&"limit"in e&&(o.limit=_.limit)));var c=[a,o];r&&c.push(r);var u=function(t){var i=t;return null==t?i=new BetaJS.Iterators.ArrayIterator([]):BetaJS.Types.is_array(t)&&(i=new BetaJS.Iterators.ArrayIterator(t)),"query"in e||BetaJS.Types.is_empty(s)||(i=new BetaJS.Iterators.FilteredIterator(i,function(t){return BetaJS.Queries.evaluate(s,t)})),"sort"in _&&!("sort"in o)&&(i=new BetaJS.Iterators.SortedIterator(i,BetaJS.Comparators.byObject(_.sort))),"skip"in _&&!("skip"in o)&&(i=new BetaJS.Iterators.SkipIterator(i,_.skip)),"limit"in _&&!("limit"in o)&&(i=new BetaJS.Iterators.LimitIterator(i,_.limit)),i},h=function(t){if(!r||!r.exception)throw t;r.exception(t)};if(r)i.apply(n||this,[a,o,{success:u,exception:h}]);else try{var d=i.apply(n||this,[a,o]);return u(d)}catch(l){h(l)}}},BetaJS.Collections.QueryCollection=BetaJS.Collections.Collection.extend("QueryCollection",{constructor:function(t){this._inherited(BetaJS.Collections.QueryCollection,"constructor",t),this.__query=BetaJS.Objs.extend({func:null,select:{},skip:0,limit:null,forward_steps:null,backward_steps:null,range:null,count:null,sort:{}},t.query),"objects"in t||(t.objects=this.__execute_query(this.__query.skip,this.__query.limit,!0))},__execute_query:function(t,e,i){t=Math.max(t,0);var n={};if(null==this.__query.sort||BetaJS.Types.is_empty(this.__query.sort)||(n.sort=this.__query.sort),i){t>0&&(n.skip=t),null!=e&&(n.limit=e);var r=this.__query.func(this.__query.select,n),s=r.asArray();this.__query.skip=t,this.__query.limit=e,this.__query.count=null==e||e>s.length?t+s.length:null,this.clear(),this.add_objects(s)}else if(this.__query.skip>t){e=this.__query.skip-t,t>0&&(n.skip=t),n.limit=e;var r=this.__query.func(this.__query.select,n),s=r.asArray();this.__query.skip=t,this.__query.limit=null==this.__query.limit?null:this.__query.limit+s.length,this.add_objects(s)}else if(t>=this.__query.skip&&null!=this.__query.limit&&(null==e||t+e>this.__query.skip+this.__query.limit)){e=t+e-(this.__query.skip+this.__query.limit),t=this.__query.skip+this.__query.limit,t>0&&(n.skip=t),null!=e&&(n.limit=e);var r=this.__query.func(this.__query.select,n),s=r.asArray();this.__query.limit=this.__query.limit+s.length,e>s.length&&(this.__query.count=t+s.length),this.add_objects(s)}},increase_forwards:function(t){t=null==t?this.__query.forward_steps:t,null!=t&&null!=this.__query.limit&&this.__execute_query(this.__query.skip+this.__query.limit,t,!1)},increase_backwards:function(t){if(t=null==t?this.__query.backward_steps:t,null!=t&&this.__query.skip>0){var t=Math.min(t,this.__query.skip);this.__execute_query(this.__query.skip-t,t,!1)}},paginate:function(t){this.__execute_query(this.__query.range*t,this.__query.range,!0)},paginate_index:function(){return null==this.__query.range?null:Math.floor(this.__query.skip/this.__query.range)},paginate_count:function(){return null==this.__query.count||null==this.__query.range?null:Math.ceil(this.__query.count/this.__query.range)},next:function(){var t=this.paginate_index();if(null!=t){var e=this.paginate_count();(null==e||this.paginate_count()-1>t)&&this.paginate(t+1)}},prev:function(){var t=this.paginate_index();null!=t&&t>0&&this.paginate(t-1)},isComplete:function(){return null!=this.__query.count}}),BetaJS.Queries.ActiveQueryEngine=BetaJS.Class.extend("ActiveQueryEngine",{constructor:function(){this._inherited(BetaJS.Queries.ActiveQueryEngine,"constructor"),this.__aqs={},this.__object_to_aqs={}},__valid_for_aq:function(t,e){return BetaJS.Queries.evaluate(e.query(),t)},insert:function(t){if(!this.__object_to_aqs[BetaJS.Ids.objectId(t)]){var e=t.getAll(),i={};this.__object_to_aqs[BetaJS.Ids.objectId(t)]=i,BetaJS.Objs.iter(this.__aqs,function(n){this.__valid_for_aq(e,n)&&(n._add(t),i[BetaJS.Ids.objectId(n)]=n)},this),t.on("change",function(){this.update(t)},this)}},remove:function(t){BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(t)],function(e){e._remove(t)},this),delete this.__object_to_aqs[BetaJS.Ids.objectId(t)],t.off(null,this,null)},update:function(t){var e=t.getAll(),i=this.__object_to_aqs[BetaJS.Ids.objectId(t)];BetaJS.Objs.iter(this.__object_to_aqs[BetaJS.Ids.objectId(t)],function(n){this.__valid_for_aq(e,n)||(n._remove(t),delete i[BetaJS.Ids.objectId(n)])},this),BetaJS.Objs.iter(this.__aqs,function(n){this.__valid_for_aq(e,n)&&(n._add(t),i[BetaJS.Ids.objectId(n)]=n)},this)},register:function(t){this.__aqs[BetaJS.Ids.objectId(t)]=t;for(var e=t.query(),i=this._query(e);i.hasNext();){var n=i.next();this.__object_to_aqs[BetaJS.Ids.objectId(n)]?(this.__object_to_aqs[BetaJS.Ids.objectId(n)][BetaJS.Ids.objectId(t)]=t,t._add(n)):this.insert(n)}},unregister:function(t){delete this.__aqs[BetaJS.Ids.objectId(t)];var e=this;t.collection().iterate(function(i){delete e.__object_to_aqs[BetaJS.Ids.objectId(i)][BetaJS.Ids.objectId(t)]})},_query:function(){}}),BetaJS.Queries.ActiveQuery=BetaJS.Class.extend("ActiveQuery",{constructor:function(t,e){this._inherited(BetaJS.Queries.ActiveQuery,"constructor"),this.__engine=t,this.__query=e,this.__collection=new BetaJS.Collections.Collection,t.register(this)},destroy:function(){this.__engine.unregister(this),this._inherited(BetaJS.Queries.ActiveQuery,"destroy")},isUniform:function(){return BetaJS.Types.is_empty(this.query())},engine:function(){return this.__engine},query:function(){return this.__query},collection:function(){return this.__collection},_add:function(t){this.__collection.add(t)},_remove:function(t){this.__collection.remove(t)},change_query:function(t){this.__engine.unregister(this),this.__query=t,this.__collection.clear(),this.__engine.register(this)}}),BetaJS.Stores=BetaJS.Stores||{},BetaJS.Stores.StoreException=BetaJS.Exceptions.Exception.extend("StoreException"),BetaJS.Stores.BaseStore=BetaJS.Class.extend("BaseStore",[BetaJS.Events.EventsMixin,{constructor:function(t){this._inherited(BetaJS.Stores.BaseStore,"constructor"),t=t||{},this._id_key=t.id_key||"id",this._create_ids=t.create_ids||!1,this._last_id=1,this._async="async"in t?t.async:!1,this._async=this._async&&this._supports_async()},_supports_async:function(){return!1},_insert:function(){},_remove:function(){},_get:function(){},_update:function(){},_query_capabilities:function(){return{}},_query:function(){},_new_id:function(){},insert:function(t,e){if(this._create_ids&&!(this._id_key in t)){if(this._async)throw new BetaJS.Stores.StoreException("Unsupported Creation of Ids");for(;this.get(this._last_id);)this._last_id++;t[this._id_key]=this._last_id}var i=this,n=function(t){i.trigger("insert",t),e&&e.success&&e.success(t)},r=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async)this._insert(t,{success:n,exception:r});else try{var s=this._insert(t);return n(s),s}catch(_){r(_)}},remove:function(t,e){var i=this,n=function(){i.trigger("remove",t),e&&e.success&&e.success(t)},r=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async)this._remove(t,{success:n,exception:r});else try{this._remove(t),n()}catch(s){r(s)}},get:function(t,e){var i=function(t){e&&e.success&&e.success(t)},n=function(t){if(!e||!e.exception)throw t;e.exception(t)};if(this._async)this._get(t,{success:i,exception:n});else try{var r=this._get(t);return i(r),r}catch(s){n(s)}},update:function(t,e,i){var n=this,r=function(t){n.trigger("update",t,e),i&&i.success&&i.success(t,e)},s=function(t){if(!i||!i.exception)throw t;i.exception(t)};if(this._async)this._update(t,e,{success:r,exception:s});else try{var _=this._update(t,e);return r(_),_}catch(a){s(a)}},query:function(t,e,i){return BetaJS.Queries.Constrained.emulate(BetaJS.Queries.Constrained.make(t,e||{}),this._query_capabilities(),this._query,this,i)},_query_applies_to_id:function(t,e){var i=this.get(e);return i&&BetaJS.Queries.overloaded_evaluate(t,i)},clear:function(){for(var t=this.query({});t.hasNext();)this.remove(t.next().id)}}]),BetaJS.Stores.AssocStore=BetaJS.Stores.BaseStore.extend("AssocStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},_iterate:function(){},constructor:function(t){t=t||{},t.create_ids=!0,this._inherited(BetaJS.Stores.AssocStore,"constructor",t)},_insert:function(t){return this._write_key(t[this._id_key],t),t},_remove:function(t){var e=this._read_key(t);return e&&!this._remove_key(t)?null:e},_get:function(t){return this._read_key(t)},_update:function(t,e){var i=this._get(t);return i&&(delete e[this._id_key],BetaJS.Objs.extend(i,e),this._write_key(t,i)),i},_query:function(){return this._iterate()}}),BetaJS.Stores.MemoryStore=BetaJS.Stores.AssocStore.extend("MemoryStore",{constructor:function(t){this._inherited(BetaJS.Stores.MemoryStore,"constructor",t),this.__data={}},_read_key:function(t){return this.__data[t]},_write_key:function(t,e){this.__data[t]=e},_remove_key:function(t){delete this.__data[t]},_iterate:function(){return new BetaJS.Iterators.ObjectValuesIterator(this.__data)}}),BetaJS.Stores.DumbStore=BetaJS.Stores.BaseStore.extend("DumbStore",{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},constructor:function(t){t=t||{},t.create_ids=!0,this._inherited(BetaJS.Stores.DumbStore,"constructor",t)},_insert:function(t){var e=this._read_last_id(),i=t[this._id_key];return null!=e?(this._write_next_id(e,i),this._write_prev_id(i,e)):this._write_first_id(i),this._write_last_id(i),this._write_item(i,t),t},_remove:function(t){var e=this._read_item(t);if(e){this._remove_item(t);var i=this._read_next_id(t),n=this._read_prev_id(t);null!=i?(this._remove_next_id(t),null!=n?(this._remove_prev_id(t),this._write_next_id(n,i),this._write_prev_id(i,n)):(this._remove_prev_id(i),this._write_first_id(i))):null!=n?(this._remove_next_id(n),this._write_last_id(n)):(this._remove_first_id(),this._remove_last_id())}return e},_get:function(t){return this._read_item(t)},_update:function(t,e){var i=this._get(t);return i&&(delete e[this._id_key],BetaJS.Objs.extend(i,e),this._write_item(t,i)),i},_query_capabilities:function(){return{query:!0}},_query:function(t){var e=new BetaJS.Iterators.Iterator,i=this,n=this._read_first_id();return BetaJS.Objs.extend(e,{__id:null==n?1:n,__store:i,__query:t,hasNext:function(){var e=this.__store._read_last_id();if(null==e)return!1;for(;e>this.__id&&!this.__store._read_item(this.__id);)this.__id++;for(;e>=this.__id;){if(this.__store._query_applies_to_id(t,this.__id))return!0;e>this.__id?this.__id=this.__store._read_next_id(this.__id):this.__id++}return!1},next:function(){if(this.hasNext()){var t=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),t}return null}}),e}}),BetaJS.Stores.AssocDumbStore=BetaJS.Stores.DumbStore.extend("AssocDumbStore",{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(t){var e=this._read_key(t);return e?parseInt(e):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(t){this._write_key("last_id",t)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(t){this._write_key("first_id",t)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(t){return this._read_key("item_"+t)},_write_item:function(t,e){this._write_key("item_"+t,e)},_remove_item:function(t){this._remove_key("item_"+t)},_read_next_id:function(t){return this.__read_id("next_"+t)},_write_next_id:function(t,e){this._write_key("next_"+t,e)},_remove_next_id:function(t){this._remove_key("next_"+t)},_read_prev_id:function(t){return this.__read_id("prev_"+t)},_write_prev_id:function(t,e){this._write_key("prev_"+t,e)},_remove_prev_id:function(t){this._remove_key("prev_"+t)}}),BetaJS.Stores.LocalStore=BetaJS.Stores.AssocDumbStore.extend("LocalStore",{constructor:function(t){this._inherited(BetaJS.Stores.LocalStore,"constructor",t),this.__prefix=t.prefix},__key:function(t){return this.__prefix+t},_read_key:function(t){var e=this.__key(t);return e in localStorage?JSON.parse(localStorage[e]):null},_write_key:function(t,e){localStorage[this.__key(t)]=JSON.stringify(e)},_remove_key:function(t){delete localStorage[this.__key(t)]}}),BetaJS.Stores.QueryCachedStore=BetaJS.Stores.BaseStore.extend("QueryCachedStore",{constructor:function(t,e){e=e||{},e.id_key=t._id_key,this._inherited(BetaJS.Stores.QueryCachedStore,"constructor",e),this.__parent=t,this.__cache={},this.__queries={}},invalidate:function(){this.__cache={},this.__queries={}},_insert:function(t){var e=this.__parent.insert(t);return e&&(this.__cache[t[this._id_key]]=t),e},_remove:function(t){var e=this.__parent.remove(t);return e&&delete this.__cache[t],e},_update:function(t,e){var i=this.__parent.update(t,e);return i&&(this.__cache[t]=BetaJS.Objs.extend(this.__cache[t],e)),i},_get:function(t){return t in this.__cache||(this.__cache[t]=this.__parent.get(t)),this.__cache[t]},_query_capabilities:function(){return this.__parent._query_capabilities()},_query:function(t,e){var i=BetaJS.Queries.Constrained.make(t,e),n=BetaJS.Queries.Constrained.format(i);if(n in this.__queries)return new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__queries[n]));var r=this.__parent.query(t,e).asArray();this.__queries[n]={};for(var s=0;r.length>s;++s)this.__cache_row(r[s],n);return new BetaJS.Iterators.ArrayIterator(r)},cache:function(t,e,i){var n=BetaJS.Queries.Constrained.make(t,e),r=BetaJS.Queries.Constrained.format(n);this.__queries[r]={};for(var s=0;i.length>s;++s)this.__cache_row(i[s],r)},__cache_row:function(t,e){this.trigger("cache",t),this.__cache[t[this._id_key]]=t,this.__queries[e][t[this._id_key]]=t}}),BetaJS.Stores.FullyCachedStore=BetaJS.Stores.BaseStore.extend("FullyCachedStore",{constructor:function(t,e,i){i=i||{},i.id_key=t._id_key,this._inherited(BetaJS.Stores.FullyCachedStore,"constructor",i),this.__parent=t,this.__cache={},this.__cached=!1,e&&this.invalidate(e)},invalidate:function(t){for(this.__cache={},t||(t=this.__parent.query({})),BetaJS.Types.is_array(t)&&(t=new BetaJS.Iterators.ArrayIterator(t));t.hasNext();){var e=t.next();this.cache(e)}this.__cached=!0},cache:function(t){this.trigger("cache",t),this.__cache[t[this._id_key]]=t},_insert:function(t){this.__cached||this.invalidate({});var e=this.__parent.insert(t);return e&&(this.__cache[t[this._id_key]]=t),e},_remove:function(t){this.__cached||this.invalidate({});var e=this.__parent.remove(t);return e&&delete this.__cache[t],e},_get:function(t){return this.__cached||this.invalidate({}),this.__cache[t]},_update:function(t,e){this.__cached||this.invalidate({});var i=this.__parent.update(t,e);return i&&(this.__cache[t]=BetaJS.Objs.extend(this.__cache[t],e)),i},_query:function(){return this.__cached||this.invalidate(),new BetaJS.Iterators.ArrayIterator(BetaJS.Objs.values(this.__cache))}}),BetaJS.Stores.RemoteStore=BetaJS.Stores.BaseStore.extend("RemoteStore",{constructor:function(t,e,i){this._inherited(BetaJS.Stores.RemoteStore,"constructor",i),this._uri=t,this.__ajax=e,this.__options=BetaJS.Objs.extend({update_method:"PUT",uri_mappings:{}},i||{})},getUri:function(){return this._uri},prepare_uri:function(t,e){return this.__options.uri_mappings[t]?this.__options.uri_mappings[t](e):"remove"==t||"get"==t||"update"==t?this.getUri()+"/"+e[this._id_key]:this.getUri()},_insert:function(t){try{return this.__ajax.syncCall({method:"POST",uri:this.prepare_uri("insert",t),data:t})}catch(e){throw new BetaJS.Stores.StoreException(""+BetaJS.Net.AjaxException.ensure(e))}},_remove:function(t){try{var e=this.__ajax.syncCall({method:"DELETE",uri:this.prepare_uri("remove",data)});return e?e:(e={},e[this._id_key]=t,e)}catch(i){throw new BetaJS.Stores.StoreException(""+BetaJS.Net.AjaxException.ensure(i))}},_get:function(t){var e={};e[this._id_key]=t;try{return this.__ajax.syncCall({uri:this.prepare_uri("get",e)})}catch(i){throw new BetaJS.Stores.StoreException(""+BetaJS.Net.AjaxException.ensure(i))}},_update:function(t,e){var i=BetaJS.Objs.clone(e,1);i[this._id_key]=t;try{return this.__ajax.syncCall({method:this.__options.update_method,uri:this.prepare_uri("update",i),data:e})}catch(n){throw new BetaJS.Stores.StoreException(""+BetaJS.Net.AjaxException.ensure(n))}},_query:function(t,e){try{var i=this.__ajax.syncCall(this._encode_query(t,e));return BetaJS.Types.is_string(i)?JSON.parse(i):i}catch(n){throw new BetaJS.Stores.StoreException(""+BetaJS.Net.AjaxException.ensure(n))}},_encode_query:function(){return{uri:this.prepare_uri("query")}}}),BetaJS.Stores.QueryGetParamsRemoteStore=BetaJS.Stores.RemoteStore.extend("QueryGetParamsRemoteStore",{constructor:function(t,e,i,n){this._inherited(BetaJS.Stores.QueryGetParamsRemoteStore,"constructor",t,e,n),this.__capability_params=i},_query_capabilities:function(){var t={};return"skip"in this.__capability_params&&(t.skip=!0),"limit"in this.__capability_params&&(t.limit=!0),t},_encode_query:function(t,e){e=e||{};var i=this.getUri()+"?";return e.skip&&"skip"in this.__capability_params&&(i+=this.__capability_params.skip+"="+e.skip+"&"),e.limit&&"limit"in this.__capability_params&&(i+=this.__capability_params.limit+"="+e.limit+"&"),{uri:i}}}),BetaJS.Stores.ConversionStore=BetaJS.Stores.BaseStore.extend("ConversionStore",{constructor:function(t,e){e=e||{},e.id_key=t._id_key,this._inherited(BetaJS.Stores.ConversionStore,"constructor",e),this.__store=t,this.__key_encoding=e.key_encoding||{},this.__key_decoding=e.key_decoding||{},this.__value_encoding=e.value_encoding||{},this.__value_decoding=e.value_decoding||{}},encode_object:function(t){var e={};for(var i in t)e[this.encode_key(i)]=this.encode_value(i,t[i]);return e},decode_object:function(t){var e={};for(var i in t)e[this.decode_key(i)]=this.decode_value(i,t[i]);return e},encode_key:function(t){return t in this.__key_encoding?this.__key_encoding[t]:t},decode_key:function(t){return t in this.__key_decoding?this.__key_decoding[t]:t},encode_value:function(t,e){return t in this.__value_encoding?this.__value_encoding[t](e):e},decode_value:function(t,e){return t in this.__value_decoding?this.__value_decoding[t](e):e},_insert:function(t){return this.decode_object(this.__store.insert(this.encode_object(t)))},_remove:function(t){return this.__store.remove(this.encode_value(this._id_key,t))},_get:function(t){return this.decode_object(this.__store.get(this.encode_value(this._id_key,t)))},_update:function(t,e){return this.decode_object(this.__store.update(this.encode_value(this._id_key,t),this.encode_object(e)))},_query_capabilities:function(){return this.__store._query_capabilities()},_query:function(t,e){var i=this,n=this.__store.query(this.encode_object(t),e);return new BetaJS.Iterators.MappedIterator(n,function(t){return i.decode_object(t)})}});