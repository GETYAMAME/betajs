/*!
betajs - v1.0.108 - 2017-07-19
Copyright (c) Oliver Friedmann,Victor Lingenthal
Apache-2.0 Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS"),a.define("module:",function(){return{guid:"71366f7a-7da3-4e55-9a0b-ea0e4e2a9e79",version:"1.0.108"}}),a.require(["module:"],function(a){this.exports("undefined"!=typeof module?module:null,a)},this),a.define("module:Ajax.Support",["module:Ajax.NoCandidateAjaxException","module:Ajax.ReturnDataParseException","module:Ajax.RequestException","module:Promise","module:Objs","module:Types","module:Net.Uri","module:Net.HttpHeader","module:Async"],function(a,b,c,d,e,f,g,h,i){return{__registry:[],register:function(a,b){this.__registry.push({descriptor:a,priority:b})},unwrapStatus:function(a,b){var d=a.status||h.HTTP_STATUS_INTERNAL_SERVER_ERROR;if(h.isSuccessStatus(d))return a.responseText;var e=a.statusText||h.format(d),f=a.responseText;try{f=this.parseReturnData(a.responseText,b)}catch(g){}throw new c(d,e,f)},parseReturnData:function(a,b){return"json"===b&&f.is_string(a)?JSON.parse(a):a},promiseReturnData:function(a,c,d,e){if(c.wrapStatus){try{d=this.parseReturnData(d,"json")}catch(f){return void a.asyncError(new b(d,e))}try{d=this.unwrapStatus(d,e)}catch(f){return void a.asyncError(f)}}try{a.asyncSuccess(this.parseReturnData(d,e))}catch(f){a.asyncError(new b(d,e))}},promiseRequestException:function(a,b,d,e,f){d=d||h.format(b);try{a.asyncError(new c(b,d,this.parseReturnData(e,f)))}catch(g){a.asyncError(new c(b,d,e))}},preprocess:function(a){return a=e.extend({method:"GET",mapMethodsKey:"_method",wrapStatus:!1,wrapStatusParam:null,context:this,query:{},jsonp:void 0,postmessage:void 0,contentType:"urlencoded",resilience:1,resilience_delay:1e3,cors:!1,sendContentType:!0,corscreds:!1,forceJsonp:!1,forcePostmessage:!1},a),a.params&&(a.query=e.extend(a.query,a.params),delete a.params),f.is_empty(a.query)||(a.query=e.filter(a.query,function(a){return null!==a&&void 0!==a})),a.method=a.method.toUpperCase(),a.baseUri&&(a.uri=a.uri?a.baseUri+a.uri:a.baseUri),delete a.baseUri,a.mapMethods&&a.method in a.mapMethods&&(a.uri=g.appendUriParams(a.uri,e.objectBy(a.mapMethodsKey,a.method)),a.method=a.mapMethods[a.method]),a.wrapStatus&&a.wrapStatusParam&&(a.uri=g.appendUriParams(a.uri,e.objectBy(a.wrapStatusParam,"true"))),delete a.mapMethods,delete a.mapMethodsKey,"urlencoded"!==a.contentType||f.is_empty(a.data)||(a.data=e.filter(a.data,function(a){return null!==a&&void 0!==a})),a.isCorsRequest="undefined"!=typeof document&&g.isCrossDomainUri(document.location.href,a.uri),a},execute:function(b,c,e){b=this.preprocess(b);var f=null;if(this.__registry.forEach(function(a){(!f||f.priority<a.priority)&&a.descriptor.supports.call(a.descriptor.context||a.descriptor,b)&&(f=a)},this),!f)return d.error(new a(b));var g=function(a){var h=f.descriptor.execute.call(f.descriptor.context||f.descriptor,b,c,e);if(!a||1>=a)return h;var j=d.create();return h.forwardSuccess(j).error(function(){i.eventually(function(){g(a-1).forwardCallback(j)},b.resilience_delay)}),j};return g(b.resilience)}}}),a.define("module:Ajax.AjaxWrapper",["module:Class","module:Objs","module:Ajax.Support"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),this._options=b},execute:function(a,d,e){return c.execute(b.extend(b.clone(this._options,1),a),d,e)}}})}),a.define("module:Ajax.AjaxException",["module:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{status_code:function(){return 500}}})}),a.define("module:Ajax.NoCandidateAjaxException",["module:Ajax.AjaxException"],function(a,b){return a.extend({scoped:b},function(a){return{}})}),a.define("module:Ajax.ReturnDataParseException",["module:Ajax.AjaxException"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,"Could not decode data with type "+c),this.__decodeType=c,this.__data=b}}})}),a.define("module:Ajax.RequestException",["module:Ajax.AjaxException","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c,d){a.constructor.call(this,b+": "+c),this.__status_code=b,this.__status_text=c,this.__data=d},status_code:function(){return this.__status_code},status_text:function(){return this.__status_text},data:function(){return this.__data},json:function(){return b.extend({data:this.data(),status_code:this.status_code(),status_text:this.status_text()},a.json.call(this))}}})}),a.define("module:Class",["module:Types","module:Objs","module:Functions","module:Ids"],function(b,c,d,e){var f=function(){};return f.extend=function(d,e,f,g){e=e||[],b.is_array(e)||(e=[e]),f=f||[],b.is_array(f)||(f=[f]),g=g||[],b.is_array(g)||(g=[g]);var h=this;e=c.map(e,function(a){return b.is_function(a)&&(a=a(h.prototype)),a});var i;c.iter(e,function(a){a.hasOwnProperty("constructor")&&(i=a.constructor)});var j=b.is_defined(i);j||(i=function(){h.prototype.constructor.apply(this,arguments)}),c.extend(i,h),c.iter(f,function(a){a=b.is_function(a)?a(h):a;var d=i._extender;c.extend(i,a),a._extender&&(i._extender=c.extend(c.clone(d,1),a._extender))});var k={};if(h.__class_statics_keys)for(var l in h.__class_statics_keys)i[l]=c.clone(h[l],1);c.iter(g,function(a){c.extend(i,a),c.extend(k,c.keys(a,!0))}),h.__class_statics_keys&&c.extend(k,h.__class_statics_keys),i.__class_statics_keys=k,i.parent=h,i.children=[],i.extend=this.extend,h.children||(h.children=[]),h.children.push(i);var m=function(){};m.prototype=h.prototype,i.prototype=new m,i.prototype.cls=i,d=c.extend({},b.is_string(d)?{classname:d,register:!0}:d);var n=d.classname;return d.scoped&&(n=d.scoped.ns.path),i.classname=n,n&&d.register&&a.setGlobal(n,i),i.__notifications={},i.__implements={},h.__notifications&&c.extend(i.__notifications,h.__notifications,1),h.__implements&&c.extend(i.__implements,h.__implements,1),c.iter(e,function(a){for(var d in a)i.prototype[d]=i._extender&&d in i._extender?i._extender[d](i.prototype[d],a[d]):a[d];if("constructor"in a&&(i.prototype.constructor=a.constructor),a._notifications)for(var e in a._notifications)i.__notifications[e]||(i.__notifications[e]=[]),i.__notifications[e].push(a._notifications[e]);a._implements&&c.iter(b.is_string(a._implements)?[a._implements]:a._implements,function(a){i.__implements[a]=!0})}),delete i.prototype._notifications,delete i.prototype._implements,j||(i.prototype.constructor=h.prototype.constructor),i},c.extend(f,{classname:"Class",__class_guid:"0f5499f9-f0d1-4c6c-a561-ef026a1eee05",__notifications:{},ancestor_of:function(a){return this==a||this!=f&&this.parent.ancestor_of(a)},is_class:function(a){return a&&b.is_object(a)&&"__class_guid"in a&&a.__class_guid==this.__class_guid},is_class_instance:function(a){return a&&b.is_object(a)&&"__class_instance_guid"in a&&a.__class_instance_guid==this.prototype.__class_instance_guid},is_pure_json:function(a){return a&&b.is_object(a)&&!this.is_class_instance(a)&&b.is_pure_object(a)},is_instance_of:function(a){return a&&this.is_class_instance(a)&&a.instance_of(this)},define:function(c,e){var f=d.getArguments(arguments,2);return b.is_object(c)?a.define(e,[],function(a){return f.unshift({scoped:a}),c.extend.apply(c,f)}):a.define(e,[c],function(a,b){return f.unshift({scoped:b}),a.extend.apply(a,f)})},_inherited:function(a,b){return a.parent[b].apply(this,Array.prototype.slice.apply(arguments,[2]))}}),f.prototype.__class_instance_guid="e6b0ed30-80ee-4b28-af02-7d52430ba45f",f.prototype.constructor=function(){this._notify("construct")},f.prototype.destroy=function(){if(this._notify("destroy"),this.__auto_destroy_list)for(var a=0;a<this.__auto_destroy_list.length;++a)"destroy"in this.__auto_destroy_list[a]&&this.__auto_destroy_list[a].weakDestroy();var b=this.cid();for(var c in this)delete this[c];e.objectId(this,b),this.destroy=this.__destroyedDestroy},f.prototype.destroyed=function(){return this.destroy===this.__destroyedDestroy},f.prototype.weakDestroy=function(){if(!this.destroyed()){if(this.__gc)return void this.__gc.queue(this);this.destroy()}},f.prototype.__destroyedDestroy=function(){throw"Trying to destroy destroyed object "+this.cid()+": "+this.cls.classname+"."},f.prototype.enableGc=function(a){return this.supportsGc&&(this.__gc=a),this},f.prototype.dependDestroy=function(a){return a.destroyed()?void 0:(this.__gc&&a.enableGc(),a.weakDestroy(),this)},f.prototype.cid=function(){return e.objectId(this)},f.prototype.cls=f,f.prototype.as_method=function(a){return d.as_method(this[a],this)},f.prototype.auto_destroy=function(a){if(a){this.__auto_destroy_list||(this.__auto_destroy_list=[]);var c=a;b.is_array(c)||(c=[c]);for(var d=0;d<c.length;++d)this.__auto_destroy_list.push(c[d])}return a},f.prototype._notify=function(a){if(this.cls.__notifications){var d=Array.prototype.slice.call(arguments,1);c.iter(this.cls.__notifications[a],function(c){var e=b.is_function(c)?c:this[c];if(!e)throw this.cls.classname+": Could not find "+a+" notification handler "+c;e.apply(this,d)},this)}},f.prototype.impl=function(a){return!(!this.cls.__implements||!this.cls.__implements[b.is_string(a)?a:a._implements])},f.prototype.instance_of=function(a){return this.cls.ancestor_of(a)},f.prototype.increaseRef=function(a){return this.__referenceCount=this.__referenceCount||0,this.__referenceCount++,this.__referenceObjects=this.__referenceObjects||{},a&&(this.__referenceObjects[a.cid()]?this.__referenceCount--:this.__referenceObjects[a.cid()]=a),this},f.prototype.decreaseRef=function(a){return this.__referenceCount=this.__referenceCount||0,this.__referenceCount--,this.__referenceObjects=this.__referenceObjects||{},a&&(this.__referenceObjects[a.cid()]?delete this.__referenceObjects[a.cid()]:this.__referenceCount++),this.__referenceCount<=0&&b.is_empty(this.__referenceObjects)&&this.weakDestroy(),this},f.prototype.inspect=function(){return{header:{cid:this.cid(),classname:this.cls.classname,destroyed:this.destroyed()},attributes:{attributes_public:c.filter(this,function(a,c){return!b.is_function(a)&&0!==c.indexOf("_")},this),attributes_protected:c.filter(this,function(a,c){return!b.is_function(a)&&0===c.indexOf("_")&&0!==c.indexOf("__")},this),attributes_private:c.filter(this,function(a,c){return!b.is_function(a)&&0===c.indexOf("__")},this)},methods:{methods_public:c.filter(this,function(a,c){return b.is_function(a)&&0!==c.indexOf("_")},this),methods_protected:c.filter(this,function(a,c){return b.is_function(a)&&0===c.indexOf("_")&&0!==c.indexOf("__")},this),method_private:c.filter(this,function(a,c){return b.is_function(a)&&0===c.indexOf("__")},this)}}},f.prototype._auto_destroy=function(a){return this.auto_destroy(a)},f.prototype._inherited=function(a,b){return a.parent.prototype[b].apply(this,Array.prototype.slice.apply(arguments,[2]))},f}),a.define("module:Classes.InvokerMixin",["module:Objs","module:Types","module:Functions"],function(a,b,c){return{invoke_delegate:function(d,e){b.is_array(e)||(e=[e]),d=this[d];var f=this;a.iter(e,function(a){this[a]=function(a){return function(){var b=c.getArguments(arguments);return b.unshift(a),d.apply(f,b)}}.call(f,a)},this)}}}),a.define("module:Classes.HelperClassMixin",["module:Objs","module:Types","module:Functions","module:Promise"],function(a,b,c,d){return{addHelper:function(a,b){var c=new a(this,b);return this.__helpers=this.__helpers||[],this.__helpers.push(this._auto_destroy(c)),c},_helper:function(e){this.__helpers=this.__helpers||[],b.is_string(e)&&(e={method:e}),e=a.extend({fold_start:null,fold:function(a,b){return a||b}},e);for(var f=c.getArguments(arguments,1),g=e.async?d.create(e.fold_start):e.fold_start,h=0;h<this.__helpers.length;++h){var i=this.__helpers[h];e.method in i&&(g=e.async?d.func(e.fold,g,d.methodArgs(i,i[e.method],f)):e.fold(g,i[e.method].apply(i,f)))}return g}}}),a.define("module:Classes.PathResolver",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._bindings=b||{}},extend:function(a,c){if(c)for(var d in a){for(var e=a[d],f=/\{([^}]+)\}/;;){var g=f.exec(e);if(!g)break;e=e.replace(f,c+"."+g[1])}this._bindings[c+"."+d]=e}else this._bindings=b.extend(this._bindings,a)},map:function(a){for(var b=[],c=0;c<a.length;++c)a[c]&&b.push(this.resolve(a[c]));return b},resolve:function(a){for(var b=/\{([^}]+)\}/;;){var c=b.exec(a);if(!c)break;a=a.replace(b,this._bindings[c[1]])}return this.simplify(a)},simplify:function(a){return a.replace(/[^\/]+\/\.\.\//,"").replace(/\/[^\/]+\/\.\./,"")}}})}),a.define("module:Classes.MultiDelegatable",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),b.iter(d,function(a){this[a]=function(){var d=arguments;return b.iter(c,function(b){b[a].apply(b,d)},this),this}},this)}}})}),a.define("module:Classes.ObjectIdScopeMixin",function(){return{__objects:{},get:function(a){return this.__objects[a]}}}),a.define("module:Classes.ObjectIdScope",["module:Class","module:Classes.ObjectIdScopeMixin"],function(a,b,c){return a.extend({scoped:c},b,function(a){return{singleton:function(){return this.__singleton||(this.__singleton=new this),this.__singleton}}})}),a.define("module:Classes.ObjectIdMixin",["module:Classes.ObjectIdScope","module:Objs","module:Ids"],function(a,b,c){return{_notifications:{construct:"__register_object_id",destroy:"__unregister_object_id"},__object_id_scope:function(){return this.object_id_scope||(this.object_id_scope=a.singleton()),this.object_id_scope},__register_object_id:function(){var a=this.__object_id_scope();a.__objects[this.cid()]=this},__unregister_object_id:function(){var a=this.__object_id_scope();delete a.__objects[this.cid()]}}}),a.define("module:Classes.SharedObjectFactory",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__createCallback=b,this.__createContext=c,this.__object=null},destroy:function(){this.__object&&!this.__object.destroyed()&&this.__object.destroy(),a.destroy.call(this)},value:function(){return this.__object&&!this.__object.destroyed()?this.__object:null},acquire:function(a){return this.__object&&!this.__object.destroyed()||(this.__object=this.__createCallback.call(this.__createContext||this)),this.__object.increaseRef(a),this.__object},release:function(a,b){a&&a===this.__object&&!a.destroyed()&&a.decreaseRef(a)}}})}),a.define("module:Comparators",["module:Types","module:Properties.Properties"],function(a,b){return{byObject:function(a){var c=this;return function(d,e){for(var f in a){var g=0;if(g=b.is_class_instance(d)&&b.is_class_instance(e)?c.byValue(d.get(f)||null,e.get(f)||null):c.byValue(d[f]||null,e[f]||null),0!==g)return g*a[f]}return 0}},byValue:function(b,c){return a.is_string(b)?b.localeCompare(c):c>b?-1:b>c?1:0},deepEqual:function(b,c,d){if(0===d)return!0;if(1===d)return b===c;if(a.is_array(b)&&a.is_array(c)){if(b.length!==c.length)return!1;for(var e=0;e<b.length;++e)if(!this.deepEqual(b[e],c[e],d-1))return!1;return!0}if(a.is_object(b)&&a.is_object(c)){if(b&&!c||c&&!b)return b||c;for(var f in b)if(!this.deepEqual(b[f],c[f],d-1))return!1;for(f in c)if(!(f in b))return!1;return!0}return b===c},listEqual:function(a,b){return this.deepEqual(a,b,2)}}}),a.define("module:Compress",function(){return{lzw_like_encode:function(a,b){void 0===b&&(b=256);for(var c=new Map,d=[],e=0;b>e;++e)c.set(String.fromCharCode(e),e);for(var f="",g=0;g<a.length;++g){var h=a.charAt(g);if(c.has(h)){if(c.has(f+h))f+=h;else if(d.push(c.get(f)),c.set(f+h,c.size),f=h,c.size>=65535){for(c=new Map,e=0;b>e;++e)c.set(String.fromCharCode(e),e);f="",g--}}else f&&d.push(c.get(f)),c.set(h,c.size),d.push(c.size+1),d.push(a.charCodeAt(g)),f=""}return f&&d.push(c.get(f)),d.map(function(a){return String.fromCharCode(a)}).join("")},lzw_like_decode:function(a,b){void 0===b&&(b=256);for(var c=[],d=[],e=0;b>e;++e)c.push(String.fromCharCode(e));for(var f="",g=0;g<a.length;++g){var h=a.charCodeAt(g);if(h>c.length)g++,h=a.charCodeAt(g),d.push(String.fromCharCode(h)),c.push(String.fromCharCode(h)),f="";else{var i=h<c.length?c[h]:f+f.charAt(0);if(d.push(i),f&&c.push(f+i.charAt(0)),f=i,c.length>=65534){for(c=[],e=0;b>e;++e)c.push(String.fromCharCode(e));f=""}}}return d.join("")}}}),a.define("module:Events.EventsMixin",["module:Timers.Timer","module:Async","module:Lists.LinkedList","module:Functions","module:Types","module:Objs"],function(a,b,c,d,e,f){return{_implements:"3d63b44f-c9f0-4aa7-b39e-7cbf195122b4",_notifications:{construct:function(){this.__suspendedEvents=0,this.__suspendedEventsQueue=[]},destroy:function(){this.off(null,null,null)}},EVENT_SPLITTER:/\s+/,__create_event_object:function(b,c,d){d=d||{};var e={callback:b,context:c};return d.eventually&&(e.eventually=d.eventually),d.min_delay&&(e.min_delay=new a({delay:d.min_delay,once:!0,start:!1,context:this,fire:function(){e.max_delay&&e.max_delay.stop(),this._invokeCallback(e.callback,e.context||this,e.params)}})),d.max_delay&&(e.max_delay=new a({delay:d.max_delay,once:!0,start:!1,context:this,fire:function(){e.min_delay&&e.min_delay.stop(),this._invokeCallback(e.callback,e.context||this,e.params)}})),e},__destroy_event_object:function(a){a.min_delay&&a.min_delay.destroy(),a.max_delay&&a.max_delay.destroy()},_invokeCallback:function(a,b,c){a.apply(b,c)},__call_event_object:function(a,c){a.min_delay&&a.min_delay.restart(),a.max_delay&&a.max_delay.start(),a.min_delay||a.max_delay?a.params=c:a.eventually?b.eventually(function(){this._invokeCallback(a.callback,a.context||this,c)},this):this._invokeCallback(a.callback,a.context||this,c)},on:function(a,b,d,e){this.__events_mixin_events=this.__events_mixin_events||{},a=a.split(this.EVENT_SPLITTER);for(var f;;){if(f=a.shift(),!f)break;this.__events_mixin_events[f]||this._notify("register_event",f),this.__events_mixin_events[f]=this.__events_mixin_events[f]||new c;var g=this.__create_event_object(b,d,e);if(this.__events_mixin_events[f].add(g),this.__events_mixin_persistent_events&&this.__events_mixin_persistent_events[f])for(var h=this.__events_mixin_persistent_events[f],i=0;i<h.length;++i)this.__call_event_object(g,h[i]);e&&e.initcall&&this.__call_event_object(g,[])}return this},off:function(a,b,c){return this.__events_mixin_events=this.__events_mixin_events||{},a?(a=a.split(this.EVENT_SPLITTER),f.iter(a,function(a){this.__events_mixin_events[a]&&(this.__events_mixin_events[a].remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===this.__events_mixin_events[a].count()&&(this.__events_mixin_events[a].destroy(),delete this.__events_mixin_events[a],this._notify("unregister_event",a)))},this)):f.iter(this.__events_mixin_events,function(a,d){a.remove_by_filter(function(a){var d=!(b&&a.callback!=b||c&&a.context!=c);return d&&this.__destroy_event_object&&this.__destroy_event_object(a),d}),0===a.count()&&(a.destroy(),delete this.__events_mixin_events[d],this._notify("unregister_event",d))},this),this},once:function(a,b,c,e){var f=this,g=d.once(function(){f.off(a,g),b.apply(this,arguments)});return g._callback=b,this.on(a,g,c,e)},trigger:function(a){if(this.__suspendedEvents>0)return this.__suspendedEventsQueue.push(arguments),this;var b=this;a=a.split(this.EVENT_SPLITTER);var c=d.getArguments(arguments,1);return this.__events_mixin_events?(f.iter(a,function(a){this.__events_mixin_events[a]&&this.__events_mixin_events[a].iterate(function(a){b.__call_event_object(a,c)}),this.__events_mixin_events&&"all"in this.__events_mixin_events&&this.__events_mixin_events.all.iterate(function(d){b.__call_event_object(d,[a].concat(c))})},this),this):this},triggerAsync:function(){var a=this,b=d.getArguments(arguments),c=setTimeout(function(){clearTimeout(c),a.trigger.apply(a,b)},0);return this},persistentTrigger:function(a){var b=d.getArguments(arguments,1);return this.__events_mixin_persistent_events=this.__events_mixin_persistent_events||[],f.iter(a.split(this.EVENT_SPLITTER),function(a){this.__events_mixin_persistent_events[a]=this.__events_mixin_persistent_events[a]||[],this.__events_mixin_persistent_events[a].push(b)},this),this.trigger.apply(this,arguments),this},delegateEvents:function(a,b,c,g){return g=g||[],c=c?c+":":"",null===a?b.on("all",function(a){var b=d.getArguments(arguments,1);this.trigger.apply(this,[c+a].concat(g).concat(b))},this):(e.is_array(a)||(a=[a]),f.iter(a,function(a){b.on(a,function(){var b=d.getArguments(arguments);this.trigger.apply(this,[c+a].concat(g).concat(b))},this)},this)),this},_eventChain:function(){},chainedTrigger:function(a,b){if(b=f.extend({source:this,bubbles:!0},b),this.trigger(a,b),b.bubbles){var c=this._eventChain();c&&c.chainedTrigger&&c.chainedTrigger(a,b)}return this},suspendEvents:function(){return this.__suspendedEvents++,this},resumeEvents:function(){return this.__suspendedEvents--,0!==this.__suspendedEvents?this:(f.iter(this.__suspendedEventsQueue,function(a){this.trigger.apply(this,a)},this),this.__suspendedEventsQueue=[],this)}}}),a.define("module:Events.Events",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},b)}),a.define("module:Events.ListenMixin",["module:Ids","module:Objs"],function(a,b){return{_notifications:{destroy:"listenOff"},listenOn:function(b,c,d,e){return this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[a.objectId(b)]=b,b.on(c,d,this,e),this},listenOnce:function(b,c,d,e){return this.__listen_mixin_listen||(this.__listen_mixin_listen={}),this.__listen_mixin_listen[a.objectId(b)]=b,b.once(c,d,this,e),this},listenOff:function(c,d,e){return this.__listen_mixin_listen?(c?(c.off(d,e,this),d||e||delete this.__listen_mixin_listen[a.objectId(c)]):b.iter(this.__listen_mixin_listen,function(b){b&&"off"in b&&b.off(d,e,this),d||e||delete this.__listen_mixin_listen[a.objectId(b)]},this),this):this}}}),a.define("module:Events.Listen",["module:Class","module:Events.ListenMixin"],function(a,b,c){return a.extend({scoped:c},b)}),a.define("module:Functions",["module:Types"],function(a){return{getStackTrace:function(a){for(var b=(new Error).stack.split("\n");b.length>0&&"error"===b[0].trim().toLowerCase();)b.shift();return a?b.slice(a):b},as_method:function(a,b){return function(){return a.apply(b,arguments)}},once:function(a){var b=!1,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},getArguments:function(a,b){return Array.prototype.slice.call(a,b||0)},matchArgs:function(b,c,d){arguments.length<3&&(d=c,c=0);var e=c,f={};for(var g in d){var h=d[g];h===!0?h={required:!0}:"string"==typeof h&&(h={type:h}),h.required||h.type&&a.type_of(b[e])==h.type?(f[g]=b[e],e++):h.def&&(f[g]=a.is_function(h.def)?h.def(f):h.def)}return f},newClassFunc:function(a){return function(){function b(){return a.apply(this,c)}var c=arguments;return b.prototype=a.prototype,new b}},newClass:function(a){return this.newClassFunc(a).apply(this,this.getArguments(arguments,1))},callWithin:function(b,c){return a.is_string(c)&&(c=b[c]),c.apply(b,this.getArguments(arguments,2))}}}),a.define("module:Ids",["module:Types","module:Objs"],function(a,b){return{__uniqueId:0,uniqueId:function(a){return(a||"")+this.__uniqueId++},objectId:function(a,b){return a?(void 0!==b?a.__cid=b:a.__cid||(a.__cid=this.uniqueId("cid_")),a.__cid):void 0},uniqueKey:function(c,d){return d&&d>0&&(a.is_object(c)||a.is_array(c))?JSON.stringify(b.map(c,function(a){return this.uniqueKey(a,d-1)},this)):null!==c&&a.is_object(c)||a.is_array(c)||a.is_function(c)?this.objectId(c):c}}}),a.define("module:IdGenerators.IdGenerator",["module:Class"],function(a,b){return a.extend({scoped:b},{generate:function(a){},valid:function(a,b){return!1}})}),a.define("module:IdGenerators.PrefixedIdGenerator",["module:IdGenerators.IdGenerator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__prefix=b,this.__generator=c},generate:function(a){return this.__prefix+this.__generator.generate(a)},valid:function(a,b){return 0===a.indexOf(this.__prefix)&&this.__generator.valid(a.substring(this.__prefix.length),b)}}})}),a.define("module:Ids.RandomIdGenerator",["module:IdGenerators.IdGenerator","module:Tokens"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__length=b||16},generate:function(a){return b.generate_token(this.__length)},valid:function(a,b){return a.length===this.__length}}})}),a.define("module:IdGenerators.ConsecutiveIdGenerator",["module:IdGenerators.IdGenerator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__current=b||0},generate:function(a){return this.__current++,this.__current},valid:function(a,b){return!isNaN(a)}}})}),a.define("module:IdGenerators.TimedIdGenerator",["module:IdGenerators.IdGenerator","module:Time"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(){a.constructor.call(this),this.__current=b.now()-1},generate:function(a){var c=b.now();return this.__current=c>this.__current?c:this.__current+1,this.__current},valid:function(a,b){return!isNaN(a)}}})}),a.define("module:JavaScript",["module:Objs"],function(a){return{STRING_SINGLE_QUOTATION_REGEX:/'[^']*'/g,STRING_DOUBLE_QUOTATION_REGEX:/"[^"]*"/g,PROPER_IDENTIFIER_REGEX:/^[a-zA-Z_][a-zA-Z_0-9]*$/,IDENTIFIER_REGEX:/[a-zA-Z_][a-zA-Z_0-9]*/g,IDENTIFIER_SCOPE_REGEX:/[a-zA-Z_][a-zA-Z_0-9\.]*/g,RESERVED:a.objectify(["if","then","else","return","var"],!0),isReserved:function(a){return a in this.RESERVED},isIdentifier:function(a){return!this.isReserved(a)},isProperIdentifier:function(a){return this.isIdentifier(a)&&this.PROPER_IDENTIFIER_REGEX.test(a)},removeStrings:function(a){return a.replace(this.STRING_SINGLE_QUOTATION_REGEX,"").replace(this.STRING_DOUBLE_QUOTATION_REGEX,"")},extractIdentifiers:function(b,c){var d=c?this.IDENTIFIER_SCOPE_REGEX:this.IDENTIFIER_REGEX;return b=this.removeStrings(b),a.filter(b.match(d),this.isIdentifier,this)}}}),a.define("module:KeyValue.KeyValueStore",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{mem:function(a){return this._mem(a)},get:function(a){return this._get(a)},set:function(a,b){this._set(a,b),this.trigger("change:"+a,b)},remove:function(a){this._remove(a)}}}])}),a.define("module:KeyValue.PrefixKeyValueStore",["module:KeyValue.KeyValueStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__kv=b,this.__prefix=c},_mem:function(a){return this.__kv.mem(this.__prefix+a)},_get:function(a){return this.__kv.get(this.__prefix+a)},_set:function(a,b){this.__kv.set(this.__prefix+a,b)},_remove:function(a){this.__kv.remove(this.__prefix+a)}}})}),a.define("module:KeyValue.MemoryKeyValueStore",["module:KeyValue.KeyValueStore","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),this.__data=b.clone(c,d?1:0)},_mem:function(a){return a in this.__data},_get:function(a){return this.__data[a]},_set:function(a,b){this.__data[a]=b},_remove:function(a){delete this.__data[a]}}})}),a.define("module:KeyValue.DefaultKeyValueStore",["module:KeyValue.KeyValueStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__kv=b,this.__def=c},_mem:function(a){return this.__kv.mem(a)||this.__def.mem(a)},_get:function(a){return this.__kv.mem(a)?this.__kv.get(a):this.__def.get(a)},_set:function(a,b){this.__kv.set(a,b)},_remove:function(a){this.__kv.remove(a)}}})}),a.define("module:Lists.AbstractList",["module:Class","module:Objs","module:Types","module:Iterators.ArrayIterator"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{_add:function(a){},_remove:function(a){},_get:function(a){},_iterate:function(a,b){},get_ident:function(a){var b=null;return this._iterate(function(c,d){return c==a?(b=d,!1):!0}),b},exists:function(a){return a&&null!==this.get_ident(a)},_ident_changed:function(a,b){},constructor:function(c){a.constructor.call(this),this.__count=0,c&&b.iter(c,function(a){this.add(a)},this)},add:function(a){var b=this._add(a);return c.is_defined(b)&&this.__count++,b},count:function(){return this.__count},clear:function(){this._iterate(function(a,b){return this.remove_by_ident(b),!0},this)},remove_by_ident:function(a){var b=this._remove(a);return c.is_defined(b)&&this.__count--,b},remove:function(a){return this.remove_by_ident(this.get_ident(a))},remove_by_filter:function(a){this._iterate(function(b,c){return a(b)&&this.remove_by_ident(c),!0},this)},get:function(a){return this._get(a)},iterate:function(a,b){this._iterate(function(b,d){var e=a.call(this,b,d);return c.is_defined(e)?e:!0},b)},iterator:function(){return d.byIterate(this.iterate,this)}}})}),a.define("module:Lists.LinkedList",["module:Lists.AbstractList"],function(a,b){return a.extend({scoped:b},function(a){return{__first:null,__last:null,_add:function(a){return this.__last={obj:a,prev:this.__last,next:null},this.__first?this.__last.prev.next=this.__last:this.__first=this.__last,this.__last},_remove:function(a){return a.next?a.next.prev=a.prev:this.__last=a.prev,a.prev?a.prev.next=a.next:this.__first=a.next,a.obj},_get:function(a){return a.obj},_iterate:function(a,b){for(var c=this.__first;c;){var d=c;if(c=c.next,!a.apply(b||this,[d.obj,d]))return}}}})}),a.define("module:Lists.ObjectIdList",["module:Lists.AbstractList","module:Ids"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c){this.__map={},this.__id_generator=c,a.constructor.call(this,b)},_add:function(a){var c=a.__cid;if(!c)for(;;)if(c=this.__id_generator?b.objectId(a,this.__id_generator()):b.objectId(a),!this.__map[c]||!this.__id_generator)break;return this.__map[c]=a,c},_remove:function(a){var b=this.__map[a];return delete this.__map[a],b},_get:function(a){return this.__map[a]},_iterate:function(a,b){for(var c in this.__map)a.apply(b||this,[this.__map[c],c])},get_ident:function(a){var c=b.objectId(a);return this.__map[c]?c:null}}})}),a.define("module:Lists.ArrayList",["module:Lists.AbstractList","module:Ids","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){this.__idToIndex={},this.__items=[],c=c||{},"compare"in c&&(this._compare=c.compare),"get_ident"in c&&(this._get_ident=c.get_ident),a.constructor.call(this,b)},set_compare:function(a){this._compare=a,a&&this.sort()},get_compare:function(){return this._compare},sort:function(a){if(a=a||this._compare){this.__items.sort(a);for(var b=0;b<this.__items.length;++b)this.__ident_changed(this.__items[b],b);this._sorted()}},_sorted:function(){},re_index:function(a){if(!this._compare)return a;for(var b=this.__items.length-1,c=this.__items[a],d=a;b>d&&this._compare(this.__items[d],this.__items[d+1])>0;)this.__items[d]=this.__items[d+1],this.__ident_changed(this.__items[d],d),this.__items[d+1]=c,++d;if(d==a)for(;d>0&&this._compare(this.__items[d],this.__items[d-1])<0;)this.__items[d]=this.__items[d-1],this.__ident_changed(this.__items[d],d),this.__items[d-1]=c,--d;return d!=a&&(this.__ident_changed(c,d),this._re_indexed(c)),d},_re_indexed:function(a){},__objectId:function(a){return this._get_ident?this._get_ident(a):b.objectId(a)},_add:function(a){var b=this.__items.length;this.__items.push(a);var c=this.re_index(b);return this.__idToIndex[this.__objectId(a)]=c,c},_remove:function(a){for(var b=this.__items[a],c=a+1;c<this.__items.length;++c)this.__items[c-1]=this.__items[c],this.__ident_changed(this.__items[c-1],c-1);return this.__items.pop(),delete this.__idToIndex[this.__objectId(b)],b},_get:function(a){return this.__items[a]},_iterate:function(a,b){for(var d=c.clone(this.__items,1),e=0;e<d.length;++e)a.apply(b||this,[d[e],this.get_ident(d[e])])},__ident_changed:function(a,b){this.__idToIndex[this.__objectId(a)]=b,this._ident_changed(a,b)},get_ident:function(a){var b=this.__objectId(a);return b in this.__idToIndex?this.__idToIndex[b]:null;
},ident_by_id:function(a){return this.__idToIndex[a]}}})}),a.define("module:Maths",[],function(){return{discreteCeil:function(a,b,c){var d=Math.ceil(a/b)*b;return c&&d>c?0:d}}}),a.define("module:Objs",["module:Types"],function(a){return{ithKey:function(a,b){b=b||0;for(var c in a){if(0>=b)return c;--b}return null},ithValue:function(a,b){b=b||0;for(var c in a){if(0>=b)return a[c];--b}return null},valueByIndex:function(b,c){return a.is_array(b)?b[c||0]:this.ithValue(b,c)},keyByIndex:function(b,c){return a.is_array(b)?c||0:this.ithKey(b,c)},count:function(b){if(a.is_array(b))return b.length;var c=0;for(var d in b)c++;return c},clone:function(b,c){return c&&0!==c?a.is_array(b)?b.slice(0):a.is_object(b)?this.extend({},b,c-1):b:b},acyclic_clone:function(b){if(null===b||!a.is_object(b))return b;var c="__acyclic_cloned";if(b[c])return b[c];var d={};b[c]=d;for(var e in b)e!==c&&(d[e]=this.acyclic_clone(b[e]));return delete b[c],d},extend:function(a,b,c){if(a=a||{},b)for(var d in b)a[d]=this.clone(b[d],c);return a},weak_extend:function(a,b,c){if(a=a||{},b)for(var d in b)d in a||(a[d]=this.clone(b[d],c));return a},tree_extend:function(b,c,d){if(b=b||{},c)for(var e in c)e in b&&a.is_object(b[e])&&a.is_object(c[e])&&!a.is_array(b[e])&&!a.is_array(c[e])?b[e]=this.tree_extend(b[e],c[e],d):b[e]=this.clone(c[e],d);return b},keys:function(b,c){var d=null,e=null;if(a.is_undefined(c)){d=[];for(e in b)d.push(e);return d}d={};for(e in b)d[e]=c;return d},subset_of:function(b,c){b=a.is_array(b)?this.objectify(b):b,c=a.is_array(c)?this.objectify(c):c;for(var d in b)if(b[d]!=c[d])return!1;return!0},superset_of:function(a,b){return this.subset_of(b,a)},pairArrayToObject:function(a){for(var b={},c=0;c<a.length/2;c+=2)b[a[c]]=a[c+1];return b},pairsToObject:function(){for(var a={},b=0;b<arguments.length;++b)a[arguments[b][0]]=arguments[b][1];return a},inverseKeyValue:function(a){var b={};return this.iter(a,function(a,c){b[a]=c}),b},exists:function(a,b,c){var d=!1;return this.iter(a,function(){return d=d||b.apply(this,arguments),!d},c),d},all:function(a,b,c){var d=!0;return this.iter(a,function(){return d=d&&b.apply(this,arguments)},c),d},peek:function(b){if(a.is_array(b))return b.length>0?b[0]:null;for(var c in b)return b[c];return null},poll:function(b){if(a.is_array(b))return b.shift();for(var c in b){var d=b[c];return delete b[c],d}return null},iter:function(b,c,d){var e=null;if(a.is_array(b)){for(var f=0;f<b.length;++f)if(e=d?c.apply(d,[b[f],f]):c(b[f],f),a.is_defined(e)&&!e)return!1}else for(var g in b)if(e=d?c.apply(d,[b[g],g]):c(b[g],g),a.is_defined(e)&&!e)return!1;return!0},intersect:function(a,b){var c={};for(var d in a)d in b&&(c[d]=a[d]);return c},diff:function(a,b){var c={};for(var d in a)d in b&&a[d]===b[d]||(c[d]=a[d]);return c},contains_key:function(b,c){return a.is_array(b)?a.is_defined(b[c]):c in b},contains_value:function(b,c){if(a.is_array(b)){for(var d=0;d<b.length;++d)if(b[d]===c)return!0}else for(var e in b)if(b[e]===c)return!0;return!1},map:function(b,c,d){var e=null;if(a.is_array(b)){e=[];for(var f=0;f<b.length;++f)e.push(d?c.apply(d,[b[f],f]):c(b[f],f));return e}e={};for(var g in b)e[g]=d?c.apply(d,[b[g],g]):c(b[g],g);return e},keyMap:function(a,b,c){result={};for(var d in a)result[b.call(c||this,a[d],d)]=a[d];return result},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},filter:function(b,c,d){if(c=c||function(a){return!!a},a.is_array(b))return b.filter(c,d);var e={};for(var f in b)(d?c.apply(d,[b[f],f]):c(b[f],f))&&(e[f]=b[f]);return e},equals:function(a,b,c){var d=null;if(c&&c>0){for(d in a)if(!(d in b&&this.equals(a[d],b[d],c-1)))return!1;for(d in b)if(!(d in a))return!1;return!0}return a==b},objectify:function(b,c,d){var e={},f=a.is_function(c);a.is_undefined(c)&&(c=!0);for(var g=0;g<b.length;++g)e[b[g]]=f?c.apply(d||this,[b[g],g]):c;return e},objectBy:function(){for(var a={},b=arguments.length/2,c=0;b>c;++c)a[arguments[2*c]]=arguments[2*c+1];return a},specialize:function(a,b,c){var d={},e=c?a:b;for(var f in e)f in a&&a[f]==b[f]||(d[f]=b[f]);return d},merge:function(b,c,d){b=b||{},c=c||{};var e={},f=this.extend(this.keys(b,!0),this.keys(c,!0));for(var g in f){var h=g in d?d[g]:"primary";"primary"==h||"secondary"==h?(g in c||g in b)&&("primary"==h?e[g]=g in c?c[g]:b[g]:e[g]=g in b?b[g]:c[g]):a.is_function(h)?e[g]=h(b[g],c[g]):a.is_object(h)&&(e[g]=this.merge(b[g],c[g],h))}return e},tree_merge:function(b,c){b=b||{},c=c||{};var d={},e=this.extend(this.keys(b,!0),this.keys(c,!0));for(var f in e)a.is_object(c[f])&&b[f]?d[f]=this.tree_merge(b[f],c[f]):d[f]=f in c?c[f]:b[f];return d},serializeFlatJSON:function(b,c){var d=[];return a.is_array(b)&&b?b.forEach(function(a){d=d.concat(this.serializeFlatJSON(a,c+"[]"))},this):a.is_object(b)&&b?this.iter(b,function(a,b){d=d.concat(this.serializeFlatJSON(a,c?c+"["+b+"]":b))},this):d=[{key:c,value:b}],d}}}),a.define("module:Objs.Scopes",["module:Types"],function(a){return{has:function(b,c){for(var d=b?b.split("."):[],e=0;e<d.length;++e){if(!c||!a.is_object(c))return!1;c=c[d[e]]}return a.is_defined(c)},get:function(b,c){for(var d=b?b.split("."):[],e=0;e<d.length;++e){if(!c||!a.is_object(c))return null;c=c[d[e]]}return c},set:function(b,c,d){if(b){for(var e=b.split("."),f=0;f<e.length-1;++f)e[f]in d&&a.is_object(d[e[f]])||(d[e[f]]={}),d=d[e[f]];d[e[e.length-1]]=c}},unset:function(b,c){if(b){for(var d=b.split("."),e=0;e<d.length-1;++e){if(!c||!a.is_object(c))return;c=c[d[e]]}delete c[d[d.length-1]]}},touch:function(b,c){if(!b)return c;for(var d=b.split("."),e=0;e<d.length;++e)d[e]in c&&a.is_object(c)||(c[d[e]]={}),c=c[d[e]];return c[d[d.length-1]]}}}),a.define("module:Parser.LexerException",["module:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,"Lexer error: Unrecognized identifier at "+b.length+"."),this.__head=b,this.__tail=c}}})}),a.define("module:Parser.Lexer",["module:Class","module:Types","module:Objs","module:Parser.LexerException"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(d){a.constructor.call(this),this.__patterns=[],c.iter(d,function(a,c){this.__patterns.push({regex:new RegExp("^"+c,"m"),data:b.is_string(a)?{token:a}:a})},this)},lex:function(a){for(var e=[],f="",g=a;g;){for(var h=null,i=null,j=0;j<this.__patterns.length;++j)if(h=this.__patterns[j].regex.exec(g)){i=c.clone(this.__patterns[j].data,1);break}if(!h)throw new d(f,g);if(f+=h[0],g=g.substring(h[0].length),i){for(var k in i)if(b.is_string(i[k]))for(var l=0;l<h.length;++l)i[k]=i[k].replace("$"+l,h[l]);e.push(i)}}return e}}})}),a.define("module:Properties.PropertiesMixin",["module:Objs.Scopes","module:Objs","module:Strings","module:Types","module:Functions"],function(a,b,c,d,e){return{__properties_guid:"ec816b66-7284-43b1-a945-0600c6abfde3",_notifications:{construct:function(){this.__properties={data:{},watchers:{children:{},eventCount:0,parent:null,key:null},computed:{},bindings:{}},b.iter(this.materializes,function(a){this.materializeAttr(a)},this)},destroy:function(){b.iter(this.__properties.bindings,function(a,b){this.unbind(b)},this),this.trigger("destroy")},register_event:function(a){b.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){c.starts_with(a,b+":")&&this.__registerWatcher(c.strip_start(a,b+":"),b)},this)},unregister_event:function(a){b.iter(["change","unset","deepchange","deepunset","strongdeepchange","strongchange"],function(b){c.starts_with(a,b+":")&&this.__unregisterWatcher(c.strip_start(a,b+":"),b)},this)}},__registerWatcher:function(a,b){for(var c=a?a.split("."):[],d=this.__properties.watchers,e=0;e<c.length;++e)c[e]in d.children||(d.children[c[e]]={parent:d,eventCount:0,children:{},key:c[e]}),d=d.children[c[e]];d.eventCount++},__unregisterWatcher:function(a,b){for(var c=a?a.split("."):[],e=this.__properties.watchers,f=0;f<c.length;++f)e&&(e=e.children[c[f]]);if(e)for(e.eventCount--;e.eventCount<=0&&d.is_empty(e.children)&&e.parent;){var g=e.parent;delete g.children[e.key],e=g}},__unsetChanged:function(a,e){function f(a,c,e){d.is_undefined(e)||(a.eventCount>0&&this.trigger("unset:"+c,e),b.iter(a.children,function(a,b){f.call(this,a,c?c+"."+b:b,e[b])},this))}this.trigger("unset",a,e);for(var g=a?a.split("."):[],h=this.__properties.watchers,i="",j=a,k=0;k<g.length;++k){if(h.eventCount>0&&this.trigger("deepunset:"+i,e,j),!(g[k]in h.children))return this;h=h.children[g[k]],i=i?i+"."+g[k]:g[k],j=c.first_after(j,".")}return f.call(this,h,a,e),this},__setChanged:function(a,e,f,g){function h(a,c,e,f){e!=f&&(a.eventCount>0&&(g||this.trigger("strongchange:"+c,e,f),this.trigger("change:"+c,e,f)),b.iter(a.children,function(a,b){h.call(this,a,c?c+"."+b:b,d.is_object(e)&&e?e[b]:null,d.is_object(f)&&f?f[b]:null)},this))}if(this.trigger("change",a,e,f),this._afterSet(a,e),!this.destroyed()){for(var i=a?a.split("."):[],j=this.__properties.watchers,k="",l=a,m=0;m<i.length;++m){if(j.eventCount>0&&(g||this.trigger("strongdeepchange:"+k,e,f,l),this.trigger("deepchange:"+k,e,f,l)),!(i[m]in j.children))return;j=j.children[i[m]],k=k?k+"."+i[m]:i[m],l=c.first_after(l,".")}h.call(this,j,a,e,f)}},materializes:[],_resolveProps:function(a){for(var b={props:this,key:a},e=this.data();a;){if(!e||!d.is_object(e))return b;if(e.__properties_guid===this.__properties_guid)return e._resolveProps(a);var f=c.splitFirst(a,".");if(!(f.head in e))return b;a=f.tail,e=e[f.head]}return b},_canSet:function(a,b){return!0},_beforeSet:function(a,b){return b},_afterSet:function(a,b){},getProp:function(a){var b=this._resolveProps(a);return b.props.get(b.key)},setProp:function(a,b){var c=this._resolveProps(a);return c.props.set(c.key,b),this},uncomputeProp:function(a){var b=this._resolveProps(a);return b.props.uncompute(b.key)},computeProp:function(a,b){var c=this._resolveProps(a),d=e.getArguments(arguments);return d[0]=c.key,c.props.compute.apply(c.props.compute,d)},get:function(b){return a.get(b,this.__properties.data)},has:function(b){return a.has(b,this.__properties.data)},setAll:function(a){for(var b in a)this.set(b,a[b]);return this},keys:function(a){return b.keys(this.__properties.data,a)},data:function(){return this.__properties.data},getAll:function(){return b.clone(this.__properties.data,1)},materializeAttr:function(a){return this[a]=function(b){return 0===arguments.length?this.get(a):void this.set(a,b)},this},uncompute:function(a){return a in this.__properties.computed&&(b.iter(this.__properties.computed[a].dependencies,function(a){a.properties.off("change:"+a.key,null,a)},this),delete this.__properties.computed[a]),this},compute:function(a,c){function f(){if(!(i.ignore>0)){var d=b.map(h,function(a){return a.properties.get(a.key)});j.set(a,c.apply(g.context,d))}}var g=e.matchArgs(arguments,2,{setter:"function",context:{type:"object",def:this},dependencies:!0});this.uncompute(a);var h=[];b.iter(g.dependencies,function(a){d.is_string(a)?h.push({properties:this,key:a}):h.push({properties:a[0],key:a[1]})},this);var i={ignore:0,func:c,context:g.context,setter:g.setter,dependencies:h};this.__properties.computed[a]=i;var j=this;return b.iter(h,function(a){var b=a.properties.get(a.key);b&&"object"==typeof b&&"on"in b&&"off"in b&&"trigger"in b&&b.on("change update",function(){f()},a),a.properties.on("change:"+a.key,function(b,c){c&&"object"==typeof c&&"on"in c&&"off"in c&&"trigger"in c&&c.off("change update",null,a),b&&"object"==typeof b&&"on"in b&&"off"in b&&"trigger"in b&&b.on("change update",function(){f()},a),f()},a)},this),f(),this},unbind:function(a,b){if(a in this.__properties.bindings){for(var c=this.__properties.bindings[a].length-1;c>=0;--c){var d=this.__properties.bindings[a][c];b&&b!=d||(d.left&&d.properties.off(null,null,d),d.right&&this.off(null,null,d),this.__properties.bindings[a].splice(c,1),c--)}0===this.__properties.bindings[a].length&&delete this.__properties.bindings[a]}return this},bind:function(a,c,d){d=b.extend({secondKey:a,left:!0,right:!0,deep:!1},d);var e={key:d.secondKey,left:d.left,right:d.right,deep:d.deep,properties:c};this.__properties.bindings[a]=this.__properties.bindings[a]||[],this.__properties.bindings[a].push(e);var f=this;return e.left&&(e.properties.on("strongchange:"+e.key,function(b){f.set(a,b)},e),e.properties.on("unset:"+e.key,function(b){f.unset(a)},e),e.deep&&(e.properties.on("strongdeepchange:"+e.key,function(b,c,d){f.get(a?a+"."+d:d)===b?f.__setChanged(a?a+"."+d:d,b,c,!0):f.set(a?a+"."+d:d,b)},e),e.properties.on("deepunset:"+e.key,function(b,c){f.has(a?a+"."+c:c)?f.unset(a?a+"."+c:c):f.__unsetChanged(a?a+"."+c:c,b)},e)),e.right&&this.has(a)||this.set(a,e.properties.get(e.key)),""===a&&b.iter(e.properties.data(),function(a,b){this.set(b,a)},this)),e.right&&(this.on("strongchange:"+a,function(a){e.properties.set(e.key,a)},e),this.on("unset:"+a,function(a){e.properties.unset(e.key)},e),e.deep&&(this.on("strongdeepchange:"+a,function(a,b,c){e.properties.get(e.key?e.key+"."+c:c)===a?e.properties.__setChanged(e.key?e.key+"."+c:c,a,b,!0):e.properties.set(e.key?e.key+"."+c:c,a)},e),this.on("deepunset:"+a,function(a,b){e.properties.has(e.key?e.key+"."+b:b)?e.properties.unset(e.key?e.key+"."+b:b):e.properties.__unsetChanged(e.key?e.key+"."+b:b,a)},e)),e.left&&!this.has(a)||e.properties.set(e.key,this.get(a)),""===a&&b.iter(this.data(),function(a,b){e.properties.set(b,a)},this)),e.properties.on("destroy",function(){f.destroyed()||f.unbind(a)},e),this},unset:function(b){if(this.has(b)){var c=this.get(b);a.unset(b,this.__properties.data),this.__unsetChanged(b,c)}return this},set:function(b,c,e){if(d.is_object(c)&&c&&c.guid==this.__properties_guid)return c.properties&&this.bind(b,c.properties,{secondKey:c.key}),c.func&&this.compute(b,c.func,c.dependencies),this;c=this._beforeSet(b,c);var f=this.get(b);return f!==c?(a.set(b,c,this.__properties.data),this.__setChanged(b,c,f)):e&&(this.trigger("change",b,c,f,!0),this.trigger("change:"+b,c,f,!0)),this},binding:function(a){return{guid:this.__properties_guid,properties:this,key:a}},computed:function(a,b){return{guid:this.__properties_guid,func:a,dependencies:b}},pid:function(){return this.cid()},isSubsetOf:function(a){return b.subset_of(this.data(),a.data?a.data():a)},isSupersetOf:function(a){return b.superset_of(this.data(),a.data?a.data():a)}}}),a.define("module:Properties.Properties",["module:Class","module:Objs","module:Events.EventsMixin","module:Properties.PropertiesMixin"],function(a,b,c,d,e,f){return a.extend({scoped:f},[c,d,e,function(a){return{constructor:function(c,d){a.constructor.call(this),c&&this.setAll(c),d&&b.iter(d,function(a){this.materializeAttr(a)},this)}}}])}),a.define("module:Sort",["module:Comparators","module:Types","module:Objs"],function(a,b,c){return{sort_object:function(a,b){var c=[];for(var d in a)c.push({key:d,value:a[d]});c.sort(function(a,c){return b(a.key,c.key,a.value,c.value)});for(var e={},f=0;f<c.length;++f)e[c[f].key]=c[f].value;return e},deep_sort:function(c,d){if(d=d||a.byValue,b.is_array(c)){for(var e=0;e<c.length;++e)c[e]=this.deep_sort(c[e],d);return c.sort(d)}if(b.is_object(c)){for(var f in c)c[f]=this.deep_sort(c[f],d);return this.sort_object(c,d)}return c},dependency_sort:function(a,d,e,f){var g=b.is_string(d)?function(a){return a[d]}:d,h=b.is_string(e)?function(a){return a[e]}:e,i=b.is_string(f)?function(a){return a[f]}:f,j=a.length,k=[],l={},m={},n=0;for(n=0;j>n;++n){m[n]=!0;var o=g(a[n],n);l[o]=n,k.push({before:{},after:{}})}var p=function(a){return function(c){var d=l[c];b.is_defined(d)&&(k[a].before[d]=!0,k[d].after[a]=!0)}},q=function(a){return function(c){var d=l[c];b.is_defined(d)&&(k[a].after[d]=!0,k[d].before[a]=!0)}};for(n=0;j>n;++n)c.iter(h(a[n],n)||[],p(n)),c.iter(i(a[n])||[],q(n));for(var r=[];!b.is_empty(m);)for(n in m)if(b.is_empty(k[n].after)){delete m[n],r.push(a[n]);for(var s in k[n].before)delete k[s].after[n]}return r}}}),a.define("module:Strings",["module:Objs"],function(a){return{regexEscape:function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},padLeft:function(a,b,c){for(;a.length<c;)a=b+a;return a},padZeros:function(a,b){return this.padLeft(a+"","0",b)},nl2br:function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},htmlentities:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},JS_ESCAPES:{"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},JS_ESCAPER_REGEX:function(){return this.JS_ESCAPER_REGEX_CACHED||(this.JS_ESCAPER_REGEX_CACHED=new RegExp(a.keys(this.JS_ESCAPES).join("|"),"g")),this.JS_ESCAPER_REGEX_CACHED},js_escape:function(a){var b=this;return a.replace(this.JS_ESCAPER_REGEX(),function(a){return"\\"+b.JS_ESCAPES[a]})},starts_with:function(a,b){return a.substring(0,b.length)==b},ends_with:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},strip_start:function(a,b){return this.starts_with(a,b)?a.substring(b.length):a},last_after:function(a,b){return this.splitLast(a,b).tail},first_after:function(a,b){return a.substring(a.indexOf(b)+1,a.length)},EMAIL_ADDRESS_REGEX:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,is_email_address:function(a){return this.EMAIL_ADDRESS_REGEX.test(a)},STRIP_HTML_TAGS:["script","style","head"],STRIP_HTML_REGEX:/<\/?([a-z][a-z0-9]*)\b[^>]*>?/gi,STRIP_HTML_COMMENT_REGEX:/<![^>]*>/gi,strip_html:function(a){for(var b=a,c=0;c<this.STRIP_HTML_TAGS.length;++c)b=b.replace(new RegExp("<"+this.STRIP_HTML_TAGS[c]+".*</"+this.STRIP_HTML_TAGS[c]+">","i"),"");return b=b.replace(this.STRIP_HTML_REGEX,"").replace(this.STRIP_HTML_COMMENT_REGEX,"")},nltrim:function(a){var b=a.replace(/\t/g,"  ").split("\n"),c=null,d=0;for(d=0;d<b.length;++d){for(var e=0;e<b[d].length&&" "==b[d].charAt(e);)++e;e<b[d].length&&(c=null===c?e:Math.min(e,c))}for(d=0;d<b.length;++d)b[d]=b[d].substring(c);return b.join("\n").trim()},replaceAll:function(a,b,c){for(;a.indexOf(b)>=0;)a=a.replace(b,c);return a},capitalize:function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},email_get_name:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),(!a||b.length<2)&&(b=b[b.length-1].split("@"),a=b[0].trim()),a=a.replace(/['"]/g,"").replace(/[\\._@]/g," "),this.capitalize(a)},email_get_email:function(a){a=a||"";var b=a.split("<");return a=b[0].trim(),b.length>1&&(b=b[1].split(">"),a=b[0].trim()),a=a.replace(/'/g,"").replace(/"/g,"").trim()},email_get_salutatory_name:function(a){return this.email_get_name(a||"").split(" ")[0]},splitFirst:function(a,b){var c=a.indexOf(b);return{head:c>=0?a.substring(0,c):a,tail:c>=0?a.substring(c+b.length):""}},splitLast:function(a,b){var c=a.lastIndexOf(b);return{head:c>=0?a.substring(0,c):"",tail:c>=0?a.substring(c+b.length):a}},regexReplaceGroups:function(a,b){for(var c=/\(.*?\)/,d=function(a){return e?e:a.substring(1,a.length-1)};b.length>0;){var e=b.shift();a=a.replace(c,d)}return a},namedCaptureRegex:function(b){var c={},d=0,e=new RegExp(b.replace(/\([^)]+\)/gi,function(a){if("?"!=a.charAt(1)&&a.indexOf(":")>0){var b=a.indexOf(":");c[a.substring(1,b)]=d,a="("+a.substring(b+1,a.length-1)+")"}return d++,a})),f=function(b){return a.map(c,function(a){return b[a+1]})},g=function(a){var b=e.exec(a);return b?f(b):null},h=function(a){for(var b=[],e=0;d>e;++e)b.push(null);for(var f in a)f in c&&(b[c[f]]=a[f]);return b};return{regex:e,map:f,exec:g,mapBack:h}}}}),a.define("module:Structures.AvlTree",function(){return{empty:function(){return null},singleton:function(a){return{data:a,left:null,right:null,height:1,length:1}},min:function(a){return a.left?this.min(a.left):a.data},max:function(a){return a.right?this.max(a.right):a.data},height:function(a){return a?a.height:0},length:function(a){return a?a.length:0},__height_join:function(a,b){return 1+Math.max(this.height(a),this.height(b))},length_join:function(a,b){return 1+this.length(a)+this.length(b)},__create:function(a,b,c){return{data:a,left:b,right:c,height:this.__height_join(b,c),length:this.length_join(b,c)}},balance:function(a,b,c){return this.height(b)>this.height(c)+2?this.height(b.left)>=this.height(b.right)?this.__create(b.data,b.left,this.__create(a,b.right,c)):this.__create(b.right.data,this.__create(b.data,b.left,b.right.left),this.__create(a,b.right.right,c)):this.height(c)>this.height(b)+2?this.height(c.right)>=this.height(c.left)?this.__create(c.data,this.__create(a,b,c.left),c.right):this.__create(c.left.data,this.__create(a,b,c.left.left),this.__create(c.data,c.left.right,c.right)):this.__create(a,b,c)},__add_left:function(a,b){return b?this.balance(b.data,this.__add_left(a,b.left),b.right):this.singleton(a)},__add_right:function(a,b){return b?this.balance(b.data,b.data,this.__add_right(a,b.right)):this.singleton(a)},__join:function(a,b,c){return b?c?this.height(b)>this.height(c)+2?this.balance(b.data,b.left,this.__join(a,b.right,c)):this.height(c)>this.height(b)+2?this.balance(c.data,this.__join(a,b,c.left),c.right):this.__create(a,b,c):this.__add_right(a,b):this.__add_left(a,c)},take_min:function(a){if(!a.left)return[a.data,a.right];var b=this.take_min(a.left);return[b[0],this.__join(a.data,b[1],a.right)]},take_max:function(a){if(!a.right)return[a.data,a.left];var b=this.take_max(a.right);return[b[0],this.__join(a.data,a.left,b[1])]},take_min_iter:function(a){return a?a.left?this.take_min_iter(this.__create(a.left.data,a.left.left,this.__create(a.data,a.left.right,a.right))):[a.data,a.left]:null},take_max_iter:function(a){return a?a.right?this.take_max_iter(this.__create(a.right.data,this.__create(a.data,a.left,a.right.left),a.right.right)):[a.data,a.right]:null}}}),a.define("module:Structures.TreeMap",["module:Structures.AvlTree"],function(a){return{empty:function(a){return{root:null,compare:a||function(a,b){return a>b?1:b>a?-1:0}}},is_empty:function(a){return!a.root},length:function(a){return a.root?a.root.length:0},__add:function(b,c,d,e){var f={key:b,value:c};if(!e)return a.singleton(f);var g=d.compare(b,e.data.key);return 0===g?(e.data=f,e):0>g?a.balance(e.data,this.__add(b,c,d,e.left),e.right):a.balance(e.data,e.left,this.__add(b,c,d,e.right))},add:function(a,b,c){return c.root=this.__add(a,b,c,c.root),c},singleton:function(a,b,c){return this.add(a,b,this.empty(c))},__find:function(a,b,c){if(!c)return null;var d=b.compare(a,c.data.key);return 0===d?c.data.value:this.__find(a,b,0>d?c.left:c.right)},find:function(a,b){return this.__find(a,b,b.root)},__iterate:function(a,b,c,d,e){return b?this.__iterate(a,e?b.right:b.left,c,d,e)&&c.call(d,b.data.key,b.data.value)!==!1&&this.__iterate(a,e?b.left:b.right,c,d,e):!0},iterate:function(a,b,c,d){this.__iterate(a,a.root,b,c,d)},__iterate_from:function(a,b,c,d,e,f){if(!c)return!0;var g=b.compare(a,c.data.key)*(f?-1:1);return 0>g&&!this.__iterate_from(a,b,f?c.right:c.left,d,e,f)?!1:0>=g&&d.call(e,c.data.key,c.data.value)===!1?!1:this.__iterate_from(a,b,f?c.left:c.right,d,e,f)},iterate_from:function(a,b,c,d,e){this.__iterate_from(a,b,b.root,c,d,e)},iterate_range:function(a,b,c,d,e,f){this.iterate_from(a,c,function(a,g){return c.compare(a,b)*(f?-1:1)<=0&&d.call(e,a,g)!==!1},this,f)},take_min:function(b){var c=a.take_min(b.root);return c[1]={compare:b.compare,root:c[1]},c},__treeSizeLeft:function(a,b,c){var d=b.compare(a,c.data.key);return 0>d?this.__treeSizeLeft(a,b,c.left):1+(c.left?c.left.length:0)+(d>0?this.__treeSizeLeft(a,b,c.right):0)},__treeSizeRight:function(a,b,c){var d=b.compare(a,c.data.key);return d>0?this.__treeSizeRight(a,b,c.right):1+(c.right?c.right.length:0)+(0>d?this.__treeSizeRight(a,b,c.left):0)},__distance:function(a,b,c,d){var e=c.compare(a,d.data.key),f=c.compare(b,d.data.key);return e>0||0>f?this.__distance(a,b,c,e>0?d.right:d.left):1+(f>0?this.__treeSizeLeft(b,c,d.right):0)+(0>e?this.__treeSizeRight(a,c,d.left):0)},treeSizeLeft:function(a,b){return this.__treeSizeLeft(a,b,b.root)},treeSizeRight:function(a,b){return this.__treeSizeRight(a,b,b.root)},distance:function(a,b,c){return c.compare(a,b)<0?this.__distance(a,b,c,c.root)-1:0}}}),a.define("module:Templates",["module:Types","module:Strings"],function(a,b){return{tokenize:function(c){if(a.is_array(c))return c;var d=[],e=0,f=this;return c.replace(f.SYNTAX_REGEX(),function(a,g,h,i,j){return j>e&&d.push({type:f.TOKEN_STRING,data:b.js_escape(c.slice(e,j))}),i&&d.push({type:f.TOKEN_CODE,data:i}),g&&d.push({type:f.TOKEN_EXPR,data:g}),h&&d.push({type:f.TOKEN_ESC,data:h}),e=j+a.length,a}),d},compile:function(c,d){a.is_string(c)&&(c=this.tokenize(c)),d=d||{};for(var e=d.start_index||0,f=d.end_index||c.length,g="__p+='",h=e;f>h;++h)switch(c[h].type){case this.TOKEN_STRING:g+=c[h].data;break;case this.TOKEN_CODE:g+="';\n"+c[h].data+"\n__p+='";break;case this.TOKEN_EXPR:g+="'+\n((__t=("+c[h].data+"))==null?'':__t)+\n'";break;case this.TOKEN_ESC:g+="'+\n((__t=("+c[h].data+"))==null?'':Helpers.Strings.htmlentities(__t))+\n'"}g+="';\n",g="with(obj||{}){\n"+g+"}\n",g="var __t,__p='',__j=Array.prototype.join,echo=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";var i=new Function("obj","Helpers",g),j=function(a){return i.call(this,a,{Strings:b})};return j.source="function(obj, Helpers){\n"+g+"}",j},SYNTAX:{OPEN:"{%",CLOSE:"%}",MODIFIER_CODE:"",MODIFIER_EXPR:"=",MODIFIER_ESC:"-"},SYNTAX_REGEX:function(){var a=this.SYNTAX;return this.SYNTAX_REGEX_CACHED||(this.SYNTAX_REGEX_CACHED=new RegExp(a.OPEN+a.MODIFIER_EXPR+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_ESC+"([\\s\\S]+?)"+a.CLOSE+"|"+a.OPEN+a.MODIFIER_CODE+"([\\s\\S]+?)"+a.CLOSE+"|$","g")),this.SYNTAX_REGEX_CACHED},TOKEN_STRING:1,TOKEN_CODE:2,TOKEN_EXPR:3,TOKEN_ESC:4}}),a.define("module:Templates.Template",["module:Class","module:Templates"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this),this.__tokens=b.tokenize(c),this.__compiled=b.compile(this.__tokens)},evaluate:function(a){return this.__compiled.apply(this,[a])}}})}),a.define("module:Time",[],function(){return{__components:{year:{set:function(a,b){a.setUTCFullYear(b)},get:function(a){return a.getUTCFullYear()}},month:{set:function(a,b){a.setUTCMonth(b)},get:function(a){return a.getUTCMonth()}},day:{dependencies:{weekday:!0},set:function(a,b){a.setUTCDate(b+1)},get:function(a){return a.getUTCDate()-1},milliseconds:864e5},weekday:{dependencies:{day:!0,month:!0,year:!0},set:function(a,b){a.setUTCDate(a.getUTCDate()+b-a.getUTCDay())},get:function(a){return a.getUTCDay()}},hour:{set:function(a,b){a.setUTCHours(b)},get:function(a){return a.getUTCHours()},max:23,milliseconds:36e5},minute:{set:function(a,b){a.setUTCMinutes(b)},get:function(a){return a.getUTCMinutes()},max:59,milliseconds:6e4},second:{set:function(a,b){a.setUTCSeconds(b)},get:function(a){return a.getUTCSeconds()},max:59,milliseconds:1e3},millisecond:{set:function(a,b){a.setUTCMilliseconds(b)},get:function(a){return a.getUTCMilliseconds()},max:999,milliseconds:1}},timezoneBias:function(a){return a===!0&&(a=(new Date).getTimezoneOffset()),"undefined"!=typeof a&&null!==a&&a!==!1||(a=0),60*a*1e3},timeToDate:function(a,b){return new Date(a+this.timezoneBias(b))},dateToTime:function(a,b){return a.getTime()-this.timezoneBias(b)},timeToTimezoneBasedDate:function(a,b){return new Date(a-this.timezoneBias(b))},timezoneBasedDateToTime:function(a,b){return a.getTime()+this.timezoneBias(b)},decodeTime:function(a,b){var c=this.timeToTimezoneBasedDate(a||this.now(),b),d={};for(var e in this.__components)d[e]=this.__components[e].get(c);return d},encodeTime:function(a,b){return this.updateTime(this.now(),a,b)},encodePeriod:function(a){return this.incrementTime(0,a)},updateTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c);for(var e in b)this.__components[e].set(d,b[e]);return this.timezoneBasedDateToTime(d,c)},now:function(a){return this.dateToTime(new Date,a)},perfNow:function(){return"undefined"==typeof performance?(new Date).getTime():performance.now()},incrementTime:function(a,b){var c=this.timeToDate(a);for(var d in b)this.__components[d].set(c,this.__components[d].get(c)+b[d]);return this.dateToTime(c)},floorTime:function(a,b,c){var d=this.timeToTimezoneBasedDate(a,c),e=!1;for(var f in this.__components){var g=this.__components[f];e=e||f==b,!e||g.dependencies&&g.dependencies[b]||g.set(d,0)}return this.timezoneBasedDateToTime(d,c)},ago:function(a,b){return this.now(b)-a},timeComponent:function(a,b,c){return Math[c||"floor"](a/this.__components[b].milliseconds)},timeComponentGet:function(a,b,c){return this.__components[b].get(this.timeToTimezoneBasedDate(a,c))},timeModulo:function(a,b,c){return this.timeComponent(a,b,c)%(this.__components[b].max+1)}}}),a.define("module:TimeFormat",["module:Time","module:Strings","module:Objs"],function(a,b,c){return{formatMappings:{HH:function(c){return b.padZeros(a.timeModulo(c,"hour","floor"),2)},H:function(b){return a.timeModulo(b,"hour","floor")},"h+":function(b){return a.timeComponent(b,"hour","floor")},hh:function(c){var d=a.timeModulo(c,"hour","floor");return d=0===d?12:d>12?d-12:d,b.padZeros(d," ",2)},h:function(b){var c=a.timeModulo(b,"hour","floor");return c=0===c?12:c>12?c-12:c},"M+":function(b){return a.timeComponent(b,"minute","floor")},MM:function(c){return b.padZeros(a.timeModulo(c,"minute","floor"),2)},M:function(b){return a.timeModulo(b,"minute","floor")},"s+":function(b){return a.timeComponent(b,"second","floor")},ss:function(c){return b.padZeros(a.timeModulo(c,"second","floor"),2)},s:function(b){return a.timeModulo(b,"second","floor")},mmm:function(a){return new Date(a).toUTCString().split(" ")[2]},mm:function(c){return b.padZeros(a.timeComponentGet(c,"month")+1,2)},m:function(b){return a.timeComponentGet(b,"month")+1},"d+":function(b){return a.timeComponent(b,"day","floor")},dddd:function(b){var c={2:"s",3:"nes",4:"rs",6:"ur"};return new Date(b).toUTCString().substring(0,3)+(c[a.timeComponentGet(b,"weekday")]||"")+"day"},ddd:function(a){return new Date(a).toUTCString().substring(0,3)},dd:function(c){return b.padZeros(a.timeComponentGet(c,"day")+1,2)},d:function(b){return a.timeComponentGet(b,"day")+1},yyyy:function(b){return a.timeComponentGet(b,"year")},yy:function(b){return a.timeComponentGet(b,"year")%100},"l+":function(a){return a},l:function(b){return a.timeComponent(b,"millisecond","floor")},L:function(b){return a.timeComponent(b,"millisecond","floor")%10},tt:function(b){return a.timeModulo(b,"hour","floor")<12?"am":"pm"},t:function(b){return a.timeModulo(b,"hour","floor")<12?"a":"p"},TT:function(b){return a.timeModulo(b,"hour","floor")<12?"AM":"PM"},T:function(b){return a.timeModulo(b,"hour","floor")<12?"A":"P"},o:function(a,c){return c=Math.floor(c/1e3/60),(c>0?"-":"+")+b.padZeros(100*Math.floor(Math.abs(c)/60)+Math.abs(c)%60,4)}},ELAPSED_HOURS_MINUTES_SECONDS:"h+:MM:ss",ELAPSED_MINUTES_SECONDS:"M+:ss",FULL_YEAR:"yyyy",LETTER_MONTH:"mmm",LETTER_MONTH_AND_DAY:"mmm d",WEEKDAY:"ddd",HOURS_MINUTES_TT:"hh:MM tt",format:function(b,d,e){d=d||a.now();var f=a.timeToTimezoneBasedDate(d,e),g=a.timezoneBias(e),h=b,i=[];c.iter(this.formatMappings,function(a,b){if(h.indexOf(b)>=0){var c=i.length;i.push(a(f,g)),h=h.replace(b,"$"+c+"$")}},this);for(var j=0;j<i.length;++j)h=h.replace("$"+j+"$",i[j]);return h},monthString:function(b){return this.format("mmm",a.encodePeriod({month:b}))},weekdayString:function(b){return this.format("ddd",a.encodePeriod({weekday:b}))},formatRelativeMostSignificant:function(b,c,d){c=c||a.now();var e=a.decodeTime(b,d),f=a.decodeTime(c,d);return e.year===f.year&&e.month===f.month&&e.day===f.day?this.format(this.HOURS_MINUTES_TT,b,d):6048e5>c-b&&e.weekday!==f.weekday?this.format(this.WEEKDAY,b,d):e.year===f.year&&e.month+1>=f.month||e.year+1===f.year&&e.month+1>=f.month+12-1?this.format(this.LETTER_MONTH_AND_DAY,b,d):e.year===f.year||e.year+1===f.year&&e.month>f.month?this.format(this.LETTER_MONTH,b,d):this.format(this.FULL_YEAR,b,d)}}}),a.define("module:Tokens",function(){return{generate_token:function(a){a=a||16;for(var b="";b.length<a;)b+=Math.random().toString(36).substr(2);
return b.substr(0,a)},simple_hash:function(a){var b=0;if(!a.length)return b;for(var c,d=0,e=a.length;e>d;++d)c=a.charCodeAt(d),b=(b<<5)-b+c,b&=b;return Math.abs(b)}}}),a.define("module:Trees.TreeNavigator",function(){return{nodeRoot:function(){},nodeId:function(a){},nodeParent:function(a){},nodeChildren:function(a){},nodeWatch:function(a,b,c){},nodeUnwatch:function(a,b,c){},nodeData:function(a){}}}),a.define("module:Trees.TreeQueryEngine",["module:Class","module:Parser.Lexer","module:Trees.TreeQueryObject"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(c){a.constructor.call(this),this.__navigator=c,this.__lexer=this._auto_destroy(new b({"<\\+":{token:"Up"},"<":{token:"Up",single:!0},">\\+":{token:"Down"},">":{token:"Down",single:!0},"\\[s*([a-zA-Z]+)s*=s*'([^']*)'s*\\]":{token:"Selector",key:"$1",value:"$2"},'\\[s*([a-zA-Z]+)s*=s*"([^\']*)"s*\\]':{token:"Selector",key:"$1",value:"$2"},s:null}))},query:function(a,b){return new c(this.__navigator,a,this.__lexer.lex(b))}}})}),a.define("module:Trees.TreeQueryObject",["module:Class","module:Events.EventsMixin","module:Objs","module:Types"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__navigator=b,this.__node=c,this.__query=d,this.__result={},this.__partials={},this.__ids=0,this.__register(c,0,{})},destroy:function(){c.iter(this.__partials,function(a){c.iter(a.partials,function(b){this.__navigator.nodeUnwatch(a.node,null,b)},this)},this),a.destroy.call(this)},result:function(){var a=[];return c.iter(this.__result,function(b){a.push(b.node)}),a},__register:function(a,b){var c=this.__navigator.nodeId(a);this.__partials[c]||(this.__partials[c]={node:a,partials:{}});var d=this.__partials[c];this.__ids++;var e={owner:d,id:this.__ids,query_index_start:b,query_index_next:b,query_index_last:b,partial_match:!1,partial_final:b>=this.__query.length,partial_data:!1,partial_children:!1,partial_parent:!1,partial_star:!1,parent:null,deps:{}};d.partials[e.id]=e;for(var f=e.query_index_start;f<this.__query.length;++f){if("Selector"!=this.__query[f].token){"Up"==this.__query[f].token?e.partial_parent=!0:"Down"==this.__query[f].token&&(e.partial_children=!0),e.partial_star=!this.__query[f].single,e.partial_star||(e.query_index_next=f+1);break}e.partial_data=!0,e.query_index_next=f+1,e.partial_final=f+1==this.__query.length}e.query_index_last=e.partial_star?e.query_index_next+1:e.query_index_next;var g=this;return this.__navigator.nodeWatch(a,function(a,b){"data"==a&&e.partial_data&&g.__update(e),"remove"==a&&g.__unregisterPartial(e),"addChild"==a&&e.partial_children&&e.partial_match&&g.__addDependentPartial(e,b)},e),this.__update(e),e},__unregisterPartial:function(a){var b=a.owner,e=b.node,f=this.__navigator.nodeId(e);a.partial_final&&this.__result[f]&&(this.__result[f].count--,this.__result[f].count<=0&&(delete this.__result[f],this.trigger("remove",e),this.trigger("change"))),c.iter(a.deps,this.__unregisterPartial,this),a.parent&&delete a.parent.deps[a.id],this.__navigator.nodeUnwatch(e,null,a),delete b.partials[a.id],d.is_empty(b.partials)&&delete this.__partials[f]},__addDependentPartial:function(a,b){var d=[];d.push(this.__register(b,a.query_index_next)),a.partial_star&&d.push(this.__register(b,a.query_index_next+1)),c.iter(d,function(b){a.deps[b.id]=b,b.parent=a},this)},__update:function(a){for(var b=!0,d=a.owner.node,e=this.__navigator.nodeId(d),f=this.__navigator.nodeData(d),g=a.query_index_start;g<a.query_index_last;++g){var h=this.__query[g];if("Selector"!=h.token)break;if(f[h.key]!=h.value){b=!1;break}}if(b!=a.partial_match)if(a.partial_match=b,b)if(a.partial_final)this.__result[e]?this.__result[e].count++:(this.__result[e]={node:d,count:1},this.trigger("add",d),this.trigger("change"));else if(a.partial_parent){var i=this.__navigator.nodeParent(d);i&&this.__addDependentPartial(a,i)}else a.partial_children&&c.iter(this.__navigator.nodeChildren(d),function(b){this.__addDependentPartial(a,b)},this);else a.partial_final&&(this.__result[e].count--,this.__result[e].count<=0&&(delete this.__result[e],this.trigger("remove",d),this.trigger("change"))),c.iter(a.deps,this.__unregisterPartial,this)}}}])}),a.define("module:Types",function(){return{is_object:function(a){return"object"==typeof a},is_array:function(a){return Array.isArray(a)},is_undefined:function(a){return"undefined"==typeof a},is_null:function(a){return null===a},is_none:function(a){return this.is_undefined(a)||this.is_null(a)},is_defined:function(a){return"undefined"!=typeof a},is_empty:function(a){return this.is_none(a)||this.is_array(a)&&0===a.length||this.is_object(a)&&this.is_empty_object(a)},is_empty_object:function(a){for(var b in a)return!1;return!0},is_string:function(a){return"string"==typeof a},is_function:function(a){return"function"==typeof a},is_boolean:function(a){return"boolean"==typeof a},compare:function(a,b){if(this.is_boolean(a)&&this.is_boolean(b))return a==b?0:a?1:-1;if(this.is_array(a)&&this.is_array(b)){for(var c=a.length,d=b.length,e=Math.min(c,d),f=0;e>f;++f){var g=this.compare(a[f],b[f]);if(0!==g)return g}return c==d?0:c>d?1:-1}return a.localeCompare(b)},parseBool:function(a){return this.is_boolean(a)?a:"true"===a||""===a?!0:"false"===a?!1:null},parseArray:function(a){return a.split(",")},type_of:function(a){return this.is_array(a)?"array":typeof a},parseType:function(a,b){return this.is_string(a)?(b=b.toLowerCase(),"bool"==b||"boolean"==b?this.parseBool(a):"int"==b||"integer"==b?parseInt(a,10):"date"==b||"time"==b||"datetime"==b?parseInt(a,10):"float"==b||"double"==b?parseFloat(a):"array"==b?this.parseArray(a):"object"==b?JSON.parse(a):a):a},parseTypes:function(a,b){var c={};for(var d in a)c[d]=d in b?this.parseType(a[d],b[d]):a[d];return c},objectType:function(a){if(!this.is_object(a))return null;var b=a.toString().match(/\[object (.*)\]/);return b?b[1]:null},is_pure_object:function(a){return this.is_object(a)&&("[object]"===a.toString().toLowerCase()||"[object object]"===a.toString().toLowerCase())}}}),a.define("module:Channels.Sender",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{send:function(a,b,c){this.trigger("send",a,b),this._send(a,b,c)},_send:function(a,b,c){}}])}),a.define("module:Channels.Receiver",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,{_receive:function(a,b){this.trigger("receive",a,b),this.trigger("receive:"+a,b)}}])}),a.define("module:Channels.ReceiverSender",["module:Channels.Sender","module:Async"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__receiver=b,this.__async=c,this.__delay=d},_send:function(a,c,d){this.__async?b.eventually(function(){this.__receiver._receive(a,c)},this,this.__delay):this.__receiver._receive(a,c)}}})}),a.define("module:Channels.ReadySender",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__cache=[],this.__sender=b},_send:function(a,b,c){this.__ready?this.__sender.send(a,b,c):this.__cache.push({message:a,data:b,serializerInfo:c})},ready:function(){this.__ready=!0,this.__cache.forEach(function(a){this.__sender.send(a.message,a.data,a.serializerInfo)},this),this.__cache=[]},unready:function(){this.__ready=!1}}})}),a.define("module:Channels.SenderMultiplexer",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__sender=b,this.__prefix=c},_send:function(a,b,c){this.__sender.send(this.__prefix+":"+a,b,c)}}})}),a.define("module:Channels.ReceiverMultiplexer",["module:Channels.Receiver","module:Strings"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),this.__receiver=c,this.__prefix=d,this.__receiver.on("receive",function(a,c){b.starts_with(a,this.__prefix+":")&&this._receive(b.strip_start(a,this.__prefix+":"),c)},this)}}})}),a.define("module:Channels.SimulatorSender",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{online:!0,constructor:function(b){a.constructor.call(this),this.__sender=b},_send:function(a,b){this.online&&this.__sender.send(a,b)}}})}),a.define("module:Channels.TransportChannel",["module:Class","module:Objs","module:Timers.Timer","module:Time","module:Promise"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(d,e,f){a.constructor.call(this),this.__sender=d,this.__receiver=e,this.__options=b.extend(f,{timeout:1e4,tries:1,timer:500}),this.__options.auto_destroy&&(this.auto_destroy(d),this.auto_destroy(e)),this.__receiver.on("receive:send",function(a){this.__reply(a)},this),this.__receiver.on("receive:reply",function(a){this.__complete(a)},this),this.__sent_id=0,this.__sent={},this.__received={},this.__timer=this._auto_destroy(new c({delay:this.__options.timer,context:this,fire:this.__maintenance}))},_reply:function(a,b){},send:function(a,b,c){var f=e.create();return c=c||{},c.stateless?(this.__sender.send("send",{message:a,data:b,stateless:!0},c.serializerInfo),f.asyncSuccess(!0)):(this.__sent_id++,this.__sent[this.__sent_id]={message:a,data:b,tries:1,time:d.now(),id:this.__sent_id,promise:f},this.__sender.send("send",{message:a,data:b,id:this.__sent_id},c.serializerInfo)),f},__reply:function(a){return a.stateless?void this._reply(a.message,a.data):void(this.__received[a.id]?this.__received[a.id].returned&&this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success}):(this.__received[a.id]=a,this.__received[a.id].time=d.now(),this.__received[a.id].returned=!1,this.__received[a.id].success=!1,this._reply(a.message,a.data).success(function(b){this.__received[a.id].reply=b,this.__received[a.id].success=!0},this).error(function(b){this.__received[a.id].reply=b},this).callback(function(){this.__received[a.id].returned=!0,this.__sender.send("reply",{id:a.id,reply:a.reply,success:a.success})},this)))},__complete:function(a){if(this.__sent[a.id]){var b=this.__sent[a.id].promise;b[a.success?"asyncSuccess":"asyncError"](a.reply),delete this.__sent[a.id]}},__maintenance:function(){var a=d.now();for(var b in this.__received){var c=this.__received[b];c.time+this.__options.tries*this.__options.timeout<=a&&delete this.__received[b]}for(var e in this.__sent){var f=this.__sent[e];f.time+f.tries*this.__options.timeout<=a&&(f.tries<this.__options.tries?(f.tries++,this.__sender.send("send",{message:f.message,data:f.data,id:f.id})):(f.promise.asyncError({message:f.message,data:f.data}),delete this.__sent[e]))}}}})}),a.define("module:Classes.ConditionalInstance",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._options=this.cls._initializeOptions(b)}}},{_initializeOptions:function(a){return a},supported:function(a){return!1}},{__registry:[],register:function(a,b){this.__registry.push({cls:a,priority:b})},match:function(a){a=this._initializeOptions(a);var c=null;return b.iter(this.__registry,function(b){(!c||c.priority<b.priority)&&b.cls.supported(a)&&(c=b)},this),c},create:function(a){var b=this.match(a);return b?new b.cls(a):null},anySupport:function(a){return null!==this.match(a)}})}),a.define("module:Classes.OptimisticConditionalInstance",["module:Class","module:Objs","module:Promise"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){a.constructor.call(this),this._transitionals={}},_initializer:function(){},_initialize:function(){return this._initializer().success(function(){this._afterInitialize()},this)},transitionals:function(){return this._transitionals},_afterInitialize:function(){}}},{},{__registry:[],register:function(a,b){this.__registry.push({cls:a,priority:b})},create:function(a){var d=c.create(),e=b.clone(this.__registry,1),f={},g=function(){if(!e.length)return void d.asyncError(!0);for(var b=-1,c=-1,h=0;h<e.length;++h)e[h].priority>b&&(b=e[h].priority,c=h);var i=e[c].cls;e.splice(c,1);var j=new i(a,f);j._initialize().error(function(){f=j.transitionals(),j.destroy(),g.call(this)},this).success(function(){d.asyncSuccess(j)})};return g.call(this),d}})}),a.define("module:Classes.LocaleMixin",function(){return{_clearLocale:function(){},_setLocale:function(a){},getLocale:function(){return this.__locale},clearLocale:function(){this._clearLocale(),this.__locale=null},setLocale:function(a){this.clearLocale(),this.__locale=a,this._setLocale(a)},isLocaleSet:function(){return!!this.__locale},setWeakLocale:function(a){this.isLocaleSet()||this.setLocale(a)}}}),a.define("module:Classes.LocaleAggregator",["module:Class","module:Classes.LocaleMixin","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},[b,function(a){return{constructor:function(){a.constructor.call(this),this.__locales=[]},register:function(a){this.__locales.push(a)},_clearLocale:function(){c.iter(this.__locales,function(a){a.clearLocale()},this)},_setLocale:function(a){c.iter(this.__locales,function(b){b.setLocale(a)},this)}}}])}),a.define("module:Classes.ObjectCache",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__keyFunction=b,this.__keyFunctionCtx=c,this.__cache={}},destroy:function(){b.iter(this.__cache,function(a){a.off(null,null,this)},this)},get:function(a){return this.__cache[a]},register:function(a){var b=this.__keyFunction.call(this.__keyFunctionCtx||this,a);return this.__cache[b]&&!this.__cache[b].destroyed()&&this.__cache[b].off(null,null,this),this.__cache[b]=a,a.on("destroy",function(){delete this.__cache[b]},this),this}}})}),a.define("module:Classes.ClassRegistry",["module:Class","module:Types","module:Functions","module:Objs"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(c,d){a.constructor.call(this),this._classes=b.is_array(c)?c:[c||{}],this._lowercase=d},_sanitize:function(a){return this._lowercase?a.toLowerCase():a},register:function(a,b){return this._classes[this._classes.length-1][this._sanitize(a)]=b,this},get:function(a){if(!b.is_string(a))return a;a=this._sanitize(a);for(var c=this._classes.length-1;c>=0;--c)if(a in this._classes[c])return this._classes[c][a];return null},create:function(a){var b=c.newClassFunc(this.get(a));return b.apply(this,c.getArguments(arguments,1))},classes:function(){var a={};return d.iter(this._classes,function(b){a=d.extend(a,b)}),a}}})}),a.define("module:Classes.ContextRegistry",["module:Class","module:Ids","module:Types","module:Objs","module:Iterators.MappedIterator","module:Iterators.ObjectValuesIterator"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{constructor:function(b,c){a.constructor.apply(this),this.__data={},this.__contexts={},this.__serializer=b||this.__defaultSerializer,this.__serializerContext=c||this},__defaultSerializer:function(a){return c.is_object(a)?b.objectId(a):a},_serializeContext:function(a){return a?b.objectId(a):null},_serializeData:function(a){return this.__serializer.call(this.__serializerContext,a)},get:function(a){var b=this._serializeData(a);return this.__data[b]},register:function(a,b){var c=this._serializeData(a),d=this._serializeContext(b),e=!1;return c in this.__data||(this.__data[c]={data:a,contexts:{}},e=!0),d in this.__contexts||(this.__contexts[d]={context:b,datas:{}}),this.__data[c].contexts[d]=!0,this.__contexts[d].datas[c]=!0,e?this.__data[c].data:null},unregister:function(a,b){var e=[];if(a){var f=this.__serializer.call(this.__serializerContext,a);if(this.__data[f])if(b){var g=this._serializeContext(b);this.__contexts[g]&&(delete this.__contexts[g].datas[f],c.is_empty(this.__contexts[g].datas)&&delete this.__contexts[g]),delete this.__data[f].contexts[g],c.is_empty(this.__data[f].contexts)&&(e.push(this.__data[f].data),delete this.__data[f])}else d.iter(this.__data[f].contexts,function(a,b){this.__contexts[b]&&(delete this.__contexts[b].datas[f],c.is_empty(this.__contexts[b].datas)&&delete this.__contexts[b])},this),e.push(this.__data[f].data),delete this.__data[f]}else if(b){var h=this._serializeContext(b);this.__contexts[h]&&(d.iter(this.__contexts[h].datas,function(a,b){this.__data[b]&&(delete this.__data[b].contexts[h],c.is_empty(this.__data[b].contexts)&&(e.push(this.__data[b].data),delete this.__data[b]))},this),delete this.__contexts[h])}else d.iter(this.__data,function(a){e.push(a.data)},this),this.__data={},this.__contexts=[];return e},customIterator:function(){return new f(this.__data)},iterator:function(){return new e(this.customIterator(),function(a){return a.data})}}})}),a.define("module:Classes.Taggable",["module:Objs"],function(a){return{hasTag:function(a){return this.__tags&&a in this.__tags},getTags:function(){return Object.keys(this.__tags||{})},removeTag:function(a){return this.__tags&&(delete this.__tags[a],this._notify("tags-changed")),this},removeTags:function(b){return a.iter(b,this.removeTag,this),this},addTag:function(a){return this.__tags=this.__tags||{},this.__tags[a]=!0,this._notify("tags-changed"),this},addTags:function(b){return a.iter(b,this.addTag,this),this},tagIntersect:function(b){return a.filter(b,this.hasTag,this)}}}),a.define("module:Classes.StringTable",["module:Class","module:Classes.Taggable","module:Functions","module:Objs"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{_notifications:{"tags-changed":function(){this.__cache={}}},constructor:function(){a.constructor.call(this),this.__cache={},this.__strings={}},__resolveKey:function(a,b){return b&&(a=b+"."+a),a=a.replace(/[^\.]+\.</g,"")},__betterMatch:function(a,b){var c=this.tagIntersect(a.tags).length-this.tagIntersect(b.tags).length;return 0!==c?c>0:(c=a.priority-b.priority,0!==c?c>0:(c=b.tags.length-a.tags.length,c>0))},register:function(){var a=c.matchArgs(arguments,{strings:!0,prefix:"string",tags:"array",priority:"number"});return d.iter(a.strings,function(b,c){c=this.__resolveKey(c,a.prefix),this.__strings[c]=this.__strings[c]||[],this.__strings[c].push({value:b,tags:a.tags||[],priority:a.priority||0}),delete this.__cache[c]},this),this},get:function(a,b){if(a=this.__resolveKey(a,b),a in this.__cache)return this.__cache[a];if(!(a in this.__strings))return null;var c=null;return d.iter(this.__strings[a],function(a){c&&!this.__betterMatch(a,c)||(c=a)},this),this.__cache[a]=c.value,c.value},all:function(){return d.map(this.__strings,function(a,b){return this.get(b)},this)}}}])}),a.define("module:Classes.LocaleTable",["module:Classes.StringTable","module:Classes.LocaleMixin"],function(a,b,c){return a.extend({scoped:c},[b,{_localeTags:function(a){if(!a)return null;var b=[];return b.push("language:"+a),a.indexOf("-")>0&&b.push("language:"+a.substring(0,a.indexOf("-"))),b},_clearLocale:function(){this.removeTags(this._localeTags(this.getLocale()))},_setLocale:function(a){this.addTags(this._localeTags(a))}}])}),a.define("module:Collections.Collection",["module:Class","module:Events.EventsMixin","module:Objs","module:Functions","module:Lists.ArrayList","module:Ids","module:Properties.Properties","module:Iterators.ArrayIterator","module:Iterators.FilteredIterator","module:Iterators.ObjectValuesIterator","module:Types","module:Promise"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a.extend({scoped:m},[b,function(b){return{constructor:function(a){b.constructor.call(this),k.is_array(a)&&(a={objects:a}),a=a||{},this.__indices={},a.release_references&&(this.__release_references=!0),a.indices&&c.iter(a.indices,this.add_secondary_index,this);var f={};"compare"in a&&(f.compare=a.compare),f.get_ident=d.as_method(this.get_ident,this),this.__data=new e([],f);var g=this;this.__data._ident_changed=function(a,b){g._index_changed(a,b)},this.__data._re_indexed=function(a){g._re_indexed(a)},this.__data._sorted=function(){g._sorted()},"objects"in a&&this.add_objects(a.objects)},add_secondary_index:function(a){return this.__indices[a]={},this.iterate(function(b){var c=b.get(a);this.__indices[a][c]=this.__indices[a][c]||{},this.__indices[a][c][this.get_ident(b)]=b},this),this},get_by_secondary_index:function(a,b,d){return d?c.ithValue(this.__indices[a][b]):this.__indices[a][b]},get_ident:function(a){return f.objectId(a)},set_compare:function(a){return this.trigger("set_compare",a),this.__data.set_compare(a),this},get_compare:function(){return this.__data.get_compare()},__load_item:function(a){"on"in a&&a.on("change",function(b,c,d){this._object_changed(a,b,c,d)},this),this.__release_references&&a.increaseRef(this)},__unload_item:function(a){"off"in a&&a.off(null,null,this),this.__release_references&&a.decreaseRef(this)},destroy:function(){this.__data.iterate(this.__unload_item,this),this.__data.destroy(),this.trigger("destroy"),b.destroy.call(this)},count:function(){return this.__data.count()},_index_changed:function(a,b){this.trigger("index",a,b)},_re_indexed:function(a){this.trigger("reindexed",a)},_sorted:function(){this.trigger("sorted")},_object_changed:function(a,b,c){this.trigger("update"),this.trigger("change",a,b,c),this.trigger("change:"+b,a,c),this.__data.re_index(this.getIndex(a))},add:function(b){if(a.is_class_instance(b)||(b=new g(b)),this.exists(b))return null;var d=this.__data.add(b);return null!==d&&(c.iter(this.__indices,function(a,c){var d=b.get(c);a[d]=a[d]||{},a[d][this.get_ident(b)]=b},this),this.trigger("add",b),this.trigger("update"),this.__load_item(b)),d},replace_objects:function(b,d){var e=[],f={};if(c.iter(b,function(b){var c=a.is_class_instance(b),d=c?b:new g(b),h=this.get_ident(d);f[h]=!0;var i=this.getById(h);i?c?(this.remove(i),this.add(d)):(d.destroy(),i.setAll(b)):e.push(d)},this),!d){for(var h=this.iterator();h.hasNext();){var i=h.next();f[this.get_ident(i)]||(this.remove(i),e.length>0&&this.add(e.shift()))}h.destroy()}for(;e.length>0;)this.add(e.shift());return this},add_objects:function(a,b){var d=0;return c.iter(a,function(a){this.add(a)&&d++},this),b?this:d},exists:function(a){return this.__data.exists(a)},remove:function(a){if(!this.exists(a))return null;c.iter(this.__indices,function(b,c){var d=a.get(c);b[d]&&(delete b[d][this.get_ident(a)],k.is_empty(b[d])&&delete b[d])},this);var b=this.__data.remove(a);return this.trigger("remove",a),this.__unload_item(a),this.trigger("update"),b},getByIndex:function(a){return this.__data.get(a)},getById:function(a){return this.__data.get(this.__data.ident_by_id(a))},getIndex:function(a){return this.__data.get_ident(a)},iterate:function(a,b){return this.__data.iterate(a,b),this},iterator:function(){return h.byIterate(this.iterate,this)},iterateSecondaryIndexValue:function(a,b){return new j(this.__indices[a][b])},query:function(a){var b=null;for(var c in this.__indices)if(c in a){b=this.iterateSecondaryIndexValue(c,a[c]);break}return new i(b||this.iterator(),function(b){return b.isSupersetOf(a)})},clear:function(){return this.iterate(function(a){this.remove(a)},this),this},increase_forwards:function(a){return l.error(!0)},first:function(){return this.getByIndex(0)},last:function(){return this.getByIndex(this.count()-1)}}}])}),a.define("module:Collections.ConcatCollection",["module:Collections.Collection","module:Objs","module:Functions"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d,e){this.__parents={},this.__itemToParent={},e=e||{},delete e.objects,e.compare||(e.compare=c.as_method(this.__compareByParent,this)),a.constructor.call(this,e);var f=0;b.iter(d,function(a){this.__parents[a.cid()]={idx:f,parent:a},a.iterate(function(b){this.__parentAdd(a,b)},this),a.on("add",function(b){this.__parentAdd(a,b)},this),a.on("remove",function(b){this.__parentRemove(a,b)},this),f++},this)},destroy:function(){b.iter(this.__parents,function(a){a.parent.off(null,null,this)},this),a.destroy.call(this)},__parentAdd:function(a,b){this.__itemToParent[b.cid()]=a,this.add(b)},__parentRemove:function(a,b){delete this.__itemToParent[b.cid()],this.remove(b)},__compareByParent:function(a,b){var c=this.__itemToParent[a.cid()],d=this.__itemToParent[b.cid()];return c===d?c.getIndex(a)-d.getIndex(b):this.__parents[c.cid()].idx-this.__parents[d.cid()].idx}}})}),a.define("module:Collections.FilteredCollection",["module:Collections.Collection"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){this.__parent=b,c=c||{},delete c.objects,c.compare=c.compare||b.get_compare(),a.constructor.call(this,c),this.__parent.on("add",this.add,this),this.__parent.on("remove",this.__selfRemove,this),this.setFilter(c.filter,c.context)},filter:function(a){return!this.__filter||this.__filter.call(this.__filterContext||this,a)},setFilter:function(a,b){this.__filterContext=b,this.__filter=a,this.iterate(function(a){this.filter(a)||this.__selfRemove(a)},this),this.__parent.iterate(function(a){return!this.exists(a)&&this.filter(a)&&this.__selfAdd(a),!0},this)},_object_changed:function(b,c,d){a._object_changed.call(this,b,c,d),this.filter(b)||this.__selfRemove(b)},destroy:function(){this.__parent.off(null,null,this),a.destroy.call(this)},__selfAdd:function(b){return a.add.call(this,b)},add:function(a){if(this.exists(a)||!this.filter(a))return null;var b=this.__selfAdd(a);return this.__parent.add(a),b},__selfRemove:function(b){return a.remove.call(this,b)},remove:function(a){if(!this.exists(a))return null;var b=this.__selfRemove(a);return b?this.__parent.remove(a):null}}})}),a.define("module:Collections.GroupedCollection",["module:Collections.Collection","module:Objs","module:Properties.Properties"],function(a,b,c,d){return a.extend({scoped:d},function(d){return{constructor:function(a,e){this.__parent=a,e=e||{},delete e.objects,this.__groupby=e.groupby,this.__keepEmptyGroups=e.keepEmptyGroups,this.__insertCallback=e.insert,this.__removeCallback=e.remove,this.__callbackContext=e.context||this,this.__propertiesClass=e.properties||c,this.__createProperties=e.create,d.constructor.call(this,e),b.iter(this.__groupby,this.add_secondary_index,this),this.__parent.iterate(this.__addParentObject,this),this.__parent.on("add",this.__addParentObject,this),this.__parent.on("remove",this.__removeParentObject,this)},destroy:function(){this.__parent.off(null,null,this),d.destroy.call(this)},touchGroup:function(d,e){d=c.is_instance_of(d)?d.data():d;var f={};b.iter(this.__groupby,function(a){f[a]=d[a]});var g=this.query(f).nextOrNull();return!g&&e&&(g=this.__createProperties?this.__createProperties.call(this.__callbackContext):new this.__propertiesClass,g.items=g.auto_destroy(new a),b.iter(this.__groupby,function(a){g.set(a,d[a])}),this.add(g)),g},__addParentObject:function(a){var b=this.touchGroup(a,!0);this.__addObjectToGroup(a,b)},__removeParentObject:function(a){var b=this.touchGroup(a);b&&(this.__removeObjectFromGroup(a,b),this.__keepEmptyGroups||0!==b.items.count()||this.remove(b))},__addObjectToGroup:function(a,b){b.items.add(a),this.__insertObject(a,b)},__removeObjectFromGroup:function(a,b){b.items.remove(a),this.__removeObject(a,b)},increase_forwards:function(a){return this.__parent.increase_forwards(a)},__insertObject:function(a,b){this.__insertCallback?this.__insertCallback.call(this.__callbackContext,a,b):b.trigger("insert",a)},__removeObject:function(a,b){this.__removeCallback?this.__removeCallback.call(this.__callbackContext,a,b):b.trigger("remove",a)}}})}),a.define("module:Collections.MappedCollection",["module:Collections.Collection","module:Functions"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){this.__parent=c,this.__parentToThis={},this.__thisToParent={},d=d||{},delete d.objects,d.compare=b.as_method(this.__compareByParent,this),a.constructor.call(this,d),this._mapFunction=d.map,this._mapCtx=d.context,c.on("add",this.__parentAdd,this),c.on("remove",this.__parentRemove,this),c.on("change",this.__parentUpdate,this),c.iterate(this.__parentAdd,this)},destroy:function(){this.__parent.off(null,null,this),a.destroy.call(this)},__compareByParent:function(a,b){return this.__parent.getIndex(this.__thisToParent[a.cid()])-this.__parent.getIndex(this.__thisToParent[b.cid()])},__mapItem:function(a,b){return this._mapFunction.call(this._mapCtx||this,a,b)},__parentAdd:function(a){var b=this.__mapItem(a);this.__parentToThis[a.cid()]=b,this.__thisToParent[b.cid()]=a,this.add(b)},__parentUpdate:function(a){this.__mapItem(a,this.__parentToThis[a.cid()])},__parentRemove:function(a){var b=this.__parentToThis[a.cid()];delete this.__parentToThis[a.cid()],delete this.__thisToParent[b.cid()],this.remove(b)}}})}),a.define("module:Exceptions.ErrorCatcher",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__thrower=b},throwException:function(a){this.__thrower.throwException(a)}}})}),a.define("module:Exceptions.UncaughtErrorCatcher",["module:Exceptions.ErrorCatcher","module:Functions"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,c),this.__listenerFunction=b.as_method(this._listenerFunction,this);try{window.addEventListener("error",this.__listenerFunction)}catch(d){}try{process.on("uncaughtException",this.__listenerFunction)}catch(d){}},destroy:function(){try{window.removeEventListener("error",this.__listenerFunction)}catch(b){}try{process.off("uncaughtException",this.__listenerFunction)}catch(b){}a.destroy.call(this)},_listenerFunction:function(a){this.throwException(a)}}})}),a.define("module:Exceptions.ExceptionThrower",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{throwException:function(a){return this._throwException(a),this},_throwException:function(a){throw a}}})}),a.define("module:Exceptions.NullExceptionThrower",["module:Exceptions.ExceptionThrower"],function(a,b){return a.extend({scoped:b},function(a){return{_throwException:function(a){}}})}),a.define("module:Exceptions.AsyncExceptionThrower",["module:Exceptions.ExceptionThrower","module:Async"],function(a,b,c){return a.extend({scoped:c},function(a){return{_throwException:function(a){b.eventually(function(){throw a})}}})}),a.define("module:Exceptions.ConsoleExceptionThrower",["module:Exceptions.ExceptionThrower","module:Exceptions.NativeException"],function(a,b,c){return a.extend({scoped:c},function(a){return{_throwException:function(a){console.log("Exception",a.toString())}}})}),a.define("module:Exceptions.EventExceptionThrower",["module:Exceptions.ExceptionThrower","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{_throwException:function(a){this.trigger("exception",a)}}}])}),a.define("module:Exceptions.Exception",["module:Class","module:Comparators"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__message=b;try{throw new Error}catch(c){this.__stack=c.stack}},assert:function(a){if(!this.instance_of(a))throw this;return this},message:function(){return this.__message},stack:function(){return this.__stack},toString:function(){return this.message()},format:function(){return this.cls.classname+": "+this.toString()},json:function(){return{classname:this.cls.classname,message:this.message(),stack:this.stack()}},equals:function(a){return a&&this.cls===a.cls&&b.deepEqual(this.json(),a.json(),-1)}}},{ensure:function(a){if(!this.is_instance_of(a))throw"Unasserted Exception "+a;return a}})}),a.define("module:Exceptions.NativeException",["module:Types","module:Objs","module:Exceptions.Exception"],function(a,b,c,d){var e=c.extend({scoped:d},function(a){return{constructor:function(c){this.__data={},c&&["name","message","filename","lineno"].forEach(function(a){a in c&&(this.__data[a]=c[a])},this),a.constructor.call(this,c?b.values(this.__data).join("; "):"null"),this.__object=c},object:function(){return this.__object},data:function(){return this.__data},json:function(){var b=a.json.call(this);return b.data=this.data(),b}};
},{ensure:function(a){return e.is_instance_of(a)?a:new e(a)}});return e}),a.define("module:Async",["module:Types","module:Functions"],function(a,b){var c={},d=1;return{waitFor:function(){var a=b.matchArgs(arguments,{condition:!0,conditionCtx:"object",callback:!0,callbackCtx:"object",interval:"int"}),c=function(){try{return!!a.condition.apply(a.conditionCtx||a.callbackCtx||this)}catch(b){return!1}};if(c())a.callback.apply(a.callbackCtx||this);else var d=setInterval(function(){c()&&(clearInterval(d),a.callback.apply(a.callbackCtx||this))},a.interval||1)},eventually:function(){var a=b.matchArgs(arguments,{func:!0,params:"array",context:"object",time:"number"}),c=setTimeout(function(){clearTimeout(c),a.func.apply(a.context||this,a.params||[])},a.time||0);return c},clearEventually:function(a){clearTimeout(a)},eventuallyOnce:function(a,b,e){var f={func:a,params:b,context:e};for(var g in c){var h=c[g];if(h.func==a&&h.params==b&&h.context==e)return}d++;var i=d;return c[i]=f,this.eventually(function(){delete c[i],a.apply(e||this,b||[])},this)}}}),a.define("module:Promise",["module:Types","module:Functions","module:Async","module:Objs"],function(a,b,c,d){var e={Promise:function(a,b,c){this.__value=b?null:a||null,this.__error=b?b:null,this.__isFinished=c,this.__hasError=!!b,this.__resultPromise=null,this.__callbacks=[]},create:function(a,b){return new this.Promise(a,b,arguments.length>0)},value:function(a){return this.is(a)?a:new this.Promise(a,null,!0)},eventualValue:function(a){var b=new this.Promise;return c.eventually(function(){b.asyncSuccess(a)}),b},error:function(a){return this.is(a)?a:new this.Promise(null,a,!0)},box:function(a,b,c){try{var d=a.apply(b||this,c||[]);return this.is(d)?d:this.value(d)}catch(e){return this.error(e)}},tryCatch:function(a,b){try{return this.value(a.apply(b||this))}catch(c){return this.error(c)}},funcCallback:function(c,d){var e=[];a.is_function(c)?(e=b.getArguments(arguments,1),d=c,c=this):e=b.getArguments(arguments,2);var f=this.create();return e.push(f.asyncCallbackFunc()),d.apply(c,e),f},and:function(b){var c=this.create();return c.__promises=[],c.__successCount=0,c.__values=[],c.__errorPromise=null,c.and=function(b){if(b=b||[],this.__ended)return this;a.is_array(b)||(b=[b]);for(var c=function(a,b){a?this.promise.__errorPromise=this.promise.__promises[this.idx]:(this.promise.__successCount++,this.promise.__values[this.idx]=b),this.promise.results()},d=0;d<b.length;++d){var e=this.__promises.length;this.__promises.push(b[d]),this.__values.push(null),b[d].isFinished()?b[d].hasValue()?(this.__successCount++,this.__values[e]=b[d].value()):this.__errorPromise=b[d]:b[d].callback(c,{promise:this,idx:e})}return this},c.end=function(){return this.__ended?this:(this.__ended=!0,this.results(),this)},c.results=function(){return this.__ended&&this.__errorPromise?this.asyncError(this.__errorPromise.err(),this.__errorPromise):this.__ended&&this.__successCount==this.__promises.length&&this.asyncSuccess(this.__values),this},c.successUnfold=function(a,b,c){return this.success(function(){return a.apply(b,arguments)},b,c)},c.and(b),c},func:function(a){for(var c=b.getArguments(arguments,1),d=[],e=0;e<c.length;++e)this.is(c[e])&&d.push(c[e]);var f=this.create();return this.and(d).end().success(function(b){for(var d=[],e=0;e<c.length;++e)d[e]=this.is(c[e])?c[e].value():c[e];var g=a.apply(this,d);this.is(g)?g.forwardCallback(f):f.asyncSuccess(g)},this).forwardError(f),f},methodArgs:function(a,b,c){return c.unshift(function(){return b.apply(a,arguments)}),this.func.apply(this,c)},method:function(a,c){return this.methodArgs(a,c,b.getArguments(arguments,2))},newClass:function(a){var c=b.getArguments(arguments,1);return c.unshift(b.newClassFunc(a)),this.func.apply(this,c)},is:function(b){return b&&a.is_object(b)&&b.classGuid==this.Promise.prototype.classGuid},resilience:function(a,b,c,d){return a.apply(b,d).mapError(function(e){return 0===c?e:this.resilience(a,b,c-1,d)},this)}};return d.extend(e.Promise.prototype,{classGuid:"7e3ed52f-22da-4e9c-95a4-e9bb877a3935",success:function(a,b,c){return this.callback(a,b,c,"success")},error:function(a,b,c){return this.callback(a,b,c,"error")},callback:function(a,b,c,d){"end"in this&&this.end();var e={type:d||"callback",func:a,options:c||{},context:b};return this.__isFinished?this.triggerResult(e):this.__callbacks.push(e),this},triggerResult:function(a){if(!this.__isFinished)return this;if(a)"success"!=a.type||this.__hasError?"error"==a.type&&this.__hasError?a.func.call(a.context||this,this.__error,this.__resultPromise||this):"callback"==a.type&&a.func.call(a.context||this,this.__error,this.__value,this.__resultPromise||this):a.func.call(a.context||this,this.__value,this.__resultPromise||this);else{var b=this.__callbacks;this.__callbacks=[];for(var c=0;c<b.length;++c)this.triggerResult(b[c])}return this},value:function(){return this.__value},err:function(){return this.__error},isFinished:function(){return this.__isFinished},hasValue:function(){return this.__isFinished&&!this.__hasError},hasError:function(){return this.__isFinished&&this.__hasError},asyncSuccess:function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__error=null,this.__isFinished=!0,this.__hasError=!1,this.__value=a,this.triggerResult())},asyncError:function(a,b){return this.__isFinished?this:(this.__resultPromise=b,this.__isFinished=!0,this.__hasError=!0,this.__error=a,this.__value=null,this.triggerResult())},asyncCallback:function(a,b,c){return a?this.asyncError(a,c):this.asyncSuccess(b,c)},forwardSuccess:function(a){return this.success(a.asyncSuccess,a),this},forwardError:function(a){return this.error(a.asyncError,a),this},forwardCallback:function(a){return this.callback(a.asyncCallback,a),this},asyncCallbackFunc:function(){return b.as_method(this.asyncCallback,this)},mapSuccess:function(a,b){var c=e.create();return this.forwardError(c).success(function(d,f){var g=a.call(b||c,d,f);e.is(g)?g.forwardCallback(c):c.asyncSuccess(g)}),c},mapError:function(a,b){var c=e.create();return this.forwardSuccess(c).error(function(d,f){var g=a.call(b||c,d,f);e.is(g)?g.forwardCallback(c):c.asyncError(g)}),c},mapCallback:function(a,b){var c=e.create();return this.callback(function(d,f,g){var h=a.call(b||c,d,f,g);e.is(h)?h.forwardCallback(c):c.asyncCallback(d?h:d,d?f:h,g)}),c},and:function(a){var b=e.and(this);return b.and(a)}}),e}),a.define("module:Timers.Timer",["module:Class","module:Objs","module:Time"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(d){a.constructor.call(this),d=b.extend({once:!1,start:!0,fire:null,context:this,destroy_on_fire:!1,destroy_on_stop:!1,real_time:!1,duration:null,fire_max:null,immediate:!1},d),this.__immediate=d.immediate,this.__delay=d.delay,this.__destroy_on_fire=d.destroy_on_fire,this.__destroy_on_stop=d.destroy_on_stop,this.__once=d.once,this.__fire=d.fire,this.__context=d.context,this.__started=!1,this.__real_time=d.real_time,this.__end_time=null!==d.duration?c.now()+d.duration:null,this.__fire_max=d.fire_max,d.start&&this.start()},destroy:function(){this.stop(),a.destroy.call(this)},fire_count:function(){return this.__fire_count},duration:function(){return c.now()-this.__start_time},fire:function(){if(this.__once&&(this.__started=!1),this.__fire&&(this.__fire.call(this.__context,this),this.__fire_count++,this.__real_time&&!this.__destroy_on_fire&&!this.__once))for(;(this.__fire_count+1)*this.__delay<=c.now()-this.__start_time;)this.__fire.call(this.__context,this),this.__fire_count++;(null!==this.__end_time&&c.now()+this.__delay>this.__end_time||null!==this.__fire_max&&this.__fire_max<=this.__fire_count)&&this.stop(),this.__destroy_on_fire&&this.weakDestroy()},stop:function(){return this.__started?(this.__once?clearTimeout(this.__timer):clearInterval(this.__timer),this.__started=!1,this.__destroy_on_stop&&this.weakDestroy(),this):this},start:function(){if(this.__started)return this;var a=this;return this.__start_time=c.now(),this.__fire_count=0,this.__once?this.__timer=setTimeout(function(){a.fire()},this.__delay):this.__timer=setInterval(function(){a.fire()},this.__delay),this.__started=!0,this.__immediate&&this.fire(),this},restart:function(){return this.stop(),this.start(),this}}})}),a.define("module:Iterators.ArrayIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__array=b,this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}}},{byIterate:function(a,b){var c=[];return a.call(b||this,function(a){c.push(a)},this),new this(c)}})}),a.define("module:Iterators.NativeMapIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__iter=b.values(),this.__next=this.__iter.next()},hasNext:function(){return!this.__next.done},next:function(){var a=this.__next.value;return this.__next=this.__iter.next(),a}}})}),a.define("module:Iterators.ObjectKeysIterator",["module:Iterators.ArrayIterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this,Object.keys(b))}}})}),a.define("module:Iterators.ObjectValuesIterator",["module:Iterators.ArrayIterator","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,b.values(c))}}})}),a.define("module:Iterators.LazyMultiArrayIterator",["module:Iterators.LazyIterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__next_callback=b,this.__next_context=c,this.__array=null,this.__i=0},_next:function(){if((null===this.__array||this.__i>=this.__array.length)&&(this.__array=this.__next_callback.apply(this.__next_context),this.__i=0),null!==this.__array){var a=this.__array[this.__i];return this.__i++,a}this._finished()}}})}),a.define("module:Iterators.MappedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__iterator=b,this.__map=c,this.__context=d||this},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.hasNext()?this.__map.call(this.__context,this.__iterator.next()):null}}})}),a.define("module:Iterators.FilteredIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__iterator=b,this.__filter=c,this.__context=d||this,this.__next=null},hasNext:function(){return this.__crawl(),null!==this.__next},next:function(){this.__crawl();var a=this.__next;return this.__next=null,a},__crawl:function(){for(;!this.__next&&this.__iterator.hasNext();){var a=this.__iterator.next();this.__filter_func(a)&&(this.__next=a)}},__filter_func:function(a){return this.__filter.apply(this.__context,[a])}}})}),a.define("module:Iterators.SkipIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){for(a.constructor.call(this),this.__iterator=b;c>0;)b.next(),c--},hasNext:function(){return this.__iterator.hasNext()},next:function(){return this.__iterator.next()}}})}),a.define("module:Iterators.LimitIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__iterator=b,this.__limit=c},hasNext:function(){return this.__limit>0&&this.__iterator.hasNext()},next:function(){return this.__limit<=0?null:(this.__limit--,this.__iterator.next())}}})}),a.define("module:Iterators.SortedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__array=b.asArray(),this.__array.sort(c),this.__i=0},hasNext:function(){return this.__i<this.__array.length},next:function(){var a=this.__array[this.__i];return this.__i++,a}}})}),a.define("module:Iterators.LazyIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(){a.constructor.call(this),this.__finished=!1,this.__initialized=!1,this.__current=null,this.__has_current=!1},_initialize:function(){},_next:function(){},_finished:function(){this.__finished=!0},_current:function(a){this.__current=a,this.__has_current=!0},__touch:function(){this.__initialized||this._initialize(),this.__initialized=!0,this.__has_current||this.__finished||this._next()},hasNext:function(){return this.__touch(),this.__has_current},next:function(){return this.__touch(),this.__has_current=!1,this.__current}}})}),a.define("module:Iterators.SortedOrIterator",["module:Iterators.LazyIterator","module:Structures.TreeMap","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(c,d){this.__iterators=c,this.__map=b.empty(d),a.constructor.call(this)},__process:function(a){if(a.hasNext()){var c=a.next(),d=b.find(c,this.__map);d?d.push(a):this.__map=b.add(c,[a],this.__map)}},_initialize:function(){c.iter(this.__iterators,this.__process,this),b.is_empty(this.__map)&&this._finished()},_next:function(){var a=b.take_min(this.__map);this._current(a[0].key),this.__map=a[1],c.iter(a[0].value,this.__process,this),b.is_empty(this.__map)&&this._finished()}}})}),a.define("module:Iterators.PartiallySortedIterator",["module:Iterators.Iterator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d){a.constructor.call(this),this.__compare=c,this.__partial_same=d,this.__iterator=b,this.__head=[],this.__tail=[]},__cache:function(){if(!(this.__head.length>0)&&(this.__head=this.__tail,this.__tail=[],this.__iterator.hasNext())){for(0===this.__head.length&&this.__head.push(this.__iterator.next());this.__iterator.hasNext();){var a=this.__iterator.next();if(!this.__partial_same(this.__head[0],a)){this.__tail.push(a);break}this.__head.push(a)}this.__head.sort(this.__compare)}},hasNext:function(){return this.__cache(),this.__head.length>0},next:function(){return this.__cache(),this.__head.shift()}}})}),a.extend("module:Iterators",["module:Types","module:Iterators.Iterator","module:Iterators.ArrayIterator"],function(a,b,c){return{ensure:function(d){return null===d?new c([]):d.instance_of(b)?d:new c(a.is_array(d)?d:[d])}}}),a.define("module:Iterators.Iterator",["module:Class","module:Functions","module:Async","module:Promise"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{hasNext:function(){return!1},next:function(){return null},nextOrNull:function(){return this.hasNext()?this.next():null},asArray:function(){for(var a=[];this.hasNext();)a.push(this.next());return a},iterate:function(a,b){for(;this.hasNext();){var c=a.call(b||this,this.next());if(c===!1)return}},asyncIterate:function(a,b,e){if(!this.hasNext())return d.value(!0);var f=a.call(b||this,this.next());if(f===!1)return d.value(!0);var g=d.create();return c.eventually(function(){this.asyncIterate(a,b,e).forwardCallback(g)},this,e),g}}})}),a.define("module:Loggers.CallOriginLogAugment",["module:Loggers.AbstractLogAugment","module:Functions"],function(a,b,c){return a.extend({scoped:c},function(a){return{augmentMessage:function(a,c,d){var e=b.getStackTrace(3*d+6);return e[0]}}})}),a.define("module:Loggers.ConsoleLogListener",["module:Loggers.LogListener"],function(a,b){return a.extend({scoped:b},function(a){return{message:function(a,b){console[b.type].apply(console,b.args.concat(b.augments))}}})}),a.define("module:Loggers.AbstractLogAugment",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{augmentMessage:function(a,b,c){}}})}),a.define("module:Loggers.LogListener",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{message:function(a,b){}}})}),a.define("module:Loggers.LogListenerFilter",["module:Loggers.LogListener","module:Objs","module:Types"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__target=b,this.__tags=c},message:function(a,d){var e=b.objectify(d.tags),f=!1;f=c.is_array(this.__tags[0])?this.__tags.some(function(a){return a.every(function(a){return e[a]})}):this.__tags.every(function(a){return e[a]}),f&&this.__target.message(a,d)}}})}),a.define("module:Loggers.Logger",["module:Class","module:Objs","module:Functions"],function(a,b,c,d){var e=a.extend({scoped:d},function(a){return{constructor:function(c){a.constructor.call(this),c=c||{},this.__listeners={},this.__augments={},this.__tags=c.tags||[],b.iter(c.listeners,this.addListener,this)},addAugment:function(a){return this.__augments[a.cid()]=a,this},removeAugment:function(a){return delete this.__augments[a.cid()],this},addListener:function(a){return this.__listeners[a.cid()]=a,this},removeListener:function(a){return delete this.__listeners[a.cid()],this},log:function(){return this.message(this,{type:"log",args:c.getArguments(arguments,0)})},logf:function(){return c.as_method(this.log,this)},warn:function(){return this.message(this,{type:"warn",args:c.getArguments(arguments,0)})},error:function(){return this.message(this,{type:"error",args:c.getArguments(arguments,0)})},taggedlog:function(a){return this.message(this,{type:"log",tags:a,args:c.getArguments(arguments,1)})},taggedwarn:function(a){return this.message(this,{type:"warn",tags:a,args:c.getArguments(arguments,1)})},taggederror:function(a){return this.message(this,{type:"error",tags:a,args:c.getArguments(arguments,1)})},message:function(a,c,d){return d=d||0,c.tags=this.__tags.concat(c.tags||[]),c.augments=c.augments||[],b.iter(this.__augments,function(b){c.augments.push(b.augmentMessage(a,c,d))},this),b.iter(this.__listeners,function(a){a.message(this,c,d+1)},this),this},tag:function(){return new e({tags:c.getArguments(arguments),listeners:[this]})}}},{global:function(){return this.__global||(this.__global=new e),this.__global}});return e}),a.define("module:Net.SocketSenderChannel",["module:Channels.Sender"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__socket=b,this.__message=c},_send:function(a,b){this.__socket.emit(this.__message,{message:a,data:b})},socket:function(){return arguments.length>0&&(this.__socket=arguments[0]),this.__socket}}})}),a.define("module:Net.SocketReceiverChannel",["module:Channels.Receiver"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__message=c,this.socket(b)},socket:function(){if(arguments.length>0&&(this.__socket=arguments[0],this.__socket)){var a=this;this.__socket.on(this.__message,function(b){a._receive(b.message,b.data)})}return this.__socket}}})}),a.define("module:Net.Cookies",["module:Objs","module:Types"],function(a,b){return{getCookielikeValue:function(a,b){return a=a||"",decodeURIComponent(a.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},createCookielikeValue:function(c,d,e,f,g,h){if(!c||/^(?:expires|max\-age|path|domain|secure)$/i.test(c))return null;var i=[];return i.push([encodeURIComponent(c),encodeURIComponent(d)]),e&&(e===1/0?i.push(["expires","Fri, 31 Dec 9999 23:59:59 GMT"]):"number"==typeof e?i.push(["max-age",e]):"object"==typeof e?i.push(["expires",e.toUTCString()]):i.push(["expires",e])),g&&i.push(["domain",g]),f&&i.push(["path",f]),h&&i.push("secure"),a.map(i,function(a){return b.is_array(a)?a.join("="):a}).join("; ")},removeCookielikeValue:function(a,b,c,d){return this.createCookielikeValue(a,b,new Date(0),c,d)},hasCookielikeValue:function(a,b){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(b).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(a)},keysCookielike:function(b){var c=b.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);return a.map(c,decodeURIComponent)}}}),a.define("module:Net.HttpHeader",function(){return{HTTP_STATUS_OK:200,HTTP_STATUS_CREATED:201,HTTP_STATUS_BAD_REQUEST:400,HTTP_STATUS_UNAUTHORIZED:401,HTTP_STATUS_PAYMENT_REQUIRED:402,HTTP_STATUS_FORBIDDEN:403,HTTP_STATUS_NOT_FOUND:404,HTTP_STATUS_PRECONDITION_FAILED:412,HTTP_STATUS_INTERNAL_SERVER_ERROR:500,HTTP_STATUS_GATEWAY_TIMEOUT:504,STRINGS:{0:"Unknown Error",200:"OK",201:"Created",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not found",412:"Precondition Failed",500:"Internal Server Error",504:"Gateway timeout"},format:function(a,b){var c=this.STRINGS[a in this.STRINGS?a:0];return b?a+" "+c:c},isSuccessStatus:function(a){return a>=this.HTTP_STATUS_OK&&300>a}}}),a.define("module:Net.Uri",["module:Objs","module:Types","module:Strings"],function(a,b,c){var d=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,e=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],g=/(?:^|&)([^&=]*)=?([^&]*)/g;return{build:function(a){var b="";return a.protocol&&(b+=a.protocol+"://"),a.username&&(b+=a.username+":"),a.password&&(b+=a.password+"@"),b+=a.server,a.port&&(b+=":"+a.port),a.path&&(b+="/"+a.path),b},encodeUriParams:function(c,d,e){d=d||"";var f=[];return e?a.iter(a.serializeFlatJSON(c),function(a){f.push(d+a.key+"="+encodeURIComponent(a.value))},this):a.iter(c,function(a,c){b.is_object(a)?f=f.concat(this.encodeUriParams(a,d+c+"_")):f.push(d+c+"="+encodeURIComponent(a))},this),f.join("&")},decodeUriParams:function(a){var b={};return a.split("&").forEach(function(a){var d=c.splitFirst(a,"=");b[d.head]=decodeURIComponent(d.tail)}),b},appendUriParams:function(a,c,d){return b.is_empty(c)?a:a+(-1!=a.indexOf("?")?"&":"?")+this.encodeUriParams(c,d)},parse:function(a,b){for(var c=b?d:e,h=c.exec(a),i={},j=0;j<f.length;++j)i[f[j]]=h[j]||"";return i.queryKey={},i[f[12]].replace(g,function(a,b,c){b&&(i.queryKey[b]=c)}),i},isCrossDomainUri:function(a,b){return b.indexOf("//")<0?!1:a.indexOf("//")<0?!0:(a=this.parse(a.toLowerCase()),b=this.parse(b.toLowerCase()),"file"===a.protocol||"file"===b.protocol?a.protocol===b.protocol:a.host!==b.host||a.port!==b.port)}}}),a.define("module:RMI.Client",["module:Class","module:Objs","module:Channels.TransportChannel","module:Ids","module:RMI.Skeleton","module:Types","module:RMI.Stub"],function(b,c,d,e,f,g,h,i){return b.extend({scoped:i},function(b){return{constructor:function(a,c){if(b.constructor.call(this),this.__channel=null,this.__instances={},a){var e=a;c&&(e=this._auto_destroy(new d(a,c))),this.__channel=e}},destroy:function(){this.__channel&&this.disconnect(),b.destroy.call(this)},connect:function(a){return this.__channel?void 0:(this.__channel=a,this)},connectTransport:function(a,b,c){return this.connect(this.auto_destroy(new d(a,b,c)))},disconnect:function(){return this.__channel?(this.__channel=null,c.iter(this.__instances,function(a){this.release(a)},this),this):void 0},_serializeValue:function(a){if(f.is_instance_of(a)){var b=this.server;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:e.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},acquire:function(b,d){if(this.__instances[d])return this.__instances[d];if(g.is_string(b)&&(b=a.getGlobal(b)),!b||!b.ancestor_of(h))return null;var f=new b;this.__instances[e.objectId(f,d)]=f;var i=this;return f.__send=function(a,b,e){return i.__channel?(b=c.map(b,i._serializeValue,i),i.__channel.send(d+":"+a,b,{serializerInfo:e}).mapSuccess(function(a){return this._unserializeValue(a)},i)):void 0},f},release:function(a){var b=e.objectId(a);return this.__instances[b]&&(a.weakDestroy(),delete this.__instances[b]),this}}})}),a.define("module:RMI.Peer",["module:Class","module:Channels.SenderMultiplexer","module:Channels.ReceiverMultiplexer","module:RMI.Client","module:RMI.Server"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(f,g){a.constructor.call(this),this.__sender=f,this.__receiver=g,this.__client_sender=this._auto_destroy(new b(f,"client")),this.__server_sender=this._auto_destroy(new b(f,"server")),this.__client_receiver=this._auto_destroy(new c(g,"server")),this.__server_receiver=this._auto_destroy(new c(g,"client")),this.client=this._auto_destroy(new d(this.__client_sender,this.__client_receiver)),this.server=this._auto_destroy(new e(this.__server_sender,this.__server_receiver)),this.client.server=this.server,this.server.client=this.client},acquire:function(a,b){return this.client.acquire(a,b)},release:function(a){this.client.release(a)},registerInstance:function(a,b){return this.server.registerInstance(a,b)},unregisterInstance:function(a){this.server.unregisterInstance(a)}}})}),a.define("module:RMI.Server",["module:Class","module:Events.EventsMixin","module:Objs","module:Channels.TransportChannel","module:Lists.ObjectIdList","module:Ids","module:RMI.Skeleton","module:Promise"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},[b,function(a){return{constructor:function(b,c){if(a.constructor.call(this),this.__channels=new e,this.__instances={},b){var f=b;c&&(f=this._auto_destroy(new d(b,c))),this.registerClient(f)}},destroy:function(){this.__channels.iterate(this.unregisterClient,this),c.iter(this.__instances,function(a){this.unregisterInstance(a.instance)},this),this.__channels.destroy(),a.destroy.call(this)},registerInstance:function(a,b){return b=b||{},this.__instances[f.objectId(a,b.name)]={instance:a,options:b},b.auto_destroy&&this.auto_destroy(a),a},unregisterInstance:function(a){return delete this.__instances[f.objectId(a)],a.weakDestroy(),this},registerClient:function(a,b){b=b||{};var c=this;return this.__channels.add(a),a._reply=function(b,d){var e=b.split(":");return 2==e.length?c._invoke(a,e[0],e[1],d):h.error(!0)},b.auto_destroy&&this.auto_destroy(a),this},registerTransportClient:function(a,b,c){return this.registerClient(this.auto_destroy(new d(a,b,c)))},unregisterClient:function(a){return this.__channels.remove(a),a._reply=null,this},_serializeValue:function(a){if(g.is_instance_of(a)){var b=this;return b.registerInstance(a),{__rmi_meta:!0,__rmi_stub:a.stub(),__rmi_stub_id:f.objectId(a)}}return a},_unserializeValue:function(a){if(a&&a.__rmi_meta){var b=this.client;return b.acquire(a.__rmi_stub,a.__rmi_stub_id)}return a},_invoke:function(a,b,d,e){var f=this.__instances[b];return f||(this.trigger("loadInstance",a,b),f=this.__instances[b]),f?(f=f.instance,e=c.map(e,this._unserializeValue,this),f.invoke(d,e,a).mapSuccess(function(a){return this._serializeValue(a)},this)):h.error(b)}}}])}),a.define("module:RMI.Skeleton",["module:Class","module:Objs","module:Promise"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{intf:[],_stub:null,_intf:{},__superIntf:["_destroy"],constructor:function(c){this._options=b.extend({destroyable:!1},c),a.constructor.call(this),this.intf=this.intf.concat(this.__superIntf);for(var d=0;d<this.intf.length;++d)this._intf[this.intf[d]]=!0},_destroy:function(){this._options.destroyable&&this.destroy()},invoke:function(a,b){if(!this._intf[a])return c.error(a);try{var d=this[a].apply(this,b);return c.is(d)?d:c.value(d)}catch(e){return c.error(e)}},_success:function(a){return c.value(a)},_error:function(a){return c.error(a)},stub:function(){if(this._stub)return this._stub;var a=this.cls.classname;return a.indexOf("Skeleton")>=0?a.replace("Skeleton","Stub"):a}}})}),a.define("module:RMI.Stub",["module:Class","module:Classes.InvokerMixin","module:Functions"],function(a,b,c,d){return a.extend({scoped:d},[b,function(a){return{intf:[],serializes:{},constructor:function(){a.constructor.call(this),this.invoke_delegate("invoke",this.intf)},destroy:function(){this.invoke("_destroy"),a.destroy.call(this)},invoke:function(a){return this.__send(a,c.getArguments(arguments,1),this.serializes[a])}}}])}),a.define("module:RMI.StubSyncer",["module:Class","module:Classes.InvokerMixin","module:Functions","module:Promise"],function(a,b,c,d,e){return a.extend({scoped:e},[b,function(a){return{constructor:function(b){a.constructor.call(this),this.__stub=b,this.__current=null,this.__queue=[],this.invoke_delegate("invoke",this.__stub.intf)},invoke:function(){var a={args:c.getArguments(arguments),promise:d.create()};return this.__queue.push(a),this.__current||this.__next(),a.promise},__next:function(){0!==this.__queue.length&&(this.__current=this.__queue.shift(),this.__stub.invoke.apply(this.__stub,this.__current.args).forwardCallback(this.__current.promise).callback(this.__next,this))}}}])}),a.define("module:Scheduling.GarbageCollector",["module:Class","module:Scheduling.SchedulableMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{constructor:function(){a.constructor.call(this),this.__classes={}},queue:function(a){if(!a||a.destroyed()||this.__classes[a.cid()])return this;var b=a.cid();return this.__classes[b]=!0,this.schedulable(function(){delete this.__classes[b],a.destroyed()||a.destroy(),delete a.__gc}),this}}}])}),a.define("module:Scheduling.SchedulableMixin",[],function(){return{schedulable:function(a,b){this.scheduler?this.scheduler.schedulable(this,a,b):a.call(this,1/0)}}}),a.define("module:Scheduling.Helper",[],function(){return{schedulable:function(a,b,c,d){c?c.schedulable(d||this,a,b):a.call(d||this,1/0)}}}),a.define("module:Scheduling.AbstractScheduler",["module:Class"],function(a,b){return a.extend({scoped:b},function(a){return{_schedulable:function(a,b,c){},_register:function(a,b){},_unregister:function(a,b){},schedulable:function(a,b,c){this._schedulable(a,b,c||1)},register:function(a,b){a.scheduler=this,this._register(a,b)},unregister:function(a,b){a.scheduler===this&&(a.scheduler=null),this._unregister(a,b)}}})}),a.define("module:Scheduling.DefaultScheduler",["module:Scheduling.AbstractScheduler","module:Time","module:Objs","module:Timers.Timer"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(b){a.constructor.call(this),this._current=null,this._last=null,this._first=null,this._map={},this._resources=0,this._options=c.extend({penaltyFactor:.5,rewardFactor:.5,defaultResources:10,defaultLimit:10,autoTimer:null},b),this._options.autoTimer&&this.auto_destroy(new d({start:!0,delay:this._options.autoTimer,context:this,fire:this.run}))},_register:function(a,b){var c=a.cid();if(!this._map[c]){b=b||{};var d={context:a,resources:b.resources||this._options.defaultResources,scheduled:[],allocatedTime:0,usedTime:0,prev:this._last,next:null};this._map[c]=d,this._last=d,this._first||(this._first=d)}},_unregister:function(a){var b=context.cid();if(this._map[b]){var c=this._map[b];this._current===c&&(this._current=c.next),c.prev?c.prev.next=c.next:this._first=c.next,c.next?c.next.prev=c.prev:this._last=c.prev,c.scheduled&&(this._resources-=c.resources),delete this._map[b]}},_schedulable:function(a,b,c){var d=a.cid(),e=this._map[d];e&&(e.scheduled.push({callback:b,initialSteps:c,totalTime:0,totalSteps:0}),1===e.scheduled.length&&(this._resources+=e.resources))},run:function(a){a=a||this._options.defaultLimit;for(var c=b.perfNow()+a;this._resources>0&&this._first;){var d=b.perfNow(),e=c-d;if(0>=e)break;var f=this._current||this._first;if(f.scheduled.length>0){var g=f.resources;f.allocatedTime>f.usedTime&&(g+=f.usedTime/f.allocatedTime*this._options.rewardFactor),f.allocatedTime<f.usedTime&&(g-=f.allocatedTime/f.usedTime*this._options.penaltyFactor);var h=Math.min(d+a*g/this._resources,c);do{var i=h-d,j=f.scheduled.shift(),k=Math.max(1,j.totalSteps>0?j.totalSteps/(j.totalTime||1)*i:j.initialSteps),l=j.callback.call(f.context,k);l===!1?f.scheduled.unshift(j):0===f.scheduled.length&&(this._resources-=f.resources);
var m=b.perfNow();f.allocatedTime+=i,f.usedTime+=m-d,d=m}while(h>d&&f.scheduled.length>0)}this._current=f.next}}}})}),a.define("module:States.CompetingComposite",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{_register_host:function(a){this._hosts=this._hosts||[],this._hosts.push(this._auto_destroy(a))},other_hosts:function(a){return b.filter(this._hosts||[],function(b){return b!=a},this)},_next:function(a,b){for(var c=this.other_hosts(a),d=0;d<c.length;++d){var e=c[d],f=e.state();f.can_coexist_with(b)||f.retreat_against(b)}}}})}),a.define("module:States.CompetingHost",["module:States.Host"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,c),this._composite=b,b&&b._register_host(this)},composite:function(){return this._composite},_can_transition_to:function(b){if(!a._can_transition_to.call(this,b))return!1;if(!this._composite)return!0;for(var c=this._composite.other_hosts(this),d=0;d<c.length;++d){var e=c[d],f=e.state();if(!b.can_coexist_with(f)&&!b.can_prevail_against(f))return!1}return!0},_next:function(b){this._composite&&this._composite._next(this,b),a._next.call(this,b)}}})}),a.define("module:States.CompetingState",["module:States.State"],function(a,b){return a.extend({scoped:b},function(a){return{can_coexist_with:function(a){return!0},can_prevail_against:function(a){return!1},retreat_against:function(a){}}})}),a.define("module:Router.RouteParser",["module:Class","module:Strings","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),this.routes={},c.iter(b,function(a,b){this.bind(b,a)},this)},parse:function(a){for(var b in this.routes){var c=this.routes[b],d=c.captureRegex.exec(a);if(d)return{name:c.name,args:d}}return null},format:function(a,c){c=c||{};var d=this.routes[a];return b.regexReplaceGroups(d.regex,d.captureRegex.mapBack(c))},bind:function(a,c){return this.routes[a]={name:a,regex:c,captureRegex:b.namedCaptureRegex("^"+c+"$")},this}}})}),a.define("module:Router.RouteMap",["module:Class","module:Strings","module:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),b=b||{},this._defaultMap=b.map,this._context=b.context||this,this._bindings=b.bindings||{}},map:function(a,b){var c=this._bindings[a];return c?c.call(this._context,a,b):this._defaultMap?this._defaultMap.call(this._context,a,b):{name:a,args:b}},bind:function(a,b){return this._bindings[a]=b,this}}})}),a.define("module:Router.Router",["module:Class","module:Events.EventsMixin","module:Objs","module:Router.RouteParser","module:Comparators"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,function(a){return{constructor:function(b){a.constructor.call(this),this._routeParser=new d(b),this._current=null},destroy:function(){this._routeParser.destroy(),a.destroy.call(this)},bind:function(a,b,c,d){return this._routeParser.bind(a,b),c&&this.on("dispatch:"+a,c,d),this},current:function(){return this._current},navigate:function(a){this.trigger("navigate",a),this.trigger("navigate:"+a);var b=this._routeParser.parse(a);return b?this.dispatch(b.name,b.args,a):this.trigger("notfound",a),this},dispatch:function(a,b,c){if(this._current){if(this._current.name===a&&e.deepEqual(b,this._current.args,2))return;this.trigger("leave",this._current.name,this._current.args,this._current),this.trigger("leave:"+this._current.name,this._current.args,this._current)}var d={route:c||this.format(a,b),name:a,args:b};return this.trigger("dispatch",a,b,d),this.trigger("dispatch:"+a,b,d),this._current=d,this.trigger("dispatched",a,b,d),this.trigger("dispatched:"+a,b,d),this},format:function(a,b){return this._routeParser.format(a,b)}}}])}),a.define("module:Router.RouteBinder",["module:Class","module:Types"],function(a,b,c){return a.extend({scoped:c},function(a){return{_setLocalRoute:function(a){},_getLocalRoute:function(){},_localRouteChanged:function(){this.setGlobalRoute(this._getLocalRoute())},constructor:function(b){a.constructor.call(this),this._router=b,b.on("dispatched",function(){this.setLocalRoute(b.current())},this),b.current()?this.setLocalRoute(b.current()):this._getLocalRoute()&&this.setGlobalRoute(this._getLocalRoute())},destroy:function(){this._router.off(null,null,this),a.destroy.call(this)},setLocalRoute:function(a){return this._setLocalRoute(a),this},setGlobalRoute:function(a){return b.is_string(a)?this._router.navigate(a):this._router.dispatch(a.name,a.args),this}}})}),a.define("module:Router.StateRouteBinder",["module:Router.RouteBinder","module:Objs","module:Strings","module:Router.RouteMap"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(e,f,g){this._stateHost=f,g=b.extend({capitalizeStates:!1},g),this._options=g,this._routeToState=new d({map:this._options.routeToState||function(a,b){return{name:g.capitalizeStates?c.capitalize(a):a,args:b}},context:this._options.context}),this._stateToRoute=new d({map:this._options.stateToRoute||function(a,b){return{name:a.toLowerCase(),args:b}},context:this._options.context}),a.constructor.call(this,e),f.on("start",this._localRouteChanged,this)},destroy:function(){this._routeToState.destroy(),this._stateToRoute.destroy(),this._stateHost.off(null,null,this),a.destroy.call(this)},bindRouteToState:function(a,b){return this._routeToState.bind(a,b),this},bindStateToRoute:function(a,b){return this._stateToRoute.bind(a,b),this},register:function(a,b,d){return this._router.bind(a,b),this._stateHost.register(this._options.capitalizeStates?c.capitalize(a):a,d),this},_setLocalRoute:function(a){var b=this._routeToState.map(a.name,a.args);b&&this._stateHost.weakNext(b.name,b.args)},_getLocalRoute:function(){if(!this._stateHost.state())return null;var a=this._stateHost.state();return this._stateToRoute.map(a.state_name(),a.allAttr())}}})}),a.define("module:Router.RouterHistory",["module:Class","module:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{constructor:function(b){a.constructor.call(this),this._router=b,this._history=[],b.on("dispatched",function(a,b,c){this._history.push(c),this.trigger("change",c),this.trigger("insert",c)},this)},destroy:function(){this._router.off(null,null,this),a.destroy.call(this)},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this._history.length},get:function(a){return a=a||0,this._history[a]},back:function(a){if(this.count()<2)return null;for(a=a||0;a>=0&&this.count()>1;){var b=this._history.pop();this.trigger("remove",b),--a}var c=this._history.pop();return this.trigger("change",c),this._router.dispatch(c.name,c.args)}}}])}),a.define("module:States.Host",["module:Properties.Properties","module:Events.EventsMixin","module:States.State","module:Types","module:Strings","module:Classes.ClassRegistry"],function(b,c,d,e,f,g,h){return b.extend({scoped:h},[c,function(b){return{constructor:function(a){b.constructor.call(this),a=a||{},this._stateRegistry=a.stateRegistry,this._baseState=a.baseState,this._enabled=!0},initialize:function(b,c){if(!this._stateRegistry){var d=null;if(e.is_string(b)&&b.indexOf(".")>=0){var h=f.splitLast(b,".");b=h.tail,d=h.head}else d=e.is_string(b)?f.splitLast(this.cls.classname,".").head:f.splitLast(b.classname,".").head;this._stateRegistry=this._auto_destroy(new g(a.getGlobal(d)))}return this._createState(b,c).start(),this._baseState=this._baseState||this._state.cls,this},_createState:function(a,b,c){return this._stateRegistry.create(a,this,b||{},c||{})},finalize:function(){return this._state&&this._state.end(),this._state=null,this},destroy:function(){this.finalize(),b.destroy.call(this)},enable:function(){return this._enabled=!0,this},disable:function(){return this._enabled=!1,this},state:function(){return this._state},state_name:function(){return this.state().state_name()},next:function(){return this.state()?this.state().next.apply(this.state(),arguments):this.initialize.apply(this,arguments)},weakNext:function(){return this.state()?this.state().weakNext.apply(this.state(),arguments):this.initialize.apply(this,arguments)},_start:function(a){this._stateEvent(a,"before_start"),this._state=a,this.set("name",a.state_name())},_afterStart:function(a){this._stateEvent(a,"start")},_end:function(a){this._stateEvent(a,"end"),this._state=null},_afterEnd:function(a){this._stateEvent(a,"after_end")},_next:function(a){this._stateEvent(a,"next")},_afterNext:function(a){this._stateEvent(a,"after_next")},_can_transition_to:function(a){return this._enabled},_stateEvent:function(a,b){this.trigger("event",b,a.state_name(),a.description()),this.trigger(b,a.state_name(),a.description()),this.trigger(b+":"+a.state_name(),a.description())},register:function(a,b,c){e.is_string(b)||(c=b,b=null),this._stateRegistry||(this._stateRegistry=this._auto_destroy(new g(f.splitLast(this.cls.classname).head)));var h=this._baseState?f.splitLast(this._baseState.classname,".").head+"."+a:a.indexOf(".")>=0?a:null,i=(this._stateRegistry.get(b)||this._baseState||d).extend(h,c);return h||(i.classname=a),this._stateRegistry.register(f.last_after(a,"."),i),this}}}])}),a.define("module:States.State",["module:Class","module:Types","module:Strings","module:Async","module:Objs"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{_locals:[],_persistents:[],_defaults:{},_clonedDefaults:{},_white_list:null,_starting:!1,_started:!1,_stopped:!1,_transitioning:!1,__next_state:null,__suspended:0,constructor:function(c,d,f){a.constructor.call(this),this.host=c,this.transitionals=f,d=e.extend(e.extend(e.clone(this._clonedDefaults||{},-1),e.clone(this._defaults||{},1)),d),this._locals=b.is_function(this._locals)?this._locals():this._locals;for(var g={},h=0;h<this._locals.length;++h)this["_"+this._locals[h]]=d[this._locals[h]],g[this._locals[h]]=!0;for(this._persistents=b.is_function(this._persistents)?this._persistents():this._persistents,h=0;h<this._persistents.length;++h)this["_"+this._persistents[h]]=d[this._persistents[h]],g[this._locals[h]]=!0;c.suspendEvents(),this.__hostArgs={},e.iter(d,function(a,b){g[b]||(this.__hostArgs[b]=!0,c.set(b,a))},this),c.resumeEvents()},allAttr:function(){var a=e.clone(this.host.data(),1);return e.iter(this._locals,function(b){a[b]=this["_"+b]},this),e.iter(this._persistents,function(b){a[b]=this["_"+b]},this),a},state_name:function(){return c.last_after(this.cls.classname,".")},description:function(){return this.state_name()},start:function(){return this._starting?this:(this._starting=!0,this.host._start(this),this._start(),this.host&&(this.host._afterStart(this),this._started=!0),this)},end:function(){return this._stopped?this:(this._stopped=!0,this._end(),this.host._end(this),this.host._afterEnd(this),this.destroy(),this)},eventualNext:function(a,b,c){this.suspend();var d=this.next(a,b,c);return this.eventualResume(),d},next:function(a,b,c){if(!this._starting||this._stopped||this.__next_state)return null;b=b||{};for(var d=0;d<this._persistents.length;++d)this._persistents[d]in b||(b[this._persistents[d]]=this["_"+this._persistents[d]]);var e=this.host._createState(a,b,c);return this.can_transition_to(e)?(this._started||(this.host._afterStart(this),this._started=!0),this.__next_state=e,this._transitioning=!0,this._transition(),this.__suspended<=0&&this.__next(),e):(e.destroy(),null)},weakSame:function(a,b,c){var d=!0;a!==this.state_name()&&(d=!1);var f=this.allAttr();return e.iter(b,function(a,b){f[b]!==a&&(d=!1)},this),d},weakNext:function(a,b,c){return this.weakSame.apply(this,arguments)?this:this.next.apply(this,arguments)},__next:function(){var a=this.host,b=this.__next_state;a._next(b);var c=this.__hostArgs;this.end(),b.start(),a.suspendEvents(),b=a.state(),e.iter(c,function(c,d){b.__hostArgs[d]||a.unset(d)},this),a.resumeEvents(),a._afterNext(b)},_transition:function(){},suspend:function(){return this.__suspended++,this},eventualResume:function(){return d.eventually(this.resume,this),this},resume:function(){return this.__suspended--,0===this.__suspended&&!this._stopped&&this.__next_state&&this.__next(),this},can_transition_to:function(a){return this.host&&this.host._can_transition_to(a)&&this._can_transition_to(a)},_start:function(){},_end:function(){},_can_transition_to:function(a){return!b.is_array(this._white_list)||e.contains_value(this._white_list,a.state_name())}}},{_extender:{_defaults:function(a,b){return e.extend(e.clone(a,1),b)}}})}),a.define("module:States.StateRouter",["module:Class","module:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this._host=b,this._routes=[],this._states={}},registerRoute:function(a,b,c){var d={key:a,route:new RegExp("^"+a+"$"),state:b,mapping:c||[]};return this._routes.push(d),this._states[b]=d,this},readRoute:function(a){var c=this._states[a.state_name()];if(!c)return null;var d=/\(.*?\)/,e=c.key;return b.iter(c.mapping,function(b){e=e.replace(d,a["_"+b])},this),e},parseRoute:function(a){for(var b=0;b<this._routes.length;++b){var c=this._routes[b],d=c.route.exec(a);if(null!==d){for(var e={},f=0;f<c.mapping.length;++f)e[c.mapping[f]]=d[f+1];return{state:c.state,args:e}}}return null},currentRoute:function(){return this.readRoute(this._host.state())},navigateRoute:function(a){var b=this.parseRoute(a);return b&&this._host.next(b.state,b.args),this}}})})}).call(Scoped);